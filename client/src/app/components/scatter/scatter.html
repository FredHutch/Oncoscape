<script type="x-shader/x-vertex" id="vertexshader">

        attribute float size;
        attribute vec3 customColor;

        varying vec3 vColor;

        void main() {

            vColor = customColor;

            vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

            gl_PointSize = size * ( 300.0 / -mvPosition.z );

            gl_Position = projectionMatrix * mvPosition;

        }

</script>

<script type="x-shader/x-fragment" id="fragmentshader">

        uniform vec3 color;
        uniform sampler2D texture;

        varying vec3 vColor;

        void main() {

            gl_FragColor = vec4( color * vColor, 1.0 );

            gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );

            if ( gl_FragColor.a < ALPHATEST ) discard;

        }

    </script>

<os-tray content="tray-content-block">
    <section class="tray-content">
        <div class="row">
            <br />
            <br />
            <div class="col-xs-12 form-item">
                <label>Gene Set</label>
                <div class="dropdown bs-dropdown">
                    <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        {{vm.geneSet.name}}
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                        <li ng-repeat="item in vm.geneSets" ng-click="vm.geneSet=item">{{item.name}}</li>
                    </ul>
                </div>
            </div>
            <div class="col-xs-12 form-item">
                <label>Data Source</label>
                <div class="dropdown bs-dropdown">
                    <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        {{vm.source.name}}
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                        <li ng-repeat="item in vm.sources" ng-click="vm.source=item">{{item.name}}</li>
                    </ul>
                </div>
            </div>
            <div class="col-xs-12 form-item">
                <label>PCA Type</label>
                <div class="dropdown bs-dropdown">
                    <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        {{vm.pcaType.name}}
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                        <li ng-repeat="item in vm.pcaTypes" ng-click="vm.pcaType=item">{{item.name}}</li>
                    </ul>
                </div>
            </div>
            <div ng-if="vm.legendCaption.length>0" class="col-xs-12 form-item">
                <label>Patient {{vm.legendCaption}}</label>

                <div ng-repeat="item in vm.legendNodes" class="legend-bar legend-bar-button" style="border-color:{{item.color}};">{{item.name}}<span id="{{item.id}}" class="legend-count"></span>

                    <label style="float:right;padding-top:5px;" class="btn-group">
                        <button 
                        ng-click="vm.deselectColor(item)"
                        class="btn btn-xs btn-default" style="background-color:#47a8d8;color:#FFF;text-shadow: 0 1px rgba(0, 0, 0, 0.2);width:24px;margin-right:1px;"><i class="fa fa-circle-o"></i></button>
                        <button
                        ng-click="vm.selectColor(item)"
                        class="btn btn-xs btn-default" style="background-color:#47a8d8;color:#FFF;text-shadow: 0 1px rgba(0, 0, 0, 0.2);width:24px;margin-left:1px;"><i class="fa fa-dot-circle-o"></i></button>
                    </label>
                </div>
            </div>
            <div class="col-xs-12 form-item">
                <label>Patient</label>
                <button class="btn btn-default btn-no-focus" type="button" style="width:100%;font-weight: 300;" ng-click="vm.showPanelColor = true">Color Options</button>
            </div>
            <div class="col-xs-12 form-label">
                <h3>Variance</h3> PC1: {{vm.pc1}}%
                <br /> PC2: {{vm.pc2}}%
                <br /> PC3: {{vm.pc3}}%
            </div>
        </div>
    </section>
</os-tray>
<!-- Label + Chart -->
<section class="tray-content-block">
    <div style="position:absolute;top:10px;text-align:center;width:100%;">
        <h2 class="h2-tool">Principal Component Analysis</h2>
        <span class="h3-tool">{{vm.datasource.source}} {{vm.datasource.name}}</span>
        <div id="scatter-chart"></div>
    </div>
</section>
<os-color-panel ng-if="vm.showPanelColor" close="vm.showPanelColor=false"></os-color-panel>
