################################################################
## OpenCPU rApache Handler                                     #
################################################################

<IfModule mod_R.c>

        RSourceOnStartup "/usr/lib/opencpu/rapache/onstartup.R"
        MaxRequestsPerChild 200

        # Used by Apache 2.4
        <IfVersion >= 2.4>
                <Directory /usr/lib/opencpu/rapache>
                        Require all granted
                </Directory>
        </IfVersion>
        # Used by Apache 2.4
        <IfVersion >= 2.4>
                <Directory /usr/lib/opencpu/rapache>
                        Require all granted
                </Directory>
        </IfVersion>

</IfModule>

################################################################
## OpenCPU NGINX proxy port                                    #
## Note: connect from external host, change 'Require' line.    #
################################################################

Listen 8004
<VirtualHost *:8004>

        DocumentRoot /var/www/html

        <Location />
                # This assumes Apache 2.4
                # Require local
        </Location>

        <Location /cpu>
                SetHandler r-handler
                RHandler opencpu:::rapachehandler
                SetOutputFilter DEFLATE
        </Location>

        LogLevel info
        ErrorLog /var/log/opencpu/apache_error.log
        CustomLog /var/log/opencpu/apache_access.log combined

</VirtualHost>