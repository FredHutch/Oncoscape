{"version":3,"sources":["scripts/app-f94cb347bd.js"],"names":["angular","module","tray","TrayController","$timeout","vm","this","trayClass","Math","random","toString","substring","iconClass","isLocked","toggle","elTray","element","elIcon","elContent","content","addClass","removeClass","attr","unbind","mouseOver","mouseOut","change","bind","$inject","directive","restrict","templateUrl","scope","caption","controller","controllerAs","bindToController","replace","transclude","tools","ToolsController","osApi","$state","$stateParams","query","beta","then","response","data","explore","tool","datasource","go","getDataSource","disease","toolmenu","ToolMenuController","timelines","TimelinesController","osHistory","$scope","$window","$document","moment","d3","saveSelected","selectedIds","d3Bars","selectAll","map","p","__data__","id","length","addPatientSelection","optCohortMode","name","draw","isUndefined","dataProcessed","dataPatients","dataEvents","d3ScaleX","d3ScaleY","minZoom","selShow","selPatient","selEvent","selFields","optCohortModes","timescaleunit","timescales","timescale","features","feature","filters","filter","events","sorts","sort","align","zoom","brush","elChart","d3Chart","select","append","style","width","d3Axis","class","shape-rendering","stroke-width","stroke","fill","d3BarsSvg","d3BarsBackground","height","innerHeight","getPatientSelection","ids","zoomed","event","shiftKey","scale","translate","ch","rh","patients","dh","rowH","rowsVisible","rowOffset","abs","y","linear","range","domain","brushing","onBrushStart","sourceEvent","target","clear","call","onBrush","extent","lower","floor","upper","each","d","i","firstChild","classed","onBrushEnd","hRow","hChart","wChart","innerWidth","processData","bounds","nice","rows","exit","remove","enter","on","transform","selected","indexOf","e","cols","filteredEvents","PatientID","Name","fields","field","Fields","isArray","push","value","$apply","transition","color","endValue","startValue","x","round","daysToUnit","tlScale","svg","axis","orient","ticks","tickFormat","pow","behavior","processedData","patient","dead","hasOwnProperty","a","b","calcEvents","index","forEach","dateEvents","dateEvent","evt","timeFn","start","end","reduce","prev","current","patientMinMax","min","max","Infinity","status","rv","processEventData","Object","keys","v","__color","processFeatureData","processPatientData","key","val","m","mf","dateSingle","eventOrder","date","unix","eventID","endDates","startDates","sd","ed","concat","setBusy","setDataset","getTimelines","log","duration","asDays","payload","pts","eventTypes","Status","Dead","unshift","$watchGroup","$watch","onPatientSelectionChange","add","selection","resize","updateEventColor","item","survival","SurvivalController","getPatientHistoryTable","tbl","getCalculatedSurvivalCurves","r","markers","SummaryController","cytoscape","signals","_","$q","login","SubnavController","toolsClick","cohortClick","toggleFilter","PlsrController","$sce","addGeneSelection","node","toUpperCase","setSelected","xScale","yScale","xMax","yMax","d3Tooltip","deathMinFilter","deathMinValue","deathMaxFilter","deathMaxValue","survivalMinFilter","survivalMinValue","survivalMaxFilter","survivalMaxValue","geneSets","geneSet","frame","tip","getGeneSelection","mtx","rownames","setBusyMessage","getPLSR","getGeneSetNames","getSummarizedPLSRPatientAttributes","AgeDx","Survival","update","onGeneSelectionChange","setScale","vectors","genes","bv","circles","cx","cy","html","pageX","pageY","modal","url","trustAsResourceUrl","delay","lines","x1","y1","x2","y2","text","text-anchor","factors","low","Number","high","getCalculatedPLSR","loadings","loadingNames","vectorNames","maxValue","debounce","Pca3dController","THREE","animate","requestAnimationFrame","controls","toggleClass","rawData","getPCA","getCalculatedPCA2","pc1","pc2","scores","scene","Scene","camera","PerspectiveCamera","position","z","renderer","WebGLRenderingContext","WebGLRenderer","antialias","CanvasRenderer","setPixelRatio","devicePixelRatio","setSize","domElement","sphereThree","numSphere","sphereGeometry","SphereGeometry","sphereMaterial","MeshBasicMaterial","idSphere","Mesh","datum","render","OrbitControls","addEventListener","PcaController","dataset","xAxis","yAxis","d3yAxis","d3xAxis","search","getCalculatedPCA","pathways","PathwaysController","skipSave","csChart","$","ele","startBatch","deselect","endBatch","getStyle","darkblue","red","purple","green","selector","text-valign","text-halign","shape","background-color","border-width","border-color","line-color","line-style","target-arrow-shape","target-arrow-color","display","overlay-opacity","overlay-color","font-size","border-style","source-arrow-shape","source-arrow-color","markersNetwork","linkTitle","links","center","term","len","nodes","unselect","substr","result","container","elements","maxZoom","layout","fit","cyTarget","nodeType","pmid","source","osSound","beep","_beep","play","Audio","service","oncoscape","$http","$location","protocol","host","port","queryString","req","table","isDefined","encodeURIComponent","JSON","stringify","method","factory","_geneSelections","desc","_geneIndex","_patientSelections","_patientIndex","_onPatientAdd","Signal","_onPatientSelectionChange","_onGeneAdd","_onGeneSelectionChange","setGeneSelection","dispatch","getGeneSelections","difference","time","format","getGeneSelectionLast","getGeneSelectionNext","setPatientSelection","getPatientSelections","getPatientSelectionLast","getPatientSelectionSecondLast","getPatientSelectionNext","removeListeners","api","onPatientAdd","onGeneAdd","osHttp","getDataSources","_dataSources","_dataSource","setDataSource","onDataSource","userApi","onLogin","onLogout","_user","password","authenticated","token","datasets","_domains","logout","user","username","res","success","getDomains","getUser","getUserApi","_userApi","show","hide","showFilter","slideToggle","hideFilter","getTools","dataPackage","osSocket","request","cmd","getDataManifest","datasetName","durationFormat","getPatientHistoryDxAndSurvivalMinMax","getSampleDataFrame","getSampleCategorizationNames","getSampleCategorization","names","getMarkersNetwork","getDrugGeneInteractions","getCanonicalizePatientIDsInDataset","patientIds","getGeneSetGenes","getOncoprintDataSelection","matrixName","factorCount","attrs","title","sampleIDs","getCalculatedTimelines","getModuleModificationDate","getPathway","getMrnaData","entities","getCnvData","getMutationData","getOncoprint","geneSetAndPatients","patientIdsAndGenes","getGeneSetTest","getGeneSetScore","Group1","Group2","group1","group2","geneset","oncoprint","OncoprintController","displayOncoprint","msg","empty","errorMessage","parse","console","setState","processed_data","onc","Oncoprint","create","suppressRendering","when","data_gene_map","obj","gene","track_id","data_gene","Date","now","addTrack","label","removable","setRuleSet","GENETIC_ALTERATION","useSameRuleSet","setTrackData","releaseRendering","click","toggleCellPadding","setZoom","allOncoLegendBlocks","allOncoLegendLabels","j","appendChild","elControl","elInstructions","elLegend","selectedPatientIds","selectedGeneIds","geneAndPatients","config","self","getTrackId","utils","makeIdCounter","id_order","inverted_id_order","visible_id_order","visible_inverted_id_order","hidden_ids","track_groups","track_group_sort_order","sort_direction","tracks","sort_config","type","cell_padding_on","true_cell_width","cell_width","zoomed_cell_width","trigger","SET_CELL_PADDING","getCellPadding","ceil","cell_padding","getZoom","clamp","updateZoomedCellWidth","updateZoom","SET_ZOOM","increaseZoom","decreaseZoom","getFullCellWidth","getZoomedCellWidth","getCellHeight","cell_height","getTrackHeight","track_height","getTrackPadding","track_padding","getFilteredIdOrder","data_filter_fn","track_ids","getTracks","getTrackDatum","getIdOrder","getInvertedIdOrder","getVisibleIdOrder","getVisibleInvertedIdOrder","updateVisibleIdOrder","invert_array","SET_VISIBLE_ID_ORDER","setIdOrder","slice","SET_ID_ORDER","hideIds","clear_existing","showIds","getTopmostTrack","setTrackSortComparator","cmp","sort_cmp","getTrackSortComparator","getTrackSortDirection","setTrackSortDirection","dir","setTrackGroupSortOrder","order","getTrackGroupSortOrder","getTrackSortOrder","ret","getTrackGroups","group_id","setSortConfig","sortById","sortBy","identity","reverse","sortByTrack","track_id_list","cmp_list","lexicographically_ordered_cmp","id1","id2","cmp_result","_len","d1","d2","d1_undef","d2_undef","isFinite","stableSort","group","ifndef","extend","defaultTrackConfig","id_data_map","ADD_TRACK","removeTrack","track","track_group","getContainingTrackGroup","old_position","splice","REMOVE_TRACK","reference","flatten","find","grp","moveTrack","new_position","moved_tracks","MOVE_TRACK","getTrackLabel","getTrackTooltip","tooltip","setTrackTooltip","getTrackData","id_accessor","getTrackDatumIdAccessor","current_id_order","current_inverted_id_order","SET_TRACK_DATA","datum_id","getTrackDatumDataKey","datum_data_key","getTrackDatumIdKey","datum_id_key","setTrackDatumIdKey","isTrackRemovable","isTrackSortDirectionChangable","sort_direction_changable","clearData","oncoprint_events","oncoprint_utils","RuleSet","oncoprint_RuleSet","defaultOncoprintConfig","legend","hiddenOncoprintConfig","pre_track_padding","undefined","CATEGORICAL_COLOR","GRADIENT_COLOR","BAR_CHART","container_selector_string","OncoprintSVGRenderer","label_font","onc_dev","ren_dev","params","target_track_id","source_track_id","toSVG","setLegendVisible","visible","FINISHED_RENDERING","CONTENT_AREA_MOUSEENTER","CONTENT_AREA_MOUSELEAVE","OncoprintRenderer","track_cell_selections","track_cells","active_rule_set_rules","toolbar_container","label_div","label_drag_div","label_container","cell_container","cell_container_node","cell_div","legend_table","document_fragment","percent_altered_max_width","textWidth","getLabelFont","altered_data_percentage","cell_tooltip_html","content_area","LABEL_AREA_CONTAINER_CLASS","CELL_AREA_CONTAINER_CLASS","cell_column_highlight","COLUMN_HIGHLIGHT_CLASS","getCellAreaHeight","CELL_AREA_CLASS","cell_mouseover_div","calculateVisibleInterval","clipAndPositionCells","mouseMove","prev_track","prev_cell_index","prev_dom","column_highlight_timeout","highlighted_col_cells","qtip","my","at","viewport","window","classes","CELL_QTIP_CLASS","border","fixed","hover_cell","dom","finish","unhover_cell","clear_and_unhover","clearTimeout","cell","margin","mouseX","mouseY","track_cell_tops","getTrackCellTops","closest_track_dist","POSITIVE_INFINITY","closest_track","top","dist","cell_unit","cell_index","cell_id","track_cell","setTimeout","cells","hover","getTrackButtonCSSClass","stop","fadeTo","fadeOut","rule_sets","removeTrackCells","removeTrackLabels","removeTrackButtons","computeTrackCellTops","renderTrackLabels","renderTrackButtons","resizeLabelDiv","resizeCellDiv","drawCells","computeAlteredDataPercentage","renderLegend","resizeCells","LABEL_DRAGGING_CLASS","prototype","rule_set","getRuleSet","alteredData","num_altered","percent_altered","getAlteredDataPercentage","cell_ctr_rect","getBoundingClientRect","visible_interval","scrollLeft","right","left","getVisibleInterval","cellRenderTarget","document","createDocumentFragment","ready","getRuleSetId","getLabelDiv","getLabelDragDiv","getCellAreaWidth","getLabelAreaWidth","getLabelAreaHeight","div","getTrackLabelCSSSelector","render_whole_labels","label_tops","getTrackLabelTops","label_area_width","percent_altered_left","label_top","label_text","getTrackLabelCSSClass","disp_label_text","max_label_length","span","dragLabel","button_class","new_btn","imgs","descs","current_sort_setting","new_width","getCellCSSClass","getTrackCellCSSClass","drawTrackCells","fragment","cell_class","track_cell_class","bound_svg","apply","force","display_all","interval_width","interval_number","cell_x","getCellXArray","id_key","prev_interval_number","new_x","disp","new_disp","isNaN","exclude_from_legend","include_all","rendered","rule_set_id","active_rules","track_map","tr","label_header","getLegendLabel","legend_body_td","legend_div","getLegendDiv","d3SelectChildren","first_track","last_track","all_track_tops","track_tops","group_track_tops","label_area_height","drag_bounds","getRenderedTrackHeight","$label_drag_div","new_pos","moveHandler","stopPropagation","preventDefault","mouse_y","sortedIndex","mouseUpHandler","off","one","full_labels","root","offset","createElementNS","text_elt","font","weight","size","pos","cell_elt","cell_rect","cell_dim","g","appendD3SVGElement","outline_styles","trim","tagName","toLowerCase","elt","drawOncoprint","_state","split","MetadataController","colnames","dtTable","dataTable","paging","MarkersController","setPatientInfo","detail","patientHtml","setGeneInfo","tmpdata","geneHtml","signal","over","out","edges","removeAll","cyChart","selection-box-color","selection-box-border-color","selection-box-border-width","selection-box-opacity","hideEdgesOnViewport","hideLabelsOnViewport","textureOnViewport","pan","chromosomes","chromosome","grabbable","locked","selectable","edgeType","sizeBdr","sizeEle","degree","sizeLbl","subType","q","c","showPopupSelection","optGeneSets","optGeneSet","optPatientLayouts","optPatientLayout","optPatientColors","optPatientColor","optCommandModes","optCommandMode","selectColor","filterModelEdge","vals","optEdgeColors","edge","cn","edgeToggle","deselectColor","lockPatients","lockGenes","lock","unselectify","selectify","abv","all","$fields","results","reset","resizeNodes","setOptions","worker","Worker","items","getElementById","collection","patients_html","patients_resize","patients_delete","patients_insert","degrees","patients_color","patients_layout","patients_legend","legendNodes","genes_html","genes_delete","genes_insert","genes_update","edges_delete","edges_insert","counts","total","edgeCounts","edges_update","options","postMessage","createOptions","opts","mode","collections","pt","colors","f","watches","needle","neighborhood","_private","LoginController","domains","hasError","promise","landing","LandingController","o","k","versionCheck","responsive","s","dt","Api","columns","details","defaults","_constructor","settings","oApi","_fnThrottle","_resize","breakpoints","_classLogic","_resizeAuto","_detailsInit","_detailsVis","_columnsVisiblity","h","auto","minWidth","includeIn","n","offsetWidth","control","eq","className","column","header","_find","l","match","RegExp","body","hasClass","row","closest","child","isShown","inArray","cloneNode","clone","appendTo","_fnGetUniqueThs","css","overflow","insertBefore","toArray","join","version","fn","Responsive","DataTable","nTable","oInit","isPlainObject","define","amd","exports","require","jQuery","history","HistoryController","defaultContent","initViewState","diagnosisMin","diagnosisMinValue","diagnosisMax","diagnosisMaxValue","survivalMin","survivalMax","initDataTable","ext","diagnosis","parseFloat","scrollY","scrollCollapse","buttons","initEvents","exportCsv","csv","encodedUri","encodeURI","open","applyFilter","maxMin","curr","age_at_diagnosis","ageAtDiagnosis","parseInt","days_to_death","daysToDeath","help","HelpController","videos","img","HeaderController","showTools","showMenu","logoutClick","transitionTo","genesettest","GenesettestController","cohort1","cohort2","message","optCohort1","optCohort2","calculateGeneSetScore","drawHeatMap2","expressionData","highcharts","chart","marginTop","marginBottom","plotBorderWidth","categories","lineWidth","lineColor","colorAxis","minColor","maxColor","verticalAlign","symbolHeight","formatter","series","point","borderWidth","summary","analysisData","DatasourceController","footer","FooterController","DataExplorerController","dataSources","dataSource","dataDiseases","dataDisease","dataTables","dataFields","dataField","bar","bottom","showValues","valueFormat","axisLabel","axisLabelDistance","chartOptions","toolTipContentFunction","graph","xFunction","yFunction","diseases","tables","cohorts","CohortsController","selections","close","setSelection","isDragable","draggable","keypress","ctrlKey","keyCode","cohortBuilder","CohortBuilderController","chain","pluck","uniq","where","created","records","runBlock","$rootScope","$exceptionHandler","onerror","fileName","lineNumber","columnNumber","error","Error","$on","toState","toParams","authenticate","run","routerConfig","$stateProvider","$urlRouterProvider","state","template","otherwise","constant","in_min","in_max","out_min","out_max","$logProvider","debugEnabled","$templateCache","put"],"mappings":"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","file":"scripts/app-f94cb347bd.js","sourcesContent":["(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape', [\n            'ngAnimate',\n            'ngCookies',\n            'ngTouch',\n            'ngSanitize',\n            'ngMessages',\n            'ngAria',\n            'ngResource',\n            'ui.router',\n            'ui.bootstrap',\n            'ui-rangeSlider',\n            'ui.bootstrap.contextMenu',\n            'nvd3',\n            'toastr'\n        ]);\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osTray', tray);\n\n    /** @ngInject */\n    function tray() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/tray/tray.html',\n            scope: {\n                caption: '@',\n                content: '@',\n                change: '&'\n\n            },\n            controller: TrayController,\n            controllerAs: 'vm',\n            bindToController: true,\n            replace: true,\n            transclude: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function TrayController($timeout) {\n\n\n            var vm = this;\n            vm.trayClass = Math.random().toString(36).substring(3);\n            vm.iconClass = Math.random().toString(36).substring(3);\n            \n\n            var isLocked = true;\n            vm.toggle = function(){\n                var elTray = angular.element(\".\"+vm.trayClass);\n                var elIcon = angular.element(\".\"+vm.iconClass);\n                var elContent = angular.element(\".\"+vm.content);\n\n                isLocked = !isLocked;\n                elIcon\n                    .addClass(isLocked ? 'fa-lock' : 'fa-unlock-alt')\n                    .removeClass(isLocked ? 'fa-unlock-alt' : 'fa-lock');\n\n                elTray.attr(\"locked\", isLocked ? \"true\" : \"false\");\n\n                if (isLocked) {\n                    elContent\n                        .removeClass(\"tray-content-block-collapsed\");\n                    elTray\n                        .unbind(\"mouseover\", mouseOver)\n                        .unbind(\"mouseout\", mouseOut)\n                        .removeClass(\"tray-collapsed\");\n                    $timeout(function(){\n                        vm.change();\n                    });\n                        \n                } else {\n                    elContent\n                        .addClass(\"tray-content-block-collapsed\");\n                    elTray\n                        .addClass(\"tray-collapsed\")\n                        .bind(\"mouseover\", mouseOver)\n                        .bind(\"mouseout\", mouseOut);\n                    $timeout(function(){\n                        vm.change();\n                    });\n                }\n            };\n\n            \n\n            var mouseOver = function(){\n                angular.element(\".\"+vm.trayClass)\n                    .removeClass(\"tray-collapsed\");\n            }\n            var mouseOut = function(){\n                angular.element(\".\"+vm.trayClass)\n                    .addClass(\"tray-collapsed\");\n            }\n        }\n    }\n\n})();\n\n\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osTools', tools);\n\n    /** @ngInject */\n    function tools() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/tools/tools.html',\n            controller: ToolsController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function ToolsController(osApi, $state, $stateParams) {\n\n            var vm = this;\n            osApi.query(\"lookup_oncoscape_tools\",{beta:false}).then(function(response){\n                vm.tools = response.data;\n            });\n\n            vm.explore = function(tool, datasource) {\n                $state.go(tool, {\n                    datasource: osApi.getDataSource().disease\n                });\n            };\n        }\n    }\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osToolMenu', toolmenu);\n\n    /** @ngInject */\n    function toolmenu() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/toolmenu/toolmenu.html',\n            controller: ToolMenuController,\n            controllerAs: 'vm',\n            scope:{\n                datasource: '@',\n                change: '&'\n            },\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function ToolMenuController(osApi, $state) {\n\n      \n            var mouseOver = function(){\n                angular.element(\".tool-menu\")\n                    .removeClass(\"tray-collapsed-left\");\n            }\n\n            var mouseOut = function(){\n                angular.element(\".tool-menu\")\n                    .addClass(\"tray-collapsed-left\");\n            }\n\n            var elTray = angular.element(\".tool-menu\");\n                elTray\n                    .bind(\"mouseover\", mouseOver)\n                    .bind(\"mouseout\", mouseOut);\n            \n            var vm = this;\n            osApi.query(\"lookup_oncoscape_tools\",{beta:false}).then(function(response){\n                vm.tools = response.data;\n            });\n\n            vm.explore = function(tool) {\n                vm.change();\n                $state.go(tool, {\n                    datasource: osApi.getDataSource().disease\n                });\n            };\n        }\n    }\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osTimelines', timelines);\n\n    /** @ngInject */\n    function timelines() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/timelines/timelines.html',\n            controller: TimelinesController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function TimelinesController(osApi, osHistory, $state, $scope, $stateParams, $window, $document, moment, d3) {\n\n            if (angular.isUndefined($stateParams.datasource)) {\n                $state.go(\"datasource\");\n                return;\n            }\n\n            // Variables\n            var dataProcessed;\n            var dataPatients;\n            var dataEvents;\n            var d3ScaleX;\n            var d3ScaleY;\n            var minZoom = 0;\n\n\n            // View Model\n            var vm = this;\n                vm.selShow = false;\n                vm.selPatient;\n                vm.selEvent;\n                vm.selFields = [];\n                vm.datasource = $stateParams.datasource;\n                vm.optCohortModes;\n                vm.optCohortMode;\n                vm.timescaleunit;\n                vm.timescales;\n                vm.timescale;\n                vm.features;\n                vm.feature;\n                vm.filters;\n                vm.filter;\n                vm.events;\n                vm.sorts;\n                vm.sort;\n                vm.align;\n                vm.optCohortModes = [{name:\"Highlight\"},{name:\"Filter\"}];\n                vm.optCohortMode = vm.optCohortModes[0];\n          \n            // Elements\n            var elChart = angular.element(\"#timelines-chart\");\n            var d3Chart = d3.select(\"#timelines-chart\").append(\"svg\")\n                .attr(\"id\", \"chart\")\n                .style({width:'100%'});\n            var d3Axis = d3Chart.append(\"g\")\n                .attr({\"class\":\"axis\"})\n                .style({'shape-rendering': 'crispEdges',\"stroke-width\": \"1.0\", \"stroke\": \"#000\",\"fill\": \"none\"});\n            var d3BarsSvg = d3Chart.append(\"svg\")  // Used To Clip Overflow\n                .attr({\"class\":\"bars-svg\"});\n            var d3BarsBackground = d3BarsSvg.append(\"rect\") // Serves As Hit Area For Zoom\n                .attr({\"width\": elChart.width(), \"height\": $window.innerHeight - 75 - 10 - 130-50 })\n                .style({fill:\"#FFFFFF\"}); //,\"cursor\": \"move\" });\n            var d3Bars = d3BarsSvg.append(\"g\")\n                .attr({\"class\":\"bars\"});  // Container For Bars\n\n            // History Integration\n            var selectedIds = (osHistory.getPatientSelection() == null) ? null : osHistory.getPatientSelection().ids;\n            function saveSelected() {\n                selectedIds = d3Bars.selectAll(\".timeline-selected\")[0].map( function (p) { return p.__data__.id; }  )\n                if (selectedIds.length==0) selectedIds = d3Bars.selectAll()[0].map( function (p) { return p.__data__.id; }  )\n                osHistory.addPatientSelection(\"Timelines\", \"Manual Selection\",\n                    selectedIds\n                );\n                if (vm.optCohortMode.name==\"Filter\") draw();\n            }\n\n            var zoom;\n            var zoomed = function(){\n                if (d3.event.shiftKey) return;\n\n                var scale = minZoom * d3.event.scale;\n                if (scale<minZoom) scale = minZoom;\n                var translate= d3.event.translate[1];\n\n                var ch = $window.innerHeight - 75 - 10 - 130- 50;\n                var rh = (dataProcessed.patients.length*20) * scale;\n                var dh = ch - rh;   // Delta height - Used For Offset\n\n                if (translate>0) translate=0;\n                if (translate<dh) translate=dh;\n\n                zoom.translate([d3.event.translate[0],translate]);\n                var rowH = (20 * scale);\n                var rowsVisible = (ch / rowH);\n                var rowOffset = Math.abs(translate / rowH);\n                  brush.y(d3.scale.linear().range([0,ch]).domain([rowOffset, rowOffset+rowsVisible]))\n\n                \n                d3Bars.attr(\"transform\",\"translate(1,\"+translate+\")scale(1,\" + scale + \")\");\n            };\n\n            var brush;\n            var brushing = false;\n            var onBrushStart = function(){\n                if (!d3.event.sourceEvent.shiftKey) {\n                    d3.event.target.clear();\n                    d3.select(this).call(d3.event.target);\n                }else{\n                    brushing = true;\n                }\n            }\n            var onBrush = function(){\n                if (!brushing) return;\n                var extent = brush.extent();\n                var lower = Math.floor(extent[0][1]);\n                var upper = Math.floor(extent[1][1]);\n                d3Bars.selectAll(\"g.timeline\")\n                    .each( function(d, i){\n                        d3.select(this.firstChild).classed(\"timeline-selected\", (i>=lower && i<=upper) );\n                    });\n            }\n            var onBrushEnd = function(){\n                if (!brushing) return;\n                brushing = false;\n                d3.event.target.clear();\n                d3.select(this).call(d3.event.target);    \n                saveSelected();\n            }\n\n\n            var draw = function(){\n\n                // Helpers\n                var hRow = 20;\n                var hChart = $window.innerHeight - 75 - 10 - 130;\n                var wChart = $window.innerWidth - 300;\n                if (wChart > 760)  wChart -= 140;\n                if (angular.element(\".tray-right\").attr(\"locked\")==\"false\"){\n                    wChart += 300;\n                } \n                \n                dataProcessed = processData(dataPatients, vm.align, vm.sort);\n                d3ScaleX = d3.scale.linear().domain( dataProcessed.bounds ).range([10, wChart-10]).nice();\n                d3ScaleY = d3.scale.linear().domain([0, dataProcessed.patients.length]).range(0,hChart-50).nice();\n                minZoom = (hChart-50) / (dataProcessed.patients.length * 20)\n                \n                // Chart\n                d3Chart.attr( {'height': hChart+\"px\"})\n                d3BarsSvg.attr( {'height' : (hChart-50)+\"px\", 'width':wChart+\"px\"} );\n                d3BarsBackground.attr( {'height' : (hChart-50)+\"px\", 'width':wChart+\"px\"} );\n                d3Bars.attr(\"transform\",\"scale(1,\" + minZoom + \")\");\n\n                // Rows\n                var rows = d3Bars.selectAll(\"g.timeline\").data( dataProcessed.patients );\n                    rows.exit().remove();\n                    rows.enter().append(\"g\").attr({ 'class' : 'timeline' })\n                        .on(\"mousedown\", function(){\n                            if (!d3.event.shiftKey) d3Bars.selectAll(\".timeline-selected\").classed(\"timeline-selected\", false);\n                        })\n                        \n                    // rows\n                        .attr({\n                            'width': wChart,\n                            'height': hRow,\n                            'transform': function(d, i) { return \"translate(0,\" +  (i * hRow)+ \")\"; }\n                        })\n                        .append(\"rect\")\n                        .attr({\n                            'class': 'timeline-row',\n                            'width': 0,\n                            'height': hRow\n                        });\n\n\n                    if (vm.optCohortMode.name==\"Highlight\" && selectedIds.length>0){\n                        rows\n                            .each( function(d){\n                                var selected = (selectedIds.indexOf(d.id)>=0);\n                                var e = d3.select(this.firstChild);\n                                e.classed(\"timeline-selected\", selected );\n                        });\n                    }else{\n                        rows\n                            .each( function(){\n                                var e = d3.select(this.firstChild);\n                                e.classed(\"timeline-selected\", false );\n                        });\n                    }\n\n                // Columns\n                var cols = rows.selectAll(\"rect.event\").data( function(d) { return d.filteredEvents; });\n                    cols.exit().remove();\n                    cols.enter().append(\"rect\").attr({'class':'event'})\n                        .on(\"mouseover\", function(){\n                                var event = dataEvents[this.__data__.id];\n                                vm.selPatient = event.PatientID;\n                                vm.selEvent = event.Name;\n                                var fields = [];\n                                for(var field in event.Fields) {\n                                    if (event.Fields[field]!=null){\n                                        if ( field==\"date\" && angular.isArray(event.Fields[field]) ){\n                                            fields.push( {name:\"Start Date\", value:event.Fields[field][0] })\n                                            fields.push( {name:\"End Start\", value:event.Fields[field][1] })\n                                        }else{\n                                            fields.push(\n                                                {name:field, value:event.Fields[field]}\n                                            );\n                                        }\n                                    }\n                                }\n                                vm.selShow = true;\n                                vm.selFields = fields;\n                                $scope.$apply();\n                            })\n                            .on(\"mouseout\", function(){\n                                vm.selShow = false;\n                                $scope.$apply();\n                            });\n                    cols.transition()\n                        .style({'fill':function(d){ return d.color; }})\n                        .attr({\n                            'height':function(d){ return (d.name == \"Radiation\" || d.name==\"Drug\") ? hRow/2 : hRow; },\n                            'width':function(d){ return (d.endValue==null) ? 3 : (d3ScaleX(d.endValue) - d3ScaleX(d.startValue)); },\n                            'x': function(d) { return Math.round(d3ScaleX(d.startValue)); },\n                            'y': function(d) { return ((d.name == \"Radiation\") ? hRow/2 : 0); }\n                        });\n\n                    var daysToUnit = function(d){\n                        if (Math.abs(d)==0) return d;\n                        if (Math.abs(d)<30) return d+\" Days\";\n                        if (Math.abs(d)<360) return Math.round( (d/30.4) * 10 ) / 10 + \" Months\";\n                        return Math.round( (d/365) * 10 ) / 10 + \" Years\";\n                    }\n                    var tlScale = d3.svg.axis()\n                        .scale(d3ScaleX)\n                        .orient(\"bottom\")\n                        .ticks(8);\n\n                    if (vm.timescale.name=='Log'){\n                        tlScale = tlScale.tickFormat(function (d) { \n                            return daysToUnit(Math.round((d<0 ? -1 : 1) * (Math.pow(2, (Math.abs(d)))-1) *100)/100);\n                        });\n                    }else{\n                        tlScale = tlScale.tickFormat(function (d) {\n                            return daysToUnit(d);\n                        });\n                    }\n\n                // Brush\n                brush = d3.svg.brush()\n                    .x(d3ScaleX)\n                    .y(d3.scale.linear().range([0,hChart]).domain([0, dataProcessed.patients.length]))\n                    .on(\"brush\", onBrush)\n                    .on(\"brushstart\", onBrushStart)\n                    .on(\"brushend\", onBrushEnd);\n                d3BarsBackground.call(brush);\n\n                // Clear Selections On MouseDown\n                d3BarsBackground.on(\"mousedown\", function(){\n                    if (!d3.event.shiftKey) d3Bars.selectAll(\".timeline-selected\").classed(\"timeline-selected\", false);\n                });\n\n                // Zoom\n                zoom = d3.behavior.zoom()\n                    .x( d3ScaleX )\n                    .y( d3ScaleY )\n                    .translate([0,0])\n                    .scale(1, minZoom )\n                    .on(\"zoom\", zoomed);\n                d3BarsBackground.call(zoom);\n\n\n                // Axis\n                d3Axis.attr({\n                    \"class\": \"timeline-axis\",\n                    \"width\": 100,\n                    transform: function() { return \"translate(0,\" +  (hChart-50) + \")\"; }\n                });\n                d3Axis.call( tlScale );\n                \n            };\n\n\n\n            // Populates ProcessedData Object With Values Consistant With ViewState\n            var processData = function (data, align, sort){\n\n                    var processedData = {};\n\n                    // Store List Of Active Events\n                    processedData.events = vm.events.filter( function(events) { return events.selected; });\n\n                    // Remove Patients That Don't Have Align Property + Possibly !Selected\n                    processedData.patients = data.filter(function(patient){\n                        if (vm.filter.name==\"Only Alive\" && patient.dead) return false;\n                        if (vm.filter.name==\"Only Dead\" && !patient.dead) return false;\n                        if (!patient.hasOwnProperty(\"__\"+this.align)) return false;\n                        if (this.filter && this.ids){\n                            if (this.ids.indexOf(patient.id)==-1) return false;\n                        }\n                        return true;\n\n                    }, {'align':align.name, 'filter':(vm.optCohortMode.name==\"Filter\"), 'ids':selectedIds});\n\n                    // Sort Patients On Align Property    \n                    if (sort.name==\"Survival\"){\n                        processedData.patients = processedData.patients.sort(function(a,b){\n                            if (a.dead==b.dead){\n                                return (a.calcEvents[sort.index].value>b.calcEvents[sort.index].value) ? 1 : -1;\n                            }else{\n                                return (a.dead) ? 1 : -1;\n                            }\n                            \n                        }, sort);\n                    }else{\n                        processedData.patients = processedData.patients.sort(function(a,b){\n                            return (a.calcEvents[sort.index].value>b.calcEvents[sort.index].value) ? 1 : -1;\n                        }, sort);\n                    }\n\n\n                    // Adjust Start + End Dates To Align Property\n                    processedData.patients.forEach(function(patient){\n\n                        patient.filteredEvents = patient.dateEvents.filter(function(dateEvent){\n                            for (var i=0; i<this.length; i++){\n                                if (this[i].name==dateEvent.name) return true;\n                            }\n                            return false;\n                        }, processedData.events);\n\n                        patient.filteredEvents.forEach(function(evt){\n                            evt.startValue = vm.timescale.timeFn(evt.start + this);\n                            evt.endValue = (evt.end!=null) ? vm.timescale.timeFn(evt.end + this) : null;\n                        }, -patient[\"__\"+this[\"align\"].name].start)\n\n                    }, {\"align\":align, \"events\":processedData.events});\n\n                    // Calculate Event Bounds Min, Max\n                    processedData.bounds = processedData.patients.reduce( function( prev, current ) {\n                        // Min Max For Individual Patients\n                        var patientMinMax = current.filteredEvents.reduce(function( prev, current ) {\n                            \n                            return [\n                                Math.min(current.startValue, prev[0]),\n                                Math.max((current.endValue==null) ? current.startValue : current.endValue, prev[1])\n                            ]\n\n                        }, [Infinity, -Infinity]);\n                        \n                        return [\n                            Math.min(patientMinMax[0], prev[0]),\n                            Math.max(patientMinMax[1], prev[1])\n                        ]   \n                    }, [Infinity, -Infinity] );\n                    return processedData;\n            };\n\n\n\n            // Initialize\n            (function(){\n\n                var color = function(d){\n                    var status = d.name;\n                    var rv = \n                        (status===\"Birth\") ?  \"#17becf\" : \n                        (status===\"Diagnosis\") ? \"#8c564b\" :\n                        (status===\"Pathology\") ? \"#7f7f7f\" :\n                        (status===\"Progression\") ? \"#1f77b4\" :\n                        (status===\"Absent\") ? \"#000000\" :\n                        (status===\"Status\") ? \"#bcbd22\" :\n                        (status===\"Radiation\") ? \"#e7969c\" :\n                        (status===\"Procedure\") ? \"#ff7f0e\" :\n                        (status===\"Encounter\") ? \"#d62728\" :\n                        (status===\"Drug\") ? \"#9467bd\" :\n                        \"black\";\n                        return rv;\n                };   \n\n                // Data Clean Up Functions\n                var processEventData = function(events){\n                    return Object.keys(events).map(function(v) {\n                            var rv =  { \"name\": v, \"selected\": true };\n                            rv.color = rv.__color = color(rv);\n                            return rv;\n                    });\n                };\n\n                var processFeatureData = function(patients){\n                    return patients[0].calcEvents.map(function(d, i) {\n                        return { \"name\": d.name, \"index\": i }\n                    });\n                };\n\n                var processPatientData = function(patients, dead){\n\n                    patients = Object.keys(patients).map(function(key) {\n                        var val = patients[key];\n                        val.id = key;\n                        return val;\n                    });\n                    for (var i = 0; i < patients.length; i++) {\n\n                        // Create References For Faster Subsequent Lookups\n                        var p = patients[i];\n                        var m = moment;\n                        var mf = \"YYYY-MM-DD\";\n\n\n                        // Map Start Dates\n                        var dateSingle =\n                            p.dateEvents\n                            .filter(function(d) {\n                                return d.eventOrder === 'single'\n                            })\n                            .map(function(d) {\n                                return {\n                                    \"start\": m(d.date, mf).unix(),\n                                    \"end\": null,\n                                    \"name\": d.name, \n                                    \"id\":d.eventID\n                                };\n                            });\n\n                        // Map Start + End Dates\n                        var endDates = p.dateEvents\n                            .filter(function(d) { return d.eventOrder==='end'; })\n                            .map(function(d){ return {\"end\":m(d.date, mf).unix(), \"id\":d.eventID}; });\n                        var startDates = p.dateEvents\n                            .filter(function(d) { return d.eventOrder==='start'; })\n                            .map(function(d){ return {\"start\":m(d.date, mf).unix(),\"name\":d.name, \"id\":d.eventID}; });\n                        startDates\n                            .forEach(function(sd){ sd.end = endDates\n                                .filter(function(ed) { return ed.id==sd.id} )[0].end });\n\n                        // Join Single + Multiple Date Events\n                        p.dateEvents = (startDates.length>0) ? startDates.concat(dateSingle) : dateSingle;\n                        p.dateEvents.forEach(function(d){\n                            d.color = color(d);\n                            p[\"__\"+d.name] = d;\n                            if (d.name==\"Status\"){\n                                p.dead = (dead.indexOf(d.id)!=-1);\n                            }\n                            \n                         });\n                    }\n                    return patients;\n                };\n\n                osApi.setBusy(true)(\"Loading Dataset\");\n                osApi.setDataset(vm.datasource).then(function() {\n                    osApi.getTimelines().then(function(response) {\n\n                        // TimeScales\n                        vm.timescales = [\n                            {name:'Log', \n                                timeFn: function(val){\n                                    return (val<0 ? -1 : 1) * Math.log(Math.abs((val*1000)/86400000)+1)/Math.log(2)\n                            }},\n                            {name:'Linear', \n                                timeFn: function(val){\n                                    return moment.duration(val*1000).asDays()\n                            }}\n                        ];\n                        vm.timescale = vm.timescales[0];\n\n                        // Clean Data + Set Default VM\n                        dataPatients = processPatientData(response.payload.pts, response.payload.eventTypes.Status.status.Dead);\n                        dataEvents = response.payload.events;\n                        vm.sorts = processFeatureData(dataPatients);\n                        \n                        vm.filters = [\n                            {name:'Alive + Dead'},\n                            {name:'Only Alive'},\n                            {name:'Only Dead'}\n                        ];\n                        vm.filter = vm.filters[0];\n\n\n                        var features = processFeatureData(dataPatients);\n                        features.unshift({index:-1, name:'None'});\n                        vm.features =  features;\n                        vm.feature = vm.features[0];\n                        vm.events = processEventData(response.payload.eventTypes);\n\n                        // Set Defaults Align By Drug, Order By Survial, Hide Birth\n                        vm.sort = vm.sorts[1];\n                        vm.events.forEach(function(e){\n                            if (e.name==\"Birth\") { e.selected = false; e.color = \"#FEFEFE\"; }\n                            if (e.name==\"Diagnosis\") this.align = e;\n                        }, vm);\n\n                        // Register Watch\n                        $scope.$watchGroup(['vm.feature', 'vm.sort', 'vm.align', 'vm.timescale', 'vm.filter'], draw);\n                        angular.element($window).bind('resize', draw);\n                        $scope.$watch(\"vm.optCohortMode\", draw );   // Triggers Inital Draw\n\n                        // History\n                        osHistory.onPatientSelectionChange.add(function(selection) {\n                            selectedIds = selection.ids;\n                            draw();\n                        });\n                        osApi.setBusy(false);\n                    });\n                });\n            })();\n\n\n            // Event Handlers\n            vm.resize = function(){\n                draw();\n            }\n            vm.updateEventColor = function(item){\n                item.selected = !item.selected;\n                item.color = (item.selected) ? item.__color : \"#FEFEFE\";\n                draw();\n            }\n\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osSurvival', survival);\n\n    /** @ngInject */\n    function survival() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/survival/survival.html',\n            controller: SurvivalController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function SurvivalController(osApi, osHistory, $state, $timeout, $scope, $stateParams) {\n\n            if (angular.isUndefined($stateParams.datasource)){\n                $state.go(\"datasource\");\n                return;\n            }\n\n\n            // View Model\n            var vm = this;\n            vm.datasource = $stateParams.datasource;\n\n            // Set Dataset \n            osApi.setBusy(true);\n            osApi.setDataset(vm.datasource).then(function() {\n                // If No Patients Are Selected, Fetch All Patients\n                if (osHistory.getPatientSelection()==null){\n                    osApi.getPatientHistoryTable(vm.datasource).then(function(response) {\n                        draw(response.payload.tbl.map( function (d) { return d[0]; }));\n                    });\n                }else{\n                    draw(osHistory.getPatientSelection().ids);\n                }\n            });\n\n            // Register History Component\n            osHistory.onPatientSelectionChange.add(function(selection){\n                draw(selection.ids)\n            });\n\n            // Draw\n            var draw = function(ids){\n                osApi.setBusy(true);\n                osApi.getCalculatedSurvivalCurves(ids, \"\").then(function(r){\n                    angular.element(\"#survival-img\").attr('src',r.payload);\n                    osApi.setBusy(false);\n                });\n            }\n        }\n    }\n})();\n\n(function() {\n    //'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osSummary', markers);\n\n    /** @ngInject */\n    function markers() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/summary/summary.html',\n            scope: {},\n            controller: SummaryController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function SummaryController(osApi, osHistory, $state, $timeout, $scope, $stateParams, cytoscape, signals, moment, $window, _, $q) {\n\n        }\n    }\n})();\n\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osSubnav', login);\n\n\n    /** @ngInject */\n    function login() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/subnav/subnav.html',\n            replace: true,\n            controller: SubnavController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function SubnavController(osApi, $state) {\n            \n            var vm = this;\n            vm.tool = \"Pathways\";\n            vm.filter = \"DemoDZ\";\n\n            vm.toolsClick = function(){\n                $state.go(\"tools\", {\n                    datasource: vm.datasource\n                });\n            };\n            \n            vm.cohortClick = function() {\n                osApi.toggleFilter();\n            };\n        }\n    }\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osPlsr', explore);\n\n    /** @ngInject */\n    function explore() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/plsr/plsr.html',\n            controller: PlsrController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function PlsrController(osApi, osHistory, $state, $stateParams, $timeout, $scope, d3, moment, $sce, $window, _) {\n\n            if (angular.isUndefined($stateParams.datasource)){\n                $state.go(\"datasource\");\n                return;\n            }\n\n            // Elements\n            var d3Chart = d3.select(\"#plsr-chart\").append(\"svg\").attr(\"id\", \"chart\");\n            var d3Tooltip = d3.select(\"body\").append(\"div\").attr(\"class\", \"tooltip plsr-tooltip\")\n\n            // Properties\n            var width, height, xScale, yScale, xMax, yMax, brush;\n\n            // View Model\n            var vm = this;\n            vm.datasource = $stateParams.datasource;\n            vm.deathMinFilter = vm.deathMinValue = 45;\n            vm.deathMaxFilter = vm.deathMaxValue = 66;\n            vm.survivalMinFilter = vm.survivalMinValue = 3;\n            vm.survivalMaxFilter = vm.survivalMaxValue = 7;\n            vm.geneSets = [];\n            vm.geneSet = null;            \n            vm.frame;\n            vm.tip = null;\n\n            // History Integration\n            var selectedIds = (osHistory.getGeneSelection() == null) ? [] : osHistory.getGeneSelection().ids;\n            function saveSelected() {\n                var selected  = d3Chart.selectAll(\".plsr-node-selected\")[0];\n                if (selected.length==0) return;\n                osHistory.addGeneSelection(\"PLSR\", \"Manual Selection\",\n                    d3Chart.selectAll(\".plsr-node-selected\")[0].map(function(node){ \n                        return node.__data__.name.toUpperCase()\n                    })\n                );\n            }\n            function setSelected() {\n                if (selectedIds.length == 0) {\n                    d3Chart.selectAll(\".plsr-node-selected\").classed(\"plsr-node-selected\", false);\n                } else {\n                    d3Chart.selectAll(\"circle\").classed(\"plsr-node-selected\", function() {\n                        return (selectedIds.indexOf(this.__data__.name) >= 0)\n                    });\n                }\n            }\n\n            // Initialize\n            osApi.setBusy(true)(\"Loading Dataset\");\n            osApi.setDataset(vm.datasource).then(function(response) {\n                var mtx = response.payload.rownames.filter(function(v) {\n                    return v.indexOf(\"mtx.mrna\") >= 0\n                });\n                mtx = mtx[mtx.length - 1].replace(\".RData\", \"\");\n                osApi.setBusyMessage(\"Creating PLSR Matrix\");\n                osApi.getPLSR(vm.datasource, mtx).then(function() {\n                    osApi.setBusyMessage(\"Loading Gene Sets\");\n                    osApi.getGeneSetNames().then(function(response) {\n\n                        // Load Gene Sets\n                        vm.geneSets = response.payload;\n                        vm.geneSet = vm.geneSets[0];\n                        osApi.setBusyMessage(\"Loading Patients\");\n                        osApi.getSummarizedPLSRPatientAttributes().then(function(response) {\n\n                            // Load Min Max Values\n                            var payload = response.payload;\n                            vm.deathMinValue = Math.floor(payload.AgeDx[0] / 365.24);\n                            vm.deathMaxValue = Math.floor(payload.AgeDx[4] / 365.24);\n                            vm.survivalMinValue = Math.floor(payload.Survival[0] / 365.24);\n                            vm.survivalMaxValue = Math.floor(payload.Survival[4] / 365.24);\n                            $scope.$watch('vm.geneSet', function() {\n                                vm.update();\n                            });\n\n                            // History\n                            osHistory.onGeneSelectionChange.add(function(selection) {\n                                selectedIds = selection.ids;\n                                setSelected();\n                            });\n                        });\n                    });\n                });\n            });\n\n\n            // API Call To Calculate PLSR\n            vm.update = function() {\n                osApi.setBusyMessage(\"Calculating PLSR\");\n                \n                var factors = [{\n                    name: \"Survival\",\n                    low: Number(vm.survivalMinFilter) * 365.24,\n                    high: Number(vm.survivalMaxFilter) * 365.24\n                }, {\n                    name: \"AgeDx\",\n                    low: Number(vm.deathMinFilter) * 365.24,\n                    high: Number(vm.deathMaxFilter) * 365.24\n                }];\n\n                osApi.getCalculatedPLSR(vm.geneSet, factors).then(function(response) {\n                    osApi.setBusyMessage(\"Rendering PLSR\");\n\n                    // Clean Up Data\n                    var payload = response.payload;\n                    var genes = payload.loadings.map(function(item, index) {\n                        item.name = this[index];\n                        return item;\n                    }, payload.loadingNames);\n                    var vectors = payload.vectors.map(function(item, index) {\n                        item.name = this[index];\n                        return item;\n                    }, payload.vectorNames);\n                    var abs = payload.maxValue * 1.2;\n                    draw(abs, vectors, genes);\n                    osApi.setBusy(false);\n                });\n\n                function setScale() {\n                    width = $window.innerWidth - 400; \n                    if (angular.element(\".tray-right\").attr(\"locked\")==\"false\"){\n                        width += 300;\n                    } \n                    height = $window.innerHeight - 190;\n                    if (angular.element(\".tray\").attr(\"locked\")==\"true\") width -= 300;\n\n                    d3Chart\n                        .attr(\"width\", '100%')\n                        .attr(\"height\", height);\n                    xScale = d3.scale.linear()\n                        .domain([-xMax, xMax])\n                        .range([0, width]).nice();\n\n                    yScale = d3.scale.linear()\n                        .domain([-yMax, yMax])\n                        .range([height, 0]).nice();\n                }\n\n                // Render\n                function draw(abs, vectors, genes) {\n\n                    xMax = abs * .9;\n                    yMax = abs * .9;\n                    setScale();\n\n                    // Brush\n                    brush = d3.svg.brush()\n                        .x(xScale)\n                        .y(yScale)\n                        .on(\"brushend\", function() {\n                            var bv = brush.extent();\n                            d3Chart.selectAll(\"circle\")\n                                .classed(\"plsr-node-selected\", function(d) {\n                                    return (d[0] > bv[0][0] && d[0] < bv[1][0] && d[1] > bv[0][1] && d[1] < bv[1][1]);\n                                });\n                            d3.select(this).transition().duration(300)\n                                .call(brush.extent([\n                                    [0, 0],\n                                    [0, 0]\n                                ]));\n                            saveSelected();\n                        });\n\n                    d3Chart.call(brush);\n\n                    // Circles\n                    var circles = d3Chart.selectAll(\"circle\").data(genes, function(d) { return d; });\n                    circles.enter()\n                        .append(\"circle\")\n                        .attr({\n                            \"class\": \"plsr-node\",\n                            \"cx\":  width * .5,\n                            \"cy\": height * .5,\n                            \"r\": 3\n                        })\n                        .style(\"fill-opacity\", \"0\")\n                        .on(\"mouseover\", function(d) {\n                            d3Tooltip.transition()        \n                                .duration(200)      \n                                .style(\"opacity\", 1);      \n                            d3Tooltip.html(d.name)  \n                                .style(\"left\", (d3.event.pageX+15) + \"px\")     \n                                .style(\"top\", (d3.event.pageY-15) + \"px\"); \n                        })\n                        .on(\"mouseout\", function() {\n                            d3Tooltip.transition()      \n                                .duration(500)      \n                                .style(\"opacity\", 0); \n                        })\n                        .on(\"click\", function(d) {\n                            angular.element('#plsr-webpage').modal();\n                            var url = \"https://www.genecards.org/cgi-bin/carddisp.pl?gene=\" + d.name;\n                            $scope.$apply(function() {\n                                vm.frame = $sce.trustAsResourceUrl(url);\n                            });\n                        });\n                    circles.transition()\n                        .duration(750)\n                        .delay(function(d, i) {\n                            return i / 300 * 500;\n                        })\n                        .attr(\"cx\", function(d) {\n                            return xScale(d[0]);\n                        })\n                        .attr(\"cy\", function(d) {\n                            return yScale(d[1]);\n                        })\n                        .style(\"fill-opacity\", 1);\n\n                     circles.exit()\n                        .transition()\n                        .duration(600)\n                        .delay(function(d, i) {\n                            return i / 300 * 500;\n                        })\n                        .attr(\"cx\", width * .5)\n                        .attr(\"cy\", height * .5)\n                        .style(\"fill-opacity\", \"0\")\n                        .remove();\n\n                    // Lines\n                    var lines = d3Chart.selectAll(\"line\").data(vectors)\n                    lines.enter()\n                        .append(\"line\")\n                        .attr({\n                            \"class\": \"line\",\n                            \"stroke-width\": 3,\n                            \"x1\": xScale(0),\n                            \"y1\": yScale(0),\n                            \"x2\": xScale(0),\n                            \"y2\": yScale(0)\n                        })\n                        .style(\"stroke\", function(d) {\n                            return (d.name.indexOf(\"Age\")) ? \"#1396de\" : \"#38347b\"\n                        });\n                    lines.transition()\n                        .duration(900)\n                        .attr({\n                            \"x1\": xScale(0),\n                            \"y1\": yScale(0),\n                            \"x2\": function(v) { return xScale(v[0]); },\n                            \"y2\": function(v) { return yScale(v[1]); }\n                        });\n                    lines.exit().remove();\n\n                    // Text\n                    var text = d3Chart.selectAll(\"text\").data(vectors);\n                    text.enter()\n                        .append(\"text\")\n                        .attr({\n                            \"class\": \"text\",\n                            \"x\": width * .5,\n                            \"y\": height * .5,\n                            \"text-anchor\": function(v) { return (v[0] > 0) ? \"start\" : \"end\" }\n                        })\n                        .text(function(v) { return v.name; })\n                        .style({\n                            \"fill\": \"black\",\n                            \"text-anchor\": \"middle\"\n                        });\n\n                    text.transition()\n                        .duration(900)\n                        .attr({\n                            \"x\": function(v) { return xScale(v[0]); },\n                            \"y\": function(v) { return yScale(v[1]); }\n                        });\n\n                    text.exit().remove();\n                    setSelected();\n                }\n\n                vm.resize = function () {\n                    setScale();\n\n                    d3Chart.selectAll(\"circle\")\n                        .attr({\n                            \"cx\": function(d) { return xScale(d[0]); },\n                            \"cy\": function(d) { return yScale(d[1]); }\n                        });\n\n                    d3Chart.selectAll(\"text\")\n                       .attr({\n                            \"x\": function(v) { return xScale(v[0]); },\n                            \"y\": function(v) { return yScale(v[1]); }\n                        });\n\n                    d3Chart.selectAll(\"line\")\n                        .attr({\n                            \"x1\": xScale(0),\n                            \"y1\": yScale(0),\n                            \"x2\": function(v) { return xScale(v[0]); },\n                            \"y2\": function(v) { return yScale(v[1]); }\n                        });\n                };\n\n                // Listen For Resize\n                angular.element($window).bind('resize', \n                    _.debounce(vm.resize, 300)\n                );\n            };\n\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osPca3d', explore);\n\n    /** @ngInject */\n    function explore() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/pca3d/pca3d.html',\n            controller: Pca3dController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function Pca3dController(osApi, $state, $stateParams, $timeout, $scope, d3, THREE, $window) {\n\n            if (angular.isUndefined($stateParams.datasource)){\n                $state.go(\"datasource\");\n                return;\n            }\n\n            // State\n            var vm = this;\n            vm.datasource = $stateParams.datasource;\n            vm.geneSets = [];\n            vm.geneSet = null;\n            vm.toggleFilter = function() {\n                angular.element(\".container-filters\").toggleClass(\"container-filters-collapsed\");\n                angular.element(\".container-filter-toggle\").toggleClass(\"container-filter-toggle-collapsed\");\n            }\n            var rawData;\n\n            // Elements\n            var elChart = angular.element(\"#pca-chart\");\n\n\n            // Initalizae\n            osApi.setBusy(true)(\"Loading Dataset\");\n            osApi.setDataset(vm.datasource).then(function(response) {\n                var mtx = response.payload.rownames.filter(function(v) {\n                    return v.indexOf(\"mtx.mrna\") >= 0\n                });\n\n                mtx = mtx[mtx.length - 1].replace(\".RData\", \"\");\n                osApi.setBusyMessage(\"Creating PCA Matrix\");\n                osApi.getPCA(vm.datasource, mtx).then(function() {\n                    osApi.setBusyMessage(\"Loading Gene Sets\");\n                    osApi.getGeneSetNames().then(function(response) {\n\n                        // Load Gene Sets\n                        vm.geneSets = response.payload;\n                        vm.geneSet = vm.geneSets[0];\n                        $scope.$watch('vm.geneSet', function() {\n                            update();\n                        });\n                    });\n                });\n            });\n\n            // API Call To Calculate PCA\n            var update = function() {\n                osApi.setBusyMessage(\"Calculating PCA\");\n                osApi.getCalculatedPCA2(vm.geneSet).then(function(response) {\n                    osApi.setBusyMessage(\"Rendering PCA\");\n                    var payload = response.payload;\n                    vm.pc1 = response.payload[\"importance.PC1\"];\n                    vm.pc2 = response.payload[\"importance.PC2\"];\n                    var scores = payload.scores;\n                    var ids = payload.ids;\n                    rawData = scores.map(function(d, i){\n                        d.id = ids[i];\n                        return d;\n                    }, payload.ids);\n                    draw()\n                    osApi.setBusy(false);\n                });\n            };\n\n            var scene = new THREE.Scene();\n            var camera = new THREE.PerspectiveCamera( 50, $window.innerWidth / $window.innerHeight, 0.1, 1000 );\n            camera.position.z = 60;\n            \n            var renderer = $window.WebGLRenderingContext ? new THREE.WebGLRenderer({ antialias: true }) : new THREE.CanvasRenderer();\n            renderer.setPixelRatio( $window.devicePixelRatio );\n            renderer.setSize( $window.innerWidth, $window.innerHeight );\n            elChart.append( renderer.domElement );\n\n\n\n            var draw = function(){\n                var sphereThree = [];\n                var numSphere = rawData.length;\n                var sphereGeometry = new THREE.SphereGeometry(.1, 8, 8);\n                var sphereMaterial = new THREE.MeshBasicMaterial({color: '#59a5fb'});//rgb(255, 0, 0)'});\n                for(var idSphere = 0; idSphere < numSphere; idSphere++){\n                    sphereThree[idSphere] = new THREE.Mesh(sphereGeometry, sphereMaterial);\n                    var datum = rawData[idSphere];\n                    sphereThree[idSphere].position.x = datum[0];\n                    sphereThree[idSphere].position.y = datum[1];\n                    sphereThree[idSphere].position.z = datum[2];\n                    scene.add(sphereThree[idSphere]);\n                }\n                render();\n            }\n            \n\n            var render = function () {\n\n//                requestAnimationFrame( render );\n\n                // if( !options.fixed ) {\n                //     mesh.rotation.x += 0.005;\n                //     mesh.rotation.y += 0.005;\n                // }\n\n\n                renderer.render( scene, camera );\n\n            };\n\n            function animate() {\n\n  requestAnimationFrame( animate );\n  controls.update();\n\n}\n\n\n\n  var controls = new THREE.OrbitControls( camera );\n  controls.addEventListener( 'change', render );\n    \n        \nanimate();\n            \n\n           \n            \n\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osPca', explore);\n\n    /** @ngInject */\n    function explore() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/pca/pca.html',\n            controller: PcaController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function PcaController(osApi, osHistory, $state, $stateParams, $timeout, $scope, d3, moment, $window, _) {\n\n            if (angular.isUndefined($stateParams.datasource)) {\n                $state.go(\"datasource\");\n                return;\n            }\n\n            // Elements\n            var d3Chart = d3.select(\"#pca-chart\").append(\"svg\").attr(\"id\", \"chart\");\n            var d3xAxis = d3Chart.append(\"g\");\n            var d3yAxis = d3Chart.append(\"g\");\n            var d3Tooltip = d3.select(\"body\").append(\"div\").attr(\"class\", \"tooltip pca-tooltip\")\n\n            // Properties\n            var width, height, xScale, yScale, xMax, yMax, xAxis, yAxis;\n            var rawData;\n\n            // View Model\n            var vm = this;\n            vm.datasource = $stateParams.datasource;\n            vm.geneSets = [];\n            vm.geneSet = null;\n            vm.search = \"\";\n\n            // History Integration\n            var selectedIds = (osHistory.getPatientSelection() == null) ? [] : osHistory.getPatientSelection().ids;\n            function saveSelected() {\n                var selected = d3Chart.selectAll(\".pca-node-selected\")[0];\n                if (selected.length==0) return;\n                osHistory.addPatientSelection(\"PCA\", \"Manual Selection\",\n                    d3Chart.selectAll(\".pca-node-selected\")[0].map(function(node) {\n                        return node.__data__.id.toUpperCase();\n                    })\n                );\n            }\n            function setSelected() {\n                if (selectedIds.length==0) {\n                    d3Chart.selectAll(\".pca-node-selected\").classed(\"pca-node-selected\", false);\n                } else {\n                    d3Chart.selectAll(\"circle\").classed(\"pca-node-selected\", function() {\n                        return (selectedIds.indexOf(this.__data__.id) >= 0)\n                    });\n                }\n            }\n\n            // Initialize\n            osApi.setBusy(true)(\"Loading Dataset\");\n            osApi.setDataset(vm.datasource).then(function(response) {\n                var mtx = response.payload.rownames.filter(function(v) {\n                    return v.indexOf(\"mtx.mrna\") >= 0\n                });\n\n                mtx = mtx[0].replace(\".RData\", \"\");\n                osApi.setBusyMessage(\"Creating PCA Matrix\");\n                osApi.getPCA(vm.datasource, mtx).then(function() {\n\n                    osApi.setBusyMessage(\"Loading Gene Sets\");\n                    osApi.getGeneSetNames().then(function(response) {\n\n                        // Load Gene Sets\n                        vm.geneSets = response.payload;\n                        vm.geneSets.unshift(\"All\");\n                        vm.geneSet = vm.geneSets[0];\n\n                        $scope.$watch('vm.geneSet', function() {\n                            update();\n                        });\n\n                        // History\n                        osHistory.onPatientSelectionChange.add(function(selection) {\n                            selectedIds = selection.ids;\n                            vm.search = \"\";\n                            setSelected();\n                        });\n                    });\n                });\n            });\n\n            // API Call To Calculate PCA\n            var update = function() {\n                osApi.setBusyMessage(\"Calculating PCA\");\n                osApi.getCalculatedPCA((vm.geneSet==\"All\") ? null : vm.geneSet).then(function(response) {\n                    osApi.setBusyMessage(\"Rendering PCA\");\n                    var payload = response.payload;\n                    vm.pc1 = Math.round(response.payload[\"importance.PC1\"] * 100);\n                    vm.pc2 = Math.round(response.payload[\"importance.PC2\"] * 100);\n                    // Error Patient Ids From Server Are Different Than \n                    var scores = payload.scores;\n                    var ids = payload.ids;\n                    rawData = scores.map(function(d, i) {\n                        d.id = ids[i];\n                        return d;\n                    }, payload.ids);\n                    draw();\n                    osApi.setBusy(false);\n                });\n            };\n\n            function setScale() {\n                \n                width = $window.innerWidth - 400;\n                if (angular.element(\".tray-right\").attr(\"locked\")==\"false\"){\n                    width += 300;\n                } \n                height = $window.innerHeight - 190;\n                if (angular.element(\".tray\").attr(\"locked\") == \"true\") width -= 300;\n\n                d3Chart\n                    .attr(\"width\", '100%')\n                    .attr(\"height\", height);\n                xScale = d3.scale.linear()\n                    .domain([-xMax, xMax])\n                    .range([0, width]).nice();\n\n                yScale = d3.scale.linear()\n                    .domain([-yMax, yMax])\n                    .range([height, 0]).nice();\n            }\n\n            // Render\n            function draw() {\n\n                var dataset = rawData;\n\n                var max, min;\n                max = Math.abs(d3.max(dataset, function(d) {\n                    return +d[0];\n                }));\n                min = Math.abs(d3.min(dataset, function(d) {\n                    return +d[0];\n                }));\n                xMax = ((max > min) ? max : min) * 1.2;\n                max = Math.abs(d3.max(dataset, function(d) {\n                    return +d[1];\n                }));\n                min = Math.abs(d3.min(dataset, function(d) {\n                    return +d[1];\n                }));\n                yMax = ((max > min) ? max : min) * 1.2;\n\n                setScale();\n\n                xAxis = d3.svg.axis()\n                    .scale(xScale)\n                    .orient(\"top\")\n                    .ticks(5);\n\n                yAxis = d3.svg.axis()\n                    .scale(yScale)\n                    .orient(\"left\")\n                    .ticks(5);\n\n                // Brush\n                var brush = d3.svg.brush()\n                    .x(xScale)\n                    .y(yScale)\n                    .on(\"brushend\", function() {\n                        var bv = brush.extent();\n                        d3Chart.selectAll(\"circle\")\n                            .classed(\"pca-node-selected\", function(d) {\n                                return (d[0] > bv[0][0] && d[0] < bv[1][0] && d[1] > bv[0][1] && d[1] < bv[1][1]);\n                            });\n                        d3.select(this).transition().duration(300)\n                            .call(brush.extent([\n                                [0, 0],\n                                [0, 0]\n                            ]));\n                        saveSelected();\n                    });\n\n                d3Chart.call(brush);\n\n                var circles = d3Chart.selectAll(\"circle\").data(rawData, function(d) {\n                    return d;\n                });\n\n                circles.enter()\n                    .append(\"circle\")\n                    .attr({\n                        \"class\": \"pca-node\",\n                        \"cx\": width * .5,\n                        \"cy\": height * .5,\n                        \"r\": 3\n                    })\n                    .style(\"fill-opacity\", \"0\")\n                    .on(\"mouseover\", function(d) {\n                        d3Tooltip.transition()\n                            .duration(200)\n                            .style(\"opacity\", 1);\n                        d3Tooltip.html(d.id)\n                            .style(\"left\", (d3.event.pageX + 10) + \"px\")\n                            .style(\"top\", (d3.event.pageY - 5) + \"px\");\n                    })\n                    .on(\"mouseout\", function() {\n                        d3Tooltip.transition()\n                            .duration(500)\n                            .style(\"opacity\", 0);\n                    })\n                    .transition()\n                    .duration(750)\n                    .delay(function(d, i) {\n                        return i / 300 * 500;\n                    })\n                    .attr(\"cx\", function(d) {\n                        return xScale(d[0]);\n                    })\n                    .attr(\"cy\", function(d) {\n                        return yScale(d[1]);\n                    })\n                    .style(\"fill-opacity\", 1);\n\n                circles.exit()\n                    .transition()\n                    .duration(600)\n                    .delay(function(d, i) {\n                        return i / 300 * 500;\n                    })\n                    .attr(\"cx\", width * .5)\n                    .attr(\"cy\", height * .5)\n                    .style(\"fill-opacity\", \"0\")\n                    .remove();\n\n\n                d3yAxis\n                    .attr(\"class\", \"axis\")\n                    .attr(\"transform\", \"translate(0, \" + yScale(0) + \")\")\n                    .call(xAxis)\n                    .append(\"text\")\n                    .text(\"PC1\");\n\n                d3xAxis\n                    .attr(\"class\", \"axis\")\n                    .attr(\"transform\", \"translate(\" + xScale(0) + \", 0)\")\n                    .call(yAxis)\n                    .append(\"text\")\n                    .attr(\"y\", 10)\n                    .attr(\"dy\", \".71em\")\n                    .text(\"PC2\");\n\n                setSelected();\n            }\n\n            vm.resize = function() {\n                setScale();\n                xAxis.scale(xScale);\n                yAxis.scale(yScale);\n                d3yAxis.attr(\"transform\", \"translate(0, \" + yScale(0) + \")\").call(xAxis);\n                d3xAxis.attr(\"transform\", \"translate(\" + xScale(0) + \", 0)\").call(yAxis);\n                d3Chart.selectAll(\"circle\")\n                    .attr(\"cx\", function(d) {\n                        return xScale(d[0]);\n                    })\n                    .attr(\"cy\", function(d) {\n                        return yScale(d[1]);\n                    })\n            };\n\n            // Listen For Resize\n            angular.element($window).bind('resize',\n                _.debounce(vm.resize, 300)\n            );\n\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osPathways', pathways);\n\n    /** @ngInject */\n    function pathways() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/pathways/pathways.html',\n            controller: PathwaysController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function PathwaysController(osApi, osHistory, $state, $stateParams, $scope, $sce, $window, moment, cytoscape, _) {\n\n            var markersNetwork;\n            var vm = this;\n            \n            // Elements\n            var elChart = angular.element(\"#gbm-chart\");\n            var csChart;\n\n            // History Integration\n            var skipSave = false;\n            var selectedIds = (osHistory.getGeneSelection() == null) ? null : osHistory.getGeneSelection().ids;\n            function saveSelected() {\n                if (skipSave) { skipSave = false; return; }\n                var ids = csChart.$('node[nodeType=\"gene\"]:selected').map(function(ele){ return ele.data().id.toUpperCase() });\n                osHistory.addGeneSelection(\"Pathways\", \"Manual Selection\", ids );\n            }\n            function setSelected() {\n\n                skipSave = true;\n                csChart.startBatch();\n                if (selectedIds == null) {\n                    csChart.$('node[nodeType=\"gene\"]:selected')\n                        .forEach( function(ele){\n                            ele.deselect();\n                        });\n                } else {\n                    csChart.$('node[nodeType=\"gene\"]')\n                        .forEach( function(ele){\n                            ele[ (this.indexOf(ele.id())==-1) ? \"deselect\" : \"select\"]();\n                        }, selectedIds);\n                }\n                csChart.endBatch();\n            }\n            \n            vm.datasource = osApi.getDataSource();\n            vm.search = \"\";\n            vm.frame;\n            vm.tip = null;\n            vm.linkTitle = \"\";\n            vm.links = [];\n\n            vm.resize = function(){\n                var width = $window.innerWidth;\n                if (width > 760)  width -= 140;\n                if (angular.element(\".tray\").attr(\"locked\")==\"true\") width -= 300;\n                elChart.width( width );\n                elChart.height($window.innerHeight - 90);\n                if (csChart){\n                    csChart.resize();\n                    csChart.center();\n                } \n            }\n\n            // Listen For Resize\n            angular.element($window).bind('resize', \n                _.debounce(vm.resize, 300)\n            );\n\n            $scope.$watch('vm.search', function() {\n                if (angular.isUndefined(csChart)) return;\n                var term = vm.search.toUpperCase();\n                var len = term.length;\n                csChart.startBatch()\n                csChart.nodes().map(function(ele) {\n                    if (len == 0) {\n                        ele.unselect();\n                    } else if (ele.attr(\"name\").substr(0, len) === term) {\n                        ele.select();\n                    } else {\n                        ele.unselect();\n                    }\n                });\n                csChart.endBatch();\n            });\n\n            // Load Datasets\n            osApi.setBusy(true);\n            osApi.query(\"render_pathways\").then(function(result){\n                markersNetwork = result.data[0];\n            \n                    csChart = cytoscape({\n                            container: elChart,\n                            elements: markersNetwork.elements,\n                            style: getStyle(),\n                            minZoom: .2,\n                            maxZoom: 5,\n                            layout: {\n                                name: \"preset\",\n                                fit: true\n                            }\n                        })\n                        .on('select', 'node', _.debounce(saveSelected, 300))\n                        .on('click', 'node', function(e) {\n                            if (e.cyTarget.data().nodeType!=\"gene\") return;\n                            angular.element('#gbm-webpage').modal();\n                            $scope.$apply(function() {\n                                 vm.frame = $sce.trustAsResourceUrl(\"https://www.genecards.org/cgi-bin/carddisp.pl?gene=\" + e.cyTarget.data().id);\n                            });\n                        })\n                        .on('click', 'edge', function(e) {\n                            /* Open Multiple Windows - Hamid Recommended We Remove\n                            links =[\n                                { name: \"PubMed Article\", url:\"https://www.ncbi.nlm.nih.gov/pubmed/?term=\" + e.cyTarget.data().pmid },\n                                { name: \"PubMed Search\",  url:\"http://www.ncbi.nlm.nih.gov/pubmed/?term=(GENE \"+e.cyTarget.data().source+\") AND (GENE \"+e.cyTarget.data().target+\")\"}\n                                { name: e.cyTarget.data().source+\"Gene Card\", url: \"https://www.genecards.org/cgi-bin/carddisp.pl?gene=\"+e.cyTarget.data().source}\n                                { name: e.cyTarget.data().target+\"Gene Card\", url: \"https://www.genecards.org/cgi-bin/carddisp.pl?gene=\"+e.cyTarget.data().target}\n                            ];\n                            $window.open(\"https://www.ncbi.nlm.nih.gov/pubmed/?term=\" + e.cyTarget.data().pmid);\n                            $window.open(\"http://www.ncbi.nlm.nih.gov/pubmed/?term=(GENE \"+e.cyTarget.data().source+\") AND (GENE \"+e.cyTarget.data().target+\")\");\n                            $window.open(\"https://www.genecards.org/cgi-bin/carddisp.pl?gene=\"+e.cyTarget.data().source);\n                            $window.open(\"https://www.genecards.org/cgi-bin/carddisp.pl?gene=\"+e.cyTarget.data().target);\n                            */\n                            angular.element('#gbm-webpage').modal();\n                            $scope.$apply(function() {\n                                vm.frame = $sce.trustAsResourceUrl(\"https://www.ncbi.nlm.nih.gov/pubmed/?term=\" + e.cyTarget.data().pmid );\n                            });\n\n                        }).on('mouseover', 'edge', function(e) {\n                            $scope.$apply(function() {\n                                vm.tip = e.cyTarget.data().source + \" Extract\";\n                            });\n\n                            e.cyTarget.style({\n                                'width': '4px'\n                            });\n                        }).on('mouseout', 'edge', function(e) {\n                            $scope.$apply(function() {\n                                vm.tip = null;\n                            });\n                            e.cyTarget.style({\n                                'width': '2px'\n                            });\n                        }).on('mouseover', 'node', function(e) {\n                            $scope.$apply(function() {\n                                vm.tip = e.cyTarget.data().name + \" Gene Card\";\n                            });\n                        }).on('mouseout', 'node', function() {\n                            $scope.$apply(function() {\n                                vm.tip = null;\n                            });\n                        })\n\n                    // Register History Component\n                    osHistory.onGeneSelectionChange.add(function(selection){\n                        selectedIds = selection.ids;\n                        setSelected();\n                    });\n                    setSelected();\n                    osApi.setBusy(false);\n                });\n\n\n            function getStyle() {\n                var darkblue = 'rgb(5, 108, 225)';\n                var red = 'red'; //rgb(230, 44, 28)';\n                var purple = 'rgb(56, 52,123)';\n                var green = 'green'; //'rgb(56, 52,123)';//'rgb(28, 230,116)';//'green';\n                return [{\n                        'selector': 'node',\n                        'style': {\n                            'content': 'data(label)',\n                            'text-valign': 'center',\n                            'text-halign': 'center',\n                            'shape': 'ellipse',\n                            'width': '60px',\n                            'height': '50px',\n                            'color': darkblue,\n                            'background-color': 'rgb(250, 250, 250)',\n                            'border-width': '2px',\n                            'border-color': darkblue\n\n                        }\n                    }, {\n                        'selector': 'edge',\n                        'style': {\n                            'width': '2px',\n                            'line-color': darkblue,\n                            'line-style': 'solid'\n                        }\n                    },\n                    // Boxes\n                    {\n                        'selector': 'node[nodeType=\"class\"], node[nodeType=\"family\"], node[nodeType=\"complex\"]',\n                        'style': {\n                            'content': '',\n                            'background-color': 'white',\n                            'shape': 'roundrectangle'\n\n                        }\n                    },\n                    // Blue Activiates & Indirect Activates\n                    {\n                        'selector': 'edge[edgeType=\"activates\"], edge[edgeType=\"indirectly activates\"]',\n                        'style': {\n                            'line-color': green,\n                            'target-arrow-shape': 'triangle',\n                            'target-arrow-color': green\n                        }\n                    },\n                    // Inhibits & Ubiquitinylates\n                    {\n                        'selector': 'edge[edgeType=\"inhibits\"], edge[edgeType=\"ubiquitinylates\"]',\n                        'style': {\n                            'line-color': red,\n                            'target-arrow-shape': 'tee',\n                            'target-arrow-color': red\n                        }\n                    },\n                    // Fusion\n                    {\n                        'selector': 'edge[edgeType=\"fusion\"]',\n                        'style': {\n                            'line-color': green\n                        }\n                    },\n                    // Hide\n                    {\n                        'selector': 'edge[edgeType=\"contains\"]',\n                        'style': {\n                            'display': 'none'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"process\"]',\n                        'style': {}\n                    }, {\n                        'selector': 'node[nodeType=\"gene\"]:selected',\n                        'style': {\n                            'overlay-opacity': '0.5',\n                            'overlay-color': 'red'\n                        }\n                    },\n\n                    // Legacy ... Not sure if it's being used\n                    {\n                        'selector': 'node[nodeType=\"rtk\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'background-color': 'rgb(224, 209, 178)',\n                            'border-color': 'black',\n                            'border-width': '0px',\n                            'font-size': '48px',\n                            'shape': 'roundrectangle',\n                            'width': '40px',\n                            'height': '160px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"kinase\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'background-color': 'rgb(255, 206, 194)',\n                            'shape': 'ellipse',\n                            'width': '160px',\n                            'height': '120px',\n                            'font-size': '48px',\n                            'border-color': 'black',\n                            'border-width': '1px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"dimer\"]',\n                        'style': {\n                            'content': '',\n                            'background-color': 'rgb(234, 219, 188)',\n                            'shape': 'ellipse',\n                            'width': '160px',\n                            'height': '120px',\n                            'font-size': '48px',\n                            'border-color': 'black',\n                            'border-width': '0px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"loop\"]',\n                        'style': {\n                            'content': '',\n                            'background-color': 'rgb(255, 255, 255)',\n                            'shape': 'ellipse',\n                            'width': '160px',\n                            'height': '120px',\n                            'font-size': '48px',\n                            'border-color': 'black',\n                            'border-width': '1px',\n                            'border-style': 'dotted'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"gtpase\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'background-color': 'rgb(194, 194, 255)',\n                            'shape': 'ellipse',\n                            'width': '160px',\n                            'height': '120px',\n                            'font-size': '48px',\n                            'border-color': 'black',\n                            'border-width': '1px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"adaptor\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'background-color': 'rgb(77, 184, 255)',\n                            'shape': 'ellipse',\n                            'width': '60px',\n                            'height': '120px',\n                            'font-size': '48px',\n                            'border-color': 'black',\n                            'border-width': '1px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"GEF\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'background-color': 'rgb(77, 184, 255)',\n                            'shape': 'ellipse',\n                            'width': '60px',\n                            'height': '60px',\n                            'font-size': '48px',\n                            'border-color': 'black',\n                            'border-width': '1px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"process\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'background-color': 'rgb(255, 255, 255)',\n                            'shape': 'roundrectangle',\n                            'width': '100px',\n                            'height': '40px',\n                            'font-size': '24px',\n                            'border-color': 'black',\n                            'border-width': '0px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"TF\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'background-color': 'rgb(255, 206, 94)',\n                            'shape': 'diamond',\n                            'width': '160px',\n                            'height': '60px',\n                            'font-size': '48px',\n                            'border-color': 'black',\n                            'border-width': '1px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"gene fusion\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'shape': 'roundrectangle',\n                            'font-size': '24px',\n                            'border-color': 'red',\n                            'border-width': '3px'\n                        }\n                    }, {\n                        'selector': 'edge:selected',\n                        'style': {\n                            'overlay-color': 'grey',\n                            'overlay-opacity': '0.3'\n                        }\n                    }, {\n                        'selector': 'edge[edgeType=\"recruits\"]',\n                        'style': {\n                            'width': '2px'\n                        }\n                    }, {\n                        'selector': 'edge[edgeType=\"fusion\"]',\n                        'style': {\n                            'line-color': purple\n                        }\n                    }, {\n                        'selector': 'edge[edgeType=\"recruits\"]',\n                        'style': {\n                            'line-color': 'red',\n                            'width': '1px',\n                            'line-style': 'dashed',\n                            'target-arrow-shape': 'triangle',\n                            'target-arrow-color': 'black'\n                        }\n                    }, {\n                        'selector': 'edge[edgeType=\"cycles\"]',\n                        'style': {\n                            'line-color': 'black',\n                            'width': '1px',\n                            'line-style': 'dashed',\n                            'target-arrow-shape': 'triangle',\n                            'source-arrow-shape': 'triangle',\n                            'target-arrow-color': 'green',\n                            'source-arrow-color': 'red'\n                        }\n                    }, {\n                        'selector': 'edge[edgeType=\"associates\"]',\n                        'style': {\n                            'line-color': 'black',\n                            'width': '1px',\n                            'line-style': 'solid'\n                        }\n                    }, {\n                        'selector': 'edge[edgeType=\"activation\"]',\n                        'style': {\n                            'line-color': 'green',\n                            'width': '1px'\n                        }\n                    }, {\n                        'selector': 'edge[edgeType=\"inhibition\"]',\n                        'style': {\n                            'line-color': 'red',\n                            'width': '1px'\n                        }\n                    }\n                ]\n\n            }\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .service('osSound', osSound);\n\n    /** @ngInject */\n    function osSound() {\n\n        var _beep = new Audio(\"data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=\");\n        function beep() { _beep.play(); }\n\n        return {\n            beep: beep\n        }\n    }\n})();\n\n (function() {\n     'use strict';\n\n     angular\n         .module('oncoscape')\n         .factory('osHttp', oncoscape);\n\n     /** @ngInject */\n     function oncoscape($http, $location) {\n\n         var url = $location.protocol() + \"://\" + $location.host() + \":\" + (($location.port() == \"3000\") ? 80 : $location.port()) + '/api/'\n         //var url = $location.protocol() + \"://\" + $location.host() + \":80/api/\";\n\n         var queryString = function(req) {\n             var query = url + req.table;\n             if (angular.isDefined(req.query)) query += \"/?q=\"+encodeURIComponent(JSON.stringify(req.query));\n             return query;\n         };\n\n         var query = function(req) {\n            return $http({\n                 method: 'GET',\n                 //cache: true,\n                 url: queryString(req)\n             });\n         };\n\n         // Return Object\n         return {\n            queryString: queryString,\n            query: query\n         };\n     }\n })();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .service('osHistory', osHistory);\n\n    /** @ngInject */\n    function osHistory(moment, signals, osSound, _) {\n\n        //var _historyMax = 100;\n        var _geneSelections = [{ids:[], tool:'Application', desc:'Load'}];\n        var _geneIndex = 0;\n        var _patientSelections = [{ids:[], tool:'Application', desc:'Load'}];\n        var _patientIndex = 0;\n        var _onPatientAdd = new signals.Signal();\n        var _onPatientSelectionChange = new signals.Signal();\n        var _onGeneAdd = new signals.Signal();\n        var _onGeneSelectionChange = new signals.Signal();\n       \n        /* Gene */\n        var setGeneSelection = function(selection){\n            var index = _geneSelections.indexOf(selection);\n            if (index>=0){\n                _geneIndex = index\n                _onGeneSelectionChange.dispatch(getGeneSelection())\n            }\n        };\n        var getGeneSelections = function(){\n            return _geneSelections;\n        };\n        var getGeneSelection = function(){\n            if (_geneIndex<0) _geneIndex = 0;\n            if (_geneIndex>=_geneSelections.length) _geneIndex = _geneSelections.length-1;\n            return _geneSelections[_geneIndex];\n        };\n        var addGeneSelection = function(tool, desc, ids){\n            ids = ids.sort();\n            if (ids.length==getGeneSelection().ids.length){\n                if (_.difference(ids, getGeneSelection().ids).length==0) return;\n            }\n            var m = moment();\n            _geneSelections.push({tool:tool, desc:desc, ids:ids, date:m.unix(), time:m.format(\"H:mm\")});\n            _geneIndex += _geneSelections.length-1;\n            _onGeneAdd.dispatch(getGeneSelection())\n        };\n        var getGeneSelectionLast = function(){\n            _geneIndex -= 1;\n            if (_geneIndex<0) { \n                osSound.beep();\n                _geneIndex = 0; return; }\n            var selection = getGeneSelection();\n            _onGeneSelectionChange.dispatch(selection);\n            return selection;\n        };\n        var getGeneSelectionNext = function(){\n            _geneIndex += 1;\n            if (_geneIndex==_geneSelections.length) { \n                osSound.beep();\n                _geneIndex = _geneSelections.length-1; return; }\n            var selection = getGeneSelection();\n            _onGeneSelectionChange.dispatch(selection);\n            return selection;\n        };\n\n        /* Patient */\n        var setPatientSelection = function(selection){\n            var index = _patientSelections.indexOf(selection);\n            if (index>=0){\n                _patientIndex = index\n                _onPatientSelectionChange.dispatch(getPatientSelection())\n            }\n        };\n        var getPatientSelections = function(){\n            return _patientSelections;\n        };\n        var getPatientSelection = function(){\n            if (_patientIndex<0) _patientIndex = 0;\n            if (_patientIndex>=_patientSelections.length) _patientIndex = _patientSelections.length-1;\n            return _patientSelections[_patientIndex];\n        };\n        var addPatientSelection = function(tool, desc, ids){\n            ids = ids.sort();\n            if (ids.length==getPatientSelection().ids.length){\n                if (_.difference(ids, getPatientSelection().ids).length==0) return;\n            }\n            var m = moment();\n            _patientSelections.push({tool:tool, desc:desc, ids:ids, date:m.unix(), time:m.format(\"H:mm\")});\n            _patientIndex = _patientSelections.length-1;\n            _onPatientAdd.dispatch(getPatientSelection());\n        };\n        var getPatientSelectionLast = function(){\n            _patientIndex -= 1;\n            if (_patientIndex<0) { \n                osSound.beep();\n                _patientIndex = 0; return; }\n            var selection = getPatientSelection();\n            _onPatientSelectionChange.dispatch(selection);\n            return selection;\n        };\n        var getPatientSelectionSecondLast = function(){\n            /*\n            var i = _patientSelections.indexOf(_patientSelection) - 2;\n            if (i<1){\n                osSound.beep();\n                return null;\n            } \n            _patientSelection = _patientSelections[i];\n            return _patientSelection;\n            */\n        };\n        var getPatientSelectionNext = function(){\n            _patientIndex += 1;\n            if (_patientIndex==_patientSelections.length) { \n                osSound.beep();\n                _patientIndex = _patientSelections.length-1; return; }\n            var selection = getPatientSelection();\n            _onPatientSelectionChange.dispatch(selection);\n            return selection;\n        };\n\n\n        var removeListeners = function(){\n          \n        };\n        var clear = function(){\n           \n        };\n\n\n        var api = {\n            onPatientAdd: _onPatientAdd,\n            onPatientSelectionChange: _onPatientSelectionChange,\n            onGeneAdd: _onGeneAdd,\n            onGeneSelectionChange: _onGeneSelectionChange,\n\n            addGeneSelection: addGeneSelection,\n            setGeneSelection: setGeneSelection,\n            getGeneSelection: getGeneSelection,\n            getGeneSelections: getGeneSelections,\n            getGeneSelectionLast: getGeneSelectionLast,\n            getGeneSelectionNext: getGeneSelectionNext,\n\n            addPatientSelection: addPatientSelection,\n            setPatientSelection: setPatientSelection,\n            getPatientSelection: getPatientSelection,\n            getPatientSelections: getPatientSelections,\n            getPatientSelectionNext: getPatientSelectionNext,\n            getPatientSelectionLast: getPatientSelectionLast,\n            getPatientSelectionSecondLast: getPatientSelectionSecondLast,\n            \n            removeListeners: removeListeners,\n            clear: clear\n        };\n\n        return api;\n    }\n})();\n(function() {\n  'use strict';\n/*\n    angular\n        .module('oncoscape')\n        .provider({\n            $exceptionHandler:\n*/\n        /** @ngInject */\n/*        \n        function exceptionFactory(){\n        \tvar handler = function (exception, cause){\n                window.alert(\"Oh Snap!  An error occured.  View console for details\")\n                console.log(exception);\n                exception.stack();\n                if (angular.isDefined(cause)) console.log(cause);\n        \t}\n            this.$get = function() { return handler; };\n        }\n       });\n*/\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .service('osApi', oncoscape);\n\n    /** @ngInject */\n    function oncoscape(osHttp, $http, signals, $location) {\n\n        // Events\n        var onDataSource = new signals.Signal();\n\n        // State\n        var _dataSources;\n        var _dataSource;\n        function getDataSources(){\n            return _dataSources;\n        }\n        function getDataSource(value){ \n            return _dataSource; \n        }\n        function setDataSource(value){\n            \n            if (typeof(value)===\"object\"){\n                if (_dataSource != value) onDataSource.dispatch(_dataSource);\n                _dataSource = value;\n            }else if (typeof(value)===\"string\"){\n                if (_dataSource.disease!=value){\n                    if (_dataSource != value) onDataSource.dispatch(_dataSource);\n                    _dataSource = _dataSources.filter(function(v){ v.disease==disease}, {key:value})[0]\n                }\n            }\n        }\n\n        query(\"lookup_oncoscape_datasources\",{beta:false}).then(function(response){ \n            _dataSources = response.data; \n                            \n        });\n        \n        /*** User Api ***/\n        function userApi(){\n\n            // Events\n            var onLogin = new signals.Signal(); // Fired When Data Changes\n            var onLogout = new signals.Signal(); // Fired When Selection changes\n            var _user = {\n                \"name\":\"\",\n                \"password\":\"\",\n                \"domain\":{\"name\":\"Guest\"},\n                \"authenticated\":false,\n                \"token\": null,\n                \"datasets\": []\n            };\n            var _domains = [\n                { \"name\": \"Guest\" },\n                { \"name\": \"FHCRC\" },\n                { \"name\": \"UW\" }\n            ];\n            var logout = function(){\n                _user.name = \"\";\n                _user.password = \"\";\n                _user.domain = {\"name\":\"Guest\"};\n                _user.authenticated = false;\n                _user.token = null;\n                _user.datasets = [];\n\n                onLogout.dispatch();\n            }\n            var login = function(user){\n                _user = user;\n                var req = {\n                    method: 'POST',\n                    url: $location.protocol()+\"://\"+$location.host()+\":\"+ (($location.port()==\"3000\") ? 80 : $location.port()) +'/login',\n                    data: {\n                        username: _user.name,\n                        password: _user.password,\n                        domain: _user.domain.name\n                    }\n                };\n                return $http(req).then(function(res) {\n                    if (res.data.success) {\n                        _user.authenticated = true;\n                        _user.token = res.data.token;\n                        _user.datasets = res.data.datasets;                        \n                        onLogin.dispatch(_user);\n                    } else {\n                        _user.authenticated = false;\n                        _user.token =null;\n                    }\n                });\n            }\n            return {\n                getDomains: function(){ return _domains; },\n                getUser: function() { return _user; },\n                login: login,\n                logout: logout,\n                onLogin: onLogin,\n                onLogout: onLogout\n            }\n        }\n        var _userApi = userApi();\n        function getUserApi() { return _userApi; }\n\n        /*** UI Functions ***/\n        function setBusy(value) {\n            if (value) {\n                angular.element(\".loader-modal\").show();\n            } else {\n                angular.element(\".loader-modal\").hide();\n            }\n            return setBusyMessage;\n        }\n        function setBusyMessage() {\n            //console.log(value);\n        }\n        function showFilter() {\n            angular.element(\"#filter-dropdown\").slideToggle();\n        }\n        function hideFilter() {\n            angular.element(\"#filter-dropdown\").slideToggle();\n        }\n        function toggleFilter(){\n            angular.element(\"#filter-dropdown\").slideToggle();\n        }\n\n        function getTools(){\n        }\n        \n        function queryString(table, query){\n            return osHttp.queryString({\n                table: table,\n                query: query\n            });\n        }\n        function query(table, query){\n            return osHttp.query({\n                table: table,\n                query: query\n            });\n        }\n\n        /*** R Service Calls ***/\n        var osSocket = {};\n        function setDataset(dataPackage) {\n            osSocket.setDataSource(dataPackage);\n            return osSocket.request({\n                cmd: \"specifyCurrentDataset\",\n                payload: dataPackage\n            });\n        }\n        \n        function getDataManifest(dataPackage) {\n            return osSocket.request({\n                cmd: \"getDataManifest\",\n                payload: dataPackage\n            });\n        }\n        function getPatientHistoryTable(dataPackage) {\n            return osSocket.request({\n                cmd: \"getPatientHistoryTable\",\n                payload: {\n                    datasetName: dataPackage,\n                    durationFormat: \"byYear\"\n                }\n            });\n        }\n        function getPatientHistoryDxAndSurvivalMinMax() {}\n        function getSampleDataFrame() {}\n        function getGeneSetNames() {\n            return osSocket.request({\n                cmd: \"getGeneSetNames\"\n            });\n        }\n        function getSampleCategorizationNames() {\n            return osSocket.request({\n                cmd: 'getSampleCategorizationNames'\n            });\n        }\n        function getSampleCategorization(names) {\n            return osSocket.request({\n                cmd: 'getSampleCategorization',\n                payload: names\n            });\n        }\n        function getMarkersNetwork(payload) {\n            // Payload is return From Set DataSource\n            return osSocket.request({\n                cmd: \"getMarkersNetwork\",\n                payload: payload\n            })\n        }\n        function getDrugGeneInteractions() {}\n        function getCanonicalizePatientIDsInDataset(patientIds) {\n            return osSocket.request({\n                cmd: \"getCanonicalizePatientIDsInDataset\",\n                payload: patientIds\n            });\n        }\n        function getGeneSetGenes() {}\n        function getOncoprintDataSelection() {}\n        function getPCA(dataPackage, matrixName) {\n            var payload = {\n                dataPackage: dataPackage,\n                matrixName: matrixName\n            };\n            return osSocket.request({\n                cmd: \"createPCA\",\n                payload: payload\n            });\n        }\n        function getCalculatedPCA(geneSet) {\n            var payload = {\n                genes: geneSet\n            };\n\n            return osSocket.request({\n                cmd: \"calculatePCA\",\n            \n                payload: payload\n            });\n        }\n        function getCalculatedPCA2(geneSet) {\n            var payload = {\n                genes: geneSet\n            };\n            return osSocket.request({\n                cmd: \"calculatePCA2\",\n                payload: payload\n            });\n        }\n        function getPLSR(dataPackage, matrixName) {\n            var payload = {\n                dataPackage: dataPackage,\n                matrixName: matrixName\n            };\n            return osSocket.request({\n                cmd: \"createPLSR\",\n                payload: payload\n            });\n        }\n        function getCalculatedPLSR(geneSet, factors) {\n            var payload = {\n                genes: geneSet,\n                factorCount: factors.length,\n                factors: factors\n            };\n            return osSocket.request({\n                cmd: \"calculatePLSR\",\n                payload: payload\n            });\n        }\n        function getSummarizedPLSRPatientAttributes(attrs) {\n            attrs = attrs || ['AgeDx', 'Survival'];\n            return osSocket.request({\n                cmd: 'summarizePLSRPatientAttributes',\n                payload: attrs\n            });\n        }\n        function getCalculatedSurvivalCurves(patientIds, title) {\n            return osSocket.request({\n                cmd: \"calculateSurvivalCurves\",\n                payload: {\n                    sampleIDs: patientIds,\n                    title: title\n                }\n            });\n        }\n        function getTimelines() {\n            return osSocket.request({\n                cmd: \"createTimelines\"\n            });\n        }\n        function getCalculatedTimelines() {}\n        function getModuleModificationDate() {\n            return osSocket.request({\n                cmd: \"getModuleModificationDate\",\n                payload: 'gbmPathways'\n            });\n        }\n        function getPathway() {\n            return osSocket.request({\n                cmd: \"getPathway\",\n                payload: 'g.gbmPathways.json'\n            });\n        }\n        function getMrnaData(entities, features) {\n            return osSocket.request({\n                cmd: \"get_mRNA_data\",\n                payload: {\n                    entities: entities,\n                    features: features\n                }\n            });\n        }\n        function getCnvData(entities, features) {\n            return osSocket.request({\n                cmd: \"get_cnv_data\",\n                payload: {\n                    entities: entities,\n                    features: features\n                }\n            });\n        }\n        function getMutationData(entities, features) {\n            return osSocket.request({\n                cmd: \"get_mutation_data\",\n                payload: {\n                    entities: entities,\n                    features: features\n                }\n            });\n        }\n        function getOncoprint(geneSetAndPatients) {\n            return osSocket.request({\n                cmd: \"oncoprint_data_selection\",\n                payload: {\n                    patientIdsAndGenes: geneSetAndPatients\n                }\n            });\n        }\n        function getGeneSetTest(dataPackage, matrixName) {\n            var payload = {\n                dataPackage: dataPackage,\n                matrixName: matrixName\n            };\n            return osSocket.request({\n                cmd: \"createGeneSetTest\",\n                payload: payload\n            });\n        }\n        function getGeneSetScore(Group1, Group2, geneSet) {\n            return osSocket.request({\n                cmd: \"geneSetScoreTest\",\n                payload: {\n                    group1: Group1,\n                    group2: Group2, \n                    geneset: geneSet\n                }\n            });\n        }\n\n\n\n        return {\n\n            // Mongo V\n            query: query,\n            queryString: queryString,\n            setDataSource: setDataSource,\n            getDataSource: getDataSource,\n            getDataSources: getDataSources,\n            onDataSource: onDataSource,\n\n            // Legacy\n            getTools: getTools,\n            getUserApi: getUserApi,\n            showFilter: showFilter,\n            hideFilter: hideFilter,\n            toggleFilter: toggleFilter,\n            setBusy: setBusy,\n            setBusyMessage: setBusyMessage,\n            setDataset: setDataset,\n            getDataManifest: getDataManifest,\n            getPatientHistoryTable: getPatientHistoryTable,\n            getPatientHistoryDxAndSurvivalMinMax: getPatientHistoryDxAndSurvivalMinMax,\n            getSampleDataFrame: getSampleDataFrame,\n            getGeneSetNames: getGeneSetNames,\n            getSampleCategorizationNames: getSampleCategorizationNames,\n            getSampleCategorization: getSampleCategorization,\n            getMarkersNetwork: getMarkersNetwork,\n            getPathway: getPathway,\n            getDrugGeneInteractions: getDrugGeneInteractions,\n            getCanonicalizePatientIDsInDataset: getCanonicalizePatientIDsInDataset,\n            getGeneSetGenes: getGeneSetGenes,\n            getOncoprintDataSelection: getOncoprintDataSelection,\n            getPCA: getPCA,\n            getCalculatedPCA: getCalculatedPCA,\n            getCalculatedPCA2: getCalculatedPCA2,\n            getPLSR: getPLSR,\n            getCalculatedPLSR: getCalculatedPLSR,\n            getSummarizedPLSRPatientAttributes: getSummarizedPLSRPatientAttributes,\n            getCalculatedSurvivalCurves: getCalculatedSurvivalCurves,\n            getTimelines: getTimelines,\n            getCalculatedTimelines: getCalculatedTimelines,\n            getMrnaData: getMrnaData,\n            getCnvData: getCnvData,\n            getMutationData: getMutationData,\n            getModuleModificationDate: getModuleModificationDate,\n            getOncoprint: getOncoprint,\n            getGeneSetTest: getGeneSetTest,\n            getGeneSetScore: getGeneSetScore\n        }\n    }\n})();\n(function() {\n    'use strict';\n    \n    angular\n        .module('oncoscape')\n        .directive('osOncoprint', oncoprint);\n\n    /** @ngInject */\n    function oncoprint() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/oncoprint/oncoprint.html',\n            controller: OncoprintController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function OncoprintController(osApi, osHistory, $state, $stateParams, $timeout, $scope, d3, $window, _) {\n\n            if (angular.isUndefined($stateParams.datasource)) {\n                $state.go(\"datasource\");\n                return;\n            }\n\n            // Elements\n            var elControl = angular.element(\"#oncoprintControlsDiv\");\n            var elInstructions = angular.element(\"#oncoprintInstructions\");\n            var elErrors = angular.element(\"#oncoprintErrorSection\");\n            var elLegend = angular.element(\"#legend\");\n            var d3Chart = d3.select(\"#onc\");\n            \n            // History Integration\n            var selectedPatientIds = (osHistory.getPatientSelection() == null) ? null : osHistory.getPatientSelection().ids;\n            var selectedGeneIds = (osHistory.getGeneSelection() == null) ? null : osHistory.getGeneSelection().ids;\n            \n            \n            // View Model\n            var vm = this;\n            vm.datasource = $stateParams.datasource;\n            vm.geneAndPatients = selectedPatientIds + \",\" + selectedGeneIds;\n            vm.errorMessage;\n\n            \n\n            var Oncoprint = (function() {\n              var events = oncoprint_events;\n              var utils = oncoprint_utils;\n              var RuleSet = oncoprint_RuleSet;\n\n              var defaultOncoprintConfig = {\n                cell_width: 6,\n                cell_padding: 2.5,\n                legend: true,\n              };\n\n              var hiddenOncoprintConfig = {\n                pre_track_padding: 0,\n              };\n\n              var defaultTrackConfig = {\n                label: 'Gene',\n                datum_id_key: 'patient',\n                cell_height: 23,\n                track_height: 20,\n                track_padding: 5,\n                sort_cmp: undefined,\n                tooltip: function(d) {\n                  return d['patient'];\n                },\n                removable: false,\n                sort_direction_changable: false\n              }; \n\n\n\n              function Oncoprint(config) {\n                var self = this;\n                var getTrackId = utils.makeIdCounter();\n\n                self.config = config;\n\n                self.id_order = [];\n                self.inverted_id_order = {};\n                self.visible_id_order = [];\n                self.visible_inverted_id_order = {};\n                self.hidden_ids = {};\n                self.track_groups = [[],[]];\n                self.track_group_sort_order = [0,1];\n                self.sort_direction = {};\n                self.tracks = {};\n                self.sort_config = {type: 'track'};\n\n                self.cell_padding_on = true;\n                self.true_cell_width = config.cell_width;\n\n                self.zoomed_cell_width = self.true_cell_width;\n                self.zoom = 1;\n\n                // Cell Padding\n                self.toggleCellPadding = function() {\n                  self.cell_padding_on = !self.cell_padding_on;\n                  $(self).trigger(events.SET_CELL_PADDING);\n                };\n                self.getCellPadding = function() {\n                  return Math.ceil(self.config.cell_padding*self.getZoom())*(+self.cell_padding_on);\n                };\n\n                // Zoom\n                self.getZoom = function() {\n                  return self.zoom;\n                };\n                self.setZoom = function(z) {\n                  self.zoom = utils.clamp(z, 0, 1);\n                  updateZoomedCellWidth();\n                  updateZoom();\n                  $(self).trigger(events.SET_ZOOM);\n                  return self.zoom;\n                };\n                var updateZoom = function() {\n                  // maps {1, ... , true_cell_width} to [0,1]\n                  self.zoom = (self.zoomed_cell_width-1)/(self.true_cell_width - 1);\n                };\n                var updateZoomedCellWidth = function() {\n                  // maps [0,1] to {1, ... , true_cell_width}\n                  self.zoomed_cell_width = Math.round(self.zoom*(self.true_cell_width-1) + 1);\n                };\n                self.increaseZoom = function() {\n                  self.zoomed_cell_width = utils.clamp(self.zoomed_cell_width+1, 1, self.true_cell_width);\n                  updateZoom();\n                  $(self).trigger(events.SET_ZOOM);\n                  return self.zoom;\n                };\n                self.decreaseZoom = function() {\n                  self.zoomed_cell_width = utils.clamp(self.zoomed_cell_width-1, 1, self.true_cell_width);\n                  updateZoom();\n                  $(self).trigger(events.SET_ZOOM);\n                  return self.zoom;\n                };\n\n                // Cell Width\n                self.getFullCellWidth = function() {\n                  return self.true_cell_width;\n                };\n                self.getZoomedCellWidth = function() {\n                  return self.zoomed_cell_width;\n                };\n\n                // Cell Height\n                self.getCellHeight = function(track_id) {\n                  return self.tracks[track_id].config.cell_height;\n                };\n\n                // Track Height\n                self.getTrackHeight = function(track_id) {\n                  return self.tracks[track_id].config.track_height;\n                };\n\n                // Track Padding\n                self.getTrackPadding = function(track_id) {\n                  return self.tracks[track_id].config.track_padding;\n                };\n\n                // Id Order\n                self.getFilteredIdOrder = function(data_filter_fn, track_ids) {\n                  var tracks = track_ids || self.getTracks();\n                  return _.filter(self.id_order, function(id) {\n                    var d = _.map(tracks, function(track_id) {\n                      return self.getTrackDatum(track_id, id);\n                    });\n                    return data_filter_fn(d);\n                  });\n                };\n                self.getIdOrder = function() {\n                  return self.id_order;\n                };\n                self.getInvertedIdOrder = function() {\n                  return self.inverted_id_order;\n                };\n                self.getVisibleIdOrder = function() {\n                  return self.visible_id_order;\n                };\n                self.getVisibleInvertedIdOrder = function() {\n                  return self.visible_inverted_id_order;\n                };\n                var updateVisibleIdOrder = function() {\n                  self.visible_id_order = _.filter(self.id_order, function(id) {\n                    return !self.hidden_ids[id];\n                  });\n                  self.visible_inverted_id_order = utils.invert_array(self.visible_id_order);\n                  $(self).trigger(events.SET_VISIBLE_ID_ORDER);\n                };\n                self.setIdOrder = function(id_order) {\n                  self.id_order = id_order.slice();\n                  self.inverted_id_order = utils.invert_array(self.id_order);\n                  updateVisibleIdOrder();\n                  $(self).trigger(events.SET_ID_ORDER);\n                };\n                // Hide Ids\n                self.hideIds = function(ids, clear_existing) {\n                  if (clear_existing) {\n                    self.hidden_ids = {};\n                  }\n                  _.each(ids, function(id) {\n                    self.hidden_ids[id] = true;\n                  });\n                  updateVisibleIdOrder();\n                };\n                self.showIds = function(ids) {\n                  if (!ids) {\n                    self.hidden_ids = {};\n                  } else {\n                    _.each(ids, function(id) {\n                      delete self.hidden_ids[id];\n                    });\n                  }\n                  updateVisibleIdOrder();\n                };\n\n                // Sorting\n                self.getTopmostTrack = function() {\n                  return (self.track_groups[0].length > 0 ? self.track_groups[0][0] : self.track_groups[1][0]);\n                };\n                self.setTrackSortComparator = function(track_id, cmp) {\n                  self.tracks[track_id].config.sort_cmp = cmp;\n                };\n                self.getTrackSortComparator = function(track_id) {\n                  return self.tracks[track_id].config.sort_cmp;\n                };\n                self.getTrackSortDirection = function(track_id) {\n                  return self.sort_direction[track_id];\n                };\n                self.setTrackSortDirection = function(track_id, dir) {\n                  self.sort_direction[track_id] = dir;\n                  self.sort();\n                };\n                self.setTrackGroupSortOrder = function(order) {\n                  self.track_group_sort_order = order.slice();\n                };\n                self.getTrackGroupSortOrder = function() {\n                  return self.track_group_sort_order.slice();\n                };\n                self.getTrackSortOrder = function() {\n                  var ret = [];\n                  var track_groups = self.getTrackGroups();\n                  _.each(self.getTrackGroupSortOrder(), function(group_id) {\n                    ret = ret.concat(track_groups[group_id]);\n                  });\n                  return ret;\n                };\n                self.setSortConfig = function(config) {\n                  self.sort_config = config;\n                };\n                var sortById = function(desc) {\n                  var ret = _.sortBy(self.getIdOrder(), _.identity);\n                  if (desc) {\n                    ret.reverse();\n                  }\n                  self.setIdOrder(ret);\n                };\n                var sortByTrack = function() {\n                  var track_id_list = self.getTrackSortOrder();\n                  var cmp_list = _.map(track_id_list, function(track_id) { \n                    return self.getTrackSortComparator(track_id);\n                  });\n                  var data = {};\n                  var id_order = self.getIdOrder();\n                  _.each(id_order, function(id) {\n                    data[id] = {};\n                    _.each(track_id_list, function(track_id) {\n                      data[id][track_id] = self.getTrackDatum(track_id, id);\n                    });\n                  });\n                  var lexicographically_ordered_cmp = function(id1,id2) {\n                    var cmp_result = 0;\n                    for (var i=0, _len = track_id_list.length; i<_len; i++) {\n                      var track_id = track_id_list[i];\n                      var cmp = cmp_list[i];\n                      var d1 = data[id1][track_id];\n                      var d2 = data[id2][track_id];\n                      var d1_undef = (typeof d1 === \"undefined\");\n                      var d2_undef = (typeof d2 === \"undefined\");\n                      if (!d1_undef && !d2_undef) {\n                        cmp_result = cmp(d1, d2);\n                      } else if (d1_undef && d2_undef) {\n                        cmp_result = 0;\n                      } else if (d1_undef) {\n                        cmp_result = 1;\n                      } else {\n                        cmp_result = -1;\n                      }\n                      if (isFinite(cmp_result)) {\n                        // reverse direction unless infinite, which is a signal that an NA is involved\n                        cmp_result *= self.sort_direction[track_id];\n                      }\n                      if (cmp_result !== 0) {\n                        break;\n                      }\n                    }\n                    return cmp_result;\n                  };\n                  self.setIdOrder(utils.stableSort(self.getIdOrder(), lexicographically_ordered_cmp));\n                };\n                self.sort = function() {\n                  var config = self.sort_config;\n                  if (config.type === 'track') {\n                    sortByTrack();\n                  } else if (config.type === 'id') {\n                    sortById(config.desc);\n                  }\n                };\n\n                // Track Creation/Destruction\n                self.addTrack = function(config, group) {\n                  group = utils.ifndef(group, 1);\n                  var track_id = getTrackId();\n                  self.tracks[track_id] ={id: track_id, \n                        data: [], \n                        config: $.extend({}, defaultTrackConfig, config),\n                        id_data_map: {}};\n                  self.track_groups[group].push(track_id);\n                  self.sort_direction[track_id] = 1;\n\n                  $(self).trigger(events.ADD_TRACK, {track_id: track_id});\n                  return track_id;\n                };\n                self.removeTrack = function(track_id) {\n                  var track = self.tracks[track_id];\n                  delete self.tracks[track_id];\n                  delete self.sort_direction[track_id];\n\n                  var track_group = self.getContainingTrackGroup(track_id, true);\n                  if (!track_group) {\n                    return false;\n                  } else {\n                    var old_position = track_group.indexOf(track_id);\n                    track_group.splice(old_position, 1);\n\n                    $(self).trigger(events.REMOVE_TRACK, {track: track, track_id: track_id});\n                    return true;  \n                  }\n                };\n\n                // Track Ordering\n                self.getTrackGroups = function(reference) {\n                  return (reference === true ? self.track_groups : $.extend(true, [], self.track_groups));      \n                };\n                self.getTracks = function() {\n                  return _.flatten(self.getTrackGroups());\n                };\n                self.getContainingTrackGroup = function(track_id, reference) {\n                  var group = false;\n                  _.find(self.track_groups, function(grp) {\n                    if (grp.indexOf(track_id) > -1) {\n                      group = grp;\n                      return true;\n                    }\n                    return false;\n                  });\n                  return (reference === true ? group : group.slice());\n                };\n                self.moveTrack = function(track_id, new_position) {\n                  var track_group = self.getContainingTrackGroup(track_id, true);\n                  if (!track_group) {\n                    return false;\n                  }\n                  var old_position = track_group.indexOf(track_id);\n                  new_position = utils.clamp(new_position, 0, track_group.length-1);\n                  track_group.splice(old_position, 1);\n                  track_group.splice(new_position, 0, track_id);\n                  var moved_tracks = track_group.slice(Math.min(old_position, new_position), Math.max(old_position, new_position) + 1);\n                  $(self).trigger(events.MOVE_TRACK, {moved_tracks: moved_tracks});\n                };\n\n\n                // Track Label\n                self.getTrackLabel = function(track_id) {\n                  return self.tracks[track_id].config.label;\n                };\n\n                // Track Tooltip\n                self.getTrackTooltip = function(track_id) {\n                  return self.tracks[track_id].config.tooltip;\n                };\n                self.setTrackTooltip = function(track_id, tooltip) {\n                  self.tracks[track_id].config.tooltip = tooltip;\n                };\n\n                // Track Data\n                self.getTrackData = function(track_id) {\n                  return self.tracks[track_id].data;\n                };\n                self.setTrackData = function(track_id, data) {\n                  var id_accessor = self.getTrackDatumIdAccessor(track_id);\n\n                  self.tracks[track_id].data = data;\n\n                  var current_id_order = self.getIdOrder();\n                  var current_inverted_id_order = self.getInvertedIdOrder();\n                  _.each(_.map(data, id_accessor), function(id) {\n                    if (!(id in current_inverted_id_order)) {\n                      current_id_order.push(id);\n                    }\n                  });\n                  self.setIdOrder(current_id_order);\n                  \n                  self.tracks[track_id].id_data_map = {};\n                  var id_data_map = self.tracks[track_id].id_data_map;\n                  _.each(self.tracks[track_id].data, function(datum) {\n                    id_data_map[id_accessor(datum)] = datum;\n                  });\n                  $(self).trigger(events.SET_TRACK_DATA, {track_id: track_id});\n                };\n                self.getTrackDatum = function(track_id, datum_id) {\n                  return self.tracks[track_id].id_data_map[datum_id];\n                };\n                self.getTrackDatumDataKey = function(track_id) {\n                  return self.tracks[track_id].config.datum_data_key;\n                };\n\n                // Track Datum Id\n                self.getTrackDatumIdAccessor = function(track_id) {\n                  var key = self.getTrackDatumIdKey(track_id);\n                  return function(d) {\n                    return d[key];\n                  };\n                };\n                self.getTrackDatumIdKey = function(track_id) {\n                  return self.tracks[track_id].config.datum_id_key;\n                };\n                self.setTrackDatumIdKey = function(track_id, key) {\n                  self.tracks[track_id].config.datum_id_key = key;\n                };\n\n                // Track info\n                self.isTrackRemovable = function(track_id) {\n                  return self.tracks[track_id].config.removable;\n                };\n                self.isTrackSortDirectionChangable = function(track_id) {\n                  return self.tracks[track_id].config.sort_direction_changable;\n                };\n\n                // Clearing\n                self.clearData = function() {\n                  _.each(self.getTracks(), function(track_id) {\n                    self.setTrackData(track_id, []);\n                  });\n                  self.setIdOrder([]);\n                }\n              }\n\n              return { \n                CATEGORICAL_COLOR: RuleSet.CATEGORICAL_COLOR,\n                GRADIENT_COLOR: RuleSet.GRADIENT_COLOR,\n                GENETIC_ALTERATION: RuleSet.GENETIC_ALTERATION,\n                BAR_CHART: RuleSet.BAR_CHART,\n                create: function CreateOncoprint(container_selector_string, config) {\n                  config = $.extend({}, defaultOncoprintConfig, config || {});\n                  config = $.extend(config, hiddenOncoprintConfig);\n                  var oncoprint = new Oncoprint(config);\n                  var renderer = new OncoprintSVGRenderer(container_selector_string, oncoprint, {label_font: 'Arial', legend:config.legend});\n                  var ret = {\n                    onc_dev: oncoprint,\n                    ren_dev: renderer,\n                    addTrack: function(config, group) {\n                      var track_id = oncoprint.addTrack(config, group);\n                      return track_id;\n                    },\n                    removeTrack: function(track_id) {\n                      oncoprint.removeTrack(track_id);\n                    },\n                    moveTrack: function(track_id, position) {\n                      oncoprint.moveTrack(track_id, position);\n                    },\n                    setTrackDatumIdKey: function(track_id, key) {\n                      oncoprint.setTrackDatumIdKey(track_id, key);\n                    },\n                    setTrackData: function(track_id, data) {\n                      oncoprint.setTrackData(track_id, data);\n                    },\n                    setRuleSet: function(track_id, type, params) {\n                      renderer.setRuleSet(track_id, type, params);\n                    },\n                    useSameRuleSet: function(target_track_id, source_track_id) {\n                      renderer.useSameRuleSet(target_track_id, source_track_id);\n                    },\n                    toggleCellPadding: function() {\n                      oncoprint.toggleCellPadding();\n                    },\n                    toSVG: function() {\n                      return renderer.toSVG();\n                    },\n                    setTrackGroupSortOrder: function(order) {\n                      oncoprint.setTrackGroupSortOrder(order);\n                    },\n                    sort: function() {\n                      oncoprint.sort();\n                    },\n                    setSortConfig: function(config) {\n                      oncoprint.setSortConfig(config);\n                    },\n                    setIdOrder: function(id_order) {\n                      oncoprint.setIdOrder(id_order);\n                    },\n                    getTrackSortDirection: function(track_id) {\n                      return oncoprint.getTrackSortDirection(track_id);\n                    },\n                    setTrackSortDirection: function(track_id, dir) {\n                      oncoprint.setTrackSortDirection(track_id, dir);\n                    },\n                    setZoom: function(z) {\n                      return oncoprint.setZoom(z);\n                    },\n                    increaseZoom: function() {\n                      return oncoprint.increaseZoom();\n                    },\n                    decreaseZoom: function() {\n                      return oncoprint.decreaseZoom();\n                    },\n                    suppressRendering: function() {\n                      renderer.suppressRendering();\n                    },\n                    releaseRendering: function() {\n                      renderer.releaseRendering();\n                    },\n                    setLegendVisible: function(track_ids, visible) {\n                      renderer.setLegendVisible(track_ids, visible);\n                    },\n                    getFilteredIdOrder: function(data_filter_fn, track_ids) {\n                      return oncoprint.getFilteredIdOrder(data_filter_fn, track_ids);\n                    },\n                    getVisibleIdOrder: function() {\n                      return oncoprint.getVisibleIdOrder();\n                    },\n                    hideIds: function(ids) {\n                      oncoprint.hideIds(ids);\n                    },\n                    showIds: function(ids) {\n                      oncoprint.showIds(ids);\n                    },\n                    clearData: function() {\n                      oncoprint.clearData();\n                    },\n                    setTrackTooltip: function(track_id, tooltip) {\n                      oncoprint.setTrackTooltip(track_id, tooltip);\n                    }\n                  };\n                  $(oncoprint).on(events.MOVE_TRACK, function() {\n                    $(ret).trigger(events.MOVE_TRACK);\n                  });\n                  $(renderer).on(events.FINISHED_RENDERING, function() {\n                    $(ret).trigger(events.FINISHED_RENDERING);\n                  });\n                  $(oncoprint).on(events.REMOVE_TRACK, function(evt, data) {\n                    $(ret).trigger(events.REMOVE_TRACK, {track_id: data.track_id});\n                  });\n                  $(renderer).on(events.CONTENT_AREA_MOUSEENTER, function(evt, data) {\n                    $(ret).trigger(events.CONTENT_AREA_MOUSEENTER);\n                  });\n                  $(renderer).on(events.CONTENT_AREA_MOUSELEAVE, function(evt, data) {\n                    $(ret).trigger(events.CONTENT_AREA_MOUSELEAVE);\n                  });\n                  return ret;\n                }\n              };\n            })();\n          \n            var OncoprintSVGRenderer = (function() {\n                  var events = oncoprint_events;\n                  var utils = oncoprint_utils;\n\n                  var TOOLBAR_CONTAINER_CLASS = 'oncoprint-toolbar-ctr';\n                  var LABEL_AREA_CONTAINER_CLASS = 'oncoprint-label-area-ctr';\n                  var CELL_AREA_CONTAINER_CLASS = 'oncoprint-cell-area-ctr';\n                  var CELL_AREA_CLASS = 'oncoprint-cell-area';\n                  var COLUMN_HIGHLIGHT_CLASS = 'oncoprint-column-highlight'\n                  \n                  var CELL_HOVER_CLASS = 'oncoprint-cell-hover';\n                  var LEGEND_HEADER_CLASS = 'oncoprint-legend-header';\n                  var LABEL_DRAGGING_CLASS = 'oncoprint-label-dragging';\n                  var LABEL_DRAGGABLE_CLASS = 'oncoprint-label-draggable';\n                  var CELL_QTIP_CLASS = 'oncoprint-cell-qtip';\n\n                  function OncoprintSVGRenderer(container_selector_string, oncoprint, config) {\n                    OncoprintRenderer.call(this, oncoprint, config);\n                    var self = this;\n                    this.track_cell_selections = {};\n                    this.track_cells = {};\n                    this.active_rule_set_rules = {};\n                    this.toolbar_container;\n                    this.label_div;\n                    this.label_drag_div;\n                    this.label_container;\n                    this.cell_container;\n                    this.cell_container_node;\n                    this.cell_div;\n                    this.legend_table;\n                    this.document_fragment;\n                    this.percent_altered_max_width = utils.textWidth('100%', self.getLabelFont());\n                    this.altered_data_percentage = {};\n                    \n                    this.cell_tooltip_html = '';\n\n                    this.container = d3.select(container_selector_string);\n                    this.container.classed('noselect', true).selectAll('*').remove();\n                    this.container.append('br');\n                    (function initLegend() {\n                      if (config.legend) {\n                        self.legend_table = d3.select(container_selector_string).append('table').style('border-collapse', 'collapse');\n                      }\n                    })();\n                    var content_area = d3.select(container_selector_string).append('div').classed('oncoprint-content-area', true);\n                    (function initLabelContainer() {\n                      self.label_container = content_area.append('div').classed(LABEL_AREA_CONTAINER_CLASS, true).style('position', 'relative');\n                      self.label_div = self.label_container.append('div').style('position', 'relative').style('overflow', 'hidden');\n                      self.label_drag_div = self.label_container.append('div').style('position', 'absolute').style('overflow', 'hidden')\n                              .style('top', '0px').style('left','0px')\n                              .style('display','none');\n                    })();\n                    (function initCellContainer() {\n                      self.cell_container = content_area.append('div').classed(CELL_AREA_CONTAINER_CLASS, true);\n                      self.cell_column_highlight = self.cell_container.append('div').classed(COLUMN_HIGHLIGHT_CLASS, true)\n                            .style('height', self.getCellAreaHeight())\n                            .style('visibility', 'hidden');\n\n                      self.cell_container_node = self.cell_container.node();\n                      self.cell_div = self.cell_container.append('div').classed(CELL_AREA_CLASS, true);\n\n                    \n                      self.cell_mouseover_div = self.cell_container.append('div').style('position', 'absolute').style('overflow', 'hidden')\n                              .style('top', '0px').style('left','0px');\n                      self.cell_container_node.addEventListener(\"scroll\", function() {\n                        self.calculateVisibleInterval();\n                        self.clipAndPositionCells();\n                      });\n                      var mouseMove, mouseOut;\n                      (function() {\n                        var prev_track, prev_cell_index, prev_dom, highlighted_col_cells = [];\n                        var column_highlight_timeout;\n                        $(self.cell_div.node()).qtip({\n                          content: 'SHARED QTIP',\n                          position: {target: 'event', my:'bottom middle', at:'top middle', viewport: $(window)},\n                          style: { classes: CELL_QTIP_CLASS, border: 'none'},\n                          show: {event: \"cell-mouseover\"},\n                          hide: {fixed: true, delay: 100, event: \"cell-mouseout\"},\n                          events: {\n                            show: function() {\n                              $(this).find('.qtip-content').html(self.cell_tooltip_html);\n                            },\n                            render: function(){\n                              $(this).find('.qtip-content').html(self.cell_tooltip_html);\n                            }\n                          }\n                        });\n                        var hover_cell = function(dom) {\n                          $('.'+CELL_QTIP_CLASS).finish();\n                          $(dom).trigger(\"cell-mouseover\");\n                        };\n                        var unhover_cell = function(dom) {\n                          $('.'+CELL_QTIP_CLASS).finish();\n                          $(dom).trigger(\"cell-mouseout\");\n                        };\n                        var clear_and_unhover = function() {\n                          prev_track = undefined;\n                          prev_cell_index = undefined;\n                          prev_dom && unhover_cell(prev_dom);\n                          prev_dom = undefined;\n                          //self.cell_column_highlight.style('visibility', 'hidden');\n                          column_highlight_timeout && clearTimeout(column_highlight_timeout)\n                          _.each(highlighted_col_cells, function(cell) {\n                            if (cell) {\n                              cell.style.border = '';\n                              cell.style.margin = '';\n                            }\n                          });\n                          highlighted_col_cells = [];\n                        };\n                        mouseOut = function() {\n                          clear_and_unhover();\n                        };\n                        mouseMove = function(evt) {\n                          var mouseX = utils.mouseX(evt);\n                          var mouseY = utils.mouseY(evt);\n                          var track_cell_tops = self.getTrackCellTops();\n                          var track = (function() {\n                            var closest_track_dist = Number.POSITIVE_INFINITY;\n                            var closest_track = undefined;\n                            _.each(track_cell_tops, function(top, track_id) {\n                              var dist = mouseY - top;\n                              if (dist >= 0 && dist < closest_track_dist) {\n                                closest_track_dist = dist;\n                                closest_track = track_id;\n                              }\n                            });\n                            return closest_track;\n                          })();\n                          if (!track) {\n                            clear_and_unhover();\n                            return;\n                          }\n                          var track_height = oncoprint.getCellHeight(track);\n                          if (mouseY > track_cell_tops[track] + track_height) {\n                            clear_and_unhover();\n                            return;\n                          }\n                          var cell_width = oncoprint.getZoomedCellWidth();\n                          var cell_unit = cell_width + oncoprint.getCellPadding();\n                          if (mouseX % cell_unit > cell_width) {\n                            clear_and_unhover();\n                            return;\n                          }\n                          // at this point, we are hovered over a cell position\n                          var cell_index = Math.floor(mouseX / cell_unit);\n                          if (cell_index !== prev_cell_index || track !== prev_track) {\n                            //self.cell_column_highlight.style('visibility', 'hidden');\n                            column_highlight_timeout && clearTimeout(column_highlight_timeout)\n                            // not the same cell as before\n                            clear_and_unhover();\n                            var cell_id = oncoprint.getVisibleIdOrder()[cell_index];\n                            var track_cell = self.track_cells[track][cell_id];\n                            if (!track_cell) {\n                              // track doesn't have a cell there\n                              return;\n                            }\n                            // otherwise, we're over a cell\n                            $('.'+CELL_QTIP_CLASS).finish().hide();\n                            prev_cell_index = cell_index;\n                            prev_track = track;\n                            prev_dom = track_cell.dom;\n                            self.cell_tooltip_html = oncoprint.getTrackTooltip(track)(track_cell.d);\n                            hover_cell(prev_dom);\n                            column_highlight_timeout = setTimeout(function() {\n                              highlighted_col_cells = _.map(self.track_cells, function(cells, track_id) {\n                                var cell = cells[cell_id].dom;\n                                if (cell) {\n                                  if (track_id === track) {\n                                    cell.style.border = \"1px solid #000000\";\n                                    cell.style.margin = \"-1px\";\n                                  } else {\n                                    cell.style.border = \"1px solid #999999\";\n                                    cell.style.margin = \"-1px\";\n                                  }\n                                }\n                                return cell;\n                              });\n                            }, 200);\n                          }\n                        };\n                      })();\n                      self.cell_mouseover_div.node().addEventListener('mousemove', mouseMove);\n                      self.cell_mouseover_div.node().addEventListener('mouseout', mouseOut);\n                      // TODO: magic number\n                      self.cell_div.style('max-width', '1000px');\n                    })();\n                    $(content_area.node()).hover(function() {\n                      $(self.label_div.node()).find('.'+self.getTrackButtonCSSClass()).stop().fadeTo(80,1);\n                    }, function() {\n                      $(self.label_div.node()).find('.'+self.getTrackButtonCSSClass()).stop().fadeOut(500);\n                    });\n                    \n                    (function reactToOncoprint() {\n                      $(oncoprint).on(events.REMOVE_TRACK, function(evt, data) {\n                        var track_id = data.track_id;\n                        delete self.rule_sets[track_id];\n                        delete self.track_cell_selections[track_id];\n                        delete self.altered_data_percentage[track_id];\n                        self.removeTrackCells(track_id);\n                        self.removeTrackLabels(track_id);\n                        self.removeTrackButtons(track_id);\n                        \n                        self.computeTrackCellTops();\n                        //self.renderLegend();\n                        self.renderTrackLabels();\n                        self.renderTrackButtons();\n                        self.resizeLabelDiv();\n                        self.resizeCellDiv();\n                        oncoprint.sort();\n                      });\n                      $(oncoprint).on(events.MOVE_TRACK, function(evt, data) {\n                        self.computeTrackCellTops();\n                        self.clipAndPositionCells(data.moved_tracks, 'top', true);\n                        self.renderTrackLabels();\n                        self.renderTrackButtons();\n                        oncoprint.sort();\n                      });\n\n                      $(oncoprint).on(events.ADD_TRACK, function(e,d) {\n                        //this.cell_div.style('display', 'none');\n                        self.drawCells(d.track_id);\n                        self.clipAndPositionCells(undefined, 'top', true);\n                        self.computeTrackCellTops();\n                        self.renderTrackLabels();\n                        self.renderTrackButtons();\n                        self.resizeLabelDiv();\n                        //self.clipCells(true, d.track_id);\n                        //this.cell_div.style('display','inherit');\n                      });\n\n                      $(oncoprint).on(events.SET_TRACK_DATA, function(e,d) {\n                        //this.cell_div.style('display', 'none');\n                        self.drawCells(d.track_id);\n                        self.clipAndPositionCells(d.track_id, undefined, true);\n                        self.computeAlteredDataPercentage(d.track_id);\n                        self.renderTrackLabels(d.track_id);\n                        self.resizeCellDiv();\n                        self.renderLegend();\n                        //self.clipCells(true);\n                        //this.cell_div.style('display','inherit');\n                      });\n\n\n                      $(oncoprint).on(events.SET_CELL_PADDING, function(e,d) {\n                        self.clipAndPositionCells(undefined, undefined, true);\n                        self.resizeCellDiv();\n                      });\n\n                      $(oncoprint).on(events.SET_ZOOM, function(e,d) {\n                        self.clipAndPositionCells(undefined, undefined, true);\n                        self.resizeCells();\n                        self.resizeCellDiv();\n                        //self.cell_highlight.style('width', oncoprint.getZoomedCellWidth() + 'px');\n                      });\n\n                      $(oncoprint).on(events.SET_VISIBLE_ID_ORDER, function() {\n                        self.clipAndPositionCells(undefined, undefined, true);\n                        self.resizeCellDiv();\n                      });\n                    })();\n                  }\n                  utils.extends(OncoprintSVGRenderer, OncoprintRenderer);\n                  OncoprintSVGRenderer.prototype.computeAlteredDataPercentage = function(track_id) {\n                    var rule_set = this.getRuleSet(track_id);\n                    if (rule_set && rule_set.alteredData) {\n                      var data = this.oncoprint.getTrackData(track_id);\n                      var num_altered = rule_set.alteredData(data).length;\n                      var percent_altered = Math.floor(100 * num_altered / data.length);\n                      this.altered_data_percentage[track_id] = percent_altered;\n                    }\n                  };\n                  OncoprintSVGRenderer.prototype.getAlteredDataPercentage = function(track_id) {\n                    return this.altered_data_percentage[track_id];\n                  };\n                  OncoprintSVGRenderer.prototype.calculateVisibleInterval = function() {\n                    var cell_unit = this.oncoprint.getZoomedCellWidth() + this.oncoprint.getCellPadding();\n                    var cell_ctr_rect = this.cell_container_node.getBoundingClientRect();\n                    this.visible_interval = [this.cell_container_node.scrollLeft, this.cell_container_node.scrollLeft + cell_ctr_rect.right - cell_ctr_rect.left];\n                    return this.visible_interval;\n                  };\n                  OncoprintSVGRenderer.prototype.getVisibleInterval = function() {\n                    return (this.visible_interval || this.calculateVisibleInterval());\n                  };\n                  OncoprintSVGRenderer.prototype.cellRenderTarget = function() {\n                    return d3.select(this.document_fragment || this.cell_div.node());\n                  };\n                  OncoprintSVGRenderer.prototype.suppressRendering = function() {\n                    this.document_fragment = document.createDocumentFragment();\n                  };\n                  OncoprintSVGRenderer.prototype.releaseRendering = function() {\n                    this.cell_div.node().appendChild(this.document_fragment);\n                    this.document_fragment = undefined;\n                    var self = this;\n                    $(this.cell_div.node()).ready(function() {\n                      self.resizeCells();\n                      self.clipAndPositionCells(undefined, undefined, true);\n                    });\n                  };\n                  // Rule sets\n                  OncoprintSVGRenderer.prototype.setRuleSet = function(track_id, type, params) {\n                    OncoprintRenderer.prototype.setRuleSet.call(this, track_id, type, params);\n                    this.active_rule_set_rules[this.getRuleSet(track_id).getRuleSetId()] = {};\n                    this.drawCells(track_id);\n                    this.clipAndPositionCells(track_id, undefined, true);\n                    this.renderLegend();\n                    this.computeAlteredDataPercentage(track_id);\n                    this.renderTrackLabels(track_id);\n                  };\n                  OncoprintSVGRenderer.prototype.useSameRuleSet = function(target_track_id, source_track_id) {\n                    OncoprintRenderer.prototype.useSameRuleSet.call(this, target_track_id, source_track_id);\n                    this.drawCells(target_track_id);\n                    this.clipAndPositionCells(target_track_id, undefined, true);\n                    this.renderLegend();\n                    this.computeAlteredDataPercentage(target_track_id);\n                    this.renderTrackLabels(target_track_id);\n                  }\n\n                  // Containers\n                  OncoprintSVGRenderer.prototype.getLabelDiv = function() {\n                    return this.label_div;\n                  };\n                  OncoprintSVGRenderer.prototype.getLabelDragDiv = function() {\n                    return this.label_drag_div;\n                  };\n                  OncoprintSVGRenderer.prototype.resizeCellDiv = function() {\n                    this.cell_div.style('min-width', this.getCellAreaWidth()+'px')\n                        .style('min-height', this.getCellAreaHeight()+'px');\n                    \n                    this.cell_mouseover_div.style('min-width', this.getCellAreaWidth()+'px')\n                        .style('min-height', this.getCellAreaHeight()+'px');\n                    this.cell_column_highlight.style('height', this.getCellAreaHeight() + 'px');\n                  };\n                  OncoprintSVGRenderer.prototype.resizeLabelDiv = function() {\n                    this.getLabelDiv().style('width', this.getLabelAreaWidth()+'px')\n                        .style('height', this.getLabelAreaHeight()+'px');\n                    this.getLabelDragDiv().style('width', this.getLabelAreaWidth()+'px')\n                        .style('height', this.getLabelAreaHeight()+'px');\n                  };\n\n                  // Labels\n                  OncoprintSVGRenderer.prototype.removeTrackLabels =function(track_ids) {\n                    track_ids = typeof track_ids === \"undefined\" ? this.oncoprint.getTracks() : track_ids;\n                    track_ids = [].concat(track_ids); \n                    var div = this.label_div;\n                    var self = this;\n                    _.each(track_ids, function(track_id) {\n                      div.selectAll(self.getTrackLabelCSSSelector(track_id)).remove();\n                    });\n                  }\n                  OncoprintSVGRenderer.prototype.renderTrackLabels = function(track_ids, y, render_whole_labels) {\n                    var div = this.label_div;\n                    if (typeof y !== \"undefined\") {\n                      div.selectAll(this.getTrackLabelCSSSelector(track_ids)).style('top', y+'px');\n                    } else {\n                      track_ids = typeof track_ids === \"undefined\" ? this.oncoprint.getTracks() : track_ids;\n                      track_ids = [].concat(track_ids);\n                      var label_tops = this.getTrackLabelTops();\n                      var self = this;\n                      var label_area_width = this.getLabelAreaWidth();\n                      var percent_altered_left = label_area_width - this.percent_altered_max_width;\n                      _.each(track_ids, function(track_id) {\n                        var label_top = label_tops[track_id];\n                        var track_label_class = self.getTrackLabelCSSClass(track_id);\n                        var label_text = self.oncoprint.getTrackLabel(track_id);\n                        var disp_label_text = label_text;\n                        if (label_text.length > self.max_label_length && !render_whole_labels) {\n                          disp_label_text = label_text.substring(0,self.max_label_length-3)+'...';\n                        }\n                        _.each(div.selectAll(self.getTrackLabelCSSSelector(track_id)), function(node) {\n                          $(node).qtip('destroy');\n                        });\n                        div.selectAll(self.getTrackLabelCSSSelector(track_id)).remove();\n                        var span = div.append('span')\n                          .style('position','absolute')\n                          .classed(self.getTrackLabelCSSClass(track_id), true)\n                          .classed('oncoprint-track-label-draggable', true)\n                          .classed('oncoprint-track-label-main', true)\n                          .classed('oncoprint-track-label', true)\n                          .classed('noselect', true)\n                          .style('font-family', self.getLabelFont())\n                          .style('font-weight', 'bold')\n                          .text(disp_label_text)\n                          .style('top', label_top+'px')\n                          .on(\"mousedown\", function() {\n                            self.dragLabel(track_id);\n                          });\n                          $(span.node()).qtip( {content: {text: (label_text.length > self.max_label_length ? label_text+'<br> hold to drag' : 'hold to drag') },\n                                  position: {my:'middle right', at:'middle left', viewport: $(window)},\n                                  style: { classes: 'qtip-light qtip-rounded qtip-shadow qtip-lightyellow'},\n                                  show: {event: \"mouseover\"}\n                                });\n                        var percent_altered = self.getAlteredDataPercentage(track_id);\n                        if (typeof percent_altered !== 'undefined') {\n                          div.append('span')\n                            .style('position','absolute')\n                            .classed(self.getTrackLabelCSSClass(track_id), true)\n                            .classed('oncoprint-track-label', true)\n                            .classed('noselect', true)\n                            .style('font-family', self.getLabelFont())\n                            .text(percent_altered + '%')\n                            .style('top', label_top+'px')\n                            .style('left', percent_altered_left+'px');  \n                        }\n                      });\n                    }\n                  };\n\n                  // Buttons\n                  OncoprintSVGRenderer.prototype.getTrackButtonCSSClass = function(track_id) {\n                    return 'oncoprint-track-button'+utils.ifndef(track_id, \"\");\n                  };\n                  OncoprintSVGRenderer.prototype.removeTrackButtons = function(track_ids) {\n                    var div = this.label_div;\n                    track_ids = typeof track_ids === \"undefined\" ? this.oncoprint.getTracks() : track_ids;\n                    track_ids = [].concat(track_ids);\n                    var self = this;\n                    _.each(track_ids, function(track_id) {\n                      div.selectAll('.'+self.getTrackButtonCSSClass(track_id)).remove();\n                    });\n                  };\n                  OncoprintSVGRenderer.prototype.renderTrackButtons = function(track_ids) {\n                    var div = this.label_div;\n                    track_ids = typeof track_ids === \"undefined\" ? this.oncoprint.getTracks() : track_ids;\n                    track_ids = [].concat(track_ids);\n                    var label_tops = this.getTrackLabelTops();\n                    var self = this;\n                    var label_area_width = this.getLabelAreaWidth();\n                    _.each(track_ids, function(track_id) {\n                      var button_class = self.getTrackButtonCSSClass(track_id);\n                      div.selectAll('.'+button_class).remove();\n                      var left = label_area_width - 15;\n                      if (self.oncoprint.isTrackRemovable(track_id)) {\n                        (function() {\n                          var new_btn = div.append('span').classed('noselect', true).style('font-size','12px').style('color', '#87CEFA').style('cursor', 'pointer')\n                          .classed(button_class, true).classed(self.getTrackButtonCSSClass(), true).on('click', function() {\n                            self.oncoprint.removeTrack(track_id);\n                          })\n                          .style('position', 'absolute').style('left', left+'px').style('top', label_tops[track_id]+'px');\n                          new_btn.text('X');\n                          $(new_btn.node()).hover(function() {\n                            new_btn.style('font-size', '15px').style('color', '#0000FF');\n                          }, function() {\n                            new_btn.style('font-size','12px').style('color', '#87CEFA');\n                          }).qtip({\n                                            //content: {text: 'Click to remove'},\n                                            position: {my:'bottom middle', at:'top middle', viewport: $(window)},\n                                            style: { classes: 'qtip-light qtip-rounded qtip-shadow qtip-lightyellow' },\n                                            show: {event: \"mouseover\"},\n                                            hide: {fixed: true, delay: 100, event: \"mouseout\"}\n                                            });\n                        })();\n                        left -= 35;\n                      }\n                      if (self.oncoprint.isTrackSortDirectionChangable(track_id)) {\n                        (function() {\n                          var imgs = ['images/decreaseSort.svg', 'images/increaseSort.svg', 'images/nonSort.svg'];\n                          var descs = ['Click to sort in descending order', 'Click to not sort on this track', 'Click to sort in ascending order'];\n                          var sort_direction = [1, -1, 0];\n                          var current_sort_setting = sort_direction.indexOf(self.oncoprint.getTrackSortDirection(track_id));\n                          var new_btn = div.append('img');\n                          new_btn.attr('src', imgs[current_sort_setting]).style('cursor','pointer');\n                          $(new_btn.node()).qtip({\n                                            content: {text: function() {\n                                              return descs[current_sort_setting];\n                                            }},\n                                            position: {my:'bottom middle', at:'top middle', viewport: $(window)},\n                                            style: { classes: 'qtip-light qtip-rounded qtip-shadow qtip-lightyellow' },\n                                            show: {event: \"mouseover\"},\n                                            hide: {fixed: true, delay: 100, event: \"mouseout\"}\n                                            });\n                          new_btn.classed(button_class, true).classed(self.getTrackButtonCSSClass(), true).on('click', function() {\n                            current_sort_setting = (current_sort_setting + 1) % 3;\n                            self.oncoprint.setTrackSortDirection(track_id, sort_direction[current_sort_setting]);//toggleTrackSortDirection(track_id);\n                            new_btn.attr('src', imgs[current_sort_setting]);\n                          })\n                          .style('position', 'absolute').style('left', left+'px').style('top', label_tops[track_id]+'px');\n                        })();\n                      }\n                    });\n                  };\n\n                  // Cells\n                  OncoprintSVGRenderer.prototype.resizeCells = function(new_width) {\n                    this.cell_div.selectAll('svg.'+this.getCellCSSClass()).style('width', this.oncoprint.getZoomedCellWidth()+'px');\n                  };\n                  OncoprintSVGRenderer.prototype.removeTrackCells = function(track_id) {\n                    this.cell_div.selectAll('svg.'+this.getTrackCellCSSClass(track_id)).remove();\n                  };\n                  OncoprintSVGRenderer.prototype.drawTrackCells = function(track_id, fragment) {\n                    var oncoprint = this.oncoprint;\n                    var data = oncoprint.getTrackData(track_id);\n                    var id_key = oncoprint.getTrackDatumIdKey(track_id);\n                    var id_accessor = oncoprint.getTrackDatumIdAccessor(track_id);\n                    var rule_set = this.getRuleSet(track_id);\n                    if (!rule_set) {\n                      return;\n                    }\n                    var self = this;\n\n                    this.track_cells[track_id] = {};\n                    var cell_class = this.getCellCSSClass();\n                    var track_cell_class = this.getTrackCellCSSClass(track_id);\n                    var track_cells = this.track_cells[track_id];\n\n                    var bound_svg = d3.select(fragment).selectAll('svg.'+track_cell_class).data(data);\n                    bound_svg.enter().append('svg').classed(track_cell_class, true).classed(cell_class, true)\n                      .attr('shape-rendering','geometricPrecision')\n                      .attr('preserveAspectRatio','none')\n                      .attr('viewBox', '0 0 '+oncoprint.getFullCellWidth()+' '+oncoprint.getCellHeight(track_id))\n                      .style('width', oncoprint.getZoomedCellWidth()+'px').style('height', oncoprint.getCellHeight(track_id)+'px');\n                    bound_svg.exit().remove();\n\n                    var tooltip = oncoprint.getTrackTooltip(track_id);\n                    bound_svg.each(function(d,i) {\n                      var dom_cell = this;\n                      var id = id_accessor(d);\n                      track_cells[id] = {dom: this, d: d};\n                    });\n                    bound_svg.selectAll('*').remove();\n                    this.active_rule_set_rules[rule_set.getRuleSetId()][track_id] = rule_set.apply(bound_svg, oncoprint.getFullCellWidth(), oncoprint.getCellHeight(track_id));\n                    self.track_cell_selections[track_id] = bound_svg;\n                  };\n                  OncoprintSVGRenderer.prototype.drawCells = function(track_ids) {\n                    var fragment;\n                    if (this.document_fragment) {\n                      //HACK\n                      fragment = document.createDocumentFragment();\n                    } else {\n                      fragment = this.cell_div.node();\n                    }\n                    track_ids = typeof track_ids === \"undefined\" ? this.oncoprint.getTracks() : track_ids;\n                    track_ids = [].concat(track_ids);\n                    var self = this;\n                    _.each(track_ids, function(track_id) {\n                      self.drawTrackCells(track_id, fragment);\n                    });\n                    if (this.document_fragment) {\n                      this.cellRenderTarget().node().appendChild(fragment);\n                    }\n                    setTimeout(function() {\n                      $(self).trigger(events.FINISHED_RENDERING);\n                    }, 0);\n                  };\n\n                  // Positioning\n                  OncoprintSVGRenderer.prototype.clipAndPositionCells = function(track_ids, axis, force, display_all) {\n                    this.cell_div.node().display = 'none';\n                    track_ids = typeof track_ids === \"undefined\" ? this.oncoprint.getTracks() : track_ids;\n                    track_ids = [].concat(track_ids);\n                    var visible_interval = this.getVisibleInterval();\n                    var interval_width = 4*(visible_interval[1] - visible_interval[0]);\n                    var interval_number = Math.floor(visible_interval[0] / interval_width);\n                    visible_interval = _.map([-interval_width, 2*interval_width], function(x) { \n                      return Math.max(x + interval_number*interval_width, 0); \n                    });\n                    var self = this;\n                    var track_cell_tops = this.getTrackCellTops();\n                    var id_order = this.oncoprint.getVisibleInvertedIdOrder();\n                    var cell_x = this.getCellXArray(Object.keys(id_order).length);\n                    _.each(track_ids, function(track_id) {\n                      var y;\n                      if (!axis || axis === 'top') {\n                        y = track_cell_tops[track_id];\n                      }\n                      var id_key = self.oncoprint.getTrackDatumIdKey(track_id);\n                      if ((interval_number !== self.prev_interval_number) || force) {\n                        if (self.track_cell_selections.hasOwnProperty(track_id)) {\n                          self.track_cell_selections[track_id].each(function(d,i) {\n                            var new_x = cell_x[id_order[d[id_key]]];\n                            var disp = this.style.display;\n                            var new_disp = ((isNaN(new_x) || new_x < visible_interval[0] || new_x > visible_interval[1]) && !display_all) ? 'none' : 'inherit';\n                            if (disp !== new_disp) {\n                              this.style.display = new_disp;\n                            }\n                            if ((!axis || axis === 'left') && new_disp !== 'none') {\n                              this.style.left = new_x + 'px';\n                            }\n                            if ((!axis || axis === 'top') && new_disp !== 'none') {\n                              this.style.top = y+'px';\n                            }\n                          });\n                        }\n                      }\n                    });\n                    this.prev_interval_number = interval_number;\n                    this.cell_div.node().display = 'block';\n                  };\n\n                  OncoprintSVGRenderer.prototype.setLegendVisible = function(track_ids, visible) {\n                    var self = this;\n                    track_ids = typeof track_ids === \"undefined\" ? this.oncoprint.getTracks() : [].concat(track_ids);\n                    _.each(track_ids, function(id) {\n                      self.getRuleSet(id).exclude_from_legend = !visible;\n                    });\n                    this.renderLegend();\n                  };\n                  OncoprintSVGRenderer.prototype.renderLegend = function(include_all) {\n                    var cell_width = this.oncoprint.getFullCellWidth();\n                    var self = this;\n                    var rendered = {};\n                    self.legend_table.selectAll('*').remove();\n                    _.each(this.rule_sets, function(rule_set, track_id) {\n                      if (rule_set.exclude_from_legend && !include_all) {\n                        return;\n                      }\n                      var rule_set_id = rule_set.getRuleSetId();\n                      var active_rules = {};\n                      _.each(self.active_rule_set_rules[rule_set_id], function(track_map, track_id) {\n                        $.extend(active_rules, track_map);\n                      });\n                      if (!rendered.hasOwnProperty(rule_set_id)) {\n                        var tr = self.legend_table.append('tr');\n                        var label_header = tr.append('td').style('padding-top', '1em').style('padding-bottom', '1em')\n                              .append('span').classed('oncoprint-legend-header', true);\n                        label_header.text(rule_set.getLegendLabel());\n                        var legend_body_td = tr.append('td');\n                        var legend_div = rule_set.getLegendDiv(active_rules, cell_width, self.oncoprint.getCellHeight(track_id));\n                        legend_body_td.node().appendChild(legend_div);\n                        utils.d3SelectChildren(d3.select(legend_div), '*').classed('oncoprint-legend-block-span', true);\n                        rendered[rule_set_id] = true;\n                      }\n                    });\n                  };\n                  OncoprintSVGRenderer.prototype.dragLabel = function(track_id) {\n                    this.getLabelDragDiv().style('display','block');\n                    var track_group = this.oncoprint.getContainingTrackGroup(track_id);\n                    var first_track = track_group[0], last_track=track_group[track_group.length-1];\n                    var all_track_tops = this.getTrackLabelTops();\n                    var track_tops = {};\n                    _.each(track_group, function(id) { \n                      track_tops[id] = all_track_tops[id];\n                    });\n                    track_group.splice(track_group.indexOf(track_id), 1);\n                    var group_track_tops = _.map(track_group, function(id) {\n                      return track_tops[id];\n                    });\n                    var label_area_height = this.getLabelAreaHeight();\n                    var drag_bounds = [undefined, undefined];\n                    drag_bounds[0] = utils.clamp(track_tops[first_track], 0, label_area_height);\n                    drag_bounds[1] = utils.clamp(track_tops[last_track]+this.getRenderedTrackHeight(last_track), 0, label_area_height);\n\n                    var self = this;\n                    var $label_drag_div = $(self.getLabelDragDiv().node());\n                    delete track_tops[track_id];\n\n                    (function(track_id) {\n                      var new_pos = -1;\n                      var moveHandler = function(evt) {\n                        if (evt.stopPropagation) {\n                          evt.stopPropagation();\n                        }\n                        if (evt.preventDefault) {\n                          evt.preventDefault();\n                        }\n                        var mouse_y = utils.clamp(utils.mouseY(evt), drag_bounds[0], drag_bounds[1]);\n                        self.renderTrackLabels(track_id, mouse_y);\n                        d3.selectAll(self.getTrackLabelCSSSelector(track_id)).classed(LABEL_DRAGGING_CLASS, true);\n                        \n                        new_pos = _.sortedIndex(group_track_tops, mouse_y);\n                        _.each(track_tops, function(top, id) {\n                          top += 3*(+(new_pos < track_group.length && track_group[new_pos] == id));\n                          top -= 3*(+(new_pos > 0 && track_group[new_pos-1] == id));\n                          self.renderTrackLabels(id, top);\n                        });\n                      }\n                      $label_drag_div.on(\"mousemove\", moveHandler);\n                      var mouseUpHandler = function(evt) {\n                        $label_drag_div.hide();\n                        $label_drag_div.off(\"mousemove\", moveHandler);\n                        if (new_pos > -1) {\n                          self.oncoprint.moveTrack(track_id, new_pos);\n                        }\n                      };\n                      $(document).one(\"mouseup\", mouseUpHandler);\n                    })(track_id);\n                  };\n                  OncoprintSVGRenderer.prototype.toSVG = function(full_labels) {\n                    var self = this;\n                    var root = $(this.container.node()).offset();\n                    var svg = d3.select(document.createElementNS('http://www.w3.org/2000/svg', 'svg'));\n                    svg.attr('width', this.getLabelAreaWidth() + this.getCellAreaWidth() + 'px');\n                    this.renderLegend(true);\n                    this.renderTrackLabels(undefined, undefined, full_labels);\n                    svg.attr('height', $(this.container.node()).height()+'px');\n                    (function addLabels() {\n                      self.label_div.selectAll('.oncoprint-track-label').each(function() {\n                        var text_elt = d3.select(this);\n                        var font = text_elt.style('font-family') || 'Arial';\n                        var weight = text_elt.style('font-weight'); \n                        var size = text_elt.style('font-size') || '12px';\n                        var pos = $(text_elt.node()).offset();\n                        var text = text_elt.text();\n                        svg.append('text').style('font-family', font).style('font-weight', weight).style('font-size', size)\n                            .attr('transform', utils.translate(pos.left - root.left,pos.top - root.top))\n                            .style('alignment-baseline', 'hanging')\n                            .text(text);  \n                      });\n                    })();\n                    (function addCells() {\n                      self.clipAndPositionCells(undefined, undefined, true, true);\n                      self.cell_div.selectAll('.oncoprint-cell').each(function() {\n                        var cell_elt = d3.select(this);\n                        var cell_rect = cell_elt.node().getBoundingClientRect();\n                        var cell_dim = {width: cell_rect.width, height: cell_rect.height};\n                        var pos = $(cell_elt.node()).offset();\n                        var g = svg.append('g').attr('transform', utils.translate(pos.left - root.left, pos.top - root.top));\n                        cell_elt.selectAll('*').each(function() {\n                          utils.appendD3SVGElement(d3.select(this), g);\n                        });\n                        var outline_styles = {color: cell_elt.style('outline-color'), width: cell_elt.style('outline-width')};\n                        if (outline_styles.color) {\n                          g.append('rect').attr('width', cell_dim.width+'px').attr('height', cell_dim.height+'px')\n                              .style('fill', 'none').style('stroke', outline_styles.color).style('stroke-width', outline_styles.width);\n                        }\n                      });\n                      //styles = {'outline-color':rule_spec.color, 'outline-style':'solid', 'outline-width':'2px'};\n                      self.clipAndPositionCells(undefined, undefined, true);\n                    })();\n                    (function addLegend() {\n                      self.legend_table.selectAll('tr').each(function() {\n                        d3.select(this).selectAll('td').each(function() {\n                          d3.select(this).selectAll('.oncoprint-legend-header,.oncoprint-legend-element').each(function() {\n                            if ($(this).text().trim().length) {\n                              // text type element\n                              var text_elt = d3.select(this);\n                              var font = text_elt.style('font-family') || 'Arial';\n                              if (font !== 'Arial') {\n                                //console.log(this);\n                              }\n                              var weight = text_elt.style('font-weight'); \n                              var size = text_elt.style('font-size') || '12px';\n                              var text = text_elt.text();\n                              var pos = $(text_elt.node()).offset();\n                              svg.append('text').style('font-family', font).style('font-weight', weight)\n                                .style('font-size', size)\n                                .attr('transform', utils.translate(pos.left - root.left, pos.top - root.top))\n                                .style('alignment-baseline', 'hanging')\n                                .text(text);\n                            } else if (this.tagName.toLowerCase() === 'svg') {\n                              var elt = d3.select(this);\n                              var pos = $(elt.node()).offset();\n                              var g = svg.append('g').attr('transform', utils.translate(pos.left - root.left, pos.top - root.top));\n                              var cell_rect = elt.node().getBoundingClientRect();\n                              var cell_dim = {width: cell_rect.width, height: cell_rect.height};\n                              var outline_styles = {color: elt.style('outline-color'), width: elt.style('outline-width')};\n                              if (outline_styles.color) {\n                                g.append('rect').attr('width', cell_dim.width+'px').attr('height', cell_dim.height+'px')\n                                    .style('fill', 'none').style('stroke', outline_styles.color).style('stroke-width', outline_styles.width);\n                              }\n                              elt.selectAll('*').each(function() {\n                                utils.appendD3SVGElement(d3.select(this), g);\n                              });\n                            }\n                          });\n                        });\n                      });\n                    })();\n                    this.renderLegend();\n                    this.renderTrackLabels();\n                    return svg.node();\n                  };\n                  return OncoprintSVGRenderer;\n            })();\n            \n            function displayOncoprint(msg)\n            {\n               $(\"#onc\").empty();\n               $(\"#oncoprintErrorSection\").empty();\n               $(\".oncoprint-label-col1\").empty();\n              \n               if(msg.status == \"error\") {\n                  vm.errorMessage = JSON.parse(msg.payload);\n                  console.log(\"***** errors in dispalyOncoprint\", vm.errorMessage);\n                  setState(\"errors\"); \n                }else{\n                     var genes = msg.payload[1];\n                     var processed_data = msg.payload[0];\n                     var onc = Oncoprint.create('#onc');\n                     onc.suppressRendering();\n                     $.when(processed_data).then(function(){\n                          if(typeof(genes) === \"string\"){\n                            genes = [genes];\n                           }  \n                          var tracks_to_load = genes.length;\n\n                          var track_id = [];\n                          for(var i = 0; i < genes.length; i++){\n                            var gene = genes[i];\n                            function data_gene_map(obj) {\n                                return obj.gene === gene;\n                            }\n                            var data_gene = processed_data.filter(data_gene_map); \n\n                            var addTrackStart = Date.now();\n                            track_id[i] = onc.addTrack({label: gene, removable:true}, 0);\n                            if(i === 0){\n                              onc.setRuleSet(track_id[i], Oncoprint.GENETIC_ALTERATION);\n                            }else{\n                              onc.useSameRuleSet(track_id[i], track_id[0]);\n                            }\n                            onc.setTrackData(track_id[i], data_gene, true);\n                          }            \n                        onc.releaseRendering();\n                        onc.sort();\n                        $('#toggle_whitespace').click(function() {\n                           onc.toggleCellPadding();\n                        });\n                        var z = 1;\n                        $('#reduce_cell_width').click(function() {\n                            z *= 0.5;\n                            onc.setZoom(z);\n                        });  \n                    //move legend to oncoscape label section\n                    var allOncoLegendBlocks = $(\".oncoprint-legend-block\");\n                    var allOncoLegendLabels = $(\".oncoprint-legend-label\");\n                    for(var j = 0; j < allOncoLegendBlocks.length; j++){\n                      allOncoLegendBlocks[j].appendChild(allOncoLegendLabels[j]);\n                    }\n                    $(\".oncoprint-label-col1\").append(allOncoLegendBlocks); \n                    $(\"#oncoprintInstructions\").hide();\n                  });  \n                }           \n            } // displayOncoprint\n           \n\n            // Initialize\n            osApi.setBusy(true)(\"Loading Dataset\");\n            osApi.setDataset(vm.datasource).then(function(response) {\n                var mtx = response.payload.rownames.filter(function(v) {\n                    return v.indexOf(\"mtx\") >= 0\n                });\n        \n                // Patient Data\n                var rawPatientData = response.payload.tbl;\n                var mtx = mtx[mtx.length - 1].replace(\".RData\", \"\");\n   \n  \n                $scope.$watchGroup(['vm.geneAndPatients'], function() {\n                   drawOncoprint(vm.geneAndPatients);\n                });  \n                 osApi.setBusy(false);\n            });\n\n\n            var _state = \"\";\n            var setState = function(value){\n              if (_state==value) return;\n              switch(value){\n                case \"instructions\":\n                  elControl.hide();\n                  elInstructions.show();\n                  elLegend.hide();\n                  break;\n                case \"control\":\n                  elControl.show();\n                  elInstructions.hide();\n                  elLegend.show();\n                  break;\n                case \"errors\":\n                  elControl.hide();\n                  elInstructions.show();\n                  elLegend.hide();\n                  break;\n              }\n              \n            }\n            \n            // API Call To oncoprint_data_selection\n            var drawOncoprint = function(msg) {\n\n                if ((selectedPatientIds == null) || (selectedGeneIds == null) ){\n                  setState(\"instructions\");\n                  return;\n                } \n              \n                var geneAndPatients = msg;\n                geneAndPatients = geneAndPatients.split(',');\n\n                if(geneAndPatients.length > 350){\n                  vm.errorMessage = \"ERROR: The total number of Patients and Genes are set to be less than 350.\";\n                  setState(\"errors\");\n                }else{\n                  osApi.setBusy(true);\n                  osApi.getOncoprint(geneAndPatients);\n                  osApi.getOncoprint(geneAndPatients).then(function(response) {\n                      var payload = response.payload;\n                      displayOncoprint(payload);\n                      setState(\"control\");\n                      osApi.setBusy(false);\n                  });\n                }\n            }\n\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osMetadata', explore);\n\n    /** @ngInject */\n    function explore() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/metadata/metadata.html',\n            controller: MetadataController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function MetadataController(osApi, $state, $timeout, $scope, $stateParams) {\n\n            if (angular.isUndefined($stateParams.datasource)){\n                $state.go(\"datasource\");\n                return;\n            }\n            // View Model\n            var vm = this;\n            vm.dataset = $stateParams.datasource;\n            vm.colnames = [];\n            vm.rows = [];\n            vm.search = \"\";\n    \n            // Elements\n            var dtTable;\n\n            // Load Datasets\n            osApi.setBusy(true);\n            osApi.getDataManifest(vm.dataset).then(function(response) {\n                vm.colnames = response.payload.colnames;\n                vm.rows = response.payload.mtx;\n                $timeout(function() {\n                    dtTable = angular.element('#metadata-datatable').dataTable({\n                        \"paging\": false\n                    });\n                    $scope.$watch('vm.search', function() {\n                        dtTable.api().search(vm.search).draw();\n                    });\n                    osApi.setBusy(false);\n                }, 0, false);\n            });\n        }\n    }\n})();\n\n(function() {\n    //'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osMarkers', markers);\n\n    /** @ngInject */\n    function markers() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/markers/markers.html',\n            scope: {},\n            controller: MarkersController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function MarkersController(osApi, osHistory, $state, $timeout, $scope, $stateParams, cytoscape, signals, moment, $window, _, $q) {\n\n            osApi.setBusy(true);\n\n            var tmpdata, patientHtml, geneHtml;\n\n            var signal = (function(){\n                return {\n                    patients: {\n                        select: new signals.Signal(),\n                        unselect: new signals.Signal(),\n                        over: new signals.Signal(),\n                        out: new signals.Signal()\n                    },\n                    genes: {\n                        select: new signals.Signal(),\n                        unselect: new signals.Signal(),\n                        over: new signals.Signal(),\n                        out: new signals.Signal()\n                    },\n                    edges: {\n                        select: new signals.Signal(),\n                        unselect: new signals.Signal(),\n                        over: new signals.Signal(),\n                        out: new signals.Signal()\n                    },\n                    clear: function(){\n                        this.edges.select.removeAll();\n                        this.edges.unselect.removeAll();\n                        this.edges.over.removeAll();\n                        this.edges.out.removeAll();\n                        this.patients.select.removeAll();\n                        this.patients.unselect.removeAll();\n                        this.patients.over.removeAll();\n                        this.patients.out.removeAll();\n                        this.genes.select.removeAll();\n                        this.genes.unselect.removeAll();\n                        this.genes.over.removeAll();\n                        this.genes.out.removeAll();\n                    }\n                };\n            })()\n\n            /*\n            *  Cytoscape Chart\n            *  + Node & Edge Styles\n            */\n            var elChart = angular.element(\"#markers-chart\");\n            var cyChart = (function(elChart) {\n                return cytoscape({\n                    container: elChart,\n                    style: [{\n                        selector: 'core',\n                        style: {\n                            'selection-box-color': '#3993fa',\n                            'selection-box-border-color': '#3993fa',\n                            'selection-box-border-width': '1px',\n                            'selection-box-opacity': '.2'\n                        }\n                    }, {\n                        selector: 'node',\n                        style: {\n                            'background-color': \"#3993fa\",\n                            'display': \"data(display)\",\n                            //'height': \"mapData(sizeEle, 0, 50, 10, 100)\",\n                            //'width': \"mapData(sizeEle, 0, 50, 10, 100)\",\n                            'width': 'data(sizeEle)',\n                            'height': 'data(sizeEle)',\n                            'border-width': 'data(sizeBdr)',\n                            'font-size': 'data(sizeLbl)',\n                            'text-valign': 'center'\n                        }\n                    }, {\n                        selector: 'node[nodeType=\"telomere\"]',\n                        style:{\n                            'background-color': \"#3993fa\",   \n                        }\n                    }\n                    , {\n                        selector: 'node[nodeType=\"patient\"]',\n                        style: {\n                            'background-color': 'data(color)',\n                            'text-halign': 'center',\n                            'border-color': '#FFFFFF'\n                        }\n                    }, {\n                        selector: 'node[nodeType=\"patient\"]:selected',\n                        style: {\n                            'border-color': \"#000\",\n                            'border-width': 50\n                        }\n                    }, {\n                        selector: 'node[nodeType=\"gene\"]',\n                        style: {\n                            'background-color': \"#FFFFFF\",\n                            'border-color': \"#38347b\",\n                            'text-halign': \"right\",\n                            'label': \"data(id)\"\n                        }\n                    }, {\n                        selector: 'node[nodeType=\"gene\"]:selected',\n                        style: {\n                            'border-color': \"#FF0000\",\n                            //'background-opacity': '.2'\n                        }\n                    }, {\n                        selector: 'node[nodeType=\"centromere\"]',\n                        style: {\n                            'font-size': '200px',\n                            'text-halign': 'center',\n                            'background-color': \"#3993fa\",\n                            'color': \"#FFFFFF\",\n                            'border-color': 'rgb(19, 150, 222)',\n                            'height': '400px',\n                            'width': '400px',\n                            'shape': 'round',\n                            'label': \"  data(id)\"\n                        }\n                    }, {\n                        selector: 'edge',\n                        style: {\n                            'display': \"data(display)\",\n                            'line-color': \"data(color)\",\n                            'width': \"data(sizeEle)\"\n                        }\n                    }],\n                    hideEdgesOnViewport: false,\n                    hideLabelsOnViewport: true,\n                    textureOnViewport: false,\n                    //motionBlur: true,\n                    //motionBlurOpacity: 0.2,\n                    zoom: 0.01,\n                    pan: {x: 550, y: 160},\n                    //minZoom: .0005,\n                    //maxZoom: 2,\n                    layout: {\n                        name: \"preset\",\n                        fit: true\n                    }\n                });\n            })(elChart);\n\n            /*\n            *  Draw Chromosome\n            */\n            (function(){\n                \n                osApi.query(\"render_chromosome\", {type:\"chromosome\"}).then(function(result){\n\n                    // Process Chromosome\n                    var chromosomes = result.data[0].data;\n                    var elements = [];\n\n                    Object.keys(chromosomes).forEach(function(key){\n                        var chromosome = this.chromosomes[key];\n                        this.elements.push(\n                            {\n                                group: \"edges\",\n                                grabbable: false,\n                                locked: true,\n                                selectable: false,\n                                data:{\n                                    color: \"#3993fa\",\n                                    id: \"ce\"+key,   // Chromosome Edge (CE)\n                                    display: \"element\",\n                                    edgeType:\"chromosome\",\n                                    sizeBdr: 0,\n                                    sizeEle: 60,  // Style?\n                                    source : \"cp\"+key,  // Chromosome P (CP)\n                                    target : \"cq\"+key   // Chromosome Q (CQ)\n                                }\n                            });\n\n                        // Telemere P\n                        this.elements.push({\n                                group: \"nodes\",\n                                grabbable: false,\n                                locked: true,\n                                selectable: false,\n                                position:{\n                                    x: chromosome.x,\n                                    y: chromosome.p\n                                },\n                                data:{\n                                    id:\"cp\"+key,\n                                    display:\"element\",\n                                    nodeType:\"telomere\",\n                                    degree:1,\n                                    sizeBdr: 50,\n                                    sizeEle:50,\n                                    sizeLbl:6,\n                                    subType: \"unassigned\"\n                                }\n                            });\n                        // Telemere Q\n                        this.elements.push({\n                               group: \"nodes\",\n                                grabbable: false,\n                                locked: true,\n                                selectable: false,\n                                position:{\n                                    x: chromosome.x,\n                                    y: chromosome.q\n                                },\n                                data:{\n                                    id:\"cq\"+key,\n                                    display:\"element\",\n                                    nodeType:\"telomere\",\n                                    degree:1,\n                                    sizeBdr:50,\n                                    sizeEle:50,\n                                    sizeLbl:50,\n                                    subType: \"unassigned\"\n                                }\n                            });\n                        // Centromere Q\n                        this.elements.push({\n                                group: \"nodes\",\n                                grabbable: false,\n                                locked: true,\n                                selectable: false,\n                                position:{\n                                    x: chromosome.x,\n                                    y: chromosome.c\n                                },\n                                data:{\n                                    id:key,\n                                    display:\"element\",\n                                    sizeBdr: 50,\n                                    nodeType:\"centromere\",\n                                    degree:1\n                                }\n                            });\n\n                    }, {chromosomes:chromosomes, elements:elements});\n                    cyChart.add(elements);\n\n                    // Select All Genes By Clicking Centromere\n                    // cyChart.$('node[nodeType=\"centromere\"]').on(\"click\", function(e){\n                    //     var posX = e.cyTarget.position().x;\n                    //     cyChart.startBatch();\n                    //     cyChart.$('node[nodeType=\"gene\"]').filter(function(p){  \n                    //         debugger;\n                    //         return p.position().x==this; }, posX)\n                    //         .forEach( function(ele){\n                    //             ele.select();\n                    //         });\n                    //     cyChart.endBatch();\n                    // });\n                });\n            })()\n\n            /*\n            * View Model + Initial Data Load \n            * + Initial Data Load\n            * + View Port Resize Event\n            */\n            var vm = (function(vm, osApi){\n                vm.showPopupSelection = false;\n                vm.datasource = osApi.getDataSource();\n                vm.detail = {show:false, html:\"\", title:\"\"};\n                vm.optGeneSets = [];\n                vm.optGeneSet;\n                vm.optPatientLayouts = [];\n                vm.optPatientLayout;\n                // vm.optDatasets = [];\n                // vm.optDataset;\n                vm.search = \"\";\n                vm.optPatientColors = [];\n                vm.optPatientColor;\n\n                vm.optCommandModes = [\n                    {name: 'Sequential'},\n                    {name: 'Set'},\n                    {name: 'Ad Hoc'}\n                ];\n                vm.optCommandMode = vm.optCommandModes[0];\n\n                vm.selectColor = function(item){\n\n                };\n\n                vm.filterModelEdge = function(){\n\n                    angular.element('#modalEdge').modal('hide');\n                    var vals = vm.optEdgeColors\n                        .filter(function(c){ return c.show; })\n                        .map(function(c){ return c.id});\n                    var edges = tmpdata.edges.filter(function(edge){\n                        return (vals.indexOf(edge.data.cn)!=-1);\n                    }, {vals:vals});\n\n                    cyChart.startBatch();\n                    var elements = cyChart.add(edges);\n                    cyChart.endBatch();\n                    tmpdata = null;\n\n                };\n\n                vm.edgeToggle = function(item){\n                    if (!item.show){\n                        cyChart.remove('edge[cn='+item.id+']');\n                    }\n\n                };\n\n                vm.deselectColor = function(item){\n                    var color = item.color;\n                    var nodes = cyChart.$('node[nodeType=\"patient\"]:selected');\n                    cyChart.startBatch();\n                    nodes.forEach(function(node){\n                        if (node.data().color == this){\n                            node.unselect();\n                        }\n                    }, color);\n                    cyChart.endBatch();\n                };\n\n                vm.lockPatients = false;\n                vm.lockGenes = false;\n                vm.lock = function(type){\n                    switch  (type){\n                        case \"patient\":\n                            vm.lockPatients = !vm.lockPatients;\n                            cyChart.startBatch();\n                            cyChart.$('node[nodeType=\"patient\"]')\n                                .forEach(function(node){ \n                                    if (vm.lockPatients) node.unselectify();\n                                    else node.selectify();\n                                });\n                            cyChart.endBatch();\n                            break;\n                        case \"gene\":\n                            vm.lockGenes = !vm.lockGenes;\n                            cyChart.startBatch();\n                            cyChart.$('node[nodeType=\"cn\"]')\n                                .forEach(function(node){ \n                                    if (vm.lockGenes) node.unselectify();\n                                    else node.selectify();\n                                });\n                            cyChart.endBatch();\n                            break;\n\n                    }\n                    \n                    \n                    //         break;\n                    //     case \"genes\":\n                    //         break;\n                    // }\n                };\n\n                vm.optEdgeColors = [{ \n                    name: 'mutation',\n                    abv:'m',\n                    show: true,\n                    color: '#004358',\n                    class: 'switch-mutation',\n                    id: 0\n                }, {\n                    name: 'cnGain.1',\n                    abv:'cnG1',\n                    show: true,\n                    color: '#1F8A70',\n                    class: 'switch-cnG1',\n                    id: 1\n                }, {\n                    name: 'cnLoss.1',\n                    abv:'cnL1',\n                    show: true,\n                    color: '#FFE11A',\n                    class: 'switch-cnL1',\n                    id: -1\n                }, {\n                    name: 'cnGain.2',\n                    abv:'cnG2',\n                    show: true,\n                    color: '#BEDB39',\n                    class: 'switch-cnG2',\n                    id: 2\n                }, {\n                    name: 'cnLoss.2',\n                    abv:'cnL2',\n                    show: true,\n                    color: '#FD7400',\n                    class: 'switch-cnL2',\n                    id: -2\n                }];\n\n                $q.all([\n                    osApi.query(\"render_chromosome\", { type:'geneset', $fields:['name'] }),\n                    osApi.query(\"render_patient\",    { type:'cluster', $fields:['name'] }),\n                    osApi.query(\"render_patient\",    { type:'color', $fields:['name'] })\n                ]).then(function(results){\n                    vm.optGeneSets = results[0].data;\n                    vm.optGeneSet = vm.optGeneSets[0];\n                    vm.optPatientLayouts = results[1].data;\n                    vm.optPatientLayout = vm.optPatientLayouts[0]\n                    vm.optPatientColors = [{'name':'Default'}].concat(results[2].data);\n                    vm.optPatientColor = vm.optPatientColors[0];\n                });\n                vm.resize = function(){\n                    var width = $window.innerWidth;\n                    if (angular.element(\".tray\").attr(\"locked\")==\"true\") width -= 300;\n                    elChart.width( width );\n                    elChart.height($window.innerHeight - 90);\n                    cyChart.resize();\n                }\n                angular.element($window).bind('resize', \n                    _.debounce(vm.resize, 300)\n                );\n\n            \n                return vm;\n            })(this, osApi);\n\n            /*\n            * Zoom Control Functions\n            * - reset\n            * - fit\n            */\n            var zoom = (function(cyChart,vm){\n                var reset = function(){\n                    cyChart.fit();\n                    cyChart.center();\n                };\n                var fit = function(){\n                    cyChart.fit( cyChart.$(':selected'), 50 )\n                };\n                vm.zoom = {reset:reset, fit:fit};\n\n\n                cyChart.on('pan', _.debounce(function(e) {\n                    cyChart.startBatch();\n                    resizeNodes();\n                    cyChart.endBatch();\n                }, 50));\n\n                return vm.zoom;\n            })(cyChart,vm);\n\n            var resizeNodes = function(){\n                var zoom = (1/cyChart.zoom())/100;\n                if (zoom<.02) zoom = .02;\n                var sizeBdr = 50 * zoom;\n                var sizeLbl = 500 * (zoom*2);\n                var sizeLbl = (sizeLbl>500) ? 0 : sizeLbl;\n                \n                cyChart.$('node[nodeType=\"patient\"],node[nodeType=\"gene\"]').forEach(function(node){\n                        node.data({'sizeEle': node.data().weight * this.zoom, sizeLbl: this.sizeLbl, sizeBdr: this.sizeBdr});\n                    }, { zoom:zoom, sizeBdr:sizeBdr, sizeLbl:sizeLbl});\n            }\n            /* \n            *  Interop Between UI and Worker Thread\n            *  - setGeneSet(name:String)\n            *  - setPatientLayout(name:String)\n            *  - setDataSource(name:String)\n            *  - setOptions(options:Object)\n            */\n            var setOptions = (function(cyChart, vm, osApi, $q, zoom, _, signal){\n\n                // Instatiate Worker\n                var cmd = {};\n                var worker = new Worker(\"app/components/markers/markers.worker.js\");\n                worker.addEventListener('message', function(msg) { cmd[msg.data.cmd](msg.data.data); }, false);\n                \n            \n                var remove = function(selector, data){\n                    if (angular.isUndefined(data)) { cyChart.remove(selector); return; }\n                    try{\n                        var items = data.map(function(item){ return this.getElementById(item); }, cyChart);\n                        cyChart.collection(items).remove();\n                    }catch(e){}\n                };\n                cmd.patients_html = function(data){\n                    patientHtml = data;\n                    console.log(\"PATIENTS HTML\");\n                };\n                cmd.patients_resize = function(data){\n                    console.log(\"PATIENTS RESIZE\");\n                };\n                cmd.patients_delete = function(data) { \n                    console.log(\"PATIENTS DELETE\");\n                    remove('node[nodeType=\"patient\"]', data); \n                };\n                cmd.patients_insert = function(data) { \n                    console.log(\"PATIENTS INSERT\");\n                    cyChart.startBatch();\n                    var signals = signal.patients;\n                    var elements = cyChart.add(data.patients);\n                    elements.on(\"select\", _.debounce(signals.select.dispatch ,300));\n                    elements.on(\"unselect\", _.debounce(signals.unselect.dispatch ,300));\n                    elements.on(\"mouseover\", signals.over.dispatch);\n                    elements.on(\"mouseout\", signals.out.dispatch);\n                    elements.forEach(function(node){\n                        try{\n                            node.data({'weight': data.degrees[node.id()].weight});\n\n                        }catch(e){\n                            node.data({'weight': 100});\n                        }\n                    });\n                    resizeNodes();\n                    cyChart.endBatch();\n                    vm.resize();\n\n                };\n                cmd.patients_color = function(data){\n                    console.log(\"PATIENTS COLOR\");\n                    cyChart.startBatch();\n                    cyChart.nodes('node[nodeType=\"patient\"]').forEach(function(node){\n                        node.data('color', data[node.id()].color);\n                    });\n                    cyChart.endBatch();\n                };\n                cmd.patients_layout = function(data) {\n                    console.log(\"PATIENTS LAYOUT\");\n                    cyChart.startBatch();\n                    cyChart.nodes('node[nodeType=\"patient\"]').forEach(function(node){\n                        try{\n                            var pos = data[node.id()];\n                            pos.x -= 40000;\n                            node.position( pos );\n                        }catch(e){}\n                    });\n                    resizeNodes();\n                    cyChart.endBatch();\n                };\n                cmd.patients_legend = function(data) {\n                    console.log(\"PATIENTS LEGEND\");\n                    $scope.$apply(function(){ vm.legendNodes = data; });\n                };\n                cmd.genes_html = function(data){\n                    geneHtml = data;\n                    console.log(\"GENES HTML\");\n                };\n                cmd.genes_delete    = function(data) { \n                    console.log(\"GENES DELETE\");\n                    remove('node[nodeType=\"gene\"]', data); \n                };\n                cmd.genes_insert    = function(data) { \n                    console.log(\"GENES INSERT\");\n                    cyChart.startBatch();\n                    var signals = signal.genes;\n                    var elements = cyChart.add(data.genes);\n                    elements.on(\"select\", _.debounce(signals.select.dispatch ,300));\n                    elements.on(\"unselect\", _.debounce(signals.unselect.dispatch ,300));\n                    elements.on(\"mouseover\", signals.over.dispatch);\n                    elements.on(\"mouseout\", signals.out.dispatch);\n                    elements.forEach(function(node){\n                        try{\n                            node.data({'weight': data.degrees[node.id()].weight});\n\n                        }catch(e){\n                            node.data({'weight': 500});\n                            \n                        }\n                    });\n                    cyChart.endBatch();\n                    osApi.setBusy(false);\n                };\n                cmd.genes_update    = function(data) {\n                    console.log(\"GENES UPDATE\");\n                    update(data); \n                };\n                cmd.edges_delete    = function(data) { \n                    console.log(\"EDGES DELETE\");\n                    remove('edge[edgeType=\"cn\"]', data); \n                };\n                cmd.edges_insert    = function(data) { \n                    console.log(\"EDGES INSERT\");\n                    tmpdata = data;\n                    if (data.counts.total>5000){\n                        angular.element('#modalEdge').modal();\n                        $scope.$apply(function(){\n                            vm.edgeCounts = data.counts;\n                        });\n                        return;\n                    }\n                    cyChart.startBatch();\n                    if (vm.optCommandMode.name==\"Ad Hoc\") cyChart.$('edge[edgeType=\"cn\"]').remove();\n                    var elements = cyChart.add(data.edges);\n                    cyChart.endBatch();\n                };\n                cmd.edges_update    = function(data) {\n                    console.log(\"EDGES UPDATE\")\n                    update(data); \n                };\n \n                // Outbound\n                return function(options) { \n                    worker.postMessage({cmd:\"setOptions\", data:options}); \n                };\n            })(cyChart, vm, osApi, $q, zoom, _, signal);\n\n            /* Options Factory */\n            var createOptions = (function(cyChart, vm){\n\n                return function(cmd){\n                    cmd = cmd || \"\";\n                    var geneset = vm.optGeneSet.name;\n                    var opts = {\n                        mode: vm.optCommandMode.name,\n                        cmd: cmd,\n                        patients:{\n                            data: vm.datasource.collections.pt,\n                            layout: vm.optPatientLayout.name,\n                            color: vm.optPatientColor.name,\n                            selected: cyChart.$('node[nodeType=\"patient\"]:selected').map(function(p){ return p.data().id })\n                        },\n                        genes:{\n                            layout: vm.optGeneSet.name,\n                            selected: cyChart.$('node[nodeType=\"gene\"]:selected').map(function(p){ return p.data().id })\n                        },\n                        edges:{\n                            layout: vm.datasource.edges\n                                .filter(function(v){ return (v.name==this)}, geneset)[0],\n                            colors: vm.optEdgeColors\n                                .filter(function(f){return f.show })\n                                .map(function(f){ return {id:f.id, color:f.color}; })\n                        }\n                    };\n                    return opts;\n                }\n            })(cyChart, vm)\n\n\n            vm.cmd = function(){}\n\n\n            /*\n            *  Watch View Model\n            *  + vm.optGeneSet\n            *  + vm.optPatientLayout\n            */\n            \n            var watch = (function(vm, $scope){\n                var watches = 1;\n\n                // GeneSet\n                watches += 1;\n                $scope.$watch('vm.optGeneSet', function(){\n                    if (watches>0) {watches -= 1; return; }\n                    if ( angular.isUndefined(vm.optGeneSet) || angular.isUndefined(vm.optPatientColor) || angular.isUndefined(vm.optPatientLayout)) return;\n                    osApi.setBusy(true);\n                    cyChart.$('edge[edgeType=\"cn\"]').remove();\n                    setOptions(createOptions());\n                    \n                });\n\n                // Patient Color\n                watches += 1;\n                $scope.$watch('vm.optPatientColor', function(){\n                    if (watches>0) {watches -= 1; return; }\n                    setOptions(createOptions());\n                });\n\n                // Patient Layout\n                watches += 1;\n                $scope.$watch('vm.optPatientLayout', function(){\n                    if (watches>0) {watches -=1; return; }\n                    setOptions(createOptions());\n                });\n\n                // Search\n                watches += 1;\n                $scope.$watch('vm.search', _.debounce(function(){\n                    if (watches>0) {watches -= 1; return; }\n                    var needle = vm.search.toUpperCase().trim();\n                    cyChart.$('node').unselect();\n                    if (needle.length>0) cyChart.$('node').filter( function(i,ele){ return (ele.id().toUpperCase().indexOf(needle)==0);} ).select();\n                }, 600))\n\n                // Edge Colors\n                watches += 1;\n                $scope.$watch('vm.optEdgeColors.color', function(){\n                    if (watches>0) {watches -= 1; return; }\n                    setOptions(createOptions());\n                    vm.resize()\n                });\n\n            })(vm, $scope);\n\n            function setPatientInfo(e){\n                $scope.$apply(function(){\n                    if (e.type==\"mouseout\"){\n                        vm.detail.show= false\n                    }else{\n                        vm.detail.title = e.cyTarget.id();\n                        vm.detail.html = patientHtml[e.cyTarget.id()]; \n                        vm.detail.show = true;\n                    }\n                });\n            };\n\n            function setGeneInfo(e){\n                console.log(\"genes\");\n            }\n\n\n\n            // Initialize Commands\n            $scope.$watch(\"vm.optCommandMode\", function(){\n                signal.clear();\n                cyChart.$('node').unselect();\n                cyChart.$('edge[edgeType=\"cn\"]').remove();\n                switch (vm.optCommandMode.name)\n                {\n                    case \"Sequential\":\n                        //try{ cyChart.$('node').unselect(); setOptions(createOptions()); }catch(e){}\n                        vm.cmd = function(cmd){\n                            switch (cmd){\n                                case \"HideAllEdges\":\n                                    cyChart.$('edge[edgeType=\"cn\"]').remove();\n                                    break;\n                                case \"HideSelectedEdges\":\n                                    cyChart.$('node[nodeType=\"patient\"]:selected, node[nodeType=\"gene\"]:selected')\n                                        .neighborhood(\"edge\").remove();\n                                    break;\n                                case \"HideUnselectedEdges\":\n                                    cyChart.$('node[nodeType=\"patient\"]:unselected')\n                                        .neighborhood(\"edge\").remove();\n                                    break;\n                                case \"SelectConnected\":\n                                    cyChart.startBatch();\n                                    cyChart.$('node:selected')\n                                        .neighborhood(\"node\")\n                                        .forEach( function(ele){\n                                            ele.select();\n                                        });\n                                    cyChart.endBatch();\n                                    break;\n                                case \"SelectInverse\":\n                                    cyChart.startBatch();\n                                    cyChart.$('node').forEach( function(ele){ ele[ele._private.selected?\"deselect\":\"select\"](); });\n                                    cyChart.endBatch();\n                                    break;\n                                case \"HideUnselectedNodes\":\n                                    cyChart.startBatch();\n                                    cyChart.$('node[nodeType=\"patient\"]:unselected')\n                                        .forEach(function(item){  \n                                            item.style({display:'none'}); });\n                                    cyChart.endBatch();\n                                    break;\n                                case \"ShowAllNodes\":\n                                    cyChart.startBatch();\n                                    cyChart.$('node[nodeType=\"patient\"]:hidden')\n                                        .forEach(function(item){ \n                                            item.style({display:'element'}); });\n                                    cyChart.endBatch();\n                                    break;\n                                default:\n                                    var opts = createOptions(cmd);\n                                    setOptions(opts);\n                                    break;\n                            }\n                        };\n                        signal.genes.over.add(setGeneInfo);\n                        signal.genes.over.add(setGeneInfo);\n                        signal.patients.over.add(setPatientInfo);\n                        signal.patients.out.add(setPatientInfo);\n                        break;\n\n                    case \"Set\":\n                        var unselect = function(){\n                            cyChart.$('edge[edgeType=\"cn\"]').remove();\n                            var opts = createOptions();\n                            if (opts.patients.selected.length>0 || opts.genes.selected.length>0) setOptions(opts); \n                        };\n                        var select = function() { \n                            cyChart.$('edge[edgeType=\"cn\"]').remove();\n                            setOptions(createOptions()); \n                        };\n                        signal.genes.over.add(setGeneInfo);\n                        signal.genes.over.add(setGeneInfo);\n                        signal.patients.over.add(setPatientInfo);\n                        signal.patients.out.add(setPatientInfo);\n                        signal.patients.select.add(select);\n                        signal.patients.unselect.add(unselect);\n                        signal.genes.select.add(select);\n                        signal.genes.unselect.add(unselect);\n                        break;\n\n                    case \"Ad Hoc\":\n                        var over = function(e){\n                            setPatientInfo(e)\n                            e.cyTarget.select();\n                            setOptions(createOptions());\n                        }\n                        var out = function(e){\n                            setPatientInfo(e)\n                            e.cyTarget.unselect();\n                            //cyChart.$('edge[edgeType=\"cn\"]').remove();\n                        }\n                        signal.genes.over.add(setGeneInfo);\n                        signal.genes.over.add(setGeneInfo);\n                        signal.patients.over.add(over);\n                        signal.patients.out.add(out);\n                        signal.genes.over.add(over);\n                        signal.genes.out.add(out);\n                        break;\n                }\n            });\n        }\n    }\n})();\n\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osLogin', login);\n\n\n    /** @ngInject */\n    function login() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/login/login.html',\n            replace: true,\n            controller: LoginController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function LoginController(osApi, $state) {\n            \n            var userApi = osApi.getUserApi();\n\n            var vm = this;\n            vm.domains = userApi.getDomains();\n            vm.user = userApi.getUser();\n            vm.hasError = false;\n\n            vm.login = function() {\n                var promise = userApi.login(vm.user);\n                if (angular.isDefined(promise)){\n                    promise.then(function() {\n                        if (vm.user.authenticated) {\n                            $state.go(\"datasource\");\n                        } else {\n                            vm.hasError = true;\n                        }\n                    });\n                }else{\n                    $state.go(\"datasource\");\n                }\n                \n            }\n        }\n    }\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osLoader', login);\n\n    /** @ngInject */\n    function login() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/loader/loader.html',\n            replace: true\n        };\n\n        return directive;\n    }\n\n})();\n\n(function() {\n    'use strict';\n    angular\n        .module('oncoscape')\n        .directive('osLanding', landing);\n\n    /** @ngInject */\n    function landing() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/landing/landing.html',\n            replace: true,\n            controller: LandingController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function LandingController($state) {\n            var vm = this;\n            vm.login = function() {\n                $state.go(\"login\");\n            }\n        }\n    }\n\n})();\n\n(function(m,o){var k=function(d,k){var g=function(c,a){if(!k.versionCheck||!k.versionCheck(\"1.10.1\"))throw\"DataTables Responsive requires DataTables 1.10.1 or newer\";c.responsive||(this.s={dt:new k.Api(c),columns:[]},a&&\"string\"===typeof a.details&&(a.details={type:a.details}),this.c=d.extend(!0,{},g.defaults,a),c.responsive=this,this._constructor())};g.prototype={_constructor:function(){var c=this,a=this.s.dt;d(m).on(\"resize.dtr\",a.settings()[0].oApi._fnThrottle(function(){c._resize()}));a.on(\"destroy.dtr\",\nfunction(){d(m).off(\"resize.dtr\")});this.c.breakpoints.sort(function(a,b){return a.width<b.width?1:a.width>b.width?-1:0});this._classLogic();this._resizeAuto();this._resize();var b=this.c.details;b.type&&(c._detailsInit(),this._detailsVis(),a.on(\"column-visibility.dtr\",function(){c._detailsVis()}),d(a.table().node()).addClass(\"dtr-\"+b.type))},_columnsVisiblity:function(c){var a=this.s.dt,b=this.s.columns,e,f,h=d.map(b,function(a){return a.auto&&null===a.minWidth?!1:!0===a.auto?\"-\":-1!==a.includeIn.indexOf(c)}),\nn=0;e=0;for(f=h.length;e<f;e++)!0===h[e]&&(n+=b[e].minWidth);a=a.table().container().offsetWidth-n;e=0;for(f=h.length;e<f;e++)b[e].control?a-=b[e].minWidth:\"-\"===h[e]&&(h[e]=0>a-b[e].minWidth?!1:!0,a-=b[e].minWidth);a=!1;e=0;for(f=b.length;e<f;e++)if(!b[e].control&&!h[e]){a=!0;break}e=0;for(f=b.length;e<f;e++)b[e].control&&(h[e]=a);return h},_classLogic:function(){var c=this,a=this.c.breakpoints,b=this.s.dt.columns().eq(0).map(function(a){return{className:this.column(a).header().className,includeIn:[],\nauto:!1,control:!1}}),e=function(a,e){var c=b[a].includeIn;-1===c.indexOf(e)&&c.push(e)},f=function(f,d,j,i){if(j)if(\"max-\"===j){i=c._find(d).width;d=0;for(j=a.length;d<j;d++)a[d].width<=i&&e(f,a[d].name)}else if(\"min-\"===j){i=c._find(d).width;d=0;for(j=a.length;d<j;d++)a[d].width>=i&&e(f,a[d].name)}else{if(\"not-\"===j){d=0;for(j=a.length;d<j;d++)-1===a[d].name.indexOf(i)&&e(f,a[d].name)}}else b[f].includeIn.push(d)};b.each(function(b,e){for(var c=b.className.split(\" \"),i=!1,g=0,k=c.length;g<k;g++){var l=\nd.trim(c[g]);if(\"all\"===l){i=!0;b.includeIn=d.map(a,function(a){return a.name});return}if(\"none\"===l){i=!0;return}if(\"control\"===l){i=!0;b.control=!0;return}d.each(a,function(a,b){var d=b.name.split(\"-\"),c=l.match(RegExp(\"(min\\\\-|max\\\\-|not\\\\-)?(\"+d[0]+\")(\\\\-[_a-zA-Z0-9])?\"));c&&(i=!0,c[2]===d[0]&&c[3]===\"-\"+d[1]?f(e,b.name,c[1],c[2]+c[3]):c[2]===d[0]&&!c[3]&&f(e,b.name,c[1],c[2]))})}i||(b.auto=!0)});this.s.columns=b},_detailsInit:function(){var c=this,a=this.s.dt,b=this.c.details;\"inline\"===b.type&&\n(b.target=\"td:first-child\");var e=b.target;d(a.table().body()).on(\"click\",\"string\"===typeof e?e:\"td\",function(){if(typeof e===\"number\"){var b=e<0?a.columns().eq().length+e:e;if(a.cell(this).index().column!==b)return}if(d(a.table().node()).hasClass(\"collapsed\")){b=a.row(d(this).closest(\"tr\"));if(b.child.isShown()){b.child(false);d(b.node()).removeClass(\"parent\")}else{var h=c.c.details.renderer(a,b[0]);b.child(h,\"child\").show();d(b.node()).addClass(\"parent\")}}})},_detailsVis:function(){var c=this,a=\nthis.s.dt;-1!==a.columns().visible().indexOf(!1)?(d(a.table().node()).addClass(\"collapsed\"),a.rows().eq(0).each(function(b){b=a.row(b);if(b.child()){var e=c.c.details.renderer(a,b[0]);!1===e?b.child.hide():b.child(e,\"child\").show()}})):(d(a.table().node()).removeClass(\"collapsed\"),a.rows().eq(0).each(function(b){a.row(b).child.hide()}))},_find:function(c){for(var a=this.c.breakpoints,b=0,e=a.length;b<e;b++)if(a[b].name===c)return a[b]},_resize:function(){for(var c=this.s.dt,a=d(m).width(),b=this.c.breakpoints,\ne=b[0].name,f=b.length-1;0<=f;f--)if(a<=b[f].width){e=b[f].name;break}var h=this._columnsVisiblity(e);c.columns().eq(0).each(function(a,b){c.column(a).visible(h[b])})},_resizeAuto:function(){var c=this.s.dt,a=this.s.columns;if(this.c.auto&&-1!==d.inArray(!0,d.map(a,function(a){return a.auto}))){c.table().node();var b=c.table().node().cloneNode(!1),e=d(c.table().header()).clone(!1).appendTo(b);d(c.table().body().cloneNode(!0)).appendTo(b);var f=c.settings()[0].oApi._fnGetUniqueThs(c.settings()[0],\ne),b=d(\"<div/>\").css({width:1,height:1,overflow:\"hidden\"}).append(b).insertBefore(c.table().node());c.columns().eq(0).each(function(b){a[b].minWidth=c.column(b).visible()?f[c.column(b).index(\"visible\")].offsetWidth:null});b.remove()}}};g.breakpoints=[{name:\"desktop\",width:Infinity},{name:\"tablet-l\",width:1024},{name:\"tablet-p\",width:768},{name:\"mobile-l\",width:480},{name:\"mobile-p\",width:320}];g.defaults={breakpoints:g.breakpoints,auto:!0,details:{renderer:function(c,a){var b=c.cells(a,\":hidden\").eq(0).map(function(a){var b=\nd(c.column(a.column).header());return b.hasClass(\"control\")?\"\":'<li><span class=\"dtr-title\">'+b.text()+':</span> <span class=\"dtr-data\">'+c.cell(a).data()+\"</span></li>\"}).toArray().join(\"\");return b?d(\"<ul/>\").append(b):!1},target:0,type:\"inline\"}};g.version=\"1.0.0\";d.fn.dataTable.Responsive=g;d.fn.DataTable.Responsive=g;d(o).on(\"init.dt.dtr\",function(c,a){if(d(a.nTable).hasClass(\"responsive\")||d(a.nTable).hasClass(\"dt-responsive\")||a.oInit.responsive){var b=a.oInit.responsive;!1!==b&&new g(a,d.isPlainObject(b)?\nb:{})}});return g};\"function\"===typeof define&&define.amd?define([\"jquery\",\"datatables\"],k):\"object\"===typeof exports?k(require(\"jquery\"),require(\"datatables\")):jQuery&&!jQuery.fn.dataTable.Responsive&&k(jQuery,jQuery.fn.dataTable)})(window,document);\n\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osHistory', history);\n\n    /** @ngInject */\n    function history() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/history/history.html',\n            controller: HistoryController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function HistoryController(osApi, osHistory, $state, $timeout, $scope, moment, $stateParams, _, $, $q) {\n            // Properties\n            var vm = this;\n            var table;\n            var selectedIds = (osHistory.getPatientSelection() == null) ? [] : osHistory.getPatientSelection().ids;\n            var fields = ['patient_ID', 'gender', 'race', 'age_at_diagnosis', 'days_to_death', 'status_vital'];\n            var columns = fields.map(function(column){\n                    return {data:column, title:column.replace(/_/g,\" \"), defaultContent:'NA'};\n            });\n\n            var initViewState = function(vm){\n                vm.datasource = osApi.getDataSource();\n                vm.diagnosisMin = vm.diagnosisMinValue = 1;\n                vm.diagnosisMax = vm.diagnosisMaxValue = 100000;\n                vm.survivalMin = vm.survivalMinValue = 0;\n                vm.survivalMax = vm.survivalMaxValue = 10;\n                vm.search = \"\";\n                vm.detail = null;\n            }\n\n            var initDataTable = function(vm, columns, data){\n                \n                // Override Filter Function\n                angular.element.fn.DataTable.ext.search = [function(settings, data) {\n                    \n                    if (selectedIds.length!=0) {\n                        if (selectedIds.indexOf(data[0]) == -1) return false;\n                    }\n\n                    var diagnosis = parseFloat(data[3]);\n                    var survival = parseFloat(data[4]);\n                    if (isNaN(survival) || isNaN(diagnosis)) return false;\n                    return (diagnosis >= vm.diagnosisMin &&\n                        diagnosis < (vm.diagnosisMax + 1) &&\n                        survival >= vm.survivalMin &&\n                        survival < (vm.survivalMax + 1));\n                    return true;\n                }];\n        \n                // Specify Data\n                table = angular.element('#history-datatable').dataTable({\n                            paging: false,\n                            columns: columns,\n                            data: data,\n                            \"scrollY\": \"60vh\",\n                            \"scrollCollapse\": true,\n                            buttons: ['copy', 'csv', 'excel', 'pdf', 'print']\n                });\n                table.api().draw();\n            }\n\n            var initEvents = function(vm, $scope){\n\n                /*\n                $('#history-datatable tbody').on( 'click', 'tr', function () {\n                    // $('.history-row-selected').removeClass('history-row-selected');\n                    $(this).addClass('history-row-selected');\n                    osApi.query(vm.datasource+\"_pt\", {'patient_ID':this.firstChild.textContent, $limit:1}).then(function(response){\n                        vm.detail = response.data[0];\n                    });\n                } );\n                $('#history-datatable tbody').on( 'mouseout', 'tr', function () {\n                    $(this).removeClass('history-row-selected');\n                    vm.detail = null;\n                });\n                */\n                vm.exportCsv = function(){\n                    \n                    var csv = table._('tr', {\n                        \"filter\": \"applied\"\n                    }).map(function(item){\n                        var row = \"\";\n                        for (var i=0; i<fields.length; i++){\n                            if (i>0) row += \",\";\n                            row += item[fields[i]];\n                        }\n                        return row;\n                    });\n                    csv.unshift(fields.join(\",\"));\n                    csv = csv.join(\"\\n\");\n                    var encodedUri = encodeURI(\"data:text/csv;charset=utf-8,\"+csv);\n                    window.open(encodedUri);\n\n                }\n\n                vm.applyFilter = function(filter) {\n\n                    selectedIds = [];\n\n                    table.api().draw();\n\n                    var o = table._('tr', {\n                        \"filter\": \"applied\"\n                    }).map(function(item) {\n                        return item[\"patient_ID\"].toString().toUpperCase()\n                    });\n\n                    o = $.map(o, function(value) {\n                        return [value];\n                    });\n\n                    osHistory.addPatientSelection(\"Patient History\", filter, o);\n                };\n\n\n                osHistory.onPatientSelectionChange.add(function(selection) {\n                    selectedIds = selection.ids;\n                    table.api().draw();\n                });\n                \n            }\n\n            // Load Datasets\n            osApi.setBusy(true);\n\n            \n\n            \n            initViewState(vm);\n            osApi.query(vm.datasource.collections.pt, {$fields:fields})\n            .then(function(response){\n               var maxMin = response.data.reduce(function(prev, curr){\n                \n                    if (angular.isDefined(curr.age_at_diagnosis)){\n                        var ageAtDiagnosis = parseInt(curr.age_at_diagnosis);\n                        prev.ageAtDiagnosis.min = Math.min(prev.ageAtDiagnosis.min, ageAtDiagnosis);\n                        prev.ageAtDiagnosis.max = Math.max(prev.ageAtDiagnosis.max, ageAtDiagnosis);\n                    }\n                    if (angular.isDefined(curr.days_to_death)){\n                        var daysToDeath = parseInt(curr.days_to_death);\n                        prev.daysToDeath.min = Math.min(prev.daysToDeath.min, daysToDeath);\n                        prev.daysToDeath.max = Math.max(prev.daysToDeath.max, daysToDeath);\n                    }\n                    return prev;\n\n               }, {ageAtDiagnosis:{max:-Infinity, min:Infinity}, daysToDeath:{max:-Infinity, min:Infinity}})\n\n               vm.diagnosisMin = vm.diagnosisMinValue = maxMin.ageAtDiagnosis.min;\n               vm.diagnosisMax = vm.diagnosisMaxValue = maxMin.ageAtDiagnosis.max;\n               vm.survivalMin = vm.survivalMinValue = maxMin.daysToDeath.min;\n               vm.survivalMax = vm.survivalMaxValue = maxMin.daysToDeath.max;\n\n               initDataTable(vm, columns, response.data);\n               initEvents(vm, $scope)\n               osApi.setBusy(false);\n            });\n        }\n    }\n})();\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osHelp', help);\n\n    /** @ngInject */\n    function help() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/help/help.html',\n            controller: HelpController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function HelpController() {\n            var vm = this;\n           vm.videos = [\n               {\n                    name: 'Oncoscape + Github',\n                    desc: 'Description Lorum Ipsum eos et sid al accusamus et iusto odio',\n                    img: ''\n               },\n               {\n                    name: 'Creating Cohorts',\n                    desc: 'Description Lorum Ipsum eos et sid al accusamus et iusto odio',\n                    img: ''\n               },\n               {\n                    name: 'Patients + Markers',\n                    desc: 'Description Lorum Ipsum eos et sid al accusamus et iusto odio',\n                    img: ''\n               },\n               {\n                    name: 'Timelines',\n                    desc: 'Description Lorum Ipsum eos et sid al accusamus et iusto odio',\n                    img: ''\n               }\n           ]\n        }\n    }\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osHeader', header);\n\n    /** @ngInject */\n    function header() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/header/header.html',\n            scope: {},\n            controller: HeaderController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function HeaderController(osApi, $stateParams, $state, $timeout) {\n\n            \n            osApi.onDataSource.add(function(){\n                $timeout(function(){\n                    vm.showTools = true;\n                });\n            });\n\n            var userApi = osApi.getUserApi();\n            userApi.onLogin.add(function(){\n                $timeout(function(){\n                    vm.showMenu = true;\n                });\n            })\n            userApi.onLogout.add(function(){\n                $timeout(function(){\n                    vm.showMenu = false;\n                });\n            })\n           \n            var vm = this;\n            vm.showMenu = false;\n            vm.showTools = false;\n              \n            vm.toolsClick = function(){\n                $state.go(\"tools\", {\n                    datasource: osApi.getDataSource()\n                });\n            };\n            \n            vm.cohortClick = function() {\n                osApi.toggleFilter();\n            };\n            \n            vm.logoutClick = function(){\n               userApi.logout();\n               $state.transitionTo(\"landing\");\n            }\n        }\n    }\n\n})();\n(function() {\n    'use strict';\n    \n    angular\n        .module('oncoscape')\n        .directive('osGenesettest', genesettest);\n\n    /** @ngInject */\n    function genesettest() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/genesettest/genesettest.html',\n            controller: GenesettestController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function GenesettestController(osApi, osHistory, $state, $stateParams, $timeout, $scope, d3, $window, _) {\n\n            if (angular.isUndefined($stateParams.datasource)) {\n                $state.go(\"datasource\");\n                return;\n            }\n\n            // Elements\n            var elInput = angular.element(\"#geneSetTestsInputsDiv\");\n            \n            // Properties\n            //var cohortPatient = osApi.getCohortPatient();\n\n            // View Model\n            var vm = this;\n            vm.datasource = $stateParams.datasource;\n            vm.geneSets = [];\n            vm.geneSet = null;\n\n        \n            var cohort1 = osHistory.getPatientSelections()[0];\n            var cohort2 = osHistory.getPatientSelections()[1];\n\n            // Initialize\n            osApi.setBusy(true);\n            osApi.setDataset(vm.datasource).then(function(response) {\n                var mtx = response.payload.rownames.filter(function(v) {\n                        return v.indexOf(\"mtx.mrna\") >= 0\n                    });\n\n                mtx = mtx[mtx.length - 1].replace(\".RData\", \"\");\n                console.log(\"**** mtx is: \", mtx);\n\n                if(cohort1 == null || cohort2 == null){\n                    vm.message = \"Please select two cohorts to test out the Gene Set\";\n                    vm.optCohort1 = \"Empty\";\n                    vm.optCohort2 = \"Empty\";\n                }else{\n                    vm.optCohort1 = cohort1.tool + \" \" +cohort1.desc + \" \" + cohort1.ids.length + \" Patients selected\" ;\n                    vm.optCohort2 = cohort2.tool + \" \" +cohort2.desc + \" \" + cohort2.ids.length + \" Patients selected\" ;\n                    var geneset = \"random.24\";\n                    //var geneset = \"tcga.pancan.mutated\";\n                    osApi.getGeneSetTest(vm.datasource, mtx).then(function() {\n                        $scope.$watchGroup(['vm.optCohort1', 'vm.optCohort2'], function() {\n                           calculateGeneSetScore(cohort1, cohort2, geneset);\n                        });  \n                     });   \n                }\n                osApi.setBusy(false);\n            });\n\n            var drawHeatMap = function(pt, genes, expressionData){\n                console.log(expressionData);\n                \n\n                var zValues = JSON.parse(expressionData);\n                var colorscaleValue = [\n                      [1, '#339966'],\n                      [2, '#003333']\n                    ];\n\n                    var data = [{\n                      //x: genes,\n                      y: pt,\n                      z: zValues,\n                      type: 'heatmap',\n                      //colorscale: colorscaleValue,\n                      showscale: true\n                    }];\n\n                    var layout = {\n                      title: 'GeneSet Heatmap',\n                      annotations: [],\n                      xaxis: {\n                        ticks: '',\n                        side: 'top'\n                      },\n                      yaxis: {\n                        ticks: '',\n                        ticksuffix: ' ',\n                        width: 500,\n                        height: 250,\n                        autosize: false\n                      }\n                    };\n\n\n                    Plotly.newPlot('heatMap', data, layout);\n            }\n            var drawHeatMap2 = function(pt, genes, expressionData){\n                   console.log(expressionData);\n            \n                   angular.element('#heatMap').highcharts({\n\n                        chart: {\n                            type: 'heatmap',\n                            marginTop: 40,\n                            marginBottom: 80,\n                            plotBorderWidth: 1,\n                        },\n\n\n                        title: {\n                            text: 'Gene Set Expression Heat Map'\n                        },\n\n                        xAxis: {\n                            // labels: {\n                            //     step: 1\n                            // },\n                            categories: genes\n                        },\n\n                        yAxis: {\n                            lineWidth: 5,\n                            lineColor: '#F33',\n                            categories: pt,\n                            title: null\n                        },\n\n                        colorAxis: {\n                            min: 0,\n                            //minColor:Highcharts.getOptions().colors[7],\n                            minColor: \"#FFFFFF\",\n                            maxColor:'#CC9933'\n                        },\n\n                        legend: {\n                            align: 'right',\n                            layout: 'vertical',\n                            margin: 10,\n                            verticalAlign: 'top',\n                            y: 25,\n                            symbolHeight: 280\n                        },\n\n                        tooltip: {\n                            formatter: function () {\n                                return '<b>' +this.series.yAxis.categories[this.point.y]  + ' '+ \n                                     this.series.xAxis.categories[this.point.x]+ ': ' +this.point.value + '</b>';\n                            }\n                        },\n\n                        series: [{\n                                    name: 'Sales per employee',\n                                    borderWidth: 0,\n                                    data: JSON.parse(expressionData) }]\n                    });\n\n            }    \n            // API Call To oncoprint_data_selection\n            var calculateGeneSetScore = function(cohort1, cohort2, geneset) {    \n                var Group1 = cohort1.ids;\n                var Group2 = cohort2.ids;\n\n                osApi.setBusy(true);\n                osApi.getGeneSetScore(Group1, Group2, geneset).then(function(response){\n                    console.log(response.payload);\n                    if(response.status == \"error\"){\n                        vm.message = response.payload + \"Please select two cohorts to test out the Gene Set\";\n                    }else{\n                        vm.message = response.payload.summary;\n                        var pt = response.payload.pt;\n                        var g = response.payload.genes;\n                        drawHeatMap2(pt, g, response.payload.analysisData);\n                    }\n                    osApi.setBusy(false);\n                });\n             }    \n     }\n    } \n})();   \n(function() {\n    'use strict';\n    \n    angular\n        .module('oncoscape')\n        .directive('osDatasource', datasource);\n\n    /** @ngInject */\n    function datasource() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/datasource/datasource.html',\n            controller: DatasourceController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function DatasourceController(osApi, $state) {\n            var vm = this;\n            vm.datasets = osApi.getDataSources();\n            vm.explore = function(tool, datasource) {\n                osApi.setDataSource(datasource);\n                $state.go(tool, {\n                    datasource: datasource.disease\n                });\n            };\n\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osFooter', footer);\n\n    /** @ngInject */\n    function footer() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/footer/footer.html',\n            controller: FooterController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function FooterController() {\n            //var vm = this;\n        }\n    }\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osDataExplorer', explore);\n\n    /** @ngInject */\n    function explore() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/dataexplorer/dataexplorer.html',\n            controller: DataExplorerController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function DataExplorerController(osApi, $state, $timeout, $scope, $stateParams, _) {\n\n            if (angular.isUndefined($stateParams.datasource)){\n                $state.go(\"datasource\");\n                return;\n            }\n            // View Model\n            var vm = this;\n            vm.dataSources;\n            vm.dataSource;\n            vm.dataDiseases;\n            vm.dataDisease;\n            vm.dataTables;\n            vm.dataTable;\n            vm.dataFields;\n            vm.dataField;\n            \n            var bar = {\n                chart: {\n                    type: 'discreteBarChart',\n                    height: 450,\n                    margin : {\n                        top: 20,\n                        right: 20,\n                        bottom: 50,\n                        left: 55\n                    },\n                    x: function(d){return d.label;},\n                    y: function(d){return d.value;},\n                    showValues: true,\n                    valueFormat: function(d){\n                        return d3.format(',.4f')(d);\n                    },\n                    duration: 500,\n                    xAxis: {\n                        axisLabel: 'X Axis'\n                    },\n                    yAxis: {\n                        axisLabel: 'Y Axis',\n                        axisLabelDistance: -10\n                    }\n                }\n            };\n\n            var pie = {\n                chart: {\n                    type: 'pieChart',\n                    height: 450,\n                    donut: false,\n                    x: function(d){return d.label; },\n                    y: function(d){return d.value; },\n                    showLabels: false,\n                    pie: {\n                        startAngle: function(d) { return d.startAngle/2 -Math.PI/2 },\n                        endAngle: function(d) { return d.endAngle/2 -Math.PI/2 }\n                    },\n                    duration: 500\n                }\n            };\n\n            vm.chartOptions = bar;\n\n            vm.toolTipContentFunction = function(){\n                return function(key, x, y, e, graph) {\n                        return  'Super New Tooltip' +\n                        '<h1>' + key + '</h1>' +\n                        '<p>' +  y + ' at ' + x + '</p>'\n                }\n            }\n\n                \n\n            vm.xFunction = function(){\n                return function(d) {\n                    return d.label;\n                };\n            }\n            \n            vm.yFunction = function(){\n                return function(d) {\n                    return d.value;\n                };\n            }\n          \n        \n\n            // Load Datasets\n            osApi.setBusy(true);\n            osApi.query(\"_collections\").then(function(result){\n\n                vm.dataSources = result.data;\n                vm.dataSource = vm.dataSources[0];\n                \n                $scope.$watch(\"vm.dataSource\", function(){\n                    vm.dataDiseases = vm.dataSource.diseases;\n                    vm.dataDisease = vm.dataSource.diseases[0];\n\n                });\n                $scope.$watch(\"vm.dataDisease\", function(){\n                    vm.dataTables = vm.dataDisease.tables;\n                    vm.dataTable = vm.dataTables[0];\n                });\n                $scope.$watch(\"vm.dataTable\", function(){\n                    osApi.query(\"_field_detail\", {collection:vm.dataTable.collection}).then(function(result){\n                         vm.dataFields = result.data[0].fields.filter(function(field){ return field.key!=\"_id\"; });\n                         vm.dataField = vm.dataFields[0];\n                         console.dir(vm.dataField)\n                    });\n                });\n\n               osApi.setBusy(false);\n               \n            });\n            \n        }\n    }\n})();\n\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osCohorts', cohorts);\n\n    /** @ngInject */\n    function cohorts() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/cohorts/cohorts.html',\n            controller: CohortsController,\n            scope:{\n                type:\"@\"\n            },\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function CohortsController(osHistory, $state, $timeout) {\n\n            var vm = this;\n            vm.selection;\n            vm.selections;\n            \n            vm.close = function(){\n                angular.element(\".cohorts-\"+vm.type).hide();\n            }\n            vm.setSelection = function(item){\n                osHistory[\"set\"+vm.type+\"Selection\"](item);\n            };\n            var update = function(){\n                $timeout(function() {\n                    vm.selections = osHistory[\"get\"+vm.type+\"Selections\"]();\n                    vm.selection = osHistory[\"get\"+vm.type+\"Selection\"]();\n                    \n                });\n            };\n            \n            osHistory[\"on\"+vm.type+\"Add\"].add(function(){update(true)});            \n            osHistory[\"on\"+vm.type+\"SelectionChange\"].add(function(){update(false)});\n            \n            var isDragable = false;\n            var show = function(){\n                angular.element(\".cohorts-\"+vm.type).show();\n                if (isDragable) return;\n                isDragable = true;\n                angular.element(\".cohorts-\"+vm.type).draggable();\n\n            }            \n\n            // Keypress\n            angular.element(document).keypress(function(e) {\n                if (!e.ctrlKey) return;\n                if(vm.type==\"Gene\"){\n                    switch(e.keyCode){\n                        case 12: show(); break;\n                        case 39: osHistory.getGeneSelectionNext(); break;\n                        case 59: osHistory.getGeneSelectionLast(); break;\n                    }\n                }else{\n                    switch (e.keyCode)\n                    {\n                        case 16: show(); break;\n                        case 27: osHistory.getPatientSelectionLast(); break;\n                        case 29: osHistory.getPatientSelectionNext(); break;                \n                    }\n                }\n                \n            });\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osCohortBuilder', cohortBuilder);\n\n    /** @ngInject */\n    function cohortBuilder() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/cohortbuilder/cohortbuilder.html',\n            controller: CohortBuilderController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function CohortBuilderController(osApi, $state, $timeout, $scope, $stateParams, _) {\n\n            if (angular.isUndefined($stateParams.datasource)){\n                $state.go(\"datasource\");\n                return;\n            }\n            // View Model\n            var vm = this;\n            vm.dataSources;\n            vm.dataSource;\n            vm.dataDiseases;\n            vm.dataDisease;\n            vm.dataTables;\n            vm.dataTable;\n            vm.dataFields;\n\n            vm.toolTipContentFunction = function(){\n                return function(key, x, y, e, graph) {\n                        return  'Super New Tooltip' +\n                        '<h1>' + key + '</h1>' +\n                        '<p>' +  y + ' at ' + x + '</p>'\n                }\n            }\n\n                \n\n            vm.xFunction = function(){\n                return function(d) {\n                    return d.label;\n                };\n            }\n            \n            vm.yFunction = function(){\n                return function(d) {\n                    return d.value;\n                };\n            }\n          \n\n            // Load Datasets\n            osApi.setBusy(true);\n            osApi.query(\"_collections\").then(function(result){\n                \n                // Transform DataSources\n                var data = result.data;\n                vm.dataSources = \n                    _.chain(data).pluck(\"source\").uniq().map(function(v){return { name:v,\n                        diseases:_.chain(data).where({source:v}).pluck(\"disease\").uniq().map(function(v){ \n                            return { name:v,\n                                tables: _.chain(data).where({source:\"tcga\",disease:v}).map(function(v){ \n                                    return {created:v.created, name:v.table, records:v.records, collection:v.collection}} ).value()\n                            };}).value()\n                    };}).value();\n                vm.dataSource = vm.dataSources[0];\n                \n                $scope.$watch(\"vm.dataSource\", function(){\n                    vm.dataDiseases = vm.dataSource.diseases;\n                    vm.dataDisease = vm.dataSource.diseases[0];\n\n                });\n                $scope.$watch(\"vm.dataDisease\", function(){\n                    vm.dataTables = vm.dataDisease.tables;\n                    vm.dataTable = vm.dataTables[0];\n                    \n                });\n                $scope.$watch(\"vm.dataTable\", function(){\n                    console.log(osApi.queryString(\"_stats\", {collection:vm.dataTable.collection}));\n                    osApi.query(\"_stats\", {collection:vm.dataTable.collection}).then(function(result){\n                        vm.dataFields = result.data[0].fields;\n                    });\n                });\n\n               osApi.setBusy(false);\n               \n            });\n            \n        }\n    }\n})();\n\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .run(runBlock);\n\n    /** @ngInject */\n    function runBlock($rootScope, $state, $window, $exceptionHandler, osApi) { //, $log\n\n        // Route Errors To Angular\n        $window.onerror = function handleGlobalError( message, fileName, lineNumber, columnNumber, error ) {\n            if ( ! error ) {\n                error = new Error( message );\n                error.fileName = fileName;\n                error.lineNumber = lineNumber;\n                error.columnNumber = ( columnNumber || 0 );\n            }\n            $exceptionHandler( error );\n        }\n        \n        // Actions To Take On State Change\n        var off = $rootScope.$on('$stateChangeStart', function(event, toState, toParams) {\n\n            // Hide Busy Cursor\n            osApi.setBusy(false);\n\n            // Reset DataTable Custom Filters\n            angular.element.fn.DataTable.ext.search = [];\n\n            \n            // // Route unauthenticated users to landing page\n            if (toState.authenticate && !osApi.getUserApi().getUser().authenticated) {\n                $state.transitionTo(\"landing\");\n                event.preventDefault();\n                return;\n            }\n\n            // Redirect If Unable To Resolve Data Source\n            if (toState.datasource && (angular.isUndefined(toParams.datasource) || toParams.datasource===\"\")){\n                $state.transitionTo(\"datasource\")\n                event.preventDefault();\n                return;\n            }else{\n                osApi.setDataSource(toParams.datasource);\n            }\n            \n\n            //osApi.setDataSource({\"disease\":\"brca\",\"source\":\"TCGA\",\"name\":\"Breast\",\"img\":\"DSbreast.png\",\"beta\":false,\"collections\":{\"drug\":\"clinical_tcga_brca_drug\",\"f1\":\"clinical_tcga_brca_f1\",\"f2\":\"clinical_tcga_brca_f2\",\"f3\":\"clinical_tcga_brca_f3\",\"nte\":\"clinical_tcga_brca_nte\",\"nte_f1\":\"clinical_tcga_brca_nte_f1\",\"omf\":\"clinical_tcga_brca_omf\",\"pt\":\"clinical_tcga_brca_pt\",\"rad\":\"clinical_tcga_brca_rad\"},\"edges\":[{\"name\":\"TCGA GBM Classifiers\",\"edges\":\"edge_brca_tcgagbmclassifiers\",\"patientWeights\":\"edge_brca_tcgagbmclassifiers_patient_weight\",\"genesWeights\":\"edge_brca_tcgagbmclassifiers_gene_weight\"},{\"name\":\"Marker Genes 545\",\"edges\":\"edge_brca_markergenes545\",\"patientWeights\":\"edge_brca_markergenes545_patient_weight\",\"genesWeights\":\"edge_brca_markergenes545_gene_weight\"},{\"name\":\"TCGA Pan Cancer Mutated\",\"edges\":\"edge_brca_tcgapancancermutated\",\"patientWeights\":\"edge_brca_tcgapancancermutated_patient_weight\",\"genesWeights\":\"edge_brca_tcgapancancermutated_gene_weight\"},{\"name\":\"Onco Vogel 274\",\"edges\":\"edge_brca_oncovogel274\",\"patientWeights\":\"edge_brca_oncovogel274_patient_weight\",\"genesWeights\":\"edge_brca_oncovogel274_gene_weight\"}]});\n\n            \n            \n            \n            \n        });\n\n        $rootScope.$on('$destroy', off)\n    }\n})();\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .config(routerConfig);\n\n    /** @ngInject */\n    function routerConfig($stateProvider, $urlRouterProvider) {\n\n\n        $stateProvider\n            .state('landing', {\n                url: '/',\n                template: '<os-landing>',\n                authenticate: false,\n                datasource: false\n            })\n            .state('help', {\n                url: '/help',\n                template: '<os-help>',\n                authenticate: false,\n                datasource: false\n            })\n            .state('datasource', {\n                url: '/datasource',\n                template: '<os-datasource>',\n                authenticate: true,\n                datasource: false\n            })\n            .state('tools', {\n                url: '/tools/{datasource}',\n                template: '<os-tools>',\n                authenticate: true,\n                datasource: true\n            })\n            .state('metadata', {\n                url: '/metadata/{datasource}',\n                template: '<os-metadata>',\n                authenticate: true,\n                datasource: true\n            })\n            .state('history', {\n                url: '/history/{datasource}',\n                template: '<os-history>',\n                authenticate: true,\n                datasource: true\n            })\n            .state('plsr', {\n                url: '/plsr/{datasource}',\n                template: '<os-plsr>',\n                authenticate: true,\n                datasource: true\n            })\n            .state('pca', {\n                url: '/pca/{datasource}',\n                template: '<os-pca>',\n                authenticate: true,\n                datasource: true\n            })\n            .state('pca3d', {\n                url: '/pca3d/{datasource}',\n                template: '<os-pca3d>',\n                authenticate: true,\n                datasource: true\n            })\n            .state('markers', {\n                url: '/markers/{datasource}',\n                template: '<os-markers>',\n                authenticate: true,\n                datasource: true\n            })\n            .state('pathways', {\n                url: '/pathways/{datasource}',\n                template: '<os-pathways>',\n                authenticate: true,\n                datasource: true\n            })\n            .state('timelines', {\n                url: '/timelines/{datasource}',\n                template: '<os-timelines>',\n                authenticate: true,\n                datasource: true\n            })\n            .state('survival', {\n                url: '/survival/{datasource}',\n                template: '<os-survival>',\n                authenticate: true,\n                datasource: true\n            })\n            .state('dataexplorer', {\n                url: '/dataexplorer/{datasource}',\n                template: '<os-data-explorer>',\n                authenticate: true,\n                datasource: true\n            })\n            .state('oncoprint', {\n                url: '/oncoprint/{datasource}',\n                template: '<os-oncoprint>',\n                authenticate: true,\n                datasource: true\n            })\n            .state('genesettest', {\n                url: '/genesettest/{datasource}',\n                template: '<os-genesettest>',\n                authenticate: true,\n                datasource: true\n            })\n            .state('cohortbuilder', {\n                url: '/cohortbuilder/{datasource}',\n                template: '<os-cohort-builder>',\n                authenticate: true,\n                datasource: true\n            })\n           \n\n        $urlRouterProvider.otherwise('/');\n    }\n\n})();\n\n/* global d3:false, $:false, signals:false, cytoscape:false, SockJS:false, document:false, moment:false, _:false, THREE:false */\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .constant('moment', moment)\n        .constant('d3', d3)\n        .constant('cytoscape', cytoscape)\n        .constant('signals', signals)\n        .constant('$', $)\n        .constant('_', _);\n    // Util Functions\n    Number.prototype.map = function (in_min, in_max, out_min, out_max) {\n        return (this - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;\n    }\n    \n    \n})();\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .config(config);\n\n    /** @ngInject */\n    function config($logProvider) {\n        // Enable log\n        $logProvider.debugEnabled(true);\n    }\n})();\n\nangular.module(\"oncoscape\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/components/cohortbuilder/cohortbuilder.html\",\"<os-tray content=\\\"tray-content-block\\\" change=\\\"vm.resize($event)\\\"><section class=\\\"tray-content cohortbuilider\\\"><div class=\\\"row\\\"></div></section></os-tray><section class=\\\"tray-content-block dataexplorer\\\"><div class=\\\"container-fluid\\\"><h2>Cohort Builder</h2><button>+</button> <button>-</button></div></section>\");\n$templateCache.put(\"app/components/cohorts/cohorts.html\",\"<div class=\\\"cohorts panel panel-default cohorts-{{vm.type}}\\\"><div class=\\\"panel-heading\\\">{{vm.type}} History <span class=\\\"pull-right fa fa-times\\\" ng-click=\\\"vm.close()\\\"></span></div><div class=\\\"panel-body cohorts-panel-body\\\"><table><tr ng-click=\\\"vm.setSelection(item)\\\" ng-repeat=\\\"item in vm.selections\\\" ng-class=\\\"{\\'cohort-selected\\' : item==vm.selection}\\\"><td>{{item.tool}}</td><td>{{item.desc}}</td><td>{{item.ids.length}}</td></tr></table></div></div>\");\n$templateCache.put(\"app/components/dataexplorer/dataexplorer.html\",\"<os-tray content=\\\"tray-content-block\\\" change=\\\"vm.resize($event)\\\"><section class=\\\"tray-content dataexplorer\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Data Source</h2></div><div class=\\\"col-xs-12 form-item\\\"><label>Origin</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.dataSource.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.dataSources\\\" ng-click=\\\"vm.dataSource = item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Disease</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.dataDisease.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.dataDiseases\\\" ng-click=\\\"vm.dataDisease = item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Table</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.dataTable.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.dataTables\\\" ng-click=\\\"vm.dataTable = item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Field</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.dataField.key}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.dataFields\\\" ng-click=\\\"vm.dataField = item\\\">{{item.key}}</li></ul></div></div><div class=\\\"col-xs-12 form-label\\\"><h2>Table Info</h2><dl><dt>Date Uploaded</dt><dd>{{vm.dataTable.created}}</dd><dt>Record Count</dt><dd>{{vm.dataTable.records}}</dd><dt>Field Count</dt><dd>{{vm.dataFields.length}}</dd></dl></div></div></section></os-tray><section class=\\\"tray-content-block dataexplorer\\\"><div class=\\\"container-fluid\\\"><h2>Data Explorer</h2><div ng-repeat=\\\"item in vm.dataFields\\\" class=\\\"data-field\\\"><b>{{item.key}}</b><div style=\\\"width:30%; margin-top:10px\\\">{{item.name}}. {{item.desc}}</div><nvd3 options=\\\"vm.chartOptions\\\" data=\\\"item.values\\\"></nvd3></div></div></section>\");\n$templateCache.put(\"app/components/datasource/datasource.html\",\"<section class=\\\"datasource container-fluid\\\"><div class=\\\"row\\\"><div class=\\\"col-sm-8 col-md-6\\\"><h1>Data Sources</h1><p>Oncoscape has analyzed and curated the following datasets hosted by The Cancer Genome Atlas (TCGA). Raw data sets for these and other available disease sites can be found at <a href=\\\"https://tcga-data.nci.nih.gov/tcga/\\\">TCGA Data Portal</a>.</p></div></div><div class=\\\"row\\\"><ul><li ng-repeat=\\\"dataset in vm.datasets\\\" class=\\\"col-xs-12 col-sm-6 col-lg-4\\\" ng-click=\\\"vm.explore(\\'tools\\',dataset)\\\"><img class=\\\"datasource-img\\\" ng-src=\\\"/assets/images/datasets/{{dataset.img}}\\\"><h3 class=\\\"datasource-lbl\\\">{{dataset.name}} ({{dataset.source}})</h3><nobr><a href=\\\"\\\">Explore</a></nobr></li></ul></div></section>\");\n$templateCache.put(\"app/components/footer/footer.html\",\"<footer class=\\\"footer container\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 col-sm-6\\\"><img class=\\\"footer-logo\\\" src=\\\"/assets/images/logo-fred-hutchinson-cancer-research-center.png\\\" alt=\\\"Fred Hutchinson Cancer Research Center\\\"> <img class=\\\"footer-logo\\\" src=\\\"/assets/images/logo-university-of-washington-medicine.png\\\" alt=\\\"UW Medicine\\\"> <img class=\\\"footer-logo\\\" src=\\\"/assets/images/logo-seattle-cancer-care-alliance.png\\\" alt=\\\"Seattle Cancer Care Alliance\\\"></div><div class=\\\"col-xm-12 col-sm-6 text-right\\\"><a href=\\\"https://www.facebook.com/STTRCancer\\\" target=\\\"_blank\\\"><img class=\\\"footer-icon\\\" src=\\\"/assets/images/sttr-facebook-out.png\\\" alt=\\\"Facebook\\\"></a> <a href=\\\"https://twitter.com/sttrcancer\\\" target=\\\"_blank\\\"><img class=\\\"footer-icon\\\" src=\\\"/assets/images/sttr-twitter-out.png\\\" alt=\\\"Twitter\\\"></a> <a href=\\\"https://plus.google.com/+fredhutch/videos\\\" target=\\\"_blank\\\"><img class=\\\"footer-icon\\\" src=\\\"/assets/images/sttr-youtube-out.png\\\" alt=\\\"YouTube\\\"></a> <a href=\\\"http://instagram.com/FredHutch\\\" target=\\\"_blank\\\"><img class=\\\"footer-icon\\\" src=\\\"/assets/images/sttr-instagram-out.png\\\" alt=\\\"Instagram\\\"></a> <a href=\\\"http://www.linkedin.com/company/fred-hutchinson-cancer-research-center/careers?trk=top_nav_careers\\\" target=\\\"_blank\\\"><img class=\\\"footer-icon\\\" src=\\\"/assets/images/sttr-linkedin-out.png\\\" alt=\\\"LinkedIn\\\"></a> <a href=\\\"https://plus.google.com/116048577052683099154/posts\\\" target=\\\"_blank\\\"><img class=\\\"footer-icon\\\" src=\\\"/assets/images/sttr-google-out.png\\\" alt=\\\"Google+\\\"></a></div></div></footer>\");\n$templateCache.put(\"app/components/genesettest/genesettest.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\" change=\\\"vm.addCohortPatient()\\\"></os-tool-menu><script src=\\\"https://cdn.plot.ly/plotly-latest.min.js\\\"></script><script src=\\\"/bower_components/highcharts/modules/heatmap.js\\\"></script><script src=\\\"/bower_components/highcharts/modules/exporting.js\\\"></script><os-tray content=\\\"tray-content-block\\\" change=\\\"vm.resize($event)\\\"><section class=\\\"tray-content\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Cohorts</h2></div><div class=\\\"col-sm-12 form-item\\\"><label>Patient Cohort 1</label><p>{{vm.optCohort1}}</p></div><div class=\\\"col-sm-12 form-item\\\"><label>Patient Cohort 2</label><p>{{vm.optCohort2}}</p></div></section></os-tray><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><h2 class=\\\"h2-tool\\\">Gene Set Binomial Test</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource}}</h3><div id=\\\"geneSetTestsModuleDiv\\\" class=\\\"genesettest\\\"><div id=\\\"geneSetTests_Div\\\"><div id=\\\"geneSetTestsControlsDiv\\\"><div class=\\\"navbar-collapse collapse navbar-inverse-collapse\\\"><div id=\\\"geneSetTestsInputsDiv\\\"><div id=\\\"geneSetTestsLaunchButtonDiv\\\"><form><div>{{vm.message}}</div><div id=\\\"heatMap\\\"></div></form></div></div></div></div></div></div></div></section>\");\n$templateCache.put(\"app/components/header/header.html\",\"<div class=\\\"header\\\"><nav class=\\\"navbar navbar-inverse navbar-fixed-top\\\"><div class=\\\"container-fluid\\\"><div class=\\\"navbar-header\\\"><button type=\\\"button\\\" class=\\\"navbar-toggle collapsed\\\" data-toggle=\\\"collapse\\\" data-target=\\\"#bs-example-navbar-collapse-1\\\" aria-expanded=\\\"false\\\"><span class=\\\"sr-only\\\">Toggle navigation</span> <span class=\\\"icon-bar\\\"></span> <span class=\\\"icon-bar\\\"></span> <span class=\\\"icon-bar\\\"></span></button> <a class=\\\"navbar-brand\\\" href=\\\"#\\\"><img alt=\\\"Brand\\\" src=\\\"/assets/images/logo.png\\\" style=\\\"max-height:50px;\\\"></a></div><div class=\\\"collapse navbar-collapse\\\" id=\\\"bs-example-navbar-collapse-1\\\" ng-if=\\\"vm.showMenu\\\"><ul class=\\\"nav navbar-nav navbar-right\\\"><li><a href=\\\"#datasource\\\"><span class=\\\"glyphicon glyphicon-th\\\"></span>Data Sources</a></li><li><a href=\\\"\\\" ng-click=\\\"vm.logoutClick()\\\"><span class=\\\"glyphicon glyphicon-user\\\"></span>Logout</a></li></ul></div></div><div class=\\\"nav-divider\\\"></div></nav></div><a href=\\\"https://github.com/FredHutch/Oncoscape/labels/help%20wanted\\\" class=\\\"github\\\" tooltip=\\\"Submit Issues\\\" style=\\\"text-align: right;\\\"><div class=\\\"logo\\\"><svg aria-hidden=\\\"true\\\" class=\\\"octicon octicon-mark-github\\\" height=\\\"28\\\" role=\\\"img\\\" version=\\\"1.1\\\" viewbox=\\\"0 0 16 16\\\" width=\\\"28\\\"><path d=\\\"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59 0.4 0.07 0.55-0.17 0.55-0.38 0-0.19-0.01-0.82-0.01-1.49-2.01 0.37-2.53-0.49-2.69-0.94-0.09-0.23-0.48-0.94-0.82-1.13-0.28-0.15-0.68-0.52-0.01-0.53 0.63-0.01 1.08 0.58 1.23 0.82 0.72 1.21 1.87 0.87 2.33 0.66 0.07-0.52 0.28-0.87 0.51-1.07-1.78-0.2-3.64-0.89-3.64-3.95 0-0.87 0.31-1.59 0.82-2.15-0.08-0.2-0.36-1.02 0.08-2.12 0 0 0.67-0.21 2.2 0.82 0.64-0.18 1.32-0.27 2-0.27 0.68 0 1.36 0.09 2 0.27 1.53-1.04 2.2-0.82 2.2-0.82 0.44 1.1 0.16 1.92 0.08 2.12 0.51 0.56 0.82 1.27 0.82 2.15 0 3.07-1.87 3.75-3.65 3.95 0.29 0.25 0.54 0.73 0.54 1.48 0 1.07-0.01 1.93-0.01 2.2 0 0.21 0.15 0.46 0.55 0.38C13.71 14.53 16 11.53 16 8 16 3.58 12.42 0 8 0z\\\"></path></svg></div></a>\");\n$templateCache.put(\"app/components/help/help.html\",\"<section class=\\\"tools container\\\"><div class=\\\"row\\\"><div class=\\\"col-sm-8 col-md-6\\\"><br><br><br></div></div><div class=\\\"row\\\"><div class=\\\"col-xs-12 col-md-7\\\"><h2 style=\\\"margin:0px;margin-bottom: 20px;\\\">Now Playing &mdash; Lorum Ipsum</h2><div style=\\\"background-color:#000;text-align: center;\\\"><video width=\\\"640\\\" height=\\\"360\\\" controls=\\\"\\\" style=\\\"background-color: #000;max-width: 100%;\\\"></video></div><h2>Video Title</h2><p>Transcription At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat</p></div><div class=\\\"col-xs-12 col-md-5\\\" style=\\\"padding-left: 40px;\\\"><h2 style=\\\"margin:0px;\\\">Oncoscape Videos</h2><ul><li ng-repeat=\\\"video in vm.videos\\\" style=\\\"clear: both;\\\"><div style=\\\"width:30%;height:90px;background-color:#EEE;display:inline-block;float:left;margin-bottom: 20px;text-align: center;cursor: pointer;\\\"><span class=\\\"glyphicon glyphicon-play-circle\\\" style=\\\"font-size: 30px;padding-top:30px; color:#FFF\\\"></span></div><div style=\\\"width:69%;display: inline-block;float:left;padding-left: 10px;\\\"><h3 class=\\\"tools-lbl\\\" style=\\\"margin:0px;\\\">{{video.name}}</h3><p>{{video.desc}}</p><a href=\\\"\\\" ng-click=\\\"vm.explore(tool.route, vm.datasource)\\\">Watch Video</a></div></li></ul></div></div></section>\");\n$templateCache.put(\"app/components/landing/landing.html\",\"<div class=\\\"landing container\\\"><div class=\\\"row\\\" style=\\\"padding-top:20px;\\\"><h2>Bridging Cancer Research and Clinical Care</h2></div><div class=\\\"row\\\" style=\\\"padding-top:20px;\\\"><div class=\\\"col-sm-8\\\"><p>Oncoscape is developed at the Fred Hutchinson Cancer Research Center under the auspices of the Solid Tumor Translational Research initiative. Oncoscape is a web-based, menu-driven analysis and visualization platform for large-scale, heterogeneous clinical and molecular patient timeline data as exemplified by the Fred Hutch HIDRA database. Oncoscape vision and development is managed by a small team comprising: <a href=\\\"https://www.fredhutch.org/en/labs/profiles/holland-eric.html\\\">Eric Holland</a>, <a href=\\\"http://www.sttrcancer.org/en/contact-us/horse-grant-bio.html\\\">Desert Horse-Grant</a>, <a href=\\\"https://www.linkedin.com/in/lisa-mcferrin-9758b029\\\">Lisa McFerrin</a>, <a href=\\\"https://www.linkedin.com/in/hbolouri\\\">Hamid Bolouri</a>, <a href=\\\"https://www.linkedin.com/in/jenny-zhang-ba62a2104\\\">Jenny Zhang</a>, <a href=\\\"https://www.linkedin.com/in/gretchenh\\\">Gretchen Heinrich</a>, <a href=\\\"https://www.linkedin.com/in/robert-mcdermott-a77b9011\\\">Robert McDermott</a> and <a href=\\\"https://www.linkedin.com/in/zager\\\">Michael Zager</a>.</p><p class=\\\"\\\">Through its easy point-and-click browser interface, Oncoscape will become an essential tool for doctors and researchers interested in:</p><ul class=\\\"\\\"><li>Comparing patients or populations across an array of features, like genetic alterations (CNV, IHC, sequencing, expression) or clinical elements (treatment regimens, diagnostics, outcomes)</li><li>Defining cohorts based on selected traits  identifying patients like me</li><li>Aligning patient histories according to timeline events: diagnosis, treatment, progression, survival</li><li>Performing powerful and integrated statistical analysis: Principle Component Analysis, Partial least squares regression, Kaplan-Meier curves, enrichment scores</li><li>Creating high quality visualizations of molecular/clinical data</li></ul><p class=\\\"\\\">By providing a portal equipped with rich data, powerful statistics and a simple interface, Oncoscape not only empowers users to quickly answer questions themselves but also expedites the process of discovering novel patterns and relationships. This can lead to numerous possible findings, including optimized drug therapies for individual patients, identification of novel regulatory pathways, or even the need to reassess adherence strategies.</p></div><div class=\\\"col-sm-4\\\"><os-login></os-login></div></div></div>\");\n$templateCache.put(\"app/components/history/history.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\" change=\\\"vm.addCohortPatient()\\\"></os-tool-menu><os-tray caption=\\\"Patients\\\" content=\\\"tray-content-block\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Filters</h2></div><div class=\\\"col-xs-12 form-item\\\"><label>Age At Diagnosis</label><div range-slider=\\\"\\\" min=\\\"vm.diagnosisMinValue\\\" model-min=\\\"vm.diagnosisMin\\\" max=\\\"vm.diagnosisMaxValue\\\" model-max=\\\"vm.diagnosisMax\\\" show-values=\\\"true\\\" attach-handle-values=\\\"true\\\" on-handle-up=\\\"vm.applyFilter(\\'Diagnosis\\')\\\"></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Survival</label><div range-slider=\\\"\\\" min=\\\"vm.survivalMinValue\\\" model-min=\\\"vm.survivalMin\\\" max=\\\"vm.survivalMaxValue\\\" model-max=\\\"vm.survivalMax\\\" show-values=\\\"true\\\" attach-handle-values=\\\"true\\\" on-handle-up=\\\"vm.applyFilter(\\'Survival\\')\\\"></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Export (beta)</label><div><button class=\\\"btn btn-default\\\" ng-click=\\\"vm.exportCsv()\\\">Excel (CSV)</button></div></div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><h2 class=\\\"h2-tool\\\">Patient Data</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource.name}} {{vm.datasource.source}}</h3><table id=\\\"history-datatable\\\" class=\\\"table table-striped table-bordered dt-responsive nowrap\\\" cellspacing=\\\"0\\\" width=\\\"100%\\\"></table></div></section>\");\n$templateCache.put(\"app/components/loader/loader.html\",\"<div class=\\\"loader-modal\\\"><div class=\\\"loader\\\"><div class=\\\"loader__bar\\\"></div><div class=\\\"loader__bar\\\"></div><div class=\\\"loader__bar\\\"></div><div class=\\\"loader__bar\\\"></div><div class=\\\"loader__bar\\\"></div><div class=\\\"loader__ball\\\"></div></div></div>\");\n$templateCache.put(\"app/components/login/login.html\",\"<form class=\\\"login\\\"><h3 class=\\\"login-header\\\">Login</h3><div class=\\\"login-body\\\"><div class=\\\"alert alert-danger\\\" role=\\\"alert\\\" ng-show=\\\"vm.hasError\\\"><span class=\\\"glyphicon glyphicon-exclamation-sign\\\" aria-hidden=\\\"true\\\"></span> <span class=\\\"sr-only\\\">Error:</span> Invalid Credentials</div><fieldset class=\\\"form-group\\\"><span for=\\\"domain\\\" class=\\\"small\\\">Affiliation</span><select id=\\\"domain\\\" class=\\\"form-control\\\" ng-options=\\\"option.name for option in vm.domains track by option.name\\\" ng-model=\\\"vm.user.domain\\\"></select></fieldset><fieldset class=\\\"form-group\\\" ng-show=\\\"vm.user.domain.name!=\\'Guest\\'\\\"><span class=\\\"form-control-label small\\\" for=\\\"username\\\">Username</span> <input id=\\\"username\\\" class=\\\"form-control input-sm\\\" type=\\\"text\\\" placeholder=\\\"Username\\\" ng-model=\\\"vm.user.name\\\"></fieldset><fieldset class=\\\"form-group\\\" ng-show=\\\"vm.user.domain.name!=\\'Guest\\'\\\"><span class=\\\"form-control-label small\\\" for=\\\"password\\\">Password</span> <input id=\\\"password\\\" class=\\\"form-control\\\" type=\\\"password\\\" placeholder=\\\"Password\\\" ng-model=\\\"vm.user.password\\\"></fieldset><button class=\\\"btn btn-default\\\" ng-click=\\\"vm.login()\\\">Login</button></div></form>\");\n$templateCache.put(\"app/components/markers/markers.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\"></os-tool-menu><os-tray content=\\\"tray-content-block\\\" change=\\\"vm.resize()\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><br><div class=\\\"col-xs-12 form-item\\\"><label>Patient Selection</label><div ng-repeat=\\\"item in vm.legendNodes\\\" class=\\\"legend-bar\\\" style=\\\"border-color:{{item.color}};position:relative;background-color:#FFF;padding:2px 10px;line-height:25px;\\\">{{item.name}}</div></div><div class=\\\"col-xs-12 form-item\\\"><label>Edge Visibility</label><div ng-repeat=\\\"item in vm.optEdgeColors\\\" class=\\\"legend-bar\\\" style=\\\"border-color:{{item.color}};position:relative;background-color:#FFF;padding:2px 10px;line-height:25px;\\\">{{item.name}} <label class=\\\"switch {{item.class}}\\\" style=\\\"float:right\\\"><input type=\\\"checkbox\\\" class=\\\"switch-input\\\" ng-model=\\\"item.show\\\" ng-change=\\\"vm.edgeToggle(item)\\\"> <span class=\\\"switch-label\\\" data-on=\\\"On\\\" data-off=\\\"Off\\\"></span> <span class=\\\"switch-handle\\\"></span></label></div></div><div class=\\\"col-xs-12 form-item\\\" ng-if=\\\"vm.optCommandMode.name==\\'Sequential\\'\\\"><label>Commands</label><br><a ng-click=\\\"vm.cmd(\\'ShowSelectedEdges\\')\\\" class=\\\"markers-command hvr-sweep-to-right\\\">Show Edges of Selected</a> <a ng-click=\\\"vm.cmd(\\'HideSelectedEdges\\')\\\" class=\\\"markers-command hvr-sweep-to-right\\\">Hide Edges of Selected</a> <a ng-click=\\\"vm.cmd(\\'HideUnselectedEdges\\')\\\" class=\\\"markers-command hvr-sweep-to-right\\\">Hide Edges of Unselected</a> <a ng-click=\\\"vm.cmd(\\'HideAllEdges\\')\\\" class=\\\"markers-command hvr-sweep-to-right\\\">Hide All Edges</a> <a ng-click=\\\"vm.cmd(\\'SelectInverse\\')\\\" class=\\\"markers-command hvr-sweep-to-right\\\">Invert Node Selection</a> <a ng-click=\\\"vm.cmd(\\'SelectConnected\\')\\\" class=\\\"markers-command hvr-sweep-to-right\\\">Select Connected Nodes</a> <a ng-click=\\\"vm.cmd(\\'HideUnselectedNodes\\')\\\" class=\\\"markers-command hvr-sweep-to-right\\\">Hide Unselected Nodes</a> <a ng-click=\\\"vm.cmd(\\'ShowAllNodes\\')\\\" class=\\\"markers-command hvr-sweep-to-right\\\">Show All Nodes</a></div><div class=\\\"col-xs-6 form-item\\\" style=\\\"padding-right:5px\\\"><label>Command Mode</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\" style=\\\"padding-right:30px;\\\">{{vm.optCommandMode.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.optCommandModes\\\" ng-click=\\\"vm.optCommandMode=item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-6 form-item\\\" style=\\\"padding-left:5px\\\"><label>Gene Set</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\" style=\\\"padding-right:30px;\\\">{{vm.optGeneSet.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.optGeneSets\\\" ng-click=\\\"vm.optGeneSet=item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-6 form-item\\\" style=\\\"padding-right:5px\\\"><label>Patient Layout</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\" style=\\\"padding-right:30px;\\\">{{vm.optPatientLayout.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.optPatientLayouts\\\" ng-click=\\\"vm.optPatientLayout=item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-6 form-item\\\" style=\\\"padding-left:5px\\\"><label>Patient Color</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\" style=\\\"padding-right:30px;\\\">{{vm.optPatientColor.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.optPatientColors\\\" ng-click=\\\"vm.optPatientColor=item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\" style=\\\"padding-left:5px\\\"><label>Lock Selections</label><div class=\\\"btn-group\\\" role=\\\"group\\\" style=\\\"display: block\\\"><button class=\\\"btn btn-default btn-no-focus\\\" type=\\\"button\\\" ng-click=\\\"vm.lock(\\'patient\\')\\\" style=\\\"width:50%; font-weight: 300;\\\" title=\\\"Patient Selection Lock\\\"><i class=\\\"fa fa-unlock\\\" ng-show=\\\"!vm.lockPatients\\\"></i> <i class=\\\"fa fa-lock\\\" ng-show=\\\"vm.lockPatients\\\"></i> Patients</button> <button class=\\\"btn btn-default btn-no-focus\\\" type=\\\"button\\\" ng-click=\\\"vm.lock(\\'gene\\')\\\" style=\\\"width:50%; font-weight: 300;\\\" title=\\\"Gene Selection Lock\\\"><i class=\\\"fa fa-unlock\\\" ng-show=\\\"!vm.lockGenes\\\"></i> <i class=\\\"fa fa-lock\\\" ng-show=\\\"vm.lockGenes\\\"></i> Genes</button></div></div><div class=\\\"col-xs-12 form-item\\\" style=\\\"padding-left:5px\\\"><label>Zoom</label><div class=\\\"btn-group\\\" role=\\\"group\\\" style=\\\"display: block\\\"><button class=\\\"btn btn-default btn-no-focus\\\" type=\\\"button\\\" ng-click=\\\"vm.zoom.reset()\\\" style=\\\"width:50%; font-weight: 300;\\\" title=\\\"Zoom Reset\\\">Reset</button> <button class=\\\"btn btn-default btn-no-focus\\\" type=\\\"button\\\" ng-click=\\\"vm.zoom.fit()\\\" style=\\\"width:50%; font-weight: 300;\\\" title=\\\"Zoom Selection\\\">Selected</button></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Search</label> <input type=\\\"text\\\" class=\\\"form-control\\\" ng-model=\\\"vm.search\\\" placeholder=\\\"Genes or Patients\\\"></div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div id=\\\"markers-chart\\\" class=\\\"markers-chart\\\"></div><div style=\\\"position:absolute;top:10px;left:50px;\\\"><h2 class=\\\"h2-tool\\\">Patients + Markers</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource.name}} {{vm.datasource.source}}</h3></div></section><div id=\\\"modalEdge\\\" class=\\\"modal fade\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"myModalLabel\\\"><div class=\\\"modal-dialog\\\" role=\\\"document\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-body\\\"><h2 style=\\\"margin-top:0px;\\\">Your request would add {{vm.edgeCounts.total}} edges to the graph.</h2><p>To improve performance + readability you may want to disable some of the edges.</p><div class=\\\"input-group\\\" ng-repeat=\\\"item in vm.optEdgeColors | filter:{show:true}\\\"><label class=\\\"switch {{item.class}}\\\"><input type=\\\"checkbox\\\" class=\\\"switch-input\\\" ng-model=\\\"item.show\\\"> <span class=\\\"switch-label\\\" data-on=\\\"On\\\" data-off=\\\"Off\\\"></span> <span class=\\\"switch-handle\\\"></span></label> <span style=\\\"padding-left:20px;\\\">{{item.name}} ({{vm.edgeCounts[item.abv]}})</span></div></div><button class=\\\"btn btn-default\\\" style=\\\"position:absolute;right:10px;bottom:10px;\\\" ng-click=\\\"vm.filterModelEdge()\\\">Continue</button></div></div></div><div class=\\\"tray tray-right\\\" ng-if=\\\"vm.detail.show\\\"><h2>{{vm.detail.title}}</h2><dl><dl class=\\\"markers-dl\\\" ng-bind-html=\\\"vm.detail.html\\\"></dl></dl></div>\");\n$templateCache.put(\"app/components/metadata/metadata.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\"></os-tool-menu><os-tray caption=\\\"Patients\\\" content=\\\"tray-content-block\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Search</h2></div><div class=\\\"col-xs-12 form-item\\\"><input type=\\\"text\\\" class=\\\"ngrs-range-slider ngrs-range-slider-no-pad\\\" style=\\\"width:100%\\\" ng-model=\\\"vm.search\\\"></div><div class=\\\"col-xs-12 form-label\\\"><h2>Information</h2><label>Raw data was provided by <a href=\\\"http://cancergenome.nih.gov/\\\">The Cancer Genome Atlas</a>. Processing of data was conducted by the <a href=\\\"http://www.sttrcancer.org/en.html\\\">Solid Tumor Translational Research Organization</a> in conjuntion with the <a href=\\\"http://www.fhcrc.org\\\">Fred Hutchinson Cancer Research Center</a>, <a href=\\\"http://www.uwmedicine.org/\\\">UW Medicine</a> and <a href=\\\"http://www.scca.org\\\">The Seattle Cancer Care Alliance</a>.</label></div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><h2 class=\\\"h2-tool\\\">{{vm.dataset}} Metadata</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource}}</h3><table id=\\\"metadata-datatable\\\" class=\\\"table table-striped table-bordered dt-responsive nowrap\\\" cellspacing=\\\"0\\\" width=\\\"100%\\\"><thead><tr><th ng-repeat=\\\"col in vm.colnames\\\">{{col}}</th></tr></thead><tbody><tr ng-repeat=\\\"row in vm.rows\\\"><td ng-repeat=\\\"datum in row track by $index\\\">{{datum}}</td></tr></tbody></table></div></section>\");\n$templateCache.put(\"app/components/oncoprint/oncoprint.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\" change=\\\"vm.addCohortPatient()\\\"></os-tool-menu><os-tray content=\\\"tray-content-block\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Cohorts</h2></div><div class=\\\"col-xs-12 form-label\\\"><h2>Legend</h2><span class=\\\"legend\\\"></span> <span class=\\\"oncoprint-label-col1\\\" id=\\\"legend\\\"></span></div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><div id=\\\"oncoprintDiv\\\" class=\\\"oncoprint\\\"><div id=\\\"oncoprintInstructions\\\" style=\\\"font-size:150%\\\">Please select and send up to 350 genes and patients from another tab, such as Markers and Patients, to populate the display.</div><div id=\\\"oncoprintErrorSection\\\" style=\\\"font-size:150%\\\" ng-show=\\\"vm.errorMessage!=\\'\\'\\\">{{vm.errorMessage}}</div><div id=\\\"oncoprintControlsDiv\\\"><div id=\\\"onc\\\"></div><button id=\\\"toggle_whitespace\\\">Toggle Whitespace</button> <button id=\\\"reduce_cell_width\\\">Reduce Cell Width</button></div></div></div></section>\");\n$templateCache.put(\"app/components/pathways/pathways.html\",\"<os-tool-menu></os-tool-menu><os-tray content=\\\"tray-content-block\\\" change=\\\"vm.resize($event)\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Options</h2></div><div class=\\\"col-xs-12 form-item\\\"><label>Search</label> <input type=\\\"text\\\" class=\\\"form-control\\\" ng-model=\\\"vm.search\\\"></div><div class=\\\"col-xs-12 form-label\\\"><h2>Legend</h2><span class=\\\"legend-bar\\\" style=\\\"border-color: green\\\">Activation</span> <span class=\\\"legend-bar\\\" style=\\\"border-color: red\\\">Inhibition</span> <span class=\\\"legend-bar\\\" style=\\\"border-color: #38347B\\\">Modification</span> <span class=\\\"legend-bar\\\" style=\\\"border-color: #056ce1\\\">Genes</span></div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><h2 class=\\\"h2-tool\\\">Pathways</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource.name}} {{vm.datasource.source}}</h3><div id=\\\"gbm-chart\\\" class=\\\"pathways-chart\\\"></div></div></section><div class=\\\"modal fade pathways\\\" id=\\\"gbm-webpage\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"myModalLabel\\\"><div class=\\\"modal-dialog\\\" role=\\\"document\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\"><span aria-hidden=\\\"true\\\">&times;</span></button><h4 class=\\\"modal-title\\\" id=\\\"myModalLabel\\\">{{vm.tip}}</h4></div><iframe class=\\\"modal-iframe\\\" ng-src=\\\"{{vm.frame}}\\\"></iframe></div></div></div>\");\n$templateCache.put(\"app/components/pca/pca.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\" change=\\\"vm.addCohortPatient()\\\"></os-tool-menu><os-tray content=\\\"tray-content-block\\\" change=\\\"vm.resize($event)\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Filters</h2></div><div class=\\\"col-xs-12 form-item\\\"><label>Gene Set</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.geneSet}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\"><li ng-repeat=\\\"item in vm.geneSets\\\" ng-click=\\\"vm.geneSet=item\\\">{{item}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Search</label> <input type=\\\"text\\\" class=\\\"ngrs-range-slider\\\" style=\\\"width: 100%;\\\" ng-model=\\\"vm.search\\\"></div><div class=\\\"col-xs-6 form-label\\\"><h2>Legend</h2><span class=\\\"circle\\\" style=\\\"background-color:black;width:10px;height: 10px;margin-right:10px;\\\"></span>Patients</div><div class=\\\"col-xs-6 form-label\\\"><h2>Variance</h2>PC1: {{vm.pc1}}%<br>PC2: {{vm.pc2}}%</div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><h2 class=\\\"h2-tool\\\">Principal Component Analysis</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource}}</h3><div id=\\\"pca-chart\\\" class=\\\"pca\\\"></div></div></section>\");\n$templateCache.put(\"app/components/pca3d/pca3d.html\",\"<section id=\\\"pca-chart\\\" class=\\\"pca container-fluid\\\" style=\\\"position: absolute;left:0px;top:0px;right: 0px;bottom: 0px;padding:0px;margin:0px;overflow: hidden;\\\"></section>\");\n$templateCache.put(\"app/components/plsr/plsr.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\" change=\\\"vm.addCohortGene()\\\"></os-tool-menu><os-tray content=\\\"tray-content-block\\\" change=\\\"vm.resize($event)\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Filters</h2></div><div class=\\\"col-xs-12 form-item\\\"><label>Gene Set</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.geneSet}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\"><li ng-repeat=\\\"item in vm.geneSets\\\" ng-click=\\\"vm.geneSet=item\\\">{{item}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Age At Diagnosis</label><div range-slider=\\\"\\\" min=\\\"vm.deathMinValue\\\" model-min=\\\"vm.deathMinFilter\\\" max=\\\"vm.deathMaxValue\\\" model-max=\\\"vm.deathMaxFilter\\\" prevent-equal-min-max=\\\"true\\\" show-values=\\\"true\\\" attach-handle-values=\\\"true\\\" on-handle-up=\\\"vm.update()\\\"></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Survival</label><div range-slider=\\\"\\\" min=\\\"vm.survivalMinValue\\\" model-min=\\\"vm.survivalMinFilter\\\" max=\\\"vm.survivalMaxValue\\\" model-max=\\\"vm.survivalMaxFilter\\\" prevent-equal-min-max=\\\"\\\" show-values=\\\"true\\\" attach-handle-values=\\\"true\\\" on-handle-up=\\\"vm.update()\\\"></div></div><div class=\\\"col-xs-12 form-label\\\"><h2>Legend</h2><span class=\\\"legend-bar\\\" style=\\\"border-color: #1396de\\\">Age At Diagnosis</span> <span class=\\\"legend-bar\\\" style=\\\"border-color: #38347b\\\">Survial</span> <span class=\\\"legend\\\"><span class=\\\"legend-dot\\\" style=\\\"background-color:#000\\\"></span>Genes</span></div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><h2 class=\\\"h2-tool\\\">Partial Least Squares Regression</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource}}</h3><div id=\\\"plsr-chart\\\" class=\\\"plsr\\\"></div></div></section><div class=\\\"modal fade plsr-webpage\\\" id=\\\"plsr-webpage\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"myModalLabel\\\"><div class=\\\"modal-dialog\\\" role=\\\"document\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\"><span aria-hidden=\\\"true\\\">&times;</span></button><h4 class=\\\"modal-title\\\" id=\\\"myModalLabel\\\">{{vm.tip}}</h4></div><iframe class=\\\"modal-iframe\\\" ng-src=\\\"{{vm.frame}}\\\"></iframe></div></div></div>\");\n$templateCache.put(\"app/components/subnav/subnav.html\",\"<div class=\\\"subnav\\\"><div class=\\\"btn-group\\\" style=\\\"float:right\\\"><button type=\\\"button\\\" class=\\\"btn btn-primary\\\" ng-click=\\\"vm.toolsClick()\\\">Analysis Tools</button> <button type=\\\"button\\\" class=\\\"btn btn-primary\\\" ng-click=\\\"vm.cohortClick()\\\">Cohorts</button></div><h2>{{vm.tool}} &mdash; {{vm.filter}}</h2></div>\");\n$templateCache.put(\"app/components/summary/summary.html\",\"<div class=\\\"summary\\\"></div>\");\n$templateCache.put(\"app/components/survival/survival.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\"></os-tool-menu><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><h2 class=\\\"h2-tool\\\">Patient Survival</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource}}</h3><div style=\\\"text-align: center;\\\"><img id=\\\"survival-img\\\" style=\\\"width:100%; height: auto; margin:auto;\\\"></div></div></section>\");\n$templateCache.put(\"app/components/timelines/timelines.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\" change=\\\"vm.addCohortPatient()\\\"></os-tool-menu><os-tray content=\\\"tray-content-block\\\" change=\\\"vm.resize($event)\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Options</h2></div><div class=\\\"col-xs-12 form-item\\\"><label>Align By</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.align.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.events\\\" ng-click=\\\"vm.align = item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Order By</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.sort.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.features\\\" ng-click=\\\"vm.sort = item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Filter</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.filter.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.filters\\\" ng-click=\\\"vm.filter = item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Timescale</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.timescale.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.timescales\\\" ng-click=\\\"vm.timescale=item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Event Colors</label> <span ng-repeat=\\\"item in vm.events\\\" class=\\\"legend-bar btn btn-default filter-button {{item.color}}\\\" ng-style=\\\"{\\'border-color\\':item.color}\\\" ng-click=\\\"vm.updateEventColor(item); $event.stopPropagation();\\\">{{item.name}} ({{item.selected ? \\'Visible\\' : \\'Hidden\\'}})</span></div><div class=\\\"col-xs-12 form-item\\\"><label>Selected Patients Display</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.optCohortMode.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.optCohortModes\\\" ng-click=\\\"vm.optCohortMode=item\\\">{{item.name}}</li></ul></div></div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><h2 class=\\\"h2-tool\\\">Timelines</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource}}</h3><div id=\\\"timelines-chart\\\"></div></div><div class=\\\"timeline-hover\\\" ng-if=\\\"vm.selShow\\\"><dl><dt>Event</dt><dd>{{vm.selEvent}}</dd></dl><dl><dt>Patient Id</dt><dd>{{vm.selPatient}}</dd></dl><dl ng-repeat=\\\"item in vm.selFields\\\"><dt>{{item.name}}</dt><dd>{{item.value}}</dd></dl></div></section>\");\n$templateCache.put(\"app/components/toolmenu/toolmenu.html\",\"<div><label class=\\\"tray-label tray-label-left\\\">Tools</label><section class=\\\"tool-menu tray tray-collapsed-left\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Tools</h2></div></div><div class=\\\"row tool-menu-row\\\" ng-repeat=\\\"tool in vm.tools\\\"><a href=\\\"\\\" ng-click=\\\"vm.explore(tool.route)\\\"><img class=\\\"tool-menu-img\\\" ng-src=\\\"/assets/images/datasets/{{tool.img}}\\\"> <span class=\\\"tool-menu-lbl\\\">{{tool.name}}</span> <span class=\\\"tool-menu-beta\\\" ng-if=\\\"tool.beta\\\" style=\\\"color:red\\\">(Beta)</span></a></div></section></div>\");\n$templateCache.put(\"app/components/tools/tools.html\",\"<section class=\\\"tools container-fluid\\\"><div class=\\\"row\\\"><div class=\\\"col-sm-8 col-md-6\\\"><h1>Analysis Tools</h1></div></div><div class=\\\"row\\\"><ul><li ng-repeat=\\\"tool in vm.tools\\\" class=\\\"col-xs-12 col-sm-6 col-md-4 col-lg-3\\\" ng-click=\\\"vm.explore(tool.route, vm.datasource)\\\"><img class=\\\"tools-img\\\" ng-src=\\\"/assets/images/datasets/{{tool.img}}\\\"><div class=\\\"tools-copy\\\"><h3 class=\\\"tools-lbl\\\">{{tool.name}}</h3><a href=\\\"\\\">Explore</a></div></li></ul></div></section>\");\n$templateCache.put(\"app/components/tray/tray.html\",\"<div><label class=\\\"tray-label tray-label-right\\\">Options</label><div class=\\\"tray {{vm.trayClass}} tray-right\\\" locked=\\\"true\\\"><ng-transclude></ng-transclude><i class=\\\"fa fa-lock tray-sticky-icon {{vm.iconClass}}\\\" ng-click=\\\"vm.toggle()\\\"></i></div></div>\");}]);"],"sourceRoot":"/source/"}