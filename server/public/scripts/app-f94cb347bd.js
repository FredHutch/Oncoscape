!function(){"use strict";angular.module("oncoscape",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngMessages","ngAria","ngResource","ui.router","ui.bootstrap","ui-rangeSlider","ui.bootstrap.contextMenu","nvd3","toastr"])}(),function(){"use strict";function e(){function e(e){var t=this;t.trayClass=Math.random().toString(36).substring(3),t.iconClass=Math.random().toString(36).substring(3);var n=!0;t.toggle=function(){var i=angular.element("."+t.trayClass),s=angular.element("."+t.iconClass),r=angular.element("."+t.content);n=!n,s.addClass(n?"fa-lock":"fa-unlock-alt").removeClass(n?"fa-unlock-alt":"fa-lock"),i.attr("locked",n?"true":"false"),n?(r.removeClass("tray-content-block-collapsed"),i.unbind("mouseover",a).unbind("mouseout",o).removeClass("tray-collapsed"),e(function(){t.change()})):(r.addClass("tray-content-block-collapsed"),i.addClass("tray-collapsed").bind("mouseover",a).bind("mouseout",o),e(function(){t.change()}))};var a=function(){angular.element("."+t.trayClass).removeClass("tray-collapsed")},o=function(){angular.element("."+t.trayClass).addClass("tray-collapsed")}}e.$inject=["$timeout"];var t={restrict:"E",templateUrl:"app/components/tray/tray.html",scope:{caption:"@",content:"@",change:"&"},controller:e,controllerAs:"vm",bindToController:!0,replace:!0,transclude:!0};return t}angular.module("oncoscape").directive("osTray",e)}(),function(){"use strict";function e(){function e(e,t,n){var a=this;e.query("lookup_oncoscape_tools",{beta:!1}).then(function(e){a.tools=e.data}),a.explore=function(n,a){t.go(n,{datasource:e.getDataSource().disease})}}e.$inject=["osApi","$state","$stateParams"];var t={restrict:"E",templateUrl:"app/components/tools/tools.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osTools",e)}(),function(){"use strict";function e(){function e(e,t){var n=function(){angular.element(".tool-menu").removeClass("tray-collapsed-left")},a=function(){angular.element(".tool-menu").addClass("tray-collapsed-left")},o=angular.element(".tool-menu");o.bind("mouseover",n).bind("mouseout",a);var i=this;e.query("lookup_oncoscape_tools",{beta:!1}).then(function(e){i.tools=e.data}),i.explore=function(n){i.change(),t.go(n,{datasource:e.getDataSource().disease})}}e.$inject=["osApi","$state"];var t={restrict:"E",templateUrl:"app/components/toolmenu/toolmenu.html",controller:e,controllerAs:"vm",scope:{datasource:"@",change:"&"},bindToController:!0};return t}angular.module("oncoscape").directive("osToolMenu",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,s,r,l){function c(){S=_.selectAll(".timeline-selected")[0].map(function(e){return e.__data__.id}),0==S.length&&(S=_.selectAll()[0].map(function(e){return e.__data__.id})),t.addPatientSelection("Timelines","Manual Selection",S),"Filter"==v.optCohortMode.name&&P()}if(angular.isUndefined(o.datasource))return void n.go("datasource");var d,u,p,m,g,h=0,v=this;v.selShow=!1,v.selPatient,v.selEvent,v.selFields=[],v.datasource=o.datasource,v.optCohortModes,v.optCohortMode,v.timescaleunit,v.timescales,v.timescale,v.features,v.feature,v.filters,v.filter,v.events,v.sorts,v.sort,v.align,v.optCohortModes=[{name:"Highlight"},{name:"Filter"}],v.optCohortMode=v.optCohortModes[0];var f,b,y=angular.element("#timelines-chart"),w=l.select("#timelines-chart").append("svg").attr("id","chart").style({width:"100%"}),A=w.append("g").attr({"class":"axis"}).style({"shape-rendering":"crispEdges","stroke-width":"1.0",stroke:"#000",fill:"none"}),k=w.append("svg").attr({"class":"bars-svg"}),x=k.append("rect").attr({width:y.width(),height:i.innerHeight-75-10-130-50}).style({fill:"#FFFFFF"}),_=k.append("g").attr({"class":"bars"}),S=null==t.getPatientSelection()?null:t.getPatientSelection().ids,T=function(){if(!l.event.shiftKey){var e=h*l.event.scale;h>e&&(e=h);var t=l.event.translate[1],n=i.innerHeight-75-10-130-50,a=20*d.patients.length*e,o=n-a;t>0&&(t=0),o>t&&(t=o),f.translate([l.event.translate[0],t]);var s=20*e,r=n/s,c=Math.abs(t/s);b.y(l.scale.linear().range([0,n]).domain([c,c+r])),_.attr("transform","translate(1,"+t+")scale(1,"+e+")")}},C=!1,E=function(){l.event.sourceEvent.shiftKey?C=!0:(l.event.target.clear(),l.select(this).call(l.event.target))},D=function(){if(C){var e=b.extent(),t=Math.floor(e[0][1]),n=Math.floor(e[1][1]);_.selectAll("g.timeline").each(function(e,a){l.select(this.firstChild).classed("timeline-selected",a>=t&&n>=a)})}},M=function(){C&&(C=!1,l.event.target.clear(),l.select(this).call(l.event.target),c())},P=function(){var e=20,t=i.innerHeight-75-10-130,n=i.innerWidth-300;n>760&&(n-=140),"false"==angular.element(".tray-right").attr("locked")&&(n+=300),d=$(u,v.align,v.sort),m=l.scale.linear().domain(d.bounds).range([10,n-10]).nice(),g=l.scale.linear().domain([0,d.patients.length]).range(0,t-50).nice(),h=(t-50)/(20*d.patients.length),w.attr({height:t+"px"}),k.attr({height:t-50+"px",width:n+"px"}),x.attr({height:t-50+"px",width:n+"px"}),_.attr("transform","scale(1,"+h+")");var o=_.selectAll("g.timeline").data(d.patients);o.exit().remove(),o.enter().append("g").attr({"class":"timeline"}).on("mousedown",function(){l.event.shiftKey||_.selectAll(".timeline-selected").classed("timeline-selected",!1)}).attr({width:n,height:e,transform:function(t,n){return"translate(0,"+n*e+")"}}).append("rect").attr({"class":"timeline-row",width:0,height:e}),"Highlight"==v.optCohortMode.name&&S.length>0?o.each(function(e){var t=S.indexOf(e.id)>=0,n=l.select(this.firstChild);n.classed("timeline-selected",t)}):o.each(function(){var e=l.select(this.firstChild);e.classed("timeline-selected",!1)});var s=o.selectAll("rect.event").data(function(e){return e.filteredEvents});s.exit().remove(),s.enter().append("rect").attr({"class":"event"}).on("mouseover",function(){var e=p[this.__data__.id];v.selPatient=e.PatientID,v.selEvent=e.Name;var t=[];for(var n in e.Fields)null!=e.Fields[n]&&("date"==n&&angular.isArray(e.Fields[n])?(t.push({name:"Start Date",value:e.Fields[n][0]}),t.push({name:"End Start",value:e.Fields[n][1]})):t.push({name:n,value:e.Fields[n]}));v.selShow=!0,v.selFields=t,a.$apply()}).on("mouseout",function(){v.selShow=!1,a.$apply()}),s.transition().style({fill:function(e){return e.color}}).attr({height:function(t){return"Radiation"==t.name||"Drug"==t.name?e/2:e},width:function(e){return null==e.endValue?3:m(e.endValue)-m(e.startValue)},x:function(e){return Math.round(m(e.startValue))},y:function(t){return"Radiation"==t.name?e/2:0}});var r=function(e){return 0==Math.abs(e)?e:Math.abs(e)<30?e+" Days":Math.abs(e)<360?Math.round(e/30.4*10)/10+" Months":Math.round(e/365*10)/10+" Years"},c=l.svg.axis().scale(m).orient("bottom").ticks(8);c="Log"==v.timescale.name?c.tickFormat(function(e){return r(Math.round((0>e?-1:1)*(Math.pow(2,Math.abs(e))-1)*100)/100)}):c.tickFormat(function(e){return r(e)}),b=l.svg.brush().x(m).y(l.scale.linear().range([0,t]).domain([0,d.patients.length])).on("brush",D).on("brushstart",E).on("brushend",M),x.call(b),x.on("mousedown",function(){l.event.shiftKey||_.selectAll(".timeline-selected").classed("timeline-selected",!1)}),f=l.behavior.zoom().x(m).y(g).translate([0,0]).scale(1,h).on("zoom",T),x.call(f),A.attr({"class":"timeline-axis",width:100,transform:function(){return"translate(0,"+(t-50)+")"}}),A.call(c)},$=function(e,t,n){var a={};return a.events=v.events.filter(function(e){return e.selected}),a.patients=e.filter(function(e){return"Only Alive"==v.filter.name&&e.dead?!1:("Only Dead"!=v.filter.name||e.dead)&&e.hasOwnProperty("__"+this.align)?this.filter&&this.ids&&-1==this.ids.indexOf(e.id)?!1:!0:!1},{align:t.name,filter:"Filter"==v.optCohortMode.name,ids:S}),"Survival"==n.name?a.patients=a.patients.sort(function(e,t){return e.dead==t.dead?e.calcEvents[n.index].value>t.calcEvents[n.index].value?1:-1:e.dead?1:-1},n):a.patients=a.patients.sort(function(e,t){return e.calcEvents[n.index].value>t.calcEvents[n.index].value?1:-1},n),a.patients.forEach(function(e){e.filteredEvents=e.dateEvents.filter(function(e){for(var t=0;t<this.length;t++)if(this[t].name==e.name)return!0;return!1},a.events),e.filteredEvents.forEach(function(e){e.startValue=v.timescale.timeFn(e.start+this),e.endValue=null!=e.end?v.timescale.timeFn(e.end+this):null},-e["__"+this.align.name].start)},{align:t,events:a.events}),a.bounds=a.patients.reduce(function(e,t){var n=t.filteredEvents.reduce(function(e,t){return[Math.min(t.startValue,e[0]),Math.max(null==t.endValue?t.startValue:t.endValue,e[1])]},[1/0,-(1/0)]);return[Math.min(n[0],e[0]),Math.max(n[1],e[1])]},[1/0,-(1/0)]),a};!function(){var n=function(e){var t=e.name,n="Birth"===t?"#17becf":"Diagnosis"===t?"#8c564b":"Pathology"===t?"#7f7f7f":"Progression"===t?"#1f77b4":"Absent"===t?"#000000":"Status"===t?"#bcbd22":"Radiation"===t?"#e7969c":"Procedure"===t?"#ff7f0e":"Encounter"===t?"#d62728":"Drug"===t?"#9467bd":"black";return n},o=function(e){return Object.keys(e).map(function(e){var t={name:e,selected:!0};return t.color=t.__color=n(t),t})},s=function(e){return e[0].calcEvents.map(function(e,t){return{name:e.name,index:t}})},l=function(e,t){e=Object.keys(e).map(function(t){var n=e[t];return n.id=t,n});for(var a=0;a<e.length;a++){var o=e[a],i=r,s="YYYY-MM-DD",l=o.dateEvents.filter(function(e){return"single"===e.eventOrder}).map(function(e){return{start:i(e.date,s).unix(),end:null,name:e.name,id:e.eventID}}),c=o.dateEvents.filter(function(e){return"end"===e.eventOrder}).map(function(e){return{end:i(e.date,s).unix(),id:e.eventID}}),d=o.dateEvents.filter(function(e){return"start"===e.eventOrder}).map(function(e){return{start:i(e.date,s).unix(),name:e.name,id:e.eventID}});d.forEach(function(e){e.end=c.filter(function(t){return t.id==e.id})[0].end}),o.dateEvents=d.length>0?d.concat(l):l,o.dateEvents.forEach(function(e){e.color=n(e),o["__"+e.name]=e,"Status"==e.name&&(o.dead=-1!=t.indexOf(e.id))})}return e};e.setBusy(!0)("Loading Dataset"),e.setDataset(v.datasource).then(function(){e.getTimelines().then(function(n){v.timescales=[{name:"Log",timeFn:function(e){return(0>e?-1:1)*Math.log(Math.abs(1e3*e/864e5)+1)/Math.log(2)}},{name:"Linear",timeFn:function(e){return r.duration(1e3*e).asDays()}}],v.timescale=v.timescales[0],u=l(n.payload.pts,n.payload.eventTypes.Status.status.Dead),p=n.payload.events,v.sorts=s(u),v.filters=[{name:"Alive + Dead"},{name:"Only Alive"},{name:"Only Dead"}],v.filter=v.filters[0];var c=s(u);c.unshift({index:-1,name:"None"}),v.features=c,v.feature=v.features[0],v.events=o(n.payload.eventTypes),v.sort=v.sorts[1],v.events.forEach(function(e){"Birth"==e.name&&(e.selected=!1,e.color="#FEFEFE"),"Diagnosis"==e.name&&(this.align=e)},v),a.$watchGroup(["vm.feature","vm.sort","vm.align","vm.timescale","vm.filter"],P),angular.element(i).bind("resize",P),a.$watch("vm.optCohortMode",P),t.onPatientSelectionChange.add(function(e){S=e.ids,P()}),e.setBusy(!1)})})}(),v.resize=function(){P()},v.updateEventColor=function(e){e.selected=!e.selected,e.color=e.selected?e.__color:"#FEFEFE",P()}}e.$inject=["osApi","osHistory","$state","$scope","$stateParams","$window","$document","moment","d3"];var t={restrict:"E",templateUrl:"app/components/timelines/timelines.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osTimelines",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i){if(angular.isUndefined(i.datasource))return void n.go("datasource");var s=this;s.datasource=i.datasource,e.setBusy(!0),e.setDataset(s.datasource).then(function(){null==t.getPatientSelection()?e.getPatientHistoryTable(s.datasource).then(function(e){r(e.payload.tbl.map(function(e){return e[0]}))}):r(t.getPatientSelection().ids)}),t.onPatientSelectionChange.add(function(e){r(e.ids)});var r=function(t){e.setBusy(!0),e.getCalculatedSurvivalCurves(t,"").then(function(t){angular.element("#survival-img").attr("src",t.payload),e.setBusy(!1)})}}e.$inject=["osApi","osHistory","$state","$timeout","$scope","$stateParams"];var t={restrict:"E",templateUrl:"app/components/survival/survival.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osSurvival",e)}(),function(){function e(){function e(e,t,n,a,o,i,s,r,l,c,d,u){}e.$inject=["osApi","osHistory","$state","$timeout","$scope","$stateParams","cytoscape","signals","moment","$window","_","$q"];var t={restrict:"E",templateUrl:"app/components/summary/summary.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osSummary",e)}(),function(){"use strict";function e(){function e(e,t){var n=this;n.tool="Pathways",n.filter="DemoDZ",n.toolsClick=function(){t.go("tools",{datasource:n.datasource})},n.cohortClick=function(){e.toggleFilter()}}e.$inject=["osApi","$state"];var t={restrict:"E",templateUrl:"app/components/subnav/subnav.html",replace:!0,controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osSubnav",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,s,r,l,c,d){function u(){var e=w.selectAll(".plsr-node-selected")[0];0!=e.length&&t.addGeneSelection("PLSR","Manual Selection",w.selectAll(".plsr-node-selected")[0].map(function(e){return e.__data__.name.toUpperCase()}))}function p(){0==x.length?w.selectAll(".plsr-node-selected").classed("plsr-node-selected",!1):w.selectAll("circle").classed("plsr-node-selected",function(){return x.indexOf(this.__data__.name)>=0})}if(angular.isUndefined(a.datasource))return void n.go("datasource");var m,g,h,v,f,b,y,w=s.select("#plsr-chart").append("svg").attr("id","chart"),A=s.select("body").append("div").attr("class","tooltip plsr-tooltip"),k=this;k.datasource=a.datasource,k.deathMinFilter=k.deathMinValue=45,k.deathMaxFilter=k.deathMaxValue=66,k.survivalMinFilter=k.survivalMinValue=3,k.survivalMaxFilter=k.survivalMaxValue=7,k.geneSets=[],k.geneSet=null,k.frame,k.tip=null;var x=null==t.getGeneSelection()?[]:t.getGeneSelection().ids;e.setBusy(!0)("Loading Dataset"),e.setDataset(k.datasource).then(function(n){var a=n.payload.rownames.filter(function(e){return e.indexOf("mtx.mrna")>=0});a=a[a.length-1].replace(".RData",""),e.setBusyMessage("Creating PLSR Matrix"),e.getPLSR(k.datasource,a).then(function(){e.setBusyMessage("Loading Gene Sets"),e.getGeneSetNames().then(function(n){k.geneSets=n.payload,k.geneSet=k.geneSets[0],e.setBusyMessage("Loading Patients"),e.getSummarizedPLSRPatientAttributes().then(function(e){var n=e.payload;k.deathMinValue=Math.floor(n.AgeDx[0]/365.24),k.deathMaxValue=Math.floor(n.AgeDx[4]/365.24),k.survivalMinValue=Math.floor(n.Survival[0]/365.24),k.survivalMaxValue=Math.floor(n.Survival[4]/365.24),i.$watch("vm.geneSet",function(){k.update()}),t.onGeneSelectionChange.add(function(e){x=e.ids,p()})})})})}),k.update=function(){function t(){m=c.innerWidth-400,"false"==angular.element(".tray-right").attr("locked")&&(m+=300),g=c.innerHeight-190,"true"==angular.element(".tray").attr("locked")&&(m-=300),w.attr("width","100%").attr("height",g),h=s.scale.linear().domain([-f,f]).range([0,m]).nice(),v=s.scale.linear().domain([-b,b]).range([g,0]).nice()}function n(e,n,a){f=.9*e,b=.9*e,t(),y=s.svg.brush().x(h).y(v).on("brushend",function(){var e=y.extent();w.selectAll("circle").classed("plsr-node-selected",function(t){return t[0]>e[0][0]&&t[0]<e[1][0]&&t[1]>e[0][1]&&t[1]<e[1][1]}),s.select(this).transition().duration(300).call(y.extent([[0,0],[0,0]])),u()}),w.call(y);var o=w.selectAll("circle").data(a,function(e){return e});o.enter().append("circle").attr({"class":"plsr-node",cx:.5*m,cy:.5*g,r:3}).style("fill-opacity","0").on("mouseover",function(e){A.transition().duration(200).style("opacity",1),A.html(e.name).style("left",s.event.pageX+15+"px").style("top",s.event.pageY-15+"px")}).on("mouseout",function(){A.transition().duration(500).style("opacity",0)}).on("click",function(e){angular.element("#plsr-webpage").modal();var t="https://www.genecards.org/cgi-bin/carddisp.pl?gene="+e.name;i.$apply(function(){k.frame=l.trustAsResourceUrl(t)})}),o.transition().duration(750).delay(function(e,t){return t/300*500}).attr("cx",function(e){return h(e[0])}).attr("cy",function(e){return v(e[1])}).style("fill-opacity",1),o.exit().transition().duration(600).delay(function(e,t){return t/300*500}).attr("cx",.5*m).attr("cy",.5*g).style("fill-opacity","0").remove();var r=w.selectAll("line").data(n);r.enter().append("line").attr({"class":"line","stroke-width":3,x1:h(0),y1:v(0),x2:h(0),y2:v(0)}).style("stroke",function(e){return e.name.indexOf("Age")?"#1396de":"#38347b"}),r.transition().duration(900).attr({x1:h(0),y1:v(0),x2:function(e){return h(e[0])},y2:function(e){return v(e[1])}}),r.exit().remove();var c=w.selectAll("text").data(n);c.enter().append("text").attr({"class":"text",x:.5*m,y:.5*g,"text-anchor":function(e){return e[0]>0?"start":"end"}}).text(function(e){return e.name}).style({fill:"black","text-anchor":"middle"}),c.transition().duration(900).attr({x:function(e){return h(e[0])},y:function(e){return v(e[1])}}),c.exit().remove(),p()}e.setBusyMessage("Calculating PLSR");var a=[{name:"Survival",low:365.24*Number(k.survivalMinFilter),high:365.24*Number(k.survivalMaxFilter)},{name:"AgeDx",low:365.24*Number(k.deathMinFilter),high:365.24*Number(k.deathMaxFilter)}];e.getCalculatedPLSR(k.geneSet,a).then(function(t){e.setBusyMessage("Rendering PLSR");var a=t.payload,o=a.loadings.map(function(e,t){return e.name=this[t],e},a.loadingNames),i=a.vectors.map(function(e,t){return e.name=this[t],e},a.vectorNames),s=1.2*a.maxValue;n(s,i,o),e.setBusy(!1)}),k.resize=function(){t(),w.selectAll("circle").attr({cx:function(e){return h(e[0])},cy:function(e){return v(e[1])}}),w.selectAll("text").attr({x:function(e){return h(e[0])},y:function(e){return v(e[1])}}),w.selectAll("line").attr({x1:h(0),y1:v(0),x2:function(e){return h(e[0])},y2:function(e){return v(e[1])}})},angular.element(c).bind("resize",d.debounce(k.resize,300))}}e.$inject=["osApi","osHistory","$state","$stateParams","$timeout","$scope","d3","moment","$sce","$window","_"];var t={restrict:"E",templateUrl:"app/components/plsr/plsr.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osPlsr",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,s,r){function l(){requestAnimationFrame(l),b.update()}if(angular.isUndefined(n.datasource))return void t.go("datasource");var c=this;c.datasource=n.datasource,c.geneSets=[],c.geneSet=null,c.toggleFilter=function(){angular.element(".container-filters").toggleClass("container-filters-collapsed"),angular.element(".container-filter-toggle").toggleClass("container-filter-toggle-collapsed")};var d,u=angular.element("#pca-chart");e.setBusy(!0)("Loading Dataset"),e.setDataset(c.datasource).then(function(t){var n=t.payload.rownames.filter(function(e){return e.indexOf("mtx.mrna")>=0});n=n[n.length-1].replace(".RData",""),e.setBusyMessage("Creating PCA Matrix"),e.getPCA(c.datasource,n).then(function(){e.setBusyMessage("Loading Gene Sets"),e.getGeneSetNames().then(function(e){c.geneSets=e.payload,c.geneSet=c.geneSets[0],o.$watch("vm.geneSet",function(){p()})})})});var p=function(){e.setBusyMessage("Calculating PCA"),e.getCalculatedPCA2(c.geneSet).then(function(t){e.setBusyMessage("Rendering PCA");var n=t.payload;c.pc1=t.payload["importance.PC1"],c.pc2=t.payload["importance.PC2"];var a=n.scores,o=n.ids;d=a.map(function(e,t){return e.id=o[t],e},n.ids),v(),e.setBusy(!1)})},m=new s.Scene,g=new s.PerspectiveCamera(50,r.innerWidth/r.innerHeight,.1,1e3);g.position.z=60;var h=r.WebGLRenderingContext?new s.WebGLRenderer({antialias:!0}):new s.CanvasRenderer;h.setPixelRatio(r.devicePixelRatio),h.setSize(r.innerWidth,r.innerHeight),u.append(h.domElement);var v=function(){for(var e=[],t=d.length,n=new s.SphereGeometry(.1,8,8),a=new s.MeshBasicMaterial({color:"#59a5fb"}),o=0;t>o;o++){e[o]=new s.Mesh(n,a);var i=d[o];e[o].position.x=i[0],e[o].position.y=i[1],e[o].position.z=i[2],m.add(e[o])}f()},f=function(){h.render(m,g)},b=new s.OrbitControls(g);b.addEventListener("change",f),l()}e.$inject=["osApi","$state","$stateParams","$timeout","$scope","d3","THREE","$window"];var t={restrict:"E",templateUrl:"app/components/pca3d/pca3d.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osPca3d",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,s,r,l,c){function d(){var e=x.selectAll(".pca-node-selected")[0];0!=e.length&&t.addPatientSelection("PCA","Manual Selection",x.selectAll(".pca-node-selected")[0].map(function(e){return e.__data__.id.toUpperCase()}))}function u(){0==E.length?x.selectAll(".pca-node-selected").classed("pca-node-selected",!1):x.selectAll("circle").classed("pca-node-selected",function(){return E.indexOf(this.__data__.id)>=0})}function p(){g=l.innerWidth-400,"false"==angular.element(".tray-right").attr("locked")&&(g+=300),h=l.innerHeight-190,"true"==angular.element(".tray").attr("locked")&&(g-=300),x.attr("width","100%").attr("height",h),v=s.scale.linear().domain([-b,b]).range([0,g]).nice(),f=s.scale.linear().domain([-y,y]).range([h,0]).nice()}function m(){var e,t,n=k;e=Math.abs(s.max(n,function(e){return+e[0]})),t=Math.abs(s.min(n,function(e){return+e[0]})),b=1.2*(e>t?e:t),e=Math.abs(s.max(n,function(e){return+e[1]})),t=Math.abs(s.min(n,function(e){return+e[1]})),y=1.2*(e>t?e:t),p(),w=s.svg.axis().scale(v).orient("top").ticks(5),A=s.svg.axis().scale(f).orient("left").ticks(5);var a=s.svg.brush().x(v).y(f).on("brushend",function(){var e=a.extent();x.selectAll("circle").classed("pca-node-selected",function(t){return t[0]>e[0][0]&&t[0]<e[1][0]&&t[1]>e[0][1]&&t[1]<e[1][1]}),s.select(this).transition().duration(300).call(a.extent([[0,0],[0,0]])),d()});x.call(a);var o=x.selectAll("circle").data(k,function(e){return e});o.enter().append("circle").attr({"class":"pca-node",cx:.5*g,cy:.5*h,r:3}).style("fill-opacity","0").on("mouseover",function(e){T.transition().duration(200).style("opacity",1),T.html(e.id).style("left",s.event.pageX+10+"px").style("top",s.event.pageY-5+"px")}).on("mouseout",function(){T.transition().duration(500).style("opacity",0)}).transition().duration(750).delay(function(e,t){return t/300*500}).attr("cx",function(e){return v(e[0])}).attr("cy",function(e){return f(e[1])}).style("fill-opacity",1),o.exit().transition().duration(600).delay(function(e,t){return t/300*500}).attr("cx",.5*g).attr("cy",.5*h).style("fill-opacity","0").remove(),S.attr("class","axis").attr("transform","translate(0, "+f(0)+")").call(w).append("text").text("PC1"),_.attr("class","axis").attr("transform","translate("+v(0)+", 0)").call(A).append("text").attr("y",10).attr("dy",".71em").text("PC2"),u()}if(angular.isUndefined(a.datasource))return void n.go("datasource");var g,h,v,f,b,y,w,A,k,x=s.select("#pca-chart").append("svg").attr("id","chart"),_=x.append("g"),S=x.append("g"),T=s.select("body").append("div").attr("class","tooltip pca-tooltip"),C=this;C.datasource=a.datasource,C.geneSets=[],C.geneSet=null,C.search="";var E=null==t.getPatientSelection()?[]:t.getPatientSelection().ids;e.setBusy(!0)("Loading Dataset"),e.setDataset(C.datasource).then(function(n){var a=n.payload.rownames.filter(function(e){return e.indexOf("mtx.mrna")>=0});a=a[0].replace(".RData",""),e.setBusyMessage("Creating PCA Matrix"),e.getPCA(C.datasource,a).then(function(){e.setBusyMessage("Loading Gene Sets"),e.getGeneSetNames().then(function(e){C.geneSets=e.payload,C.geneSets.unshift("All"),C.geneSet=C.geneSets[0],i.$watch("vm.geneSet",function(){D()}),t.onPatientSelectionChange.add(function(e){E=e.ids,C.search="",u()})})})});var D=function(){e.setBusyMessage("Calculating PCA"),e.getCalculatedPCA("All"==C.geneSet?null:C.geneSet).then(function(t){e.setBusyMessage("Rendering PCA");var n=t.payload;C.pc1=Math.round(100*t.payload["importance.PC1"]),C.pc2=Math.round(100*t.payload["importance.PC2"]);var a=n.scores,o=n.ids;k=a.map(function(e,t){return e.id=o[t],e},n.ids),m(),e.setBusy(!1)})};C.resize=function(){p(),w.scale(v),A.scale(f),S.attr("transform","translate(0, "+f(0)+")").call(w),_.attr("transform","translate("+v(0)+", 0)").call(A),x.selectAll("circle").attr("cx",function(e){return v(e[0])}).attr("cy",function(e){return f(e[1])})},angular.element(l).bind("resize",c.debounce(C.resize,300))}e.$inject=["osApi","osHistory","$state","$stateParams","$timeout","$scope","d3","moment","$window","_"];var t={restrict:"E",templateUrl:"app/components/pca/pca.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osPca",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,s,r,l,c){function d(){if(f)return void(f=!1);var e=g.$('node[nodeType="gene"]:selected').map(function(e){return e.data().id.toUpperCase()});t.addGeneSelection("Pathways","Manual Selection",e)}function u(){f=!0,g.startBatch(),null==b?g.$('node[nodeType="gene"]:selected').forEach(function(e){e.deselect()}):g.$('node[nodeType="gene"]').forEach(function(e){e[-1==this.indexOf(e.id())?"deselect":"select"]()},b),g.endBatch()}function p(){var e="rgb(5, 108, 225)",t="red",n="rgb(56, 52,123)",a="green";return[{selector:"node",style:{content:"data(label)","text-valign":"center","text-halign":"center",shape:"ellipse",width:"60px",height:"50px",color:e,"background-color":"rgb(250, 250, 250)","border-width":"2px","border-color":e}},{selector:"edge",style:{width:"2px","line-color":e,"line-style":"solid"}},{selector:'node[nodeType="class"], node[nodeType="family"], node[nodeType="complex"]',style:{content:"","background-color":"white",shape:"roundrectangle"}},{selector:'edge[edgeType="activates"], edge[edgeType="indirectly activates"]',style:{"line-color":a,"target-arrow-shape":"triangle","target-arrow-color":a}},{selector:'edge[edgeType="inhibits"], edge[edgeType="ubiquitinylates"]',style:{"line-color":t,"target-arrow-shape":"tee","target-arrow-color":t}},{selector:'edge[edgeType="fusion"]',style:{"line-color":a}},{selector:'edge[edgeType="contains"]',style:{display:"none"}},{selector:'node[nodeType="process"]',style:{}},{selector:'node[nodeType="gene"]:selected',style:{"overlay-opacity":"0.5","overlay-color":"red"}},{selector:'node[nodeType="rtk"]',style:{content:"data(label)","background-color":"rgb(224, 209, 178)","border-color":"black","border-width":"0px","font-size":"48px",shape:"roundrectangle",width:"40px",height:"160px"}},{selector:'node[nodeType="kinase"]',style:{content:"data(label)","background-color":"rgb(255, 206, 194)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="dimer"]',style:{content:"","background-color":"rgb(234, 219, 188)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"0px"}},{selector:'node[nodeType="loop"]',style:{content:"","background-color":"rgb(255, 255, 255)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px","border-style":"dotted"}},{selector:'node[nodeType="gtpase"]',style:{content:"data(label)","background-color":"rgb(194, 194, 255)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="adaptor"]',style:{content:"data(label)","background-color":"rgb(77, 184, 255)",shape:"ellipse",width:"60px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="GEF"]',style:{content:"data(label)","background-color":"rgb(77, 184, 255)",shape:"ellipse",width:"60px",height:"60px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="process"]',style:{content:"data(label)","background-color":"rgb(255, 255, 255)",shape:"roundrectangle",width:"100px",height:"40px","font-size":"24px","border-color":"black","border-width":"0px"}},{selector:'node[nodeType="TF"]',style:{content:"data(label)","background-color":"rgb(255, 206, 94)",shape:"diamond",width:"160px",height:"60px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="gene fusion"]',style:{content:"data(label)",shape:"roundrectangle","font-size":"24px","border-color":"red","border-width":"3px"}},{selector:"edge:selected",style:{"overlay-color":"grey","overlay-opacity":"0.3"}},{selector:'edge[edgeType="recruits"]',style:{width:"2px"}},{selector:'edge[edgeType="fusion"]',style:{"line-color":n}},{selector:'edge[edgeType="recruits"]',style:{"line-color":"red",width:"1px","line-style":"dashed","target-arrow-shape":"triangle","target-arrow-color":"black"}},{selector:'edge[edgeType="cycles"]',style:{"line-color":"black",width:"1px","line-style":"dashed","target-arrow-shape":"triangle","source-arrow-shape":"triangle","target-arrow-color":"green","source-arrow-color":"red"}},{selector:'edge[edgeType="associates"]',style:{"line-color":"black",width:"1px","line-style":"solid"}},{selector:'edge[edgeType="activation"]',style:{"line-color":"green",width:"1px"}},{selector:'edge[edgeType="inhibition"]',style:{"line-color":"red",width:"1px"}}]}var m,g,h=this,v=angular.element("#gbm-chart"),f=!1,b=null==t.getGeneSelection()?null:t.getGeneSelection().ids;h.datasource=e.getDataSource(),h.search="",h.frame,h.tip=null,h.linkTitle="",h.links=[],h.resize=function(){var e=s.innerWidth;e>760&&(e-=140),"true"==angular.element(".tray").attr("locked")&&(e-=300),v.width(e),v.height(s.innerHeight-90),g&&(g.resize(),g.center())},angular.element(s).bind("resize",c.debounce(h.resize,300)),o.$watch("vm.search",function(){if(!angular.isUndefined(g)){var e=h.search.toUpperCase(),t=e.length;g.startBatch(),g.nodes().map(function(n){0==t?n.unselect():n.attr("name").substr(0,t)===e?n.select():n.unselect()}),g.endBatch()}}),e.setBusy(!0),e.query("render_pathways").then(function(n){m=n.data[0],g=l({container:v,elements:m.elements,style:p(),minZoom:.2,maxZoom:5,layout:{name:"preset",fit:!0}}).on("select","node",c.debounce(d,300)).on("click","node",function(e){"gene"==e.cyTarget.data().nodeType&&(angular.element("#gbm-webpage").modal(),o.$apply(function(){h.frame=i.trustAsResourceUrl("https://www.genecards.org/cgi-bin/carddisp.pl?gene="+e.cyTarget.data().id)}))}).on("click","edge",function(e){angular.element("#gbm-webpage").modal(),o.$apply(function(){h.frame=i.trustAsResourceUrl("https://www.ncbi.nlm.nih.gov/pubmed/?term="+e.cyTarget.data().pmid)})}).on("mouseover","edge",function(e){o.$apply(function(){h.tip=e.cyTarget.data().source+" Extract"}),e.cyTarget.style({width:"4px"})}).on("mouseout","edge",function(e){o.$apply(function(){h.tip=null}),e.cyTarget.style({width:"2px"})}).on("mouseover","node",function(e){o.$apply(function(){h.tip=e.cyTarget.data().name+" Gene Card"})}).on("mouseout","node",function(){o.$apply(function(){h.tip=null})}),t.onGeneSelectionChange.add(function(e){b=e.ids,u()}),u(),e.setBusy(!1)})}e.$inject=["osApi","osHistory","$state","$stateParams","$scope","$sce","$window","moment","cytoscape","_"];var t={restrict:"E",templateUrl:"app/components/pathways/pathways.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osPathways",e)}(),function(){"use strict";function e(){function e(){t.play()}var t=new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");
return{beep:e}}angular.module("oncoscape").service("osSound",e)}(),function(){"use strict";function e(e,t){var n=t.protocol()+"://"+t.host()+":"+("3000"==t.port()?80:t.port())+"/api/",a=function(e){var t=n+e.table;return angular.isDefined(e.query)&&(t+="/?q="+encodeURIComponent(JSON.stringify(e.query))),t},o=function(t){return e({method:"GET",url:a(t)})};return{queryString:a,query:o}}e.$inject=["$http","$location"],angular.module("oncoscape").factory("osHttp",e)}(),function(){"use strict";function e(e,t,n,a){var o=[{ids:[],tool:"Application",desc:"Load"}],i=0,s=[{ids:[],tool:"Application",desc:"Load"}],r=0,l=new t.Signal,c=new t.Signal,d=new t.Signal,u=new t.Signal,p=function(e){var t=o.indexOf(e);t>=0&&(i=t,u.dispatch(g()))},m=function(){return o},g=function(){return 0>i&&(i=0),i>=o.length&&(i=o.length-1),o[i]},h=function(t,n,s){if(s=s.sort(),s.length!=g().ids.length||0!=a.difference(s,g().ids).length){var r=e();o.push({tool:t,desc:n,ids:s,date:r.unix(),time:r.format("H:mm")}),i+=o.length-1,d.dispatch(g())}},v=function(){if(i-=1,0>i)return n.beep(),void(i=0);var e=g();return u.dispatch(e),e},f=function(){if(i+=1,i==o.length)return n.beep(),void(i=o.length-1);var e=g();return u.dispatch(e),e},b=function(e){var t=s.indexOf(e);t>=0&&(r=t,c.dispatch(w()))},y=function(){return s},w=function(){return 0>r&&(r=0),r>=s.length&&(r=s.length-1),s[r]},A=function(t,n,o){if(o=o.sort(),o.length!=w().ids.length||0!=a.difference(o,w().ids).length){var i=e();s.push({tool:t,desc:n,ids:o,date:i.unix(),time:i.format("H:mm")}),r=s.length-1,l.dispatch(w())}},k=function(){if(r-=1,0>r)return n.beep(),void(r=0);var e=w();return c.dispatch(e),e},x=function(){},_=function(){if(r+=1,r==s.length)return n.beep(),void(r=s.length-1);var e=w();return c.dispatch(e),e},S=function(){},T=function(){},C={onPatientAdd:l,onPatientSelectionChange:c,onGeneAdd:d,onGeneSelectionChange:u,addGeneSelection:h,setGeneSelection:p,getGeneSelection:g,getGeneSelections:m,getGeneSelectionLast:v,getGeneSelectionNext:f,addPatientSelection:A,setPatientSelection:b,getPatientSelection:w,getPatientSelections:y,getPatientSelectionNext:_,getPatientSelectionLast:k,getPatientSelectionSecondLast:x,removeListeners:S,clear:T};return C}e.$inject=["moment","signals","osSound","_"],angular.module("oncoscape").service("osHistory",e)}(),function(){"use strict"}(),function(){"use strict";function e(e,t,n,a){function o(){return Q}function i(e){return j}function s(e){"object"==typeof e?(j!=e&&Z.dispatch(j),j=e):"string"==typeof e&&j.disease!=e&&(j!=e&&Z.dispatch(j),j=Q.filter(function(e){e.disease==disease},{key:e})[0])}function r(){var e=new n.Signal,o=new n.Signal,i={name:"",password:"",domain:{name:"Guest"},authenticated:!1,token:null,datasets:[]},s=[{name:"Guest"},{name:"FHCRC"},{name:"UW"}],r=function(){i.name="",i.password="",i.domain={name:"Guest"},i.authenticated=!1,i.token=null,i.datasets=[],o.dispatch()},l=function(n){i=n;var o={method:"POST",url:a.protocol()+"://"+a.host()+":"+("3000"==a.port()?80:a.port())+"/login",data:{username:i.name,password:i.password,domain:i.domain.name}};return t(o).then(function(t){t.data.success?(i.authenticated=!0,i.token=t.data.token,i.datasets=t.data.datasets,e.dispatch(i)):(i.authenticated=!1,i.token=null)})};return{getDomains:function(){return s},getUser:function(){return i},login:l,logout:r,onLogin:e,onLogout:o}}function l(){return K}function c(e){return e?angular.element(".loader-modal").show():angular.element(".loader-modal").hide(),d}function d(){}function u(){angular.element("#filter-dropdown").slideToggle()}function p(){angular.element("#filter-dropdown").slideToggle()}function m(){angular.element("#filter-dropdown").slideToggle()}function g(){}function h(t,n){return e.queryString({table:t,query:n})}function v(t,n){return e.query({table:t,query:n})}function f(e){return Y.setDataSource(e),Y.request({cmd:"specifyCurrentDataset",payload:e})}function b(e){return Y.request({cmd:"getDataManifest",payload:e})}function y(e){return Y.request({cmd:"getPatientHistoryTable",payload:{datasetName:e,durationFormat:"byYear"}})}function w(){}function A(){}function k(){return Y.request({cmd:"getGeneSetNames"})}function x(){return Y.request({cmd:"getSampleCategorizationNames"})}function _(e){return Y.request({cmd:"getSampleCategorization",payload:e})}function S(e){return Y.request({cmd:"getMarkersNetwork",payload:e})}function T(){}function C(e){return Y.request({cmd:"getCanonicalizePatientIDsInDataset",payload:e})}function E(){}function D(){}function M(e,t){var n={dataPackage:e,matrixName:t};return Y.request({cmd:"createPCA",payload:n})}function P(e){var t={genes:e};return Y.request({cmd:"calculatePCA",payload:t})}function $(e){var t={genes:e};return Y.request({cmd:"calculatePCA2",payload:t})}function L(e,t){var n={dataPackage:e,matrixName:t};return Y.request({cmd:"createPLSR",payload:n})}function I(e,t){var n={genes:e,factorCount:t.length,factors:t};return Y.request({cmd:"calculatePLSR",payload:n})}function R(e){return e=e||["AgeDx","Survival"],Y.request({cmd:"summarizePLSRPatientAttributes",payload:e})}function F(e,t){return Y.request({cmd:"calculateSurvivalCurves",payload:{sampleIDs:e,title:t}})}function B(){return Y.request({cmd:"createTimelines"})}function G(){}function O(){return Y.request({cmd:"getModuleModificationDate",payload:"gbmPathways"})}function z(){return Y.request({cmd:"getPathway",payload:"g.gbmPathways.json"})}function q(e,t){return Y.request({cmd:"get_mRNA_data",payload:{entities:e,features:t}})}function N(e,t){return Y.request({cmd:"get_cnv_data",payload:{entities:e,features:t}})}function U(e,t){return Y.request({cmd:"get_mutation_data",payload:{entities:e,features:t}})}function H(e){return Y.request({cmd:"oncoprint_data_selection",payload:{patientIdsAndGenes:e}})}function V(e,t){var n={dataPackage:e,matrixName:t};return Y.request({cmd:"createGeneSetTest",payload:n})}function W(e,t,n){return Y.request({cmd:"geneSetScoreTest",payload:{group1:e,group2:t,geneset:n}})}var Q,j,Z=new n.Signal;v("lookup_oncoscape_datasources",{beta:!1}).then(function(e){Q=e.data});var K=r(),Y={};return{query:v,queryString:h,setDataSource:s,getDataSource:i,getDataSources:o,onDataSource:Z,getTools:g,getUserApi:l,showFilter:u,hideFilter:p,toggleFilter:m,setBusy:c,setBusyMessage:d,setDataset:f,getDataManifest:b,getPatientHistoryTable:y,getPatientHistoryDxAndSurvivalMinMax:w,getSampleDataFrame:A,getGeneSetNames:k,getSampleCategorizationNames:x,getSampleCategorization:_,getMarkersNetwork:S,getPathway:z,getDrugGeneInteractions:T,getCanonicalizePatientIDsInDataset:C,getGeneSetGenes:E,getOncoprintDataSelection:D,getPCA:M,getCalculatedPCA:P,getCalculatedPCA2:$,getPLSR:L,getCalculatedPLSR:I,getSummarizedPLSRPatientAttributes:R,getCalculatedSurvivalCurves:F,getTimelines:B,getCalculatedTimelines:G,getMrnaData:q,getCnvData:N,getMutationData:U,getModuleModificationDate:O,getOncoprint:H,getGeneSetTest:V,getGeneSetScore:W}}e.$inject=["osHttp","$http","signals","$location"],angular.module("oncoscape").service("osApi",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,s,r,l){function c(e){if($("#onc").empty(),$("#oncoprintErrorSection").empty(),$(".oncoprint-label-col1").empty(),"error"==e.status)h.errorMessage=JSON.parse(e.payload),console.log("***** errors in dispalyOncoprint",h.errorMessage),y("errors");else{var t=e.payload[1],n=e.payload[0],a=v.create("#onc");a.suppressRendering(),$.when(n).then(function(){function e(e){return e.gene===s}"string"==typeof t&&(t=[t]);for(var o=(t.length,[]),i=0;i<t.length;i++){var s=t[i],r=n.filter(e);Date.now();o[i]=a.addTrack({label:s,removable:!0},0),0===i?a.setRuleSet(o[i],v.GENETIC_ALTERATION):a.useSameRuleSet(o[i],o[0]),a.setTrackData(o[i],r,!0)}a.releaseRendering(),a.sort(),$("#toggle_whitespace").click(function(){a.toggleCellPadding()});var l=1;$("#reduce_cell_width").click(function(){l*=.5,a.setZoom(l)});for(var c=$(".oncoprint-legend-block"),d=$(".oncoprint-legend-label"),u=0;u<c.length;u++)c[u].appendChild(d[u]);$(".oncoprint-label-col1").append(c),$("#oncoprintInstructions").hide()})}}if(angular.isUndefined(a.datasource))return void n.go("datasource");var d=angular.element("#oncoprintControlsDiv"),u=angular.element("#oncoprintInstructions"),p=(angular.element("#oncoprintErrorSection"),angular.element("#legend")),m=(s.select("#onc"),null==t.getPatientSelection()?null:t.getPatientSelection().ids),g=null==t.getGeneSelection()?null:t.getGeneSelection().ids,h=this;h.datasource=a.datasource,h.geneAndPatients=m+","+g,h.errorMessage;var v=function(){function e(e){var a=this,o=n.makeIdCounter();a.config=e,a.id_order=[],a.inverted_id_order={},a.visible_id_order=[],a.visible_inverted_id_order={},a.hidden_ids={},a.track_groups=[[],[]],a.track_group_sort_order=[0,1],a.sort_direction={},a.tracks={},a.sort_config={type:"track"},a.cell_padding_on=!0,a.true_cell_width=e.cell_width,a.zoomed_cell_width=a.true_cell_width,a.zoom=1,a.toggleCellPadding=function(){a.cell_padding_on=!a.cell_padding_on,$(a).trigger(t.SET_CELL_PADDING)},a.getCellPadding=function(){return Math.ceil(a.config.cell_padding*a.getZoom())*+a.cell_padding_on},a.getZoom=function(){return a.zoom},a.setZoom=function(e){return a.zoom=n.clamp(e,0,1),r(),i(),$(a).trigger(t.SET_ZOOM),a.zoom};var i=function(){a.zoom=(a.zoomed_cell_width-1)/(a.true_cell_width-1)},r=function(){a.zoomed_cell_width=Math.round(a.zoom*(a.true_cell_width-1)+1)};a.increaseZoom=function(){return a.zoomed_cell_width=n.clamp(a.zoomed_cell_width+1,1,a.true_cell_width),i(),$(a).trigger(t.SET_ZOOM),a.zoom},a.decreaseZoom=function(){return a.zoomed_cell_width=n.clamp(a.zoomed_cell_width-1,1,a.true_cell_width),i(),$(a).trigger(t.SET_ZOOM),a.zoom},a.getFullCellWidth=function(){return a.true_cell_width},a.getZoomedCellWidth=function(){return a.zoomed_cell_width},a.getCellHeight=function(e){return a.tracks[e].config.cell_height},a.getTrackHeight=function(e){return a.tracks[e].config.track_height},a.getTrackPadding=function(e){return a.tracks[e].config.track_padding},a.getFilteredIdOrder=function(e,t){var n=t||a.getTracks();return l.filter(a.id_order,function(t){var o=l.map(n,function(e){return a.getTrackDatum(e,t)});return e(o)})},a.getIdOrder=function(){return a.id_order},a.getInvertedIdOrder=function(){return a.inverted_id_order},a.getVisibleIdOrder=function(){return a.visible_id_order},a.getVisibleInvertedIdOrder=function(){return a.visible_inverted_id_order};var c=function(){a.visible_id_order=l.filter(a.id_order,function(e){return!a.hidden_ids[e]}),a.visible_inverted_id_order=n.invert_array(a.visible_id_order),$(a).trigger(t.SET_VISIBLE_ID_ORDER)};a.setIdOrder=function(e){a.id_order=e.slice(),a.inverted_id_order=n.invert_array(a.id_order),c(),$(a).trigger(t.SET_ID_ORDER)},a.hideIds=function(e,t){t&&(a.hidden_ids={}),l.each(e,function(e){a.hidden_ids[e]=!0}),c()},a.showIds=function(e){e?l.each(e,function(e){delete a.hidden_ids[e]}):a.hidden_ids={},c()},a.getTopmostTrack=function(){return a.track_groups[0].length>0?a.track_groups[0][0]:a.track_groups[1][0]},a.setTrackSortComparator=function(e,t){a.tracks[e].config.sort_cmp=t},a.getTrackSortComparator=function(e){return a.tracks[e].config.sort_cmp},a.getTrackSortDirection=function(e){return a.sort_direction[e]},a.setTrackSortDirection=function(e,t){a.sort_direction[e]=t,a.sort()},a.setTrackGroupSortOrder=function(e){a.track_group_sort_order=e.slice()},a.getTrackGroupSortOrder=function(){return a.track_group_sort_order.slice()},a.getTrackSortOrder=function(){var e=[],t=a.getTrackGroups();return l.each(a.getTrackGroupSortOrder(),function(n){e=e.concat(t[n])}),e},a.setSortConfig=function(e){a.sort_config=e};var d=function(e){var t=l.sortBy(a.getIdOrder(),l.identity);e&&t.reverse(),a.setIdOrder(t)},u=function(){var e=a.getTrackSortOrder(),t=l.map(e,function(e){return a.getTrackSortComparator(e)}),o={},i=a.getIdOrder();l.each(i,function(t){o[t]={},l.each(e,function(e){o[t][e]=a.getTrackDatum(e,t)})});var s=function(n,i){for(var s=0,r=0,l=e.length;l>r;r++){var c=e[r],d=t[r],u=o[n][c],p=o[i][c],m="undefined"==typeof u,g="undefined"==typeof p;if(s=m||g?m&&g?0:m?1:-1:d(u,p),isFinite(s)&&(s*=a.sort_direction[c]),0!==s)break}return s};a.setIdOrder(n.stableSort(a.getIdOrder(),s))};a.sort=function(){var e=a.sort_config;"track"===e.type?u():"id"===e.type&&d(e.desc)},a.addTrack=function(e,i){i=n.ifndef(i,1);var r=o();return a.tracks[r]={id:r,data:[],config:$.extend({},s,e),id_data_map:{}},a.track_groups[i].push(r),a.sort_direction[r]=1,$(a).trigger(t.ADD_TRACK,{track_id:r}),r},a.removeTrack=function(e){var n=a.tracks[e];delete a.tracks[e],delete a.sort_direction[e];var o=a.getContainingTrackGroup(e,!0);if(o){var i=o.indexOf(e);return o.splice(i,1),$(a).trigger(t.REMOVE_TRACK,{track:n,track_id:e}),!0}return!1},a.getTrackGroups=function(e){return e===!0?a.track_groups:$.extend(!0,[],a.track_groups)},a.getTracks=function(){return l.flatten(a.getTrackGroups())},a.getContainingTrackGroup=function(e,t){var n=!1;return l.find(a.track_groups,function(t){return t.indexOf(e)>-1?(n=t,!0):!1}),t===!0?n:n.slice()},a.moveTrack=function(e,o){var i=a.getContainingTrackGroup(e,!0);if(!i)return!1;var s=i.indexOf(e);o=n.clamp(o,0,i.length-1),i.splice(s,1),i.splice(o,0,e);var r=i.slice(Math.min(s,o),Math.max(s,o)+1);$(a).trigger(t.MOVE_TRACK,{moved_tracks:r})},a.getTrackLabel=function(e){return a.tracks[e].config.label},a.getTrackTooltip=function(e){return a.tracks[e].config.tooltip},a.setTrackTooltip=function(e,t){a.tracks[e].config.tooltip=t},a.getTrackData=function(e){return a.tracks[e].data},a.setTrackData=function(e,n){var o=a.getTrackDatumIdAccessor(e);a.tracks[e].data=n;var i=a.getIdOrder(),s=a.getInvertedIdOrder();l.each(l.map(n,o),function(e){e in s||i.push(e)}),a.setIdOrder(i),a.tracks[e].id_data_map={};var r=a.tracks[e].id_data_map;l.each(a.tracks[e].data,function(e){r[o(e)]=e}),$(a).trigger(t.SET_TRACK_DATA,{track_id:e})},a.getTrackDatum=function(e,t){return a.tracks[e].id_data_map[t]},a.getTrackDatumDataKey=function(e){return a.tracks[e].config.datum_data_key},a.getTrackDatumIdAccessor=function(e){var t=a.getTrackDatumIdKey(e);return function(e){return e[t]}},a.getTrackDatumIdKey=function(e){return a.tracks[e].config.datum_id_key},a.setTrackDatumIdKey=function(e,t){a.tracks[e].config.datum_id_key=t},a.isTrackRemovable=function(e){return a.tracks[e].config.removable},a.isTrackSortDirectionChangable=function(e){return a.tracks[e].config.sort_direction_changable},a.clearData=function(){l.each(a.getTracks(),function(e){a.setTrackData(e,[])}),a.setIdOrder([])}}var t=oncoprint_events,n=oncoprint_utils,a=oncoprint_RuleSet,o={cell_width:6,cell_padding:2.5,legend:!0},i={pre_track_padding:0},s={label:"Gene",datum_id_key:"patient",cell_height:23,track_height:20,track_padding:5,sort_cmp:void 0,tooltip:function(e){return e.patient},removable:!1,sort_direction_changable:!1};return{CATEGORICAL_COLOR:a.CATEGORICAL_COLOR,GRADIENT_COLOR:a.GRADIENT_COLOR,GENETIC_ALTERATION:a.GENETIC_ALTERATION,BAR_CHART:a.BAR_CHART,create:function(n,a){a=$.extend({},o,a||{}),a=$.extend(a,i);var s=new e(a),r=new f(n,s,{label_font:"Arial",legend:a.legend}),l={onc_dev:s,ren_dev:r,addTrack:function(e,t){var n=s.addTrack(e,t);return n},removeTrack:function(e){s.removeTrack(e)},moveTrack:function(e,t){s.moveTrack(e,t)},setTrackDatumIdKey:function(e,t){s.setTrackDatumIdKey(e,t)},setTrackData:function(e,t){s.setTrackData(e,t)},setRuleSet:function(e,t,n){r.setRuleSet(e,t,n)},useSameRuleSet:function(e,t){r.useSameRuleSet(e,t)},toggleCellPadding:function(){s.toggleCellPadding()},toSVG:function(){return r.toSVG()},setTrackGroupSortOrder:function(e){s.setTrackGroupSortOrder(e)},sort:function(){s.sort()},setSortConfig:function(e){s.setSortConfig(e)},setIdOrder:function(e){s.setIdOrder(e)},getTrackSortDirection:function(e){return s.getTrackSortDirection(e)},setTrackSortDirection:function(e,t){s.setTrackSortDirection(e,t)},setZoom:function(e){return s.setZoom(e)},increaseZoom:function(){return s.increaseZoom()},decreaseZoom:function(){return s.decreaseZoom()},suppressRendering:function(){r.suppressRendering()},releaseRendering:function(){r.releaseRendering()},setLegendVisible:function(e,t){r.setLegendVisible(e,t)},getFilteredIdOrder:function(e,t){return s.getFilteredIdOrder(e,t)},getVisibleIdOrder:function(){return s.getVisibleIdOrder()},hideIds:function(e){s.hideIds(e)},showIds:function(e){s.showIds(e)},clearData:function(){s.clearData()},setTrackTooltip:function(e,t){s.setTrackTooltip(e,t)}};return $(s).on(t.MOVE_TRACK,function(){$(l).trigger(t.MOVE_TRACK)}),$(r).on(t.FINISHED_RENDERING,function(){$(l).trigger(t.FINISHED_RENDERING)}),$(s).on(t.REMOVE_TRACK,function(e,n){$(l).trigger(t.REMOVE_TRACK,{track_id:n.track_id})}),$(r).on(t.CONTENT_AREA_MOUSEENTER,function(e,n){$(l).trigger(t.CONTENT_AREA_MOUSEENTER)}),$(r).on(t.CONTENT_AREA_MOUSELEAVE,function(e,n){$(l).trigger(t.CONTENT_AREA_MOUSELEAVE)}),l}}}(),f=function(){function e(e,c,u){OncoprintRenderer.call(this,c,u);var p=this;this.track_cell_selections={},this.track_cells={},this.active_rule_set_rules={},this.toolbar_container,this.label_div,this.label_drag_div,this.label_container,this.cell_container,this.cell_container_node,this.cell_div,this.legend_table,this.document_fragment,this.percent_altered_max_width=n.textWidth("100%",p.getLabelFont()),this.altered_data_percentage={},this.cell_tooltip_html="",this.container=s.select(e),this.container.classed("noselect",!0).selectAll("*").remove(),this.container.append("br"),function(){u.legend&&(p.legend_table=s.select(e).append("table").style("border-collapse","collapse"))}();var m=s.select(e).append("div").classed("oncoprint-content-area",!0);!function(){p.label_container=m.append("div").classed(a,!0).style("position","relative"),p.label_div=p.label_container.append("div").style("position","relative").style("overflow","hidden"),p.label_drag_div=p.label_container.append("div").style("position","absolute").style("overflow","hidden").style("top","0px").style("left","0px").style("display","none")}(),function(){p.cell_container=m.append("div").classed(o,!0),p.cell_column_highlight=p.cell_container.append("div").classed(r,!0).style("height",p.getCellAreaHeight()).style("visibility","hidden"),p.cell_container_node=p.cell_container.node(),p.cell_div=p.cell_container.append("div").classed(i,!0),p.cell_mouseover_div=p.cell_container.append("div").style("position","absolute").style("overflow","hidden").style("top","0px").style("left","0px"),p.cell_container_node.addEventListener("scroll",function(){p.calculateVisibleInterval(),p.clipAndPositionCells()});var e,t;!function(){var a,o,i,s,r=[];$(p.cell_div.node()).qtip({content:"SHARED QTIP",position:{target:"event",my:"bottom middle",at:"top middle",viewport:$(window)},style:{classes:d,border:"none"},show:{event:"cell-mouseover"},hide:{fixed:!0,delay:100,event:"cell-mouseout"},events:{show:function(){$(this).find(".qtip-content").html(p.cell_tooltip_html)},render:function(){$(this).find(".qtip-content").html(p.cell_tooltip_html)}}});var u=function(e){$("."+d).finish(),$(e).trigger("cell-mouseover")},m=function(e){$("."+d).finish(),$(e).trigger("cell-mouseout")},g=function(){a=void 0,o=void 0,i&&m(i),i=void 0,s&&clearTimeout(s),l.each(r,function(e){e&&(e.style.border="",e.style.margin="")}),r=[]};t=function(){g()},e=function(e){var t=n.mouseX(e),m=n.mouseY(e),h=p.getTrackCellTops(),v=function(){var e=Number.POSITIVE_INFINITY,t=void 0;return l.each(h,function(n,a){var o=m-n;o>=0&&e>o&&(e=o,t=a)}),t}();if(!v)return void g();var f=c.getCellHeight(v);if(m>h[v]+f)return void g();var b=c.getZoomedCellWidth(),y=b+c.getCellPadding();if(t%y>b)return void g();var w=Math.floor(t/y);if(w!==o||v!==a){s&&clearTimeout(s),g();var A=c.getVisibleIdOrder()[w],k=p.track_cells[v][A];if(!k)return;$("."+d).finish().hide(),o=w,a=v,i=k.dom,p.cell_tooltip_html=c.getTrackTooltip(v)(k.d),u(i),s=setTimeout(function(){r=l.map(p.track_cells,function(e,t){var n=e[A].dom;return n&&(t===v?(n.style.border="1px solid #000000",n.style.margin="-1px"):(n.style.border="1px solid #999999",n.style.margin="-1px")),n})},200)}}}(),p.cell_mouseover_div.node().addEventListener("mousemove",e),p.cell_mouseover_div.node().addEventListener("mouseout",t),p.cell_div.style("max-width","1000px")}(),$(m.node()).hover(function(){$(p.label_div.node()).find("."+p.getTrackButtonCSSClass()).stop().fadeTo(80,1)},function(){$(p.label_div.node()).find("."+p.getTrackButtonCSSClass()).stop().fadeOut(500)}),function(){$(c).on(t.REMOVE_TRACK,function(e,t){var n=t.track_id;delete p.rule_sets[n],delete p.track_cell_selections[n],delete p.altered_data_percentage[n],p.removeTrackCells(n),p.removeTrackLabels(n),p.removeTrackButtons(n),p.computeTrackCellTops(),p.renderTrackLabels(),p.renderTrackButtons(),p.resizeLabelDiv(),p.resizeCellDiv(),c.sort()}),$(c).on(t.MOVE_TRACK,function(e,t){p.computeTrackCellTops(),p.clipAndPositionCells(t.moved_tracks,"top",!0),p.renderTrackLabels(),p.renderTrackButtons(),c.sort()}),$(c).on(t.ADD_TRACK,function(e,t){p.drawCells(t.track_id),p.clipAndPositionCells(void 0,"top",!0),p.computeTrackCellTops(),p.renderTrackLabels(),p.renderTrackButtons(),p.resizeLabelDiv()}),$(c).on(t.SET_TRACK_DATA,function(e,t){p.drawCells(t.track_id),p.clipAndPositionCells(t.track_id,void 0,!0),p.computeAlteredDataPercentage(t.track_id),p.renderTrackLabels(t.track_id),p.resizeCellDiv(),p.renderLegend()}),$(c).on(t.SET_CELL_PADDING,function(e,t){p.clipAndPositionCells(void 0,void 0,!0),p.resizeCellDiv()}),$(c).on(t.SET_ZOOM,function(e,t){p.clipAndPositionCells(void 0,void 0,!0),p.resizeCells(),p.resizeCellDiv()}),$(c).on(t.SET_VISIBLE_ID_ORDER,function(){p.clipAndPositionCells(void 0,void 0,!0),p.resizeCellDiv()})}()}var t=oncoprint_events,n=oncoprint_utils,a="oncoprint-label-area-ctr",o="oncoprint-cell-area-ctr",i="oncoprint-cell-area",r="oncoprint-column-highlight",c="oncoprint-label-dragging",d="oncoprint-cell-qtip";return n["extends"](e,OncoprintRenderer),e.prototype.computeAlteredDataPercentage=function(e){var t=this.getRuleSet(e);if(t&&t.alteredData){var n=this.oncoprint.getTrackData(e),a=t.alteredData(n).length,o=Math.floor(100*a/n.length);this.altered_data_percentage[e]=o}},e.prototype.getAlteredDataPercentage=function(e){return this.altered_data_percentage[e]},e.prototype.calculateVisibleInterval=function(){var e=(this.oncoprint.getZoomedCellWidth()+this.oncoprint.getCellPadding(),this.cell_container_node.getBoundingClientRect());return this.visible_interval=[this.cell_container_node.scrollLeft,this.cell_container_node.scrollLeft+e.right-e.left],this.visible_interval},e.prototype.getVisibleInterval=function(){return this.visible_interval||this.calculateVisibleInterval()},e.prototype.cellRenderTarget=function(){return s.select(this.document_fragment||this.cell_div.node())},e.prototype.suppressRendering=function(){this.document_fragment=document.createDocumentFragment()},e.prototype.releaseRendering=function(){this.cell_div.node().appendChild(this.document_fragment),this.document_fragment=void 0;var e=this;$(this.cell_div.node()).ready(function(){e.resizeCells(),e.clipAndPositionCells(void 0,void 0,!0)})},e.prototype.setRuleSet=function(e,t,n){OncoprintRenderer.prototype.setRuleSet.call(this,e,t,n),this.active_rule_set_rules[this.getRuleSet(e).getRuleSetId()]={},this.drawCells(e),this.clipAndPositionCells(e,void 0,!0),this.renderLegend(),this.computeAlteredDataPercentage(e),this.renderTrackLabels(e)},e.prototype.useSameRuleSet=function(e,t){OncoprintRenderer.prototype.useSameRuleSet.call(this,e,t),this.drawCells(e),this.clipAndPositionCells(e,void 0,!0),this.renderLegend(),this.computeAlteredDataPercentage(e),this.renderTrackLabels(e)},e.prototype.getLabelDiv=function(){return this.label_div},e.prototype.getLabelDragDiv=function(){return this.label_drag_div},e.prototype.resizeCellDiv=function(){this.cell_div.style("min-width",this.getCellAreaWidth()+"px").style("min-height",this.getCellAreaHeight()+"px"),this.cell_mouseover_div.style("min-width",this.getCellAreaWidth()+"px").style("min-height",this.getCellAreaHeight()+"px"),this.cell_column_highlight.style("height",this.getCellAreaHeight()+"px")},e.prototype.resizeLabelDiv=function(){this.getLabelDiv().style("width",this.getLabelAreaWidth()+"px").style("height",this.getLabelAreaHeight()+"px"),this.getLabelDragDiv().style("width",this.getLabelAreaWidth()+"px").style("height",this.getLabelAreaHeight()+"px")},e.prototype.removeTrackLabels=function(e){e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var t=this.label_div,n=this;l.each(e,function(e){t.selectAll(n.getTrackLabelCSSSelector(e)).remove()})},e.prototype.renderTrackLabels=function(e,t,n){var a=this.label_div;if("undefined"!=typeof t)a.selectAll(this.getTrackLabelCSSSelector(e)).style("top",t+"px");else{e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var o=this.getTrackLabelTops(),i=this,s=this.getLabelAreaWidth(),r=s-this.percent_altered_max_width;l.each(e,function(e){var t=o[e],s=(i.getTrackLabelCSSClass(e),i.oncoprint.getTrackLabel(e)),c=s;s.length>i.max_label_length&&!n&&(c=s.substring(0,i.max_label_length-3)+"..."),l.each(a.selectAll(i.getTrackLabelCSSSelector(e)),function(e){$(e).qtip("destroy")}),a.selectAll(i.getTrackLabelCSSSelector(e)).remove();var d=a.append("span").style("position","absolute").classed(i.getTrackLabelCSSClass(e),!0).classed("oncoprint-track-label-draggable",!0).classed("oncoprint-track-label-main",!0).classed("oncoprint-track-label",!0).classed("noselect",!0).style("font-family",i.getLabelFont()).style("font-weight","bold").text(c).style("top",t+"px").on("mousedown",function(){i.dragLabel(e)});$(d.node()).qtip({content:{text:s.length>i.max_label_length?s+"<br> hold to drag":"hold to drag"},position:{my:"middle right",at:"middle left",viewport:$(window)},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow"},show:{event:"mouseover"}});var u=i.getAlteredDataPercentage(e);"undefined"!=typeof u&&a.append("span").style("position","absolute").classed(i.getTrackLabelCSSClass(e),!0).classed("oncoprint-track-label",!0).classed("noselect",!0).style("font-family",i.getLabelFont()).text(u+"%").style("top",t+"px").style("left",r+"px")})}},e.prototype.getTrackButtonCSSClass=function(e){return"oncoprint-track-button"+n.ifndef(e,"")},e.prototype.removeTrackButtons=function(e){var t=this.label_div;e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var n=this;l.each(e,function(e){t.selectAll("."+n.getTrackButtonCSSClass(e)).remove()})},e.prototype.renderTrackButtons=function(e){var t=this.label_div;e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var n=this.getTrackLabelTops(),a=this,o=this.getLabelAreaWidth();l.each(e,function(e){var i=a.getTrackButtonCSSClass(e);t.selectAll("."+i).remove();var s=o-15;a.oncoprint.isTrackRemovable(e)&&(!function(){var o=t.append("span").classed("noselect",!0).style("font-size","12px").style("color","#87CEFA").style("cursor","pointer").classed(i,!0).classed(a.getTrackButtonCSSClass(),!0).on("click",function(){a.oncoprint.removeTrack(e)}).style("position","absolute").style("left",s+"px").style("top",n[e]+"px");o.text("X"),$(o.node()).hover(function(){o.style("font-size","15px").style("color","#0000FF")},function(){o.style("font-size","12px").style("color","#87CEFA")}).qtip({position:{my:"bottom middle",at:"top middle",viewport:$(window)},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow"},show:{event:"mouseover"},hide:{fixed:!0,delay:100,event:"mouseout"}})}(),s-=35),a.oncoprint.isTrackSortDirectionChangable(e)&&!function(){var o=["images/decreaseSort.svg","images/increaseSort.svg","images/nonSort.svg"],r=["Click to sort in descending order","Click to not sort on this track","Click to sort in ascending order"],l=[1,-1,0],c=l.indexOf(a.oncoprint.getTrackSortDirection(e)),d=t.append("img");d.attr("src",o[c]).style("cursor","pointer"),$(d.node()).qtip({content:{text:function(){return r[c]}},position:{my:"bottom middle",at:"top middle",viewport:$(window)},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow"},show:{event:"mouseover"},hide:{fixed:!0,delay:100,event:"mouseout"}}),d.classed(i,!0).classed(a.getTrackButtonCSSClass(),!0).on("click",function(){c=(c+1)%3,a.oncoprint.setTrackSortDirection(e,l[c]),d.attr("src",o[c])}).style("position","absolute").style("left",s+"px").style("top",n[e]+"px")}()})},e.prototype.resizeCells=function(e){this.cell_div.selectAll("svg."+this.getCellCSSClass()).style("width",this.oncoprint.getZoomedCellWidth()+"px")},e.prototype.removeTrackCells=function(e){this.cell_div.selectAll("svg."+this.getTrackCellCSSClass(e)).remove()},e.prototype.drawTrackCells=function(e,t){var n=this.oncoprint,a=n.getTrackData(e),o=(n.getTrackDatumIdKey(e),n.getTrackDatumIdAccessor(e)),i=this.getRuleSet(e);if(i){var r=this;this.track_cells[e]={};var l=this.getCellCSSClass(),c=this.getTrackCellCSSClass(e),d=this.track_cells[e],u=s.select(t).selectAll("svg."+c).data(a);u.enter().append("svg").classed(c,!0).classed(l,!0).attr("shape-rendering","geometricPrecision").attr("preserveAspectRatio","none").attr("viewBox","0 0 "+n.getFullCellWidth()+" "+n.getCellHeight(e)).style("width",n.getZoomedCellWidth()+"px").style("height",n.getCellHeight(e)+"px"),u.exit().remove();n.getTrackTooltip(e);u.each(function(e,t){var n=o(e);d[n]={dom:this,d:e}}),u.selectAll("*").remove(),this.active_rule_set_rules[i.getRuleSetId()][e]=i.apply(u,n.getFullCellWidth(),n.getCellHeight(e)),r.track_cell_selections[e]=u}},e.prototype.drawCells=function(e){var n;n=this.document_fragment?document.createDocumentFragment():this.cell_div.node(),e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var a=this;l.each(e,function(e){a.drawTrackCells(e,n)}),this.document_fragment&&this.cellRenderTarget().node().appendChild(n),setTimeout(function(){$(a).trigger(t.FINISHED_RENDERING)},0)},e.prototype.clipAndPositionCells=function(e,t,n,a){this.cell_div.node().display="none",e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var o=this.getVisibleInterval(),i=4*(o[1]-o[0]),s=Math.floor(o[0]/i);o=l.map([-i,2*i],function(e){return Math.max(e+s*i,0)});var r=this,c=this.getTrackCellTops(),d=this.oncoprint.getVisibleInvertedIdOrder(),u=this.getCellXArray(Object.keys(d).length);l.each(e,function(e){var i;t&&"top"!==t||(i=c[e]);var l=r.oncoprint.getTrackDatumIdKey(e);(s!==r.prev_interval_number||n)&&r.track_cell_selections.hasOwnProperty(e)&&r.track_cell_selections[e].each(function(e,n){var s=u[d[e[l]]],r=this.style.display,c=(isNaN(s)||s<o[0]||s>o[1])&&!a?"none":"inherit";r!==c&&(this.style.display=c),t&&"left"!==t||"none"===c||(this.style.left=s+"px"),t&&"top"!==t||"none"===c||(this.style.top=i+"px")})}),this.prev_interval_number=s,this.cell_div.node().display="block"},e.prototype.setLegendVisible=function(e,t){var n=this;e="undefined"==typeof e?this.oncoprint.getTracks():[].concat(e),l.each(e,function(e){n.getRuleSet(e).exclude_from_legend=!t}),this.renderLegend()},e.prototype.renderLegend=function(e){var t=this.oncoprint.getFullCellWidth(),a=this,o={};a.legend_table.selectAll("*").remove(),l.each(this.rule_sets,function(i,r){if(!i.exclude_from_legend||e){var c=i.getRuleSetId(),d={};if(l.each(a.active_rule_set_rules[c],function(e,t){$.extend(d,e)}),!o.hasOwnProperty(c)){var u=a.legend_table.append("tr"),p=u.append("td").style("padding-top","1em").style("padding-bottom","1em").append("span").classed("oncoprint-legend-header",!0);p.text(i.getLegendLabel());var m=u.append("td"),g=i.getLegendDiv(d,t,a.oncoprint.getCellHeight(r));m.node().appendChild(g),n.d3SelectChildren(s.select(g),"*").classed("oncoprint-legend-block-span",!0),o[c]=!0}}})},e.prototype.dragLabel=function(e){this.getLabelDragDiv().style("display","block");var t=this.oncoprint.getContainingTrackGroup(e),a=t[0],o=t[t.length-1],i=this.getTrackLabelTops(),r={};l.each(t,function(e){r[e]=i[e]}),t.splice(t.indexOf(e),1);var d=l.map(t,function(e){return r[e]}),u=this.getLabelAreaHeight(),p=[void 0,void 0];p[0]=n.clamp(r[a],0,u),p[1]=n.clamp(r[o]+this.getRenderedTrackHeight(o),0,u);var m=this,g=$(m.getLabelDragDiv().node());
delete r[e],function(e){var a=-1,o=function(o){o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault();var i=n.clamp(n.mouseY(o),p[0],p[1]);m.renderTrackLabels(e,i),s.selectAll(m.getTrackLabelCSSSelector(e)).classed(c,!0),a=l.sortedIndex(d,i),l.each(r,function(e,n){e+=3*+(a<t.length&&t[a]==n),e-=3*+(a>0&&t[a-1]==n),m.renderTrackLabels(n,e)})};g.on("mousemove",o);var i=function(t){g.hide(),g.off("mousemove",o),a>-1&&m.oncoprint.moveTrack(e,a)};$(document).one("mouseup",i)}(e)},e.prototype.toSVG=function(e){var t=this,a=$(this.container.node()).offset(),o=s.select(document.createElementNS("http://www.w3.org/2000/svg","svg"));return o.attr("width",this.getLabelAreaWidth()+this.getCellAreaWidth()+"px"),this.renderLegend(!0),this.renderTrackLabels(void 0,void 0,e),o.attr("height",$(this.container.node()).height()+"px"),function(){t.label_div.selectAll(".oncoprint-track-label").each(function(){var e=s.select(this),t=e.style("font-family")||"Arial",i=e.style("font-weight"),r=e.style("font-size")||"12px",l=$(e.node()).offset(),c=e.text();o.append("text").style("font-family",t).style("font-weight",i).style("font-size",r).attr("transform",n.translate(l.left-a.left,l.top-a.top)).style("alignment-baseline","hanging").text(c)})}(),function(){t.clipAndPositionCells(void 0,void 0,!0,!0),t.cell_div.selectAll(".oncoprint-cell").each(function(){var e=s.select(this),t=e.node().getBoundingClientRect(),i={width:t.width,height:t.height},r=$(e.node()).offset(),l=o.append("g").attr("transform",n.translate(r.left-a.left,r.top-a.top));e.selectAll("*").each(function(){n.appendD3SVGElement(s.select(this),l)});var c={color:e.style("outline-color"),width:e.style("outline-width")};c.color&&l.append("rect").attr("width",i.width+"px").attr("height",i.height+"px").style("fill","none").style("stroke",c.color).style("stroke-width",c.width)}),t.clipAndPositionCells(void 0,void 0,!0)}(),function(){t.legend_table.selectAll("tr").each(function(){s.select(this).selectAll("td").each(function(){s.select(this).selectAll(".oncoprint-legend-header,.oncoprint-legend-element").each(function(){if($(this).text().trim().length){var e=s.select(this),t=e.style("font-family")||"Arial",i=e.style("font-weight"),r=e.style("font-size")||"12px",l=e.text(),c=$(e.node()).offset();o.append("text").style("font-family",t).style("font-weight",i).style("font-size",r).attr("transform",n.translate(c.left-a.left,c.top-a.top)).style("alignment-baseline","hanging").text(l)}else if("svg"===this.tagName.toLowerCase()){var d=s.select(this),c=$(d.node()).offset(),u=o.append("g").attr("transform",n.translate(c.left-a.left,c.top-a.top)),p=d.node().getBoundingClientRect(),m={width:p.width,height:p.height},g={color:d.style("outline-color"),width:d.style("outline-width")};g.color&&u.append("rect").attr("width",m.width+"px").attr("height",m.height+"px").style("fill","none").style("stroke",g.color).style("stroke-width",g.width),d.selectAll("*").each(function(){n.appendD3SVGElement(s.select(this),u)})}})})})}(),this.renderLegend(),this.renderTrackLabels(),o.node()},e}();e.setBusy(!0)("Loading Dataset"),e.setDataset(h.datasource).then(function(t){var n=t.payload.rownames.filter(function(e){return e.indexOf("mtx")>=0}),n=(t.payload.tbl,n[n.length-1].replace(".RData",""));i.$watchGroup(["vm.geneAndPatients"],function(){w(h.geneAndPatients)}),e.setBusy(!1)});var b="",y=function(e){if(b!=e)switch(e){case"instructions":d.hide(),u.show(),p.hide();break;case"control":d.show(),u.hide(),p.show();break;case"errors":d.hide(),u.show(),p.hide()}},w=function(t){if(null==m||null==g)return void y("instructions");var n=t;n=n.split(","),n.length>350?(h.errorMessage="ERROR: The total number of Patients and Genes are set to be less than 350.",y("errors")):(e.setBusy(!0),e.getOncoprint(n),e.getOncoprint(n).then(function(t){var n=t.payload;c(n),y("control"),e.setBusy(!1)}))}}e.$inject=["osApi","osHistory","$state","$stateParams","$timeout","$scope","d3","$window","_"];var t={restrict:"E",templateUrl:"app/components/oncoprint/oncoprint.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osOncoprint",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o){if(angular.isUndefined(o.datasource))return void t.go("datasource");var i=this;i.dataset=o.datasource,i.colnames=[],i.rows=[],i.search="";var s;e.setBusy(!0),e.getDataManifest(i.dataset).then(function(t){i.colnames=t.payload.colnames,i.rows=t.payload.mtx,n(function(){s=angular.element("#metadata-datatable").dataTable({paging:!1}),a.$watch("vm.search",function(){s.api().search(i.search).draw()}),e.setBusy(!1)},0,!1)})}e.$inject=["osApi","$state","$timeout","$scope","$stateParams"];var t={restrict:"E",templateUrl:"app/components/metadata/metadata.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osMetadata",e)}(),function(){function e(){function e(e,t,n,a,o,i,s,r,l,c,d,u){function p(e){o.$apply(function(){"mouseout"==e.type?w.detail.show=!1:(w.detail.title=e.cyTarget.id(),w.detail.html=h[e.cyTarget.id()],w.detail.show=!0)})}function m(e){console.log("genes")}e.setBusy(!0);var g,h,v,f=function(){return{patients:{select:new r.Signal,unselect:new r.Signal,over:new r.Signal,out:new r.Signal},genes:{select:new r.Signal,unselect:new r.Signal,over:new r.Signal,out:new r.Signal},edges:{select:new r.Signal,unselect:new r.Signal,over:new r.Signal,out:new r.Signal},clear:function(){this.edges.select.removeAll(),this.edges.unselect.removeAll(),this.edges.over.removeAll(),this.edges.out.removeAll(),this.patients.select.removeAll(),this.patients.unselect.removeAll(),this.patients.over.removeAll(),this.patients.out.removeAll(),this.genes.select.removeAll(),this.genes.unselect.removeAll(),this.genes.over.removeAll(),this.genes.out.removeAll()}}}(),b=angular.element("#markers-chart"),y=function(e){return s({container:e,style:[{selector:"core",style:{"selection-box-color":"#3993fa","selection-box-border-color":"#3993fa","selection-box-border-width":"1px","selection-box-opacity":".2"}},{selector:"node",style:{"background-color":"#3993fa",display:"data(display)",width:"data(sizeEle)",height:"data(sizeEle)","border-width":"data(sizeBdr)","font-size":"data(sizeLbl)","text-valign":"center"}},{selector:'node[nodeType="telomere"]',style:{"background-color":"#3993fa"}},{selector:'node[nodeType="patient"]',style:{"background-color":"data(color)","text-halign":"center","border-color":"#FFFFFF"}},{selector:'node[nodeType="patient"]:selected',style:{"border-color":"#000","border-width":50}},{selector:'node[nodeType="gene"]',style:{"background-color":"#FFFFFF","border-color":"#38347b","text-halign":"right",label:"data(id)"}},{selector:'node[nodeType="gene"]:selected',style:{"border-color":"#FF0000"}},{selector:'node[nodeType="centromere"]',style:{"font-size":"200px","text-halign":"center","background-color":"#3993fa",color:"#FFFFFF","border-color":"rgb(19, 150, 222)",height:"400px",width:"400px",shape:"round",label:"  data(id)"}},{selector:"edge",style:{display:"data(display)","line-color":"data(color)",width:"data(sizeEle)"}}],hideEdgesOnViewport:!1,hideLabelsOnViewport:!0,textureOnViewport:!1,zoom:.01,pan:{x:550,y:160},layout:{name:"preset",fit:!0}})}(b);!function(){e.query("render_chromosome",{type:"chromosome"}).then(function(e){var t=e.data[0].data,n=[];Object.keys(t).forEach(function(e){var t=this.chromosomes[e];this.elements.push({group:"edges",grabbable:!1,locked:!0,selectable:!1,data:{color:"#3993fa",id:"ce"+e,display:"element",edgeType:"chromosome",sizeBdr:0,sizeEle:60,source:"cp"+e,target:"cq"+e}}),this.elements.push({group:"nodes",grabbable:!1,locked:!0,selectable:!1,position:{x:t.x,y:t.p},data:{id:"cp"+e,display:"element",nodeType:"telomere",degree:1,sizeBdr:50,sizeEle:50,sizeLbl:6,subType:"unassigned"}}),this.elements.push({group:"nodes",grabbable:!1,locked:!0,selectable:!1,position:{x:t.x,y:t.q},data:{id:"cq"+e,display:"element",nodeType:"telomere",degree:1,sizeBdr:50,sizeEle:50,sizeLbl:50,subType:"unassigned"}}),this.elements.push({group:"nodes",grabbable:!1,locked:!0,selectable:!1,position:{x:t.x,y:t.c},data:{id:e,display:"element",sizeBdr:50,nodeType:"centromere",degree:1}})},{chromosomes:t,elements:n}),y.add(n)})}();var w=function(e,t){return e.showPopupSelection=!1,e.datasource=t.getDataSource(),e.detail={show:!1,html:"",title:""},e.optGeneSets=[],e.optGeneSet,e.optPatientLayouts=[],e.optPatientLayout,e.search="",e.optPatientColors=[],e.optPatientColor,e.optCommandModes=[{name:"Sequential"},{name:"Set"},{name:"Ad Hoc"}],e.optCommandMode=e.optCommandModes[0],e.selectColor=function(e){},e.filterModelEdge=function(){angular.element("#modalEdge").modal("hide");var t=e.optEdgeColors.filter(function(e){return e.show}).map(function(e){return e.id}),n=g.edges.filter(function(e){return-1!=t.indexOf(e.data.cn)},{vals:t});y.startBatch();y.add(n);y.endBatch(),g=null},e.edgeToggle=function(e){e.show||y.remove("edge[cn="+e.id+"]")},e.deselectColor=function(e){var t=e.color,n=y.$('node[nodeType="patient"]:selected');y.startBatch(),n.forEach(function(e){e.data().color==this&&e.unselect()},t),y.endBatch()},e.lockPatients=!1,e.lockGenes=!1,e.lock=function(t){switch(t){case"patient":e.lockPatients=!e.lockPatients,y.startBatch(),y.$('node[nodeType="patient"]').forEach(function(t){e.lockPatients?t.unselectify():t.selectify()}),y.endBatch();break;case"gene":e.lockGenes=!e.lockGenes,y.startBatch(),y.$('node[nodeType="cn"]').forEach(function(t){e.lockGenes?t.unselectify():t.selectify()}),y.endBatch()}},e.optEdgeColors=[{name:"mutation",abv:"m",show:!0,color:"#004358","class":"switch-mutation",id:0},{name:"cnGain.1",abv:"cnG1",show:!0,color:"#1F8A70","class":"switch-cnG1",id:1},{name:"cnLoss.1",abv:"cnL1",show:!0,color:"#FFE11A","class":"switch-cnL1",id:-1},{name:"cnGain.2",abv:"cnG2",show:!0,color:"#BEDB39","class":"switch-cnG2",id:2},{name:"cnLoss.2",abv:"cnL2",show:!0,color:"#FD7400","class":"switch-cnL2",id:-2}],u.all([t.query("render_chromosome",{type:"geneset",$fields:["name"]}),t.query("render_patient",{type:"cluster",$fields:["name"]}),t.query("render_patient",{type:"color",$fields:["name"]})]).then(function(t){e.optGeneSets=t[0].data,e.optGeneSet=e.optGeneSets[0],e.optPatientLayouts=t[1].data,e.optPatientLayout=e.optPatientLayouts[0],e.optPatientColors=[{name:"Default"}].concat(t[2].data),e.optPatientColor=e.optPatientColors[0]}),e.resize=function(){var e=c.innerWidth;"true"==angular.element(".tray").attr("locked")&&(e-=300),b.width(e),b.height(c.innerHeight-90),y.resize()},angular.element(c).bind("resize",d.debounce(e.resize,300)),e}(this,e),A=function(e,t){var n=function(){e.fit(),e.center()},a=function(){e.fit(e.$(":selected"),50)};return t.zoom={reset:n,fit:a},e.on("pan",d.debounce(function(t){e.startBatch(),k(),e.endBatch()},50)),t.zoom}(y,w),k=function(){var e=1/y.zoom()/100;.02>e&&(e=.02);var t=50*e,n=500*(2*e),n=n>500?0:n;y.$('node[nodeType="patient"],node[nodeType="gene"]').forEach(function(e){e.data({sizeEle:e.data().weight*this.zoom,sizeLbl:this.sizeLbl,sizeBdr:this.sizeBdr})},{zoom:e,sizeBdr:t,sizeLbl:n})},x=function(e,t,n,a,i,s,r){var l={},c=new Worker("app/components/markers/markers.worker.js");c.addEventListener("message",function(e){l[e.data.cmd](e.data.data)},!1);var d=function(t,n){if(angular.isUndefined(n))return void e.remove(t);try{var a=n.map(function(e){return this.getElementById(e)},e);e.collection(a).remove()}catch(o){}};return l.patients_html=function(e){h=e,console.log("PATIENTS HTML")},l.patients_resize=function(e){console.log("PATIENTS RESIZE")},l.patients_delete=function(e){console.log("PATIENTS DELETE"),d('node[nodeType="patient"]',e)},l.patients_insert=function(n){console.log("PATIENTS INSERT"),e.startBatch();var a=r.patients,o=e.add(n.patients);o.on("select",s.debounce(a.select.dispatch,300)),o.on("unselect",s.debounce(a.unselect.dispatch,300)),o.on("mouseover",a.over.dispatch),o.on("mouseout",a.out.dispatch),o.forEach(function(e){try{e.data({weight:n.degrees[e.id()].weight})}catch(t){e.data({weight:100})}}),k(),e.endBatch(),t.resize()},l.patients_color=function(t){console.log("PATIENTS COLOR"),e.startBatch(),e.nodes('node[nodeType="patient"]').forEach(function(e){e.data("color",t[e.id()].color)}),e.endBatch()},l.patients_layout=function(t){console.log("PATIENTS LAYOUT"),e.startBatch(),e.nodes('node[nodeType="patient"]').forEach(function(e){try{var n=t[e.id()];n.x-=4e4,e.position(n)}catch(a){}}),k(),e.endBatch()},l.patients_legend=function(e){console.log("PATIENTS LEGEND"),o.$apply(function(){t.legendNodes=e})},l.genes_html=function(e){v=e,console.log("GENES HTML")},l.genes_delete=function(e){console.log("GENES DELETE"),d('node[nodeType="gene"]',e)},l.genes_insert=function(t){console.log("GENES INSERT"),e.startBatch();var a=r.genes,o=e.add(t.genes);o.on("select",s.debounce(a.select.dispatch,300)),o.on("unselect",s.debounce(a.unselect.dispatch,300)),o.on("mouseover",a.over.dispatch),o.on("mouseout",a.out.dispatch),o.forEach(function(e){try{e.data({weight:t.degrees[e.id()].weight})}catch(n){e.data({weight:500})}}),e.endBatch(),n.setBusy(!1)},l.genes_update=function(e){console.log("GENES UPDATE"),update(e)},l.edges_delete=function(e){console.log("EDGES DELETE"),d('edge[edgeType="cn"]',e)},l.edges_insert=function(n){if(console.log("EDGES INSERT"),g=n,n.counts.total>5e3)return angular.element("#modalEdge").modal(),void o.$apply(function(){t.edgeCounts=n.counts});e.startBatch(),"Ad Hoc"==t.optCommandMode.name&&e.$('edge[edgeType="cn"]').remove();e.add(n.edges);e.endBatch()},l.edges_update=function(e){console.log("EDGES UPDATE"),update(e)},function(e){c.postMessage({cmd:"setOptions",data:e})}}(y,w,e,u,A,d,f),_=function(e,t){return function(n){n=n||"";var a=t.optGeneSet.name,o={mode:t.optCommandMode.name,cmd:n,patients:{data:t.datasource.collections.pt,layout:t.optPatientLayout.name,color:t.optPatientColor.name,selected:e.$('node[nodeType="patient"]:selected').map(function(e){return e.data().id})},genes:{layout:t.optGeneSet.name,selected:e.$('node[nodeType="gene"]:selected').map(function(e){return e.data().id})},edges:{layout:t.datasource.edges.filter(function(e){return e.name==this},a)[0],colors:t.optEdgeColors.filter(function(e){return e.show}).map(function(e){return{id:e.id,color:e.color}})}};return o}}(y,w);w.cmd=function(){};(function(t,n){var a=1;a+=1,n.$watch("vm.optGeneSet",function(){return a>0?void(a-=1):void(angular.isUndefined(t.optGeneSet)||angular.isUndefined(t.optPatientColor)||angular.isUndefined(t.optPatientLayout)||(e.setBusy(!0),y.$('edge[edgeType="cn"]').remove(),x(_())))}),a+=1,n.$watch("vm.optPatientColor",function(){return a>0?void(a-=1):void x(_())}),a+=1,n.$watch("vm.optPatientLayout",function(){return a>0?void(a-=1):void x(_())}),a+=1,n.$watch("vm.search",d.debounce(function(){if(a>0)return void(a-=1);var e=t.search.toUpperCase().trim();y.$("node").unselect(),e.length>0&&y.$("node").filter(function(t,n){return 0==n.id().toUpperCase().indexOf(e)}).select()},600)),a+=1,n.$watch("vm.optEdgeColors.color",function(){return a>0?void(a-=1):(x(_()),void t.resize())})})(w,o);o.$watch("vm.optCommandMode",function(){switch(f.clear(),y.$("node").unselect(),y.$('edge[edgeType="cn"]').remove(),w.optCommandMode.name){case"Sequential":w.cmd=function(e){switch(e){case"HideAllEdges":y.$('edge[edgeType="cn"]').remove();break;case"HideSelectedEdges":y.$('node[nodeType="patient"]:selected, node[nodeType="gene"]:selected').neighborhood("edge").remove();break;case"HideUnselectedEdges":y.$('node[nodeType="patient"]:unselected').neighborhood("edge").remove();break;case"SelectConnected":y.startBatch(),y.$("node:selected").neighborhood("node").forEach(function(e){e.select()}),y.endBatch();break;case"SelectInverse":y.startBatch(),y.$("node").forEach(function(e){e[e._private.selected?"deselect":"select"]()}),y.endBatch();break;case"HideUnselectedNodes":y.startBatch(),y.$('node[nodeType="patient"]:unselected').forEach(function(e){e.style({display:"none"})}),y.endBatch();break;case"ShowAllNodes":y.startBatch(),y.$('node[nodeType="patient"]:hidden').forEach(function(e){e.style({display:"element"})}),y.endBatch();break;default:var t=_(e);x(t)}},f.genes.over.add(m),f.genes.over.add(m),f.patients.over.add(p),f.patients.out.add(p);break;case"Set":var e=function(){y.$('edge[edgeType="cn"]').remove();var e=_();(e.patients.selected.length>0||e.genes.selected.length>0)&&x(e)},t=function(){y.$('edge[edgeType="cn"]').remove(),x(_())};f.genes.over.add(m),f.genes.over.add(m),f.patients.over.add(p),f.patients.out.add(p),f.patients.select.add(t),f.patients.unselect.add(e),f.genes.select.add(t),f.genes.unselect.add(e);break;case"Ad Hoc":var n=function(e){p(e),e.cyTarget.select(),x(_())},a=function(e){p(e),e.cyTarget.unselect()};f.genes.over.add(m),f.genes.over.add(m),f.patients.over.add(n),f.patients.out.add(a),f.genes.over.add(n),f.genes.out.add(a)}})}e.$inject=["osApi","osHistory","$state","$timeout","$scope","$stateParams","cytoscape","signals","moment","$window","_","$q"];var t={restrict:"E",templateUrl:"app/components/markers/markers.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osMarkers",e)}(),function(){"use strict";function e(){function e(e,t){var n=e.getUserApi(),a=this;a.domains=n.getDomains(),a.user=n.getUser(),a.hasError=!1,a.login=function(){var e=n.login(a.user);angular.isDefined(e)?e.then(function(){a.user.authenticated?t.go("datasource"):a.hasError=!0}):t.go("datasource")}}e.$inject=["osApi","$state"];var t={restrict:"E",templateUrl:"app/components/login/login.html",replace:!0,controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osLogin",e)}(),function(){"use strict";function e(){var e={restrict:"E",templateUrl:"app/components/loader/loader.html",replace:!0};return e}angular.module("oncoscape").directive("osLoader",e)}(),function(){"use strict";function e(){function e(e){var t=this;t.login=function(){e.go("login")}}e.$inject=["$state"];var t={restrict:"E",templateUrl:"app/components/landing/landing.html",replace:!0,controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osLanding",e)}(),function(e,t){var n=function(n,a){var o=function(e,t){if(!a.versionCheck||!a.versionCheck("1.10.1"))throw"DataTables Responsive requires DataTables 1.10.1 or newer";e.responsive||(this.s={dt:new a.Api(e),columns:[]},t&&"string"==typeof t.details&&(t.details={type:t.details}),this.c=n.extend(!0,{},o.defaults,t),e.responsive=this,this._constructor())};return o.prototype={_constructor:function(){var t=this,a=this.s.dt;n(e).on("resize.dtr",a.settings()[0].oApi._fnThrottle(function(){t._resize()})),a.on("destroy.dtr",function(){n(e).off("resize.dtr")}),this.c.breakpoints.sort(function(e,t){return e.width<t.width?1:e.width>t.width?-1:0}),this._classLogic(),this._resizeAuto(),this._resize();var o=this.c.details;o.type&&(t._detailsInit(),this._detailsVis(),a.on("column-visibility.dtr",function(){t._detailsVis()}),n(a.table().node()).addClass("dtr-"+o.type))},_columnsVisiblity:function(e){var t,a,o=this.s.dt,i=this.s.columns,s=n.map(i,function(t){return t.auto&&null===t.minWidth?!1:!0===t.auto?"-":-1!==t.includeIn.indexOf(e)}),r=0;for(t=0,a=s.length;a>t;t++)!0===s[t]&&(r+=i[t].minWidth);for(o=o.table().container().offsetWidth-r,t=0,a=s.length;a>t;t++)i[t].control?o-=i[t].minWidth:"-"===s[t]&&(s[t]=0>o-i[t].minWidth?!1:!0,o-=i[t].minWidth);for(o=!1,t=0,a=i.length;a>t;t++)if(!i[t].control&&!s[t]){o=!0;break}for(t=0,a=i.length;a>t;t++)i[t].control&&(s[t]=o);return s},_classLogic:function(){var e=this,t=this.c.breakpoints,a=this.s.dt.columns().eq(0).map(function(e){return{className:this.column(e).header().className,includeIn:[],auto:!1,control:!1}}),o=function(e,t){var n=a[e].includeIn;-1===n.indexOf(t)&&n.push(t)},i=function(n,i,s,r){if(s){if("max-"===s)for(r=e._find(i).width,i=0,s=t.length;s>i;i++)t[i].width<=r&&o(n,t[i].name);else if("min-"===s)for(r=e._find(i).width,i=0,s=t.length;s>i;i++)t[i].width>=r&&o(n,t[i].name);else if("not-"===s)for(i=0,s=t.length;s>i;i++)-1===t[i].name.indexOf(r)&&o(n,t[i].name)}else a[n].includeIn.push(i)};a.each(function(e,a){for(var o=e.className.split(" "),s=!1,r=0,l=o.length;l>r;r++){var c=n.trim(o[r]);if("all"===c)return s=!0,void(e.includeIn=n.map(t,function(e){return e.name}));if("none"===c)return void(s=!0);if("control"===c)return s=!0,void(e.control=!0);n.each(t,function(e,t){var n=t.name.split("-"),o=c.match(RegExp("(min\\-|max\\-|not\\-)?("+n[0]+")(\\-[_a-zA-Z0-9])?"));o&&(s=!0,o[2]===n[0]&&o[3]==="-"+n[1]?i(a,t.name,o[1],o[2]+o[3]):o[2]===n[0]&&!o[3]&&i(a,t.name,o[1],o[2]))})}s||(e.auto=!0)}),this.s.columns=a},_detailsInit:function(){var e=this,t=this.s.dt,a=this.c.details;"inline"===a.type&&(a.target="td:first-child");var o=a.target;n(t.table().body()).on("click","string"==typeof o?o:"td",function(){if("number"==typeof o){var a=0>o?t.columns().eq().length+o:o;if(t.cell(this).index().column!==a)return}if(n(t.table().node()).hasClass("collapsed"))if(a=t.row(n(this).closest("tr")),a.child.isShown())a.child(!1),n(a.node()).removeClass("parent");else{var i=e.c.details.renderer(t,a[0]);a.child(i,"child").show(),n(a.node()).addClass("parent")}})},_detailsVis:function(){var e=this,t=this.s.dt;-1!==t.columns().visible().indexOf(!1)?(n(t.table().node()).addClass("collapsed"),t.rows().eq(0).each(function(n){if(n=t.row(n),n.child()){var a=e.c.details.renderer(t,n[0]);!1===a?n.child.hide():n.child(a,"child").show()}})):(n(t.table().node()).removeClass("collapsed"),t.rows().eq(0).each(function(e){t.row(e).child.hide()}))},_find:function(e){for(var t=this.c.breakpoints,n=0,a=t.length;a>n;n++)if(t[n].name===e)return t[n]},_resize:function(){for(var t=this.s.dt,a=n(e).width(),o=this.c.breakpoints,i=o[0].name,s=o.length-1;s>=0;s--)if(a<=o[s].width){i=o[s].name;break}var r=this._columnsVisiblity(i);t.columns().eq(0).each(function(e,n){t.column(e).visible(r[n])})},_resizeAuto:function(){var e=this.s.dt,t=this.s.columns;if(this.c.auto&&-1!==n.inArray(!0,n.map(t,function(e){return e.auto}))){e.table().node();var a=e.table().node().cloneNode(!1),o=n(e.table().header()).clone(!1).appendTo(a);n(e.table().body().cloneNode(!0)).appendTo(a);var i=e.settings()[0].oApi._fnGetUniqueThs(e.settings()[0],o),a=n("<div/>").css({width:1,height:1,overflow:"hidden"}).append(a).insertBefore(e.table().node());e.columns().eq(0).each(function(n){t[n].minWidth=e.column(n).visible()?i[e.column(n).index("visible")].offsetWidth:null}),a.remove()}}},o.breakpoints=[{name:"desktop",width:1/0},{name:"tablet-l",width:1024},{name:"tablet-p",width:768},{name:"mobile-l",width:480},{name:"mobile-p",width:320}],o.defaults={breakpoints:o.breakpoints,auto:!0,details:{renderer:function(e,t){var a=e.cells(t,":hidden").eq(0).map(function(t){var a=n(e.column(t.column).header());return a.hasClass("control")?"":'<li><span class="dtr-title">'+a.text()+':</span> <span class="dtr-data">'+e.cell(t).data()+"</span></li>"}).toArray().join("");return a?n("<ul/>").append(a):!1},target:0,type:"inline"}},o.version="1.0.0",n.fn.dataTable.Responsive=o,n.fn.DataTable.Responsive=o,n(t).on("init.dt.dtr",function(e,t){if(n(t.nTable).hasClass("responsive")||n(t.nTable).hasClass("dt-responsive")||t.oInit.responsive){var a=t.oInit.responsive;!1!==a&&new o(t,n.isPlainObject(a)?a:{})}}),o};"function"==typeof define&&define.amd?define(["jquery","datatables"],n):"object"==typeof exports?n(require("jquery"),require("datatables")):jQuery&&!jQuery.fn.dataTable.Responsive&&n(jQuery,jQuery.fn.dataTable)}(window,document),function(){"use strict";function e(){function e(e,t,n,a,o,i,s,r,l,c){var d,u=this,p=null==t.getPatientSelection()?[]:t.getPatientSelection().ids,m=["patient_ID","gender","race","age_at_diagnosis","days_to_death","status_vital"],g=m.map(function(e){return{data:e,title:e.replace(/_/g," "),defaultContent:"NA"}}),h=function(t){t.datasource=e.getDataSource(),t.diagnosisMin=t.diagnosisMinValue=1,t.diagnosisMax=t.diagnosisMaxValue=1e5,t.survivalMin=t.survivalMinValue=0,t.survivalMax=t.survivalMaxValue=10,t.search="",t.detail=null},v=function(e,t,n){angular.element.fn.DataTable.ext.search=[function(t,n){if(0!=p.length&&-1==p.indexOf(n[0]))return!1;var a=parseFloat(n[3]),o=parseFloat(n[4]);return isNaN(o)||isNaN(a)?!1:a>=e.diagnosisMin&&a<e.diagnosisMax+1&&o>=e.survivalMin&&o<e.survivalMax+1}],d=angular.element("#history-datatable").dataTable({paging:!1,columns:t,data:n,scrollY:"60vh",scrollCollapse:!0,buttons:["copy","csv","excel","pdf","print"]}),d.api().draw()},f=function(e,n){e.exportCsv=function(){var e=d._("tr",{filter:"applied"}).map(function(e){for(var t="",n=0;n<m.length;n++)n>0&&(t+=","),t+=e[m[n]];return t});e.unshift(m.join(",")),e=e.join("\n");var t=encodeURI("data:text/csv;charset=utf-8,"+e);window.open(t)},e.applyFilter=function(e){p=[],d.api().draw();var n=d._("tr",{filter:"applied"}).map(function(e){return e.patient_ID.toString().toUpperCase()});n=l.map(n,function(e){return[e]}),t.addPatientSelection("Patient History",e,n)},t.onPatientSelectionChange.add(function(e){p=e.ids,d.api().draw()})};e.setBusy(!0),h(u),e.query(u.datasource.collections.pt,{$fields:m}).then(function(t){var n=t.data.reduce(function(e,t){if(angular.isDefined(t.age_at_diagnosis)){var n=parseInt(t.age_at_diagnosis);e.ageAtDiagnosis.min=Math.min(e.ageAtDiagnosis.min,n),e.ageAtDiagnosis.max=Math.max(e.ageAtDiagnosis.max,n)}if(angular.isDefined(t.days_to_death)){var a=parseInt(t.days_to_death);e.daysToDeath.min=Math.min(e.daysToDeath.min,a),e.daysToDeath.max=Math.max(e.daysToDeath.max,a)}return e},{ageAtDiagnosis:{max:-(1/0),min:1/0},daysToDeath:{max:-(1/0),min:1/0}});u.diagnosisMin=u.diagnosisMinValue=n.ageAtDiagnosis.min,u.diagnosisMax=u.diagnosisMaxValue=n.ageAtDiagnosis.max,u.survivalMin=u.survivalMinValue=n.daysToDeath.min,u.survivalMax=u.survivalMaxValue=n.daysToDeath.max,v(u,g,t.data),f(u,o),e.setBusy(!1)})}e.$inject=["osApi","osHistory","$state","$timeout","$scope","moment","$stateParams","_","$","$q"];var t={restrict:"E",templateUrl:"app/components/history/history.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osHistory",e)}(),function(){"use strict";function e(){function e(){var e=this;e.videos=[{name:"Oncoscape + Github",desc:"Description Lorum Ipsum eos et sid al accusamus et iusto odio",img:""},{name:"Creating Cohorts",desc:"Description Lorum Ipsum eos et sid al accusamus et iusto odio",img:""},{name:"Patients + Markers",desc:"Description Lorum Ipsum eos et sid al accusamus et iusto odio",img:""},{name:"Timelines",desc:"Description Lorum Ipsum eos et sid al accusamus et iusto odio",img:""}]}var t={restrict:"E",templateUrl:"app/components/help/help.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osHelp",e)}(),function(){"use strict";function e(){function e(e,t,n,a){e.onDataSource.add(function(){a(function(){i.showTools=!0})});var o=e.getUserApi();o.onLogin.add(function(){a(function(){i.showMenu=!0})}),o.onLogout.add(function(){a(function(){i.showMenu=!1})});var i=this;i.showMenu=!1,i.showTools=!1,i.toolsClick=function(){n.go("tools",{datasource:e.getDataSource()})},i.cohortClick=function(){e.toggleFilter()},i.logoutClick=function(){o.logout(),n.transitionTo("landing")}}e.$inject=["osApi","$stateParams","$state","$timeout"];var t={restrict:"E",templateUrl:"app/components/header/header.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osHeader",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,s,r,l){if(angular.isUndefined(a.datasource))return void n.go("datasource");var c=(angular.element("#geneSetTestsInputsDiv"),this);c.datasource=a.datasource,c.geneSets=[],c.geneSet=null;var d=t.getPatientSelections()[0],u=t.getPatientSelections()[1];e.setBusy(!0),e.setDataset(c.datasource).then(function(t){var n=t.payload.rownames.filter(function(e){return e.indexOf("mtx.mrna")>=0});if(n=n[n.length-1].replace(".RData",""),console.log("**** mtx is: ",n),null==d||null==u)c.message="Please select two cohorts to test out the Gene Set",c.optCohort1="Empty",c.optCohort2="Empty";else{c.optCohort1=d.tool+" "+d.desc+" "+d.ids.length+" Patients selected",c.optCohort2=u.tool+" "+u.desc+" "+u.ids.length+" Patients selected";var a="random.24";e.getGeneSetTest(c.datasource,n).then(function(){i.$watchGroup(["vm.optCohort1","vm.optCohort2"],function(){m(d,u,a)})})}e.setBusy(!1)});var p=function(e,t,n){console.log(n),angular.element("#heatMap").highcharts({chart:{type:"heatmap",marginTop:40,marginBottom:80,plotBorderWidth:1},title:{text:"Gene Set Expression Heat Map"},xAxis:{categories:t},yAxis:{lineWidth:5,lineColor:"#F33",categories:e,title:null},colorAxis:{min:0,minColor:"#FFFFFF",maxColor:"#CC9933"},legend:{align:"right",layout:"vertical",margin:10,verticalAlign:"top",y:25,symbolHeight:280},tooltip:{formatter:function(){return"<b>"+this.series.yAxis.categories[this.point.y]+" "+this.series.xAxis.categories[this.point.x]+": "+this.point.value+"</b>"}},series:[{name:"Sales per employee",borderWidth:0,data:JSON.parse(n)}]})},m=function(t,n,a){var o=t.ids,i=n.ids;e.setBusy(!0),e.getGeneSetScore(o,i,a).then(function(t){if(console.log(t.payload),"error"==t.status)c.message=t.payload+"Please select two cohorts to test out the Gene Set";else{c.message=t.payload.summary;var n=t.payload.pt,a=t.payload.genes;p(n,a,t.payload.analysisData)}e.setBusy(!1)})}}e.$inject=["osApi","osHistory","$state","$stateParams","$timeout","$scope","d3","$window","_"];var t={restrict:"E",templateUrl:"app/components/genesettest/genesettest.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osGenesettest",e)}(),function(){"use strict";function e(){function e(e,t){var n=this;n.datasets=e.getDataSources(),n.explore=function(n,a){e.setDataSource(a),t.go(n,{datasource:a.disease})}}e.$inject=["osApi","$state"];var t={restrict:"E",templateUrl:"app/components/datasource/datasource.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osDatasource",e)}(),function(){"use strict";function e(){function e(){}var t={restrict:"E",templateUrl:"app/components/footer/footer.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osFooter",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i){if(angular.isUndefined(o.datasource))return void t.go("datasource");var s=this;s.dataSources,s.dataSource,s.dataDiseases,s.dataDisease,s.dataTables,s.dataTable,s.dataFields,s.dataField;var r={chart:{type:"discreteBarChart",height:450,margin:{top:20,right:20,bottom:50,left:55},x:function(e){return e.label},y:function(e){return e.value},showValues:!0,valueFormat:function(e){return d3.format(",.4f")(e)},duration:500,xAxis:{axisLabel:"X Axis"},yAxis:{axisLabel:"Y Axis",axisLabelDistance:-10}}};s.chartOptions=r,s.toolTipContentFunction=function(){return function(e,t,n,a,o){return"Super New Tooltip<h1>"+e+"</h1><p>"+n+" at "+t+"</p>"}},s.xFunction=function(){return function(e){return e.label}},s.yFunction=function(){return function(e){return e.value}},e.setBusy(!0),e.query("_collections").then(function(t){s.dataSources=t.data,s.dataSource=s.dataSources[0],a.$watch("vm.dataSource",function(){s.dataDiseases=s.dataSource.diseases,s.dataDisease=s.dataSource.diseases[0]}),a.$watch("vm.dataDisease",function(){s.dataTables=s.dataDisease.tables,s.dataTable=s.dataTables[0]}),a.$watch("vm.dataTable",function(){e.query("_field_detail",{collection:s.dataTable.collection}).then(function(e){s.dataFields=e.data[0].fields.filter(function(e){return"_id"!=e.key}),s.dataField=s.dataFields[0],console.dir(s.dataField)})}),e.setBusy(!1)})}e.$inject=["osApi","$state","$timeout","$scope","$stateParams","_"];var t={restrict:"E",templateUrl:"app/components/dataexplorer/dataexplorer.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osDataExplorer",e);
}(),function(){"use strict";function e(){function e(e,t,n){var a=this;a.selection,a.selections,a.close=function(){angular.element(".cohorts-"+a.type).hide()},a.setSelection=function(t){e["set"+a.type+"Selection"](t)};var o=function(){n(function(){a.selections=e["get"+a.type+"Selections"](),a.selection=e["get"+a.type+"Selection"]()})};e["on"+a.type+"Add"].add(function(){o(!0)}),e["on"+a.type+"SelectionChange"].add(function(){o(!1)});var i=!1,s=function(){angular.element(".cohorts-"+a.type).show(),i||(i=!0,angular.element(".cohorts-"+a.type).draggable())};angular.element(document).keypress(function(t){if(t.ctrlKey)if("Gene"==a.type)switch(t.keyCode){case 12:s();break;case 39:e.getGeneSelectionNext();break;case 59:e.getGeneSelectionLast()}else switch(t.keyCode){case 16:s();break;case 27:e.getPatientSelectionLast();break;case 29:e.getPatientSelectionNext()}})}e.$inject=["osHistory","$state","$timeout"];var t={restrict:"E",templateUrl:"app/components/cohorts/cohorts.html",controller:e,scope:{type:"@"},controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osCohorts",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i){if(angular.isUndefined(o.datasource))return void t.go("datasource");var s=this;s.dataSources,s.dataSource,s.dataDiseases,s.dataDisease,s.dataTables,s.dataTable,s.dataFields,s.toolTipContentFunction=function(){return function(e,t,n,a,o){return"Super New Tooltip<h1>"+e+"</h1><p>"+n+" at "+t+"</p>"}},s.xFunction=function(){return function(e){return e.label}},s.yFunction=function(){return function(e){return e.value}},e.setBusy(!0),e.query("_collections").then(function(t){var n=t.data;s.dataSources=i.chain(n).pluck("source").uniq().map(function(e){return{name:e,diseases:i.chain(n).where({source:e}).pluck("disease").uniq().map(function(e){return{name:e,tables:i.chain(n).where({source:"tcga",disease:e}).map(function(e){return{created:e.created,name:e.table,records:e.records,collection:e.collection}}).value()}}).value()}}).value(),s.dataSource=s.dataSources[0],a.$watch("vm.dataSource",function(){s.dataDiseases=s.dataSource.diseases,s.dataDisease=s.dataSource.diseases[0]}),a.$watch("vm.dataDisease",function(){s.dataTables=s.dataDisease.tables,s.dataTable=s.dataTables[0]}),a.$watch("vm.dataTable",function(){console.log(e.queryString("_stats",{collection:s.dataTable.collection})),e.query("_stats",{collection:s.dataTable.collection}).then(function(e){s.dataFields=e.data[0].fields})}),e.setBusy(!1)})}e.$inject=["osApi","$state","$timeout","$scope","$stateParams","_"];var t={restrict:"E",templateUrl:"app/components/cohortbuilder/cohortbuilder.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osCohortBuilder",e)}(),function(){"use strict";function e(e,t,n,a,o){n.onerror=function(e,t,n,o,i){i||(i=new Error(e),i.fileName=t,i.lineNumber=n,i.columnNumber=o||0),a(i)};var i=e.$on("$stateChangeStart",function(e,n,a){return o.setBusy(!1),angular.element.fn.DataTable.ext.search=[],n.authenticate&&!o.getUserApi().getUser().authenticated?(t.transitionTo("landing"),void e.preventDefault()):n.datasource&&(angular.isUndefined(a.datasource)||""===a.datasource)?(t.transitionTo("datasource"),void e.preventDefault()):void o.setDataSource(a.datasource)});e.$on("$destroy",i)}e.$inject=["$rootScope","$state","$window","$exceptionHandler","osApi"],angular.module("oncoscape").run(e)}(),function(){"use strict";function e(e,t){e.state("landing",{url:"/",template:"<os-landing>",authenticate:!1,datasource:!1}).state("help",{url:"/help",template:"<os-help>",authenticate:!1,datasource:!1}).state("datasource",{url:"/datasource",template:"<os-datasource>",authenticate:!0,datasource:!1}).state("tools",{url:"/tools/{datasource}",template:"<os-tools>",authenticate:!0,datasource:!0}).state("metadata",{url:"/metadata/{datasource}",template:"<os-metadata>",authenticate:!0,datasource:!0}).state("history",{url:"/history/{datasource}",template:"<os-history>",authenticate:!0,datasource:!0}).state("plsr",{url:"/plsr/{datasource}",template:"<os-plsr>",authenticate:!0,datasource:!0}).state("pca",{url:"/pca/{datasource}",template:"<os-pca>",authenticate:!0,datasource:!0}).state("pca3d",{url:"/pca3d/{datasource}",template:"<os-pca3d>",authenticate:!0,datasource:!0}).state("markers",{url:"/markers/{datasource}",template:"<os-markers>",authenticate:!0,datasource:!0}).state("pathways",{url:"/pathways/{datasource}",template:"<os-pathways>",authenticate:!0,datasource:!0}).state("timelines",{url:"/timelines/{datasource}",template:"<os-timelines>",authenticate:!0,datasource:!0}).state("survival",{url:"/survival/{datasource}",template:"<os-survival>",authenticate:!0,datasource:!0}).state("dataexplorer",{url:"/dataexplorer/{datasource}",template:"<os-data-explorer>",authenticate:!0,datasource:!0}).state("oncoprint",{url:"/oncoprint/{datasource}",template:"<os-oncoprint>",authenticate:!0,datasource:!0}).state("genesettest",{url:"/genesettest/{datasource}",template:"<os-genesettest>",authenticate:!0,datasource:!0}).state("cohortbuilder",{url:"/cohortbuilder/{datasource}",template:"<os-cohort-builder>",authenticate:!0,datasource:!0}),t.otherwise("/")}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("oncoscape").config(e)}(),function(){"use strict";angular.module("oncoscape").constant("moment",moment).constant("d3",d3).constant("cytoscape",cytoscape).constant("signals",signals).constant("$",$).constant("_",_),Number.prototype.map=function(e,t,n,a){return(this-e)*(a-n)/(t-e)+n}}(),function(){"use strict";function e(e){e.debugEnabled(!0)}e.$inject=["$logProvider"],angular.module("oncoscape").config(e)}(),angular.module("oncoscape").run(["$templateCache",function(e){e.put("app/components/cohortbuilder/cohortbuilder.html",'<os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content cohortbuilider"><div class="row"></div></section></os-tray><section class="tray-content-block dataexplorer"><div class="container-fluid"><h2>Cohort Builder</h2><button>+</button> <button>-</button></div></section>'),e.put("app/components/cohorts/cohorts.html",'<div class="cohorts panel panel-default cohorts-{{vm.type}}"><div class="panel-heading">{{vm.type}} History <span class="pull-right fa fa-times" ng-click="vm.close()"></span></div><div class="panel-body cohorts-panel-body"><table><tr ng-click="vm.setSelection(item)" ng-repeat="item in vm.selections" ng-class="{\'cohort-selected\' : item==vm.selection}"><td>{{item.tool}}</td><td>{{item.desc}}</td><td>{{item.ids.length}}</td></tr></table></div></div>'),e.put("app/components/dataexplorer/dataexplorer.html",'<os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content dataexplorer"><div class="row"><div class="col-xs-12 form-label"><h2>Data Source</h2></div><div class="col-xs-12 form-item"><label>Origin</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.dataSource.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.dataSources" ng-click="vm.dataSource = item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Disease</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.dataDisease.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.dataDiseases" ng-click="vm.dataDisease = item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Table</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.dataTable.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.dataTables" ng-click="vm.dataTable = item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Field</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.dataField.key}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.dataFields" ng-click="vm.dataField = item">{{item.key}}</li></ul></div></div><div class="col-xs-12 form-label"><h2>Table Info</h2><dl><dt>Date Uploaded</dt><dd>{{vm.dataTable.created}}</dd><dt>Record Count</dt><dd>{{vm.dataTable.records}}</dd><dt>Field Count</dt><dd>{{vm.dataFields.length}}</dd></dl></div></div></section></os-tray><section class="tray-content-block dataexplorer"><div class="container-fluid"><h2>Data Explorer</h2><div ng-repeat="item in vm.dataFields" class="data-field"><b>{{item.key}}</b><div style="width:30%; margin-top:10px">{{item.name}}. {{item.desc}}</div><nvd3 options="vm.chartOptions" data="item.values"></nvd3></div></div></section>'),e.put("app/components/datasource/datasource.html",'<section class="datasource container-fluid"><div class="row"><div class="col-sm-8 col-md-6"><h1>Data Sources</h1><p>Oncoscape has analyzed and curated the following datasets hosted by The Cancer Genome Atlas (TCGA). Raw data sets for these and other available disease sites can be found at <a href="https://tcga-data.nci.nih.gov/tcga/">TCGA Data Portal</a>.</p></div></div><div class="row"><ul><li ng-repeat="dataset in vm.datasets" class="col-xs-12 col-sm-6 col-lg-4" ng-click="vm.explore(\'tools\',dataset)"><img class="datasource-img" ng-src="/assets/images/datasets/{{dataset.img}}"><h3 class="datasource-lbl">{{dataset.name}} ({{dataset.source}})</h3><nobr><a href="">Explore</a></nobr></li></ul></div></section>'),e.put("app/components/footer/footer.html",'<footer class="footer container"><div class="row"><div class="col-xs-12 col-sm-6"><img class="footer-logo" src="/assets/images/logo-fred-hutchinson-cancer-research-center.png" alt="Fred Hutchinson Cancer Research Center"> <img class="footer-logo" src="/assets/images/logo-university-of-washington-medicine.png" alt="UW Medicine"> <img class="footer-logo" src="/assets/images/logo-seattle-cancer-care-alliance.png" alt="Seattle Cancer Care Alliance"></div><div class="col-xm-12 col-sm-6 text-right"><a href="https://www.facebook.com/STTRCancer" target="_blank"><img class="footer-icon" src="/assets/images/sttr-facebook-out.png" alt="Facebook"></a> <a href="https://twitter.com/sttrcancer" target="_blank"><img class="footer-icon" src="/assets/images/sttr-twitter-out.png" alt="Twitter"></a> <a href="https://plus.google.com/+fredhutch/videos" target="_blank"><img class="footer-icon" src="/assets/images/sttr-youtube-out.png" alt="YouTube"></a> <a href="http://instagram.com/FredHutch" target="_blank"><img class="footer-icon" src="/assets/images/sttr-instagram-out.png" alt="Instagram"></a> <a href="http://www.linkedin.com/company/fred-hutchinson-cancer-research-center/careers?trk=top_nav_careers" target="_blank"><img class="footer-icon" src="/assets/images/sttr-linkedin-out.png" alt="LinkedIn"></a> <a href="https://plus.google.com/116048577052683099154/posts" target="_blank"><img class="footer-icon" src="/assets/images/sttr-google-out.png" alt="Google+"></a></div></div></footer>'),e.put("app/components/genesettest/genesettest.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortPatient()"></os-tool-menu><script src="https://cdn.plot.ly/plotly-latest.min.js"></script><script src="/bower_components/highcharts/modules/heatmap.js"></script><script src="/bower_components/highcharts/modules/exporting.js"></script><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="col-xs-12 form-label"><h2>Cohorts</h2></div><div class="col-sm-12 form-item"><label>Patient Cohort 1</label><p>{{vm.optCohort1}}</p></div><div class="col-sm-12 form-item"><label>Patient Cohort 2</label><p>{{vm.optCohort2}}</p></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Gene Set Binomial Test</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div id="geneSetTestsModuleDiv" class="genesettest"><div id="geneSetTests_Div"><div id="geneSetTestsControlsDiv"><div class="navbar-collapse collapse navbar-inverse-collapse"><div id="geneSetTestsInputsDiv"><div id="geneSetTestsLaunchButtonDiv"><form><div>{{vm.message}}</div><div id="heatMap"></div></form></div></div></div></div></div></div></div></section>'),e.put("app/components/header/header.html",'<div class="header"><nav class="navbar navbar-inverse navbar-fixed-top"><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="#"><img alt="Brand" src="/assets/images/logo.png" style="max-height:50px;"></a></div><div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" ng-if="vm.showMenu"><ul class="nav navbar-nav navbar-right"><li><a href="#datasource"><span class="glyphicon glyphicon-th"></span>Data Sources</a></li><li><a href="" ng-click="vm.logoutClick()"><span class="glyphicon glyphicon-user"></span>Logout</a></li></ul></div></div><div class="nav-divider"></div></nav></div><a href="https://github.com/FredHutch/Oncoscape/labels/help%20wanted" class="github" tooltip="Submit Issues" style="text-align: right;"><div class="logo"><svg aria-hidden="true" class="octicon octicon-mark-github" height="28" role="img" version="1.1" viewbox="0 0 16 16" width="28"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59 0.4 0.07 0.55-0.17 0.55-0.38 0-0.19-0.01-0.82-0.01-1.49-2.01 0.37-2.53-0.49-2.69-0.94-0.09-0.23-0.48-0.94-0.82-1.13-0.28-0.15-0.68-0.52-0.01-0.53 0.63-0.01 1.08 0.58 1.23 0.82 0.72 1.21 1.87 0.87 2.33 0.66 0.07-0.52 0.28-0.87 0.51-1.07-1.78-0.2-3.64-0.89-3.64-3.95 0-0.87 0.31-1.59 0.82-2.15-0.08-0.2-0.36-1.02 0.08-2.12 0 0 0.67-0.21 2.2 0.82 0.64-0.18 1.32-0.27 2-0.27 0.68 0 1.36 0.09 2 0.27 1.53-1.04 2.2-0.82 2.2-0.82 0.44 1.1 0.16 1.92 0.08 2.12 0.51 0.56 0.82 1.27 0.82 2.15 0 3.07-1.87 3.75-3.65 3.95 0.29 0.25 0.54 0.73 0.54 1.48 0 1.07-0.01 1.93-0.01 2.2 0 0.21 0.15 0.46 0.55 0.38C13.71 14.53 16 11.53 16 8 16 3.58 12.42 0 8 0z"></path></svg></div></a>'),e.put("app/components/help/help.html",'<section class="tools container"><div class="row"><div class="col-sm-8 col-md-6"><br><br><br></div></div><div class="row"><div class="col-xs-12 col-md-7"><h2 style="margin:0px;margin-bottom: 20px;">Now Playing &mdash; Lorum Ipsum</h2><div style="background-color:#000;text-align: center;"><video width="640" height="360" controls="" style="background-color: #000;max-width: 100%;"></video></div><h2>Video Title</h2><p>Transcription At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat</p></div><div class="col-xs-12 col-md-5" style="padding-left: 40px;"><h2 style="margin:0px;">Oncoscape Videos</h2><ul><li ng-repeat="video in vm.videos" style="clear: both;"><div style="width:30%;height:90px;background-color:#EEE;display:inline-block;float:left;margin-bottom: 20px;text-align: center;cursor: pointer;"><span class="glyphicon glyphicon-play-circle" style="font-size: 30px;padding-top:30px; color:#FFF"></span></div><div style="width:69%;display: inline-block;float:left;padding-left: 10px;"><h3 class="tools-lbl" style="margin:0px;">{{video.name}}</h3><p>{{video.desc}}</p><a href="" ng-click="vm.explore(tool.route, vm.datasource)">Watch Video</a></div></li></ul></div></div></section>'),e.put("app/components/landing/landing.html",'<div class="landing container"><div class="row" style="padding-top:20px;"><h2>Bridging Cancer Research and Clinical Care</h2></div><div class="row" style="padding-top:20px;"><div class="col-sm-8"><p>Oncoscape is developed at the Fred Hutchinson Cancer Research Center under the auspices of the Solid Tumor Translational Research initiative. Oncoscape is a web-based, menu-driven analysis and visualization platform for large-scale, heterogeneous clinical and molecular patient timeline data as exemplified by the Fred Hutch HIDRA database. Oncoscape vision and development is managed by a small team comprising: <a href="https://www.fredhutch.org/en/labs/profiles/holland-eric.html">Eric Holland</a>, <a href="http://www.sttrcancer.org/en/contact-us/horse-grant-bio.html">Desert Horse-Grant</a>, <a href="https://www.linkedin.com/in/lisa-mcferrin-9758b029">Lisa McFerrin</a>, <a href="https://www.linkedin.com/in/hbolouri">Hamid Bolouri</a>, <a href="https://www.linkedin.com/in/jenny-zhang-ba62a2104">Jenny Zhang</a>, <a href="https://www.linkedin.com/in/gretchenh">Gretchen Heinrich</a>, <a href="https://www.linkedin.com/in/robert-mcdermott-a77b9011">Robert McDermott</a> and <a href="https://www.linkedin.com/in/zager">Michael Zager</a>.</p><p class="">Through its easy point-and-click browser interface, Oncoscape will become an essential tool for doctors and researchers interested in:</p><ul class=""><li>Comparing patients or populations across an array of features, like genetic alterations (CNV, IHC, sequencing, expression) or clinical elements (treatment regimens, diagnostics, outcomes)</li><li>Defining cohorts based on selected traits – identifying “patients like me”</li><li>Aligning patient histories according to timeline events: diagnosis, treatment, progression, survival</li><li>Performing powerful and integrated statistical analysis: Principle Component Analysis, Partial least squares regression, Kaplan-Meier curves, enrichment scores</li><li>Creating high quality visualizations of molecular/clinical data</li></ul><p class="">By providing a portal equipped with rich data, powerful statistics and a simple interface, Oncoscape not only empowers users to quickly answer questions themselves but also expedites the process of discovering novel patterns and relationships. This can lead to numerous possible findings, including optimized drug therapies for individual patients, identification of novel regulatory pathways, or even the need to reassess adherence strategies.</p></div><div class="col-sm-4"><os-login></os-login></div></div></div>'),e.put("app/components/history/history.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortPatient()"></os-tool-menu><os-tray caption="Patients" content="tray-content-block"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Filters</h2></div><div class="col-xs-12 form-item"><label>Age At Diagnosis</label><div range-slider="" min="vm.diagnosisMinValue" model-min="vm.diagnosisMin" max="vm.diagnosisMaxValue" model-max="vm.diagnosisMax" show-values="true" attach-handle-values="true" on-handle-up="vm.applyFilter(\'Diagnosis\')"></div></div><div class="col-xs-12 form-item"><label>Survival</label><div range-slider="" min="vm.survivalMinValue" model-min="vm.survivalMin" max="vm.survivalMaxValue" model-max="vm.survivalMax" show-values="true" attach-handle-values="true" on-handle-up="vm.applyFilter(\'Survival\')"></div></div><div class="col-xs-12 form-item"><label>Export (beta)</label><div><button class="btn btn-default" ng-click="vm.exportCsv()">Excel (CSV)</button></div></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Patient Data</h2><h3 class="h3-datasource">{{vm.datasource.name}} {{vm.datasource.source}}</h3><table id="history-datatable" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%"></table></div></section>'),e.put("app/components/loader/loader.html",'<div class="loader-modal"><div class="loader"><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__ball"></div></div></div>'),e.put("app/components/login/login.html",'<form class="login"><h3 class="login-header">Login</h3><div class="login-body"><div class="alert alert-danger" role="alert" ng-show="vm.hasError"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> <span class="sr-only">Error:</span> Invalid Credentials</div><fieldset class="form-group"><span for="domain" class="small">Affiliation</span><select id="domain" class="form-control" ng-options="option.name for option in vm.domains track by option.name" ng-model="vm.user.domain"></select></fieldset><fieldset class="form-group" ng-show="vm.user.domain.name!=\'Guest\'"><span class="form-control-label small" for="username">Username</span> <input id="username" class="form-control input-sm" type="text" placeholder="Username" ng-model="vm.user.name"></fieldset><fieldset class="form-group" ng-show="vm.user.domain.name!=\'Guest\'"><span class="form-control-label small" for="password">Password</span> <input id="password" class="form-control" type="password" placeholder="Password" ng-model="vm.user.password"></fieldset><button class="btn btn-default" ng-click="vm.login()">Login</button></div></form>'),e.put("app/components/markers/markers.html",'<os-tool-menu datasource="{{vm.datasource}}"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize()"><section class="tray-content"><div class="row"><br><div class="col-xs-12 form-item"><label>Patient Selection</label><div ng-repeat="item in vm.legendNodes" class="legend-bar" style="border-color:{{item.color}};position:relative;background-color:#FFF;padding:2px 10px;line-height:25px;">{{item.name}}</div></div><div class="col-xs-12 form-item"><label>Edge Visibility</label><div ng-repeat="item in vm.optEdgeColors" class="legend-bar" style="border-color:{{item.color}};position:relative;background-color:#FFF;padding:2px 10px;line-height:25px;">{{item.name}} <label class="switch {{item.class}}" style="float:right"><input type="checkbox" class="switch-input" ng-model="item.show" ng-change="vm.edgeToggle(item)"> <span class="switch-label" data-on="On" data-off="Off"></span> <span class="switch-handle"></span></label></div></div><div class="col-xs-12 form-item" ng-if="vm.optCommandMode.name==\'Sequential\'"><label>Commands</label><br><a ng-click="vm.cmd(\'ShowSelectedEdges\')" class="markers-command hvr-sweep-to-right">Show Edges of Selected</a> <a ng-click="vm.cmd(\'HideSelectedEdges\')" class="markers-command hvr-sweep-to-right">Hide Edges of Selected</a> <a ng-click="vm.cmd(\'HideUnselectedEdges\')" class="markers-command hvr-sweep-to-right">Hide Edges of Unselected</a> <a ng-click="vm.cmd(\'HideAllEdges\')" class="markers-command hvr-sweep-to-right">Hide All Edges</a> <a ng-click="vm.cmd(\'SelectInverse\')" class="markers-command hvr-sweep-to-right">Invert Node Selection</a> <a ng-click="vm.cmd(\'SelectConnected\')" class="markers-command hvr-sweep-to-right">Select Connected Nodes</a> <a ng-click="vm.cmd(\'HideUnselectedNodes\')" class="markers-command hvr-sweep-to-right">Hide Unselected Nodes</a> <a ng-click="vm.cmd(\'ShowAllNodes\')" class="markers-command hvr-sweep-to-right">Show All Nodes</a></div><div class="col-xs-6 form-item" style="padding-right:5px"><label>Command Mode</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="padding-right:30px;">{{vm.optCommandMode.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optCommandModes" ng-click="vm.optCommandMode=item">{{item.name}}</li></ul></div></div><div class="col-xs-6 form-item" style="padding-left:5px"><label>Gene Set</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="padding-right:30px;">{{vm.optGeneSet.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optGeneSets" ng-click="vm.optGeneSet=item">{{item.name}}</li></ul></div></div><div class="col-xs-6 form-item" style="padding-right:5px"><label>Patient Layout</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="padding-right:30px;">{{vm.optPatientLayout.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optPatientLayouts" ng-click="vm.optPatientLayout=item">{{item.name}}</li></ul></div></div><div class="col-xs-6 form-item" style="padding-left:5px"><label>Patient Color</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="padding-right:30px;">{{vm.optPatientColor.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optPatientColors" ng-click="vm.optPatientColor=item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item" style="padding-left:5px"><label>Lock Selections</label><div class="btn-group" role="group" style="display: block"><button class="btn btn-default btn-no-focus" type="button" ng-click="vm.lock(\'patient\')" style="width:50%; font-weight: 300;" title="Patient Selection Lock"><i class="fa fa-unlock" ng-show="!vm.lockPatients"></i> <i class="fa fa-lock" ng-show="vm.lockPatients"></i> Patients</button> <button class="btn btn-default btn-no-focus" type="button" ng-click="vm.lock(\'gene\')" style="width:50%; font-weight: 300;" title="Gene Selection Lock"><i class="fa fa-unlock" ng-show="!vm.lockGenes"></i> <i class="fa fa-lock" ng-show="vm.lockGenes"></i> Genes</button></div></div><div class="col-xs-12 form-item" style="padding-left:5px"><label>Zoom</label><div class="btn-group" role="group" style="display: block"><button class="btn btn-default btn-no-focus" type="button" ng-click="vm.zoom.reset()" style="width:50%; font-weight: 300;" title="Zoom Reset">Reset</button> <button class="btn btn-default btn-no-focus" type="button" ng-click="vm.zoom.fit()" style="width:50%; font-weight: 300;" title="Zoom Selection">Selected</button></div></div><div class="col-xs-12 form-item"><label>Search</label> <input type="text" class="form-control" ng-model="vm.search" placeholder="Genes or Patients"></div></div></section></os-tray><section class="tray-content-block"><div id="markers-chart" class="markers-chart"></div><div style="position:absolute;top:10px;left:50px;"><h2 class="h2-tool">Patients + Markers</h2><h3 class="h3-datasource">{{vm.datasource.name}} {{vm.datasource.source}}</h3></div></section><div id="modalEdge" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-body"><h2 style="margin-top:0px;">Your request would add {{vm.edgeCounts.total}} edges to the graph.</h2><p>To improve performance + readability you may want to disable some of the edges.</p><div class="input-group" ng-repeat="item in vm.optEdgeColors | filter:{show:true}"><label class="switch {{item.class}}"><input type="checkbox" class="switch-input" ng-model="item.show"> <span class="switch-label" data-on="On" data-off="Off"></span> <span class="switch-handle"></span></label> <span style="padding-left:20px;">{{item.name}} ({{vm.edgeCounts[item.abv]}})</span></div></div><button class="btn btn-default" style="position:absolute;right:10px;bottom:10px;" ng-click="vm.filterModelEdge()">Continue</button></div></div></div><div class="tray tray-right" ng-if="vm.detail.show"><h2>{{vm.detail.title}}</h2><dl><dl class="markers-dl" ng-bind-html="vm.detail.html"></dl></dl></div>'),e.put("app/components/metadata/metadata.html",'<os-tool-menu datasource="{{vm.datasource}}"></os-tool-menu><os-tray caption="Patients" content="tray-content-block"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Search</h2></div><div class="col-xs-12 form-item"><input type="text" class="ngrs-range-slider ngrs-range-slider-no-pad" style="width:100%" ng-model="vm.search"></div><div class="col-xs-12 form-label"><h2>Information</h2><label>Raw data was provided by <a href="http://cancergenome.nih.gov/">The Cancer Genome Atlas</a>. Processing of data was conducted by the <a href="http://www.sttrcancer.org/en.html">Solid Tumor Translational Research Organization</a> in conjuntion with the <a href="http://www.fhcrc.org">Fred Hutchinson Cancer Research Center</a>, <a href="http://www.uwmedicine.org/">UW Medicine</a> and <a href="http://www.scca.org">The Seattle Cancer Care Alliance</a>.</label></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">{{vm.dataset}} Metadata</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><table id="metadata-datatable" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%"><thead><tr><th ng-repeat="col in vm.colnames">{{col}}</th></tr></thead><tbody><tr ng-repeat="row in vm.rows"><td ng-repeat="datum in row track by $index">{{datum}}</td></tr></tbody></table></div></section>'),e.put("app/components/oncoprint/oncoprint.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortPatient()"></os-tool-menu><os-tray content="tray-content-block"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Cohorts</h2></div><div class="col-xs-12 form-label"><h2>Legend</h2><span class="legend"></span> <span class="oncoprint-label-col1" id="legend"></span></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><div id="oncoprintDiv" class="oncoprint"><div id="oncoprintInstructions" style="font-size:150%">Please select and send up to 350 genes and patients from another tab, such as Markers and Patients, to populate the display.</div><div id="oncoprintErrorSection" style="font-size:150%" ng-show="vm.errorMessage!=\'\'">{{vm.errorMessage}}</div><div id="oncoprintControlsDiv"><div id="onc"></div><button id="toggle_whitespace">Toggle Whitespace</button> <button id="reduce_cell_width">Reduce Cell Width</button></div></div></div></section>'),e.put("app/components/pathways/pathways.html",'<os-tool-menu></os-tool-menu><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Options</h2></div><div class="col-xs-12 form-item"><label>Search</label> <input type="text" class="form-control" ng-model="vm.search"></div><div class="col-xs-12 form-label"><h2>Legend</h2><span class="legend-bar" style="border-color: green">Activation</span> <span class="legend-bar" style="border-color: red">Inhibition</span> <span class="legend-bar" style="border-color: #38347B">Modification</span> <span class="legend-bar" style="border-color: #056ce1">Genes</span></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Pathways</h2><h3 class="h3-datasource">{{vm.datasource.name}} {{vm.datasource.source}}</h3><div id="gbm-chart" class="pathways-chart"></div></div></section><div class="modal fade pathways" id="gbm-webpage" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">{{vm.tip}}</h4></div><iframe class="modal-iframe" ng-src="{{vm.frame}}"></iframe></div></div></div>'),
e.put("app/components/pca/pca.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortPatient()"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Filters</h2></div><div class="col-xs-12 form-item"><label>Gene Set</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.geneSet}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li ng-repeat="item in vm.geneSets" ng-click="vm.geneSet=item">{{item}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Search</label> <input type="text" class="ngrs-range-slider" style="width: 100%;" ng-model="vm.search"></div><div class="col-xs-6 form-label"><h2>Legend</h2><span class="circle" style="background-color:black;width:10px;height: 10px;margin-right:10px;"></span>Patients</div><div class="col-xs-6 form-label"><h2>Variance</h2>PC1: {{vm.pc1}}%<br>PC2: {{vm.pc2}}%</div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Principal Component Analysis</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div id="pca-chart" class="pca"></div></div></section>'),e.put("app/components/pca3d/pca3d.html",'<section id="pca-chart" class="pca container-fluid" style="position: absolute;left:0px;top:0px;right: 0px;bottom: 0px;padding:0px;margin:0px;overflow: hidden;"></section>'),e.put("app/components/plsr/plsr.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortGene()"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Filters</h2></div><div class="col-xs-12 form-item"><label>Gene Set</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.geneSet}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li ng-repeat="item in vm.geneSets" ng-click="vm.geneSet=item">{{item}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Age At Diagnosis</label><div range-slider="" min="vm.deathMinValue" model-min="vm.deathMinFilter" max="vm.deathMaxValue" model-max="vm.deathMaxFilter" prevent-equal-min-max="true" show-values="true" attach-handle-values="true" on-handle-up="vm.update()"></div></div><div class="col-xs-12 form-item"><label>Survival</label><div range-slider="" min="vm.survivalMinValue" model-min="vm.survivalMinFilter" max="vm.survivalMaxValue" model-max="vm.survivalMaxFilter" prevent-equal-min-max="" show-values="true" attach-handle-values="true" on-handle-up="vm.update()"></div></div><div class="col-xs-12 form-label"><h2>Legend</h2><span class="legend-bar" style="border-color: #1396de">Age At Diagnosis</span> <span class="legend-bar" style="border-color: #38347b">Survial</span> <span class="legend"><span class="legend-dot" style="background-color:#000"></span>Genes</span></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Partial Least Squares Regression</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div id="plsr-chart" class="plsr"></div></div></section><div class="modal fade plsr-webpage" id="plsr-webpage" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">{{vm.tip}}</h4></div><iframe class="modal-iframe" ng-src="{{vm.frame}}"></iframe></div></div></div>'),e.put("app/components/subnav/subnav.html",'<div class="subnav"><div class="btn-group" style="float:right"><button type="button" class="btn btn-primary" ng-click="vm.toolsClick()">Analysis Tools</button> <button type="button" class="btn btn-primary" ng-click="vm.cohortClick()">Cohorts</button></div><h2>{{vm.tool}} &mdash; {{vm.filter}}</h2></div>'),e.put("app/components/summary/summary.html",'<div class="summary"></div>'),e.put("app/components/survival/survival.html",'<os-tool-menu datasource="{{vm.datasource}}"></os-tool-menu><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Patient Survival</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div style="text-align: center;"><img id="survival-img" style="width:100%; height: auto; margin:auto;"></div></div></section>'),e.put("app/components/timelines/timelines.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortPatient()"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Options</h2></div><div class="col-xs-12 form-item"><label>Align By</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.align.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.events" ng-click="vm.align = item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Order By</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.sort.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.features" ng-click="vm.sort = item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Filter</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.filter.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.filters" ng-click="vm.filter = item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Timescale</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.timescale.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.timescales" ng-click="vm.timescale=item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Event Colors</label> <span ng-repeat="item in vm.events" class="legend-bar btn btn-default filter-button {{item.color}}" ng-style="{\'border-color\':item.color}" ng-click="vm.updateEventColor(item); $event.stopPropagation();">{{item.name}} ({{item.selected ? \'Visible\' : \'Hidden\'}})</span></div><div class="col-xs-12 form-item"><label>Selected Patients Display</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.optCohortMode.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optCohortModes" ng-click="vm.optCohortMode=item">{{item.name}}</li></ul></div></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Timelines</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div id="timelines-chart"></div></div><div class="timeline-hover" ng-if="vm.selShow"><dl><dt>Event</dt><dd>{{vm.selEvent}}</dd></dl><dl><dt>Patient Id</dt><dd>{{vm.selPatient}}</dd></dl><dl ng-repeat="item in vm.selFields"><dt>{{item.name}}</dt><dd>{{item.value}}</dd></dl></div></section>'),e.put("app/components/toolmenu/toolmenu.html",'<div><label class="tray-label tray-label-left">Tools</label><section class="tool-menu tray tray-collapsed-left"><div class="row"><div class="col-xs-12 form-label"><h2>Tools</h2></div></div><div class="row tool-menu-row" ng-repeat="tool in vm.tools"><a href="" ng-click="vm.explore(tool.route)"><img class="tool-menu-img" ng-src="/assets/images/datasets/{{tool.img}}"> <span class="tool-menu-lbl">{{tool.name}}</span> <span class="tool-menu-beta" ng-if="tool.beta" style="color:red">(Beta)</span></a></div></section></div>'),e.put("app/components/tools/tools.html",'<section class="tools container-fluid"><div class="row"><div class="col-sm-8 col-md-6"><h1>Analysis Tools</h1></div></div><div class="row"><ul><li ng-repeat="tool in vm.tools" class="col-xs-12 col-sm-6 col-md-4 col-lg-3" ng-click="vm.explore(tool.route, vm.datasource)"><img class="tools-img" ng-src="/assets/images/datasets/{{tool.img}}"><div class="tools-copy"><h3 class="tools-lbl">{{tool.name}}</h3><a href="">Explore</a></div></li></ul></div></section>'),e.put("app/components/tray/tray.html",'<div><label class="tray-label tray-label-right">Options</label><div class="tray {{vm.trayClass}} tray-right" locked="true"><ng-transclude></ng-transclude><i class="fa fa-lock tray-sticky-icon {{vm.iconClass}}" ng-click="vm.toggle()"></i></div></div>')}]);
//# sourceMappingURL=../maps/scripts/app-f94cb347bd.js.map
