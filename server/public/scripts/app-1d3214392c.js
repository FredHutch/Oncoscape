!function(){"use strict";angular.module("oncoscape",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngMessages","ngAria","ngResource","ui.router","ui.bootstrap","ui-rangeSlider","ui.bootstrap.contextMenu","toastr"])}(),function(){"use strict";function e(){function e(e){var t=this;t.trayClass=Math.random().toString(36).substring(3),t.iconClass=Math.random().toString(36).substring(3);var n=!0;t.toggle=function(){var i=angular.element("."+t.trayClass),r=angular.element("."+t.iconClass),s=angular.element("."+t.content);n=!n,r.addClass(n?"fa-lock":"fa-unlock-alt").removeClass(n?"fa-unlock-alt":"fa-lock"),i.attr("locked",n?"true":"false"),n?(s.removeClass("tray-content-block-collapsed"),i.unbind("mouseover",a).unbind("mouseout",o).removeClass("tray-collapsed"),e(function(){t.change()})):(s.addClass("tray-content-block-collapsed"),i.addClass("tray-collapsed").bind("mouseover",a).bind("mouseout",o),e(function(){t.change()}))};var a=function(){angular.element("."+t.trayClass).removeClass("tray-collapsed")},o=function(){angular.element("."+t.trayClass).addClass("tray-collapsed")}}e.$inject=["$timeout"];var t={restrict:"E",templateUrl:"app/components/tray/tray.html",scope:{caption:"@",content:"@",change:"&"},controller:e,controllerAs:"vm",bindToController:!0,replace:!0,transclude:!0};return t}angular.module("oncoscape").directive("osTray",e)}(),function(){"use strict";function e(){function e(e,t,n){if(angular.isUndefined(n.datasource))return void t.go("datasource");var a=this;a.datasource=n.datasource,a.tools=[{name:"Markers + Patients",route:"markers",img:"markers.png",copy:"Link copy number variation and mutation data to patients."},{name:"Timelines",route:"timelines",img:"timelines.png",copy:""},{name:"Pathways",route:"pathways",img:"pathways.png",copy:"Map patient specific expression levels on a hand curated network of genes."},{name:"PLSR",route:"plsr",img:"plsr.png",copy:"Use linear regression to correlate genes with clinical features using RNA expression."},{name:"PCA",route:"pca",img:"pca.png",copy:"Two dimensional view of per sample expression data."},{name:"Survival",route:"survival",img:"survival.png",copy:"Compare survival rates of selected patients against the remaining population in a Kaplan Meier plot."},{name:"Patient Data",route:"history",img:"history.png",copy:""},{name:"Oncoprint",route:"oncoprint",img:"metadata.png",copy:""},{name:"MetaData",route:"metadata",img:"metadata.png",copy:""}],a.explore=function(e,n){t.go(e,{datasource:n})}}e.$inject=["osApi","$state","$stateParams"];var t={restrict:"E",templateUrl:"app/components/tools/tools.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osTools",e)}(),function(){"use strict";function e(){function e(e,t){var n=function(){angular.element(".tool-menu").removeClass("tray-collapsed-left")},a=function(){angular.element(".tool-menu").addClass("tray-collapsed-left")},o=angular.element(".tool-menu");o.bind("mouseover",n).bind("mouseout",a);var i=this;i.tools=[{name:"Markers + Patients",route:"markers",img:"markers.png",copy:"Link copy number variation and mutation data to patients."},{name:"Timelines",route:"timelines",img:"timelines.png",copy:""},{name:"Pathways",route:"pathways",img:"pathways.png",copy:"Map patient specific expression levels on a hand curated network of genes."},{name:"PLSR",route:"plsr",img:"plsr.png",copy:"Use linear regression to correlate genes with clinical features using RNA expression."},{name:"PCA",route:"pca",img:"pca.png",copy:"Two dimensional view of per sample expression data."},{name:"Survival",route:"survival",img:"survival.png",copy:"Compare survival rates of selected patients against the remaining population in a Kaplan Meier plot."},{name:"Patient Data",route:"history",img:"history.png",copy:""},{name:"Oncoprint",route:"oncoprint",img:"history.png",copy:""},{name:"MetaData",route:"metadata",img:"metadata.png",copy:""}],i.explore=function(e){i.change(),t.go(e,{datasource:i.datasource})}}e.$inject=["osApi","$state"];var t={restrict:"E",templateUrl:"app/components/toolmenu/toolmenu.html",controller:e,controllerAs:"vm",scope:{datasource:"@",change:"&"},bindToController:!0};return t}angular.module("oncoscape").directive("osToolMenu",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,r,s){if(angular.isUndefined(a.datasource))return void t.go("datasource");var l,c,d,u,p,h=0,g=this;g.selShow=!1,g.selPatient,g.selEvent,g.selFields=[],g.datasource=a.datasource,g.optCohortPatients,g.optCohortPatient,g.optCohortModes,g.optCohortMode,g.timescaleunit,g.timescales,g.timescale,g.features,g.feature,g.filters,g.filter,g.events,g.sorts,g.sort,g.align;var m,f,v=angular.element("#timelines-chart"),b=s.select("#timelines-chart").append("svg").attr("id","chart").style({width:"100%"}),y=b.append("g").attr({"class":"axis"}).style({"shape-rendering":"crispEdges","stroke-width":"1.0",stroke:"#000",fill:"none"}),w=b.append("svg").attr({"class":"bars-svg"}),_=w.append("rect").attr({width:v.width(),height:o.innerHeight-75-10-130-50}).style({fill:"#FFFFFF"}),C=w.append("g").attr({"class":"bars"}),x=function(){if(!s.event.shiftKey){var e=h*s.event.scale;h>e&&(e=h);var t=s.event.translate[1],n=o.innerHeight-75-10-130-50,a=20*l.patients.length*e,i=n-a;t>0&&(t=0),i>t&&(t=i),m.translate([s.event.translate[0],t]);var r=20*e,c=n/r,d=Math.abs(t/r);f.y(s.scale.linear().range([0,n]).domain([d,d+c])),C.attr("transform","translate(1,"+t+")scale(1,"+e+")")}},k=function(){s.event.shiftKey||(s.event.target.clear(),s.select(this).call(s.event.target))},T=function(){var e=f.extent(),t=Math.floor(e[0][1]),n=Math.floor(e[1][1]);C.selectAll("g.timeline").each(function(e,a){var o=s.select(this.firstChild);o.classed("timeline-selected",a>=t&&n>=a)})},S=function(){s.event.target.clear(),s.select(this).call(s.event.target)},E=function(){var e=20,t=o.innerHeight-75-10-130,a=o.innerWidth-300;a>760&&(a-=140),"false"==angular.element(".tray-right").attr("locked")&&(a+=300),l=P(c,g.align,g.sort),u=s.scale.linear().domain(l.bounds).range([10,a-10]).nice(),p=s.scale.linear().domain([0,l.patients.length]).range(0,t-50).nice(),h=(t-50)/(20*l.patients.length),b.attr({height:t+"px"}),w.attr({height:t-50+"px",width:a+"px"}),_.attr({height:t-50+"px",width:a+"px"}),C.attr("transform","scale(1,"+h+")");var i=C.selectAll("g.timeline").data(l.patients);i.exit().remove(),i.enter().append("g").attr({"class":"timeline"}).on("mousedown",function(){s.event.shiftKey||C.selectAll(".timeline-selected").classed("timeline-selected",!1)}).attr({width:a,height:e,transform:function(t,n){return"translate(0,"+n*e+")"}}).append("rect").attr({"class":"timeline-row",width:0,height:e}),"Highlight"==g.optCohortMode.name&&"*"!=g.optCohortPatient.ids?i.each(function(e){var t=g.optCohortPatient.ids.indexOf(e.id)>=0,n=s.select(this.firstChild);n.classed("timeline-selected",t)}):i.each(function(){var e=s.select(this.firstChild);e.classed("timeline-selected",!1)});var r=i.selectAll("rect.event").data(function(e){return e.filteredEvents});r.exit().remove(),r.enter().append("rect").attr({"class":"event"}).on("mouseover",function(){var e=d[this.__data__.id];g.selPatient=e.PatientID,g.selEvent=e.Name;var t=[];for(var a in e.Fields)null!=e.Fields[a]&&("date"==a&&angular.isArray(e.Fields[a])?(t.push({name:"Start Date",value:e.Fields[a][0]}),t.push({name:"End Start",value:e.Fields[a][1]})):t.push({name:a,value:e.Fields[a]}));g.selShow=!0,g.selFields=t,n.$apply()}).on("mouseout",function(){g.selShow=!1,n.$apply()}),r.transition().style({fill:function(e){return e.color}}).attr({height:function(t){return"Radiation"==t.name||"Drug"==t.name?e/2:e},width:function(e){return null==e.endValue?3:u(e.endValue)-u(e.startValue)},x:function(e){return Math.round(u(e.startValue))},y:function(t){return"Radiation"==t.name?e/2:0}});var v=function(e){return 0==Math.abs(e)?e:Math.abs(e)<30?e+" Days":Math.abs(e)<360?Math.round(e/30.4*10)/10+" Months":Math.round(e/365*10)/10+" Years"},E=s.svg.axis().scale(u).orient("bottom").ticks(8);E="Log"==g.timescale.name?E.tickFormat(function(e){return v(Math.round((0>e?-1:1)*(Math.pow(2,Math.abs(e))-1)*100)/100)}):E.tickFormat(function(e){return v(e)}),f=s.svg.brush().x(u).y(s.scale.linear().range([0,t]).domain([0,l.patients.length])).on("brush",T).on("brushstart",k).on("brushend",S),_.call(f),_.on("mousedown",function(){s.event.shiftKey||C.selectAll(".timeline-selected").classed("timeline-selected",!1)}),m=s.behavior.zoom().x(u).y(p).translate([0,0]).scale(1,h).on("zoom",x),_.call(m),y.attr({"class":"timeline-axis",width:100,transform:function(){return"translate(0,"+(t-50)+")"}}),y.call(E)},P=function(e,t,n){var a={};return a.events=g.events.filter(function(e){return e.selected}),a.patients=e.filter(function(e){return"Only Alive"==g.filter.name&&e.dead?!1:("Only Dead"!=g.filter.name||e.dead)&&e.hasOwnProperty("__"+this.align)?this.filter&"*"!==this.ids&&-1==this.ids.indexOf(e.id)?!1:!0:!1},{align:t.name,filter:"Filter"==g.optCohortMode.name,ids:g.optCohortPatient.ids}),"Survival"==n.name?a.patients=a.patients.sort(function(e,t){return e.dead==t.dead?e.calcEvents[n.index].value>t.calcEvents[n.index].value?1:-1:e.dead?1:-1},n):a.patients=a.patients.sort(function(e,t){return e.calcEvents[n.index].value>t.calcEvents[n.index].value?1:-1},n),a.patients.forEach(function(e){e.filteredEvents=e.dateEvents.filter(function(e){for(var t=0;t<this.length;t++)if(this[t].name==e.name)return!0;return!1},a.events),e.filteredEvents.forEach(function(e){e.startValue=g.timescale.timeFn(e.start+this),e.endValue=null!=e.end?g.timescale.timeFn(e.end+this):null},-e["__"+this.align.name].start)},{align:t,events:a.events}),a.bounds=a.patients.reduce(function(e,t){var n=t.filteredEvents.reduce(function(e,t){return[Math.min(t.startValue,e[0]),Math.max(null==t.endValue?t.startValue:t.endValue,e[1])]},[1/0,-(1/0)]);return[Math.min(n[0],e[0]),Math.max(n[1],e[1])]},[1/0,-(1/0)]),a};!function(){var t=function(e){var t=e.name,n="Birth"===t?"#17becf":"Diagnosis"===t?"#8c564b":"Pathology"===t?"#7f7f7f":"Progression"===t?"#1f77b4":"Absent"===t?"#000000":"Status"===t?"#bcbd22":"Radiation"===t?"#e7969c":"Procedure"===t?"#ff7f0e":"Encounter"===t?"#d62728":"Drug"===t?"#9467bd":"black";return n},a=function(e){return Object.keys(e).map(function(e){var n={name:e,selected:!0};return n.color=n.__color=t(n),n})},i=function(e){return e[0].calcEvents.map(function(e,t){return{name:e.name,index:t}})},s=function(e,n){e=Object.keys(e).map(function(t){var n=e[t];return n.id=t,n});for(var a=0;a<e.length;a++){var o=e[a],i=r,s="YYYY-MM-DD",l=o.dateEvents.filter(function(e){return"single"===e.eventOrder}).map(function(e){return{start:i(e.date,s).unix(),end:null,name:e.name,id:e.eventID}}),c=o.dateEvents.filter(function(e){return"end"===e.eventOrder}).map(function(e){return{end:i(e.date,s).unix(),id:e.eventID}}),d=o.dateEvents.filter(function(e){return"start"===e.eventOrder}).map(function(e){return{start:i(e.date,s).unix(),name:e.name,id:e.eventID}});d.forEach(function(e){e.end=c.filter(function(t){return t.id==e.id})[0].end}),o.dateEvents=d.length>0?d.concat(l):l,o.dateEvents.forEach(function(e){e.color=t(e),o["__"+e.name]=e,"Status"==e.name&&(o.dead=-1!=n.indexOf(e.id))})}return e};e.setBusy(!0)("Loading Dataset"),e.setDataset(g.datasource).then(function(){e.getTimelines().then(function(t){g.timescales=[{name:"Log",timeFn:function(e){return(0>e?-1:1)*Math.log(Math.abs(1e3*e/864e5)+1)/Math.log(2)}},{name:"Linear",timeFn:function(e){return r.duration(1e3*e).asDays()}}],g.timescale=g.timescales[0],c=s(t.payload.pts,t.payload.eventTypes.Status.status.Dead),d=t.payload.events,g.sorts=i(c),g.filters=[{name:"Alive + Dead"},{name:"Only Alive"},{name:"Only Dead"}],g.filter=g.filters[0];var l=i(c);l.unshift({index:-1,name:"None"}),g.features=l,g.feature=g.features[0],g.events=a(t.payload.eventTypes),g.sort=g.sorts[1],g.events.forEach(function(e){"Birth"==e.name&&(e.selected=!1,e.color="#FEFEFE"),"Diagnosis"==e.name&&(this.align=e)},g),n.$watchGroup(["vm.feature","vm.sort","vm.align","vm.timescale","vm.filter"],E),angular.element(o).bind("resize",E),A(g,e),E(),e.setBusy(!1)})})}();var A=function(e,t){var a=t.getCohortPatient();e.optCohortModes=[{name:"Highlight"},{name:"Filter"}],e.optCohortMode=e.optCohortModes[1],e.optCohortPatients=a.get(),e.optCohortPatient=e.optCohortPatients[0],e.addCohortPatient=function(){var t="TL "+r().format("- H:mm - M/D/YY"),n=C.selectAll(".timeline-selected")[0].map(function(e){return e.__data__.id}),o={name:t,ids:n};0!=n.length&&(a.add(o),e.optCohortPatient=o)},n.$watch("vm.optCohortMode",E),n.$watch("vm.optCohortPatient",E)};g.resize=function(){E()},g.updateEventColor=function(e){e.selected=!e.selected,e.color=e.selected?e.__color:"#FEFEFE",E()}}e.$inject=["osApi","$state","$scope","$stateParams","$window","$document","moment","d3"];var t={restrict:"E",templateUrl:"app/components/timelines/timelines.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osTimelines",e)}(),function(){"use strict";function e(){function e(e){var t=this;t.message="Robert",t.datasets=[],e.setBusy(!0),e.getDataSetNames().then(function(n){t.datasets=n.payload.datasets,e.setBusy(!1)})}e.$inject=["osApi"];var t={restrict:"E",templateUrl:"app/components/test/test.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osTest",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o){function i(t){e.setBusy(!0),e.getCalculatedSurvivalCurves(t,"").then(function(t){angular.element("#survival-img").attr("src",t.payload),e.setBusy(!1)})}if(angular.isUndefined(o.datasource))return void t.go("datasource");var r,s=e.getCohortPatient(),l=this;l.datasource=o.datasource,l.optCohortPatients=s.get(),l.optCohortPatient=l.optCohortPatients[0],a.$watch("vm.optCohortPatient",function(){var e=l.optCohortPatient.ids;if("*"==e)e=r;else{var t=l.optCohortPatient.ids;null!=r&&(e=r.filter(function(e){return t.indexOf(e)>=0}),i(e))}}),e.setBusy(!0),e.setDataset(l.datasource).then(function(){e.getPatientHistoryTable(l.datasource).then(function(e){r=e.payload.tbl.map(function(e){return e[0]});var t="*"==l.optCohortPatient.ids?r:l.optCohortPatient.ids;i(t)})})}e.$inject=["osApi","$state","$timeout","$scope","$stateParams"];var t={restrict:"E",templateUrl:"app/components/survival/survival.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osSurvival",e)}(),function(){"use strict";function e(){function e(e,t){var n=this;n.tool="Pathways",n.filter="DemoDZ",n.toolsClick=function(){t.go("tools",{datasource:n.datasource})},n.cohortClick=function(){e.toggleFilter()}}e.$inject=["osApi","$state"];var t={restrict:"E",templateUrl:"app/components/subnav/subnav.html",replace:!0,controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osSubnav",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,r,s,l,c){if(angular.isUndefined(n.datasource))return void t.go("datasource");var d,u,p,h,g,m,f,v=i.select("#plsr-chart").append("svg").attr("id","chart"),b=i.select("body").append("div").attr("class","tooltip plsr-tooltip"),y=e.getCohortGene(),w=this;w.datasource=n.datasource,w.deathMinFilter=w.deathMinValue=45,w.deathMaxFilter=w.deathMaxValue=66,w.survivalMinFilter=w.survivalMinValue=3,w.survivalMaxFilter=w.survivalMaxValue=7,w.geneSets=[],w.geneSet=null,w.optCohortGenes=y.get(),w.optCohortGene=w.optCohortGenes[0],w.frame,w.tip=null,w.addCohortGene=function(){var e="PLSR "+r().format("- H:mm:ss - M/D/YY"),t=v.selectAll(".plsr-node-selected")[0].map(function(e){return e.__data__.name.toUpperCase()});if(0!=t.length){var n={name:e,ids:t};y.add(n),w.optCohortGene=n}},o.$watch("vm.optCohortGene",function(){var e=w.optCohortGene.ids;"*"==e?v.selectAll(".plsr-node-selected").classed("plsr-node-selected",!1):v.selectAll("circle").classed("plsr-node-selected",function(){return e.indexOf(this.__data__.name)>=0})}),e.setBusy(!0)("Loading Dataset"),e.setDataset(w.datasource).then(function(t){var n=t.payload.rownames.filter(function(e){return e.indexOf("mtx.mrna")>=0});n=n[n.length-1].replace(".RData",""),e.setBusyMessage("Creating PLSR Matrix"),e.getPLSR(w.datasource,n).then(function(){e.setBusyMessage("Loading Gene Sets"),e.getGeneSetNames().then(function(t){w.geneSets=t.payload,w.geneSet=w.geneSets[0],e.setBusyMessage("Loading Patients"),e.getSummarizedPLSRPatientAttributes().then(function(e){var t=e.payload;w.deathMinValue=Math.floor(t.AgeDx[0]/365.24),w.deathMaxValue=Math.floor(t.AgeDx[4]/365.24),w.survivalMinValue=Math.floor(t.Survival[0]/365.24),w.survivalMaxValue=Math.floor(t.Survival[4]/365.24),o.$watch("vm.geneSet",function(){w.update()})})})})}),w.update=function(){function t(){d=l.innerWidth-100,u=l.innerHeight-190,"true"==angular.element(".tray").attr("locked")&&(d-=300),v.attr("width","100%").attr("height",u),p=i.scale.linear().domain([-g,g]).range([0,d]).nice(),h=i.scale.linear().domain([-m,m]).range([u,0]).nice()}function n(e,n,a){g=.9*e,m=.9*e,t(),f=i.svg.brush().x(p).y(h).on("brushend",function(){var e=f.extent();v.selectAll("circle").classed("plsr-node-selected",function(t){return t[0]>e[0][0]&&t[0]<e[1][0]&&t[1]>e[0][1]&&t[1]<e[1][1]}),i.select(this).transition().duration(300).call(f.extent([[0,0],[0,0]]))}),v.call(f);var r=v.selectAll("circle").data(a,function(e){return e});r.enter().append("circle").attr({"class":"plsr-node",cx:.5*d,cy:.5*u,r:3}).style("fill-opacity","0").on("mouseover",function(e){b.transition().duration(200).style("opacity",1),b.html(e.name).style("left",i.event.pageX+15+"px").style("top",i.event.pageY-15+"px")}).on("mouseout",function(){b.transition().duration(500).style("opacity",0)}).on("click",function(e){angular.element("#plsr-webpage").modal();var t="https://www.genecards.org/cgi-bin/carddisp.pl?gene="+e.name;o.$apply(function(){w.frame=s.trustAsResourceUrl(t)})}),r.transition().duration(750).delay(function(e,t){return t/300*500}).attr("cx",function(e){return p(e[0])}).attr("cy",function(e){return h(e[1])}).style("fill-opacity",1),r.exit().transition().duration(600).delay(function(e,t){return t/300*500}).attr("cx",.5*d).attr("cy",.5*u).style("fill-opacity","0").remove();var l=v.selectAll("line").data(n);l.enter().append("line").attr({"class":"line","stroke-width":3,x1:p(0),y1:h(0),x2:p(0),y2:h(0)}).style("stroke",function(e){return e.name.indexOf("Age")?"#1396de":"#38347b"}),l.transition().duration(900).attr({x1:p(0),y1:h(0),x2:function(e){return p(e[0])},y2:function(e){return h(e[1])}}),l.exit().remove();var c=v.selectAll("text").data(n);c.enter().append("text").attr({"class":"text",x:.5*d,y:.5*u,"text-anchor":function(e){return e[0]>0?"start":"end"}}).text(function(e){return e.name}).style({fill:"black","text-anchor":"middle"}),c.transition().duration(900).attr({x:function(e){return p(e[0])},y:function(e){return h(e[1])}}),c.exit().remove()}e.setBusyMessage("Calculating PLSR");var a=[{name:"Survival",low:365.24*Number(w.survivalMinFilter),high:365.24*Number(w.survivalMaxFilter)},{name:"AgeDx",low:365.24*Number(w.deathMinFilter),high:365.24*Number(w.deathMaxFilter)}];e.getCalculatedPLSR(w.geneSet,a).then(function(t){e.setBusyMessage("Rendering PLSR");var a=t.payload,o=a.loadings.map(function(e,t){return e.name=this[t],e},a.loadingNames),i=a.vectors.map(function(e,t){return e.name=this[t],e},a.vectorNames),r=1.2*a.maxValue;n(r,i,o),e.setBusy(!1)}),w.resize=function(){t(),v.selectAll("circle").attr({cx:function(e){return p(e[0])},cy:function(e){return h(e[1])}}),v.selectAll("text").attr({x:function(e){return p(e[0])},y:function(e){return h(e[1])}}),v.selectAll("line").attr({x1:p(0),y1:h(0),x2:function(e){return p(e[0])},y2:function(e){return h(e[1])}})},angular.element(l).bind("resize",c.debounce(w.resize,300))}}e.$inject=["osApi","$state","$stateParams","$timeout","$scope","d3","moment","$sce","$window","_"];var t={restrict:"E",templateUrl:"app/components/plsr/plsr.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osPlsr",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,r,s){function l(){requestAnimationFrame(l),b.update()}if(angular.isUndefined(n.datasource))return void t.go("datasource");var c=this;c.datasource=n.datasource,c.geneSets=[],c.geneSet=null,c.toggleFilter=function(){angular.element(".container-filters").toggleClass("container-filters-collapsed"),angular.element(".container-filter-toggle").toggleClass("container-filter-toggle-collapsed")};var d,u=angular.element("#pca-chart");e.setBusy(!0)("Loading Dataset"),e.setDataset(c.datasource).then(function(t){var n=t.payload.rownames.filter(function(e){return e.indexOf("mtx.mrna")>=0});n=n[n.length-1].replace(".RData",""),e.setBusyMessage("Creating PCA Matrix"),e.getPCA(c.datasource,n).then(function(){e.setBusyMessage("Loading Gene Sets"),e.getGeneSetNames().then(function(e){c.geneSets=e.payload,c.geneSet=c.geneSets[0],o.$watch("vm.geneSet",function(){p()})})})});var p=function(){e.setBusyMessage("Calculating PCA"),e.getCalculatedPCA2(c.geneSet).then(function(t){e.setBusyMessage("Rendering PCA");var n=t.payload;c.pc1=t.payload["importance.PC1"],c.pc2=t.payload["importance.PC2"];var a=n.scores,o=n.ids;d=a.map(function(e,t){return e.id=o[t],e},n.ids),f(),e.setBusy(!1)})},h=new r.Scene,g=new r.PerspectiveCamera(50,s.innerWidth/s.innerHeight,.1,1e3);g.position.z=60;var m=s.WebGLRenderingContext?new r.WebGLRenderer({antialias:!0}):new r.CanvasRenderer;m.setPixelRatio(s.devicePixelRatio),m.setSize(s.innerWidth,s.innerHeight),u.append(m.domElement);var f=function(){for(var e=[],t=d.length,n=new r.SphereGeometry(.1,8,8),a=new r.MeshBasicMaterial({color:"#59a5fb"}),o=0;t>o;o++){e[o]=new r.Mesh(n,a);var i=d[o];e[o].position.x=i[0],e[o].position.y=i[1],e[o].position.z=i[2],h.add(e[o])}v()},v=function(){m.render(h,g)},b=new r.OrbitControls(g);b.addEventListener("change",v),l()}e.$inject=["osApi","$state","$stateParams","$timeout","$scope","d3","THREE","$window"];var t={restrict:"E",templateUrl:"app/components/pca3d/pca3d.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osPca3d",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,r,s,l){function c(){u=s.innerWidth-100,p=s.innerHeight-190,"true"==angular.element(".tray").attr("locked")&&(u-=300),w.attr("width","100%").attr("height",p),h=i.scale.linear().domain([-m,m]).range([0,u]).nice(),g=i.scale.linear().domain([-f,f]).range([p,0]).nice()}function d(){var e,t,n=y;e=Math.abs(i.max(n,function(e){return+e[0]})),t=Math.abs(i.min(n,function(e){return+e[0]})),m=1.2*(e>t?e:t),e=Math.abs(i.max(n,function(e){return+e[1]})),t=Math.abs(i.min(n,function(e){return+e[1]})),f=1.2*(e>t?e:t),c(),v=i.svg.axis().scale(h).orient("top").ticks(5),b=i.svg.axis().scale(g).orient("left").ticks(5);var a=i.svg.brush().x(h).y(g).on("brushend",function(){var e=a.extent();w.selectAll("circle").classed("pca-node-selected",function(t){return t[0]>e[0][0]&&t[0]<e[1][0]&&t[1]>e[0][1]&&t[1]<e[1][1]}),i.select(this).transition().duration(300).call(a.extent([[0,0],[0,0]]))});w.call(a);var o=w.selectAll("circle").data(y,function(e){return e});o.enter().append("circle").attr({"class":"pca-node",cx:.5*u,cy:.5*p,r:3}).style("fill-opacity","0").on("mouseover",function(e){x.transition().duration(200).style("opacity",1),x.html(e.id).style("left",i.event.pageX+10+"px").style("top",i.event.pageY-5+"px")}).on("mouseout",function(){x.transition().duration(500).style("opacity",0)}).transition().duration(750).delay(function(e,t){return t/300*500}).attr("cx",function(e){return h(e[0])}).attr("cy",function(e){return g(e[1])}).style("fill-opacity",1),o.exit().transition().duration(600).delay(function(e,t){return t/300*500}).attr("cx",.5*u).attr("cy",.5*p).style("fill-opacity","0").remove(),C.attr("class","axis").attr("transform","translate(0, "+g(0)+")").call(v).append("text").text("PC1"),_.attr("class","axis").attr("transform","translate("+h(0)+", 0)").call(b).append("text").attr("y",10).attr("dy",".71em").text("PC2")}if(angular.isUndefined(n.datasource))return void t.go("datasource");var u,p,h,g,m,f,v,b,y,w=i.select("#pca-chart").append("svg").attr("id","chart"),_=w.append("g"),C=w.append("g"),x=i.select("body").append("div").attr("class","tooltip pca-tooltip"),k=e.getCohortPatient(),T=this;T.datasource=n.datasource,T.geneSets=[],T.geneSet=null,T.optNodeColors=[{name:"Default"},{name:"Gender"},{name:"Age At Diagnosis"}],T.optNodeColor=T.optNodeColors[0],T.optCohortPatients=k.get(),T.optCohortPatient=T.optCohortPatients[0],T.addCohortPatient=function(){var e="PCA "+r().format("- H:mm:ss - M/D/YY"),t=w.selectAll(".pca-node-selected")[0].map(function(e){return e.__data__.id.toUpperCase()});if(0!=t.length){var n={name:e,ids:t};k.add(n),T.optCohortPatient=n}};var S=function(){var e=T.optCohortPatient.ids;"*"==e?w.selectAll(".pca-node-selected").classed("pca-node-selected",!1):w.selectAll("circle").classed("pca-node-selected",function(){return e.indexOf(this.__data__.id)>=0})};o.$watch("vm.optCohortPatient",S),e.setBusy(!0)("Loading Dataset"),e.setDataset(T.datasource).then(function(t){var n=t.payload.rownames.filter(function(e){return e.indexOf("mtx.mrna")>=0});n=n[n.length-1].replace(".RData",""),e.setBusyMessage("Creating PCA Matrix"),e.getPCA(T.datasource,n).then(function(){e.setBusyMessage("Loading Gene Sets"),e.getGeneSetNames().then(function(e){T.geneSets=e.payload,T.geneSet=T.geneSets[0],o.$watch("vm.geneSet",function(){E()})})})});var E=function(){e.setBusyMessage("Calculating PCA"),e.getCalculatedPCA(T.geneSet).then(function(t){e.setBusyMessage("Rendering PCA");var n=t.payload;T.pc1=Math.round(100*t.payload["importance.PC1"]),T.pc2=Math.round(100*t.payload["importance.PC2"]);var a=n.scores,o=n.ids;y=a.map(function(e,t){return e.id=o[t],e},n.ids),d(),S(),e.setBusy(!1)})};T.resize=function(){c(),v.scale(h),b.scale(g),C.attr("transform","translate(0, "+g(0)+")").call(v),_.attr("transform","translate("+h(0)+", 0)").call(b),w.selectAll("circle").attr("cx",function(e){return h(e[0])}).attr("cy",function(e){return g(e[1])})},angular.element(s).bind("resize",l.debounce(T.resize,300))}e.$inject=["osApi","$state","$stateParams","$timeout","$scope","d3","moment","$window","_"];var t={restrict:"E",templateUrl:"app/components/pca/pca.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osPca",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,r,s,l){function c(){var e="rgb(5, 108, 225)",t="red",n="rgb(56, 52,123)",a="green";return[{selector:"node",style:{content:"data(label)","text-valign":"center","text-halign":"center",shape:"ellipse",width:"60px",height:"50px",color:e,"background-color":"rgb(250, 250, 250)","border-width":"2px","border-color":e}},{selector:"edge",style:{width:"2px","line-color":e,"line-style":"solid"}},{selector:'node[nodeType="class"], node[nodeType="family"], node[nodeType="complex"]',style:{content:"","background-color":"white",shape:"roundrectangle"}},{selector:'edge[edgeType="activates"], edge[edgeType="indirectly activates"]',style:{"line-color":a,"target-arrow-shape":"triangle","target-arrow-color":a}},{selector:'edge[edgeType="inhibits"], edge[edgeType="ubiquitinylates"]',style:{"line-color":t,"target-arrow-shape":"tee","target-arrow-color":t}},{selector:'edge[edgeType="fusion"]',style:{"line-color":a}},{selector:'edge[edgeType="contains"]',style:{display:"none"}},{selector:'node[nodeType="process"]',style:{}},{selector:'node[nodeType="gene"]:selected',style:{"overlay-opacity":"0.5","overlay-color":"red"}},{selector:'node[nodeType="rtk"]',style:{content:"data(label)","background-color":"rgb(224, 209, 178)","border-color":"black","border-width":"0px","font-size":"48px",shape:"roundrectangle",width:"40px",height:"160px"}},{selector:'node[nodeType="kinase"]',style:{content:"data(label)","background-color":"rgb(255, 206, 194)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="dimer"]',style:{content:"","background-color":"rgb(234, 219, 188)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"0px"}},{selector:'node[nodeType="loop"]',style:{content:"","background-color":"rgb(255, 255, 255)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px","border-style":"dotted"}},{selector:'node[nodeType="gtpase"]',style:{content:"data(label)","background-color":"rgb(194, 194, 255)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="adaptor"]',style:{content:"data(label)","background-color":"rgb(77, 184, 255)",shape:"ellipse",width:"60px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="GEF"]',style:{content:"data(label)","background-color":"rgb(77, 184, 255)",shape:"ellipse",width:"60px",height:"60px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="process"]',style:{content:"data(label)","background-color":"rgb(255, 255, 255)",shape:"roundrectangle",width:"100px",height:"40px","font-size":"24px","border-color":"black","border-width":"0px"}},{selector:'node[nodeType="TF"]',style:{content:"data(label)","background-color":"rgb(255, 206, 94)",shape:"diamond",width:"160px",height:"60px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="gene fusion"]',style:{content:"data(label)",shape:"roundrectangle","font-size":"24px","border-color":"red","border-width":"3px"}},{selector:"edge:selected",style:{"overlay-color":"grey","overlay-opacity":"0.3"}},{selector:'edge[edgeType="recruits"]',style:{width:"2px"}},{selector:'edge[edgeType="fusion"]',style:{"line-color":n}},{selector:'edge[edgeType="recruits"]',style:{"line-color":"red",width:"1px","line-style":"dashed","target-arrow-shape":"triangle","target-arrow-color":"black"}},{selector:'edge[edgeType="cycles"]',style:{"line-color":"black",width:"1px","line-style":"dashed","target-arrow-shape":"triangle","source-arrow-shape":"triangle","target-arrow-color":"green","source-arrow-color":"red"}},{selector:'edge[edgeType="associates"]',style:{"line-color":"black",width:"1px","line-style":"solid"}},{selector:'edge[edgeType="activation"]',style:{"line-color":"green",width:"1px"}},{selector:'edge[edgeType="inhibition"]',style:{"line-color":"red",width:"1px"}}]}if(angular.isUndefined(n.datasource))return void t.go("datasource");var d,u,p=this,h=e.getCohortGene(),g=angular.element("#gbm-chart");p.optCohortGenes=h.get(),p.optCohortGene=p.optCohortGenes[0],p.datasource=n.datasource,p.search="",p.frame,p.tip=null,p.resize=function(){var e=i.innerWidth;e>760&&(e-=140),"true"==angular.element(".tray").attr("locked")&&(e-=300),g.width(e),g.height(i.innerHeight-90),u&&(u.resize(),u.center())},angular.element(i).bind("resize",l.debounce(p.resize,300)),p.addCohortGene=function(){var e="Pathways "+r().format("- H:mm - M/D/YY"),t=u.$('node[nodeType="gene"]:selected').map(function(e){return e.data().id.toUpperCase()}),n={name:e,ids:t};0!=t.length&&(h.add(n),p.optCohortGene=n)},a.$watch("vm.optCohortGene",function(){if(!angular.isUndefined(u)){u.startBatch();var e=!0,t={};"*"==p.optCohortGene.ids?u.$('node[nodeType="gene"]:selected').forEach(function(e){e.deselect(),t[e.id()]={display:"element"}},t):u.$('node[nodeType="gene"]').forEach(function(t){this.ids.indexOf(t.id())>=0?(t.select(),this.degmap[t.id()]={display:"element"}):(t.deselect(),this.degmap[t.id()]={display:e?"element":"none"})},{degmap:t,ids:p.optCohortGene.ids}),u.batchData(t),u.endBatch()}}),a.$watch("vm.search",function(){if(!angular.isUndefined(u)){var e=p.search.toUpperCase(),t=e.length;u.startBatch(),u.nodes().map(function(n){0==t?n.unselect():n.attr("name").substr(0,t)===e?n.select():n.unselect()}),u.endBatch()}}),e.setBusy(!0),
e.setDataset(p.datasource).then(function(){e.getPathway().then(function(t){d=angular.fromJson(t.payload),u=s({container:g,elements:d.elements,style:c(),minZoom:.2,maxZoom:5,layout:{name:"preset",fit:!0}}).on("click","node",function(e){"gene"==e.cyTarget.data().nodeType&&i.open("https://www.genecards.org/cgi-bin/carddisp.pl?gene="+e.cyTarget.data().id)}).on("click","edge",function(e){i.open("https://www.ncbi.nlm.nih.gov/pubmed/?term="+e.cyTarget.data().pmid),i.open("http://www.ncbi.nlm.nih.gov/pubmed/?term=(GENE "+e.cyTarget.data().source+") AND (GENE "+e.cyTarget.data().target+")"),i.open("https://www.genecards.org/cgi-bin/carddisp.pl?gene="+e.cyTarget.data().source),i.open("https://www.genecards.org/cgi-bin/carddisp.pl?gene="+e.cyTarget.data().target)}).on("mouseover","edge",function(e){a.$apply(function(){p.tip=e.cyTarget.data().source+" Extract"}),e.cyTarget.style({width:"4px"})}).on("mouseout","edge",function(e){a.$apply(function(){p.tip=null}),e.cyTarget.style({width:"2px"})}).on("mouseover","node",function(e){a.$apply(function(){p.tip=e.cyTarget.data().name+" Gene Card"})}).on("mouseout","node",function(){a.$apply(function(){p.tip=null})}),e.setBusy(!1)})})}e.$inject=["osApi","$state","$stateParams","$scope","$sce","$window","moment","cytoscape","_"];var t={restrict:"E",templateUrl:"app/components/pathways/pathways.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osPathways",e)}(),function(){"use strict";function e(e,t,n,a,o){var i,r={},s=function(){return i},l=function(e){i=e},c=1,d=function(){return 9999==c&&(c=1),c++},u=new e(o.protocol()+"://"+o.host()+":"+("3002"==o.port()?80:o.port())+"/oncoscape","",{debug:!1,devel:!1});u.onmessage=function(e){var t=angular.fromJson(e.data);if(angular.isDefined(r[t.cmd])){var n=r[t.cmd];delete r[t.cmd],n.resolve(t)}else a.error("Unhandled message: %o",t)};var p=function(e){e.callback=d(),e.status="request",e.payload=e.payload||"",e.ds=s();var t=n.defer();return r[e.callback]=t,0===u.readyState?u.onopen=function(){u.send(angular.toJson(e))}:u.send(angular.toJson(e)),t.promise.then(function(t){return e.response=t,t})};return{request:p,setDataSource:l}}e.$inject=["SockJS","$rootScope","$q","$log","$location"],angular.module("oncoscape").factory("osSocket",e)}(),function(){"use strict"}(),function(){"use strict";function e(e,t,n,a){function o(){return U}function i(t){j.clear(),W.clear(),e.setDataSource(t),U=t,q.dispatch(U)}function r(){var e=new n.Signal,o=new n.Signal,i={name:"",password:"",domain:{name:"Guest"},authenticated:!1,token:null,datasets:[]},r=[{name:"Guest"},{name:"FHCRC"},{name:"UW"}],s=function(){i.name="",i.password="",i.domain={name:"Guest"},i.authenticated=!1,i.token=null,i.datasets=[],o.dispatch()},l=function(n){i=n;var o={method:"POST",url:a.protocol()+"://"+a.host()+":"+("3002"==a.port()?80:a.port())+"/login",data:{username:i.name,password:i.password,domain:i.domain.name}};return t(o).then(function(t){t.data.success?(i.authenticated=!0,i.token=t.data.token,i.datasets=t.data.datasets,e.dispatch(i)):(i.authenticated=!1,i.token=null)})};return{getDomains:function(){return r},getUser:function(){return i},login:l,logout:s,onLogin:e,onLogout:o}}function s(){return Y}function l(e){return e?angular.element(".loader-modal").show():angular.element(".loader-modal").hide(),c}function c(){}function d(){angular.element("#filter-dropdown").slideToggle()}function u(){angular.element("#filter-dropdown").slideToggle()}function p(){angular.element("#filter-dropdown").slideToggle()}function h(t){return e.setDataSource(t),e.request({cmd:"specifyCurrentDataset",payload:t})}function g(t){return e.request({cmd:"getDataManifest",payload:t})}function m(t){return e.request({cmd:"getPatientHistoryTable",payload:{datasetName:t,durationFormat:"byYear"}})}function f(){}function v(){}function b(){return e.request({cmd:"getGeneSetNames"})}function y(){return e.request({cmd:"getSampleCategorizationNames"})}function w(t){return e.request({cmd:"getSampleCategorization",payload:t})}function _(t){return e.request({cmd:"getMarkersNetwork",payload:t})}function C(){}function x(t){return e.request({cmd:"getCanonicalizePatientIDsInDataset",payload:t})}function k(){}function T(){}function S(t,n){var a={dataPackage:t,matrixName:n};return e.request({cmd:"createPCA",payload:a})}function E(t){var n={genes:t};return e.request({cmd:"calculatePCA",payload:n})}function P(t){var n={genes:t};return e.request({cmd:"calculatePCA2",payload:n})}function A(t,n){var a={dataPackage:t,matrixName:n};return e.request({cmd:"createPLSR",payload:a})}function D(t,n){var a={genes:t,factorCount:n.length,factors:n};return e.request({cmd:"calculatePLSR",payload:a})}function M(t){return t=t||["AgeDx","Survival"],e.request({cmd:"summarizePLSRPatientAttributes",payload:t})}function G(t,n){return e.request({cmd:"calculateSurvivalCurves",payload:{sampleIDs:t,title:n}})}function $(){return e.request({cmd:"createTimelines"})}function I(){}function R(){return e.request({cmd:"getModuleModificationDate",payload:"gbmPathways"})}function L(){return e.request({cmd:"getPathway",payload:"g.gbmPathways.json"})}function O(t,n){return e.request({cmd:"get_mRNA_data",payload:{entities:t,features:n}})}function N(t,n){return e.request({cmd:"get_cnv_data",payload:{entities:t,features:n}})}function F(t,n){return e.request({cmd:"get_mutation_data",payload:{entities:t,features:n}})}function B(t){return e.request({cmd:"oncoprint_data_selection",payload:{patientIdsAndGenes:t}})}function z(){return W}function V(){return j}function H(e,t){function n(){return d}function a(e){d.unshift(e),l.dispatch(d)}function o(){d=[t]}function i(e){d.splice(d.indexOf(e)),c.dispatch(d)}function r(){}function s(){}var l=new e.Signal,c=new e.Signal,d=[t];return{get:n,add:a,remove:i,onAdd:l,onRemove:c,save:r,load:s,clear:o}}var U,q=new n.Signal,Y=r(),W=H(n,{name:"All Patients",ids:"*"},"osCohortPatient"),j=H(n,{name:"All Genes",ids:"*"},"osCohortGene");return{getCohortPatient:z,getCohortGene:V,setDataSource:i,getDataSource:o,onDataSource:q,getUserApi:s,showFilter:d,hideFilter:u,toggleFilter:p,setBusy:l,setBusyMessage:c,setDataset:h,getDataManifest:g,getPatientHistoryTable:m,getPatientHistoryDxAndSurvivalMinMax:f,getSampleDataFrame:v,getGeneSetNames:b,getSampleCategorizationNames:y,getSampleCategorization:w,getMarkersNetwork:_,getPathway:L,getDrugGeneInteractions:C,getCanonicalizePatientIDsInDataset:x,getGeneSetGenes:k,getOncoprintDataSelection:T,getPCA:S,getCalculatedPCA:E,getCalculatedPCA2:P,getPLSR:A,getCalculatedPLSR:D,getSummarizedPLSRPatientAttributes:M,getCalculatedSurvivalCurves:G,getTimelines:$,getCalculatedTimelines:I,getMrnaData:O,getCnvData:N,getMutationData:F,getModuleModificationDate:R,getOncoprint:B}}e.$inject=["osSocket","$http","signals","$location"],angular.module("oncoscape").service("osApi",e)}(),/*
 * Copyright (c) 2015 Memorial Sloan-Kettering Cancer Center.
 *
 * This library is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY, WITHOUT EVEN THE IMPLIED WARRANTY OF MERCHANTABILITY OR FITNESS
 * FOR A PARTICULAR PURPOSE. The software and documentation provided hereunder
 * is on an "as is" basis, and Memorial Sloan-Kettering Cancer Center has no
 * obligations to provide maintenance, support, updates, enhancements or
 * modifications. In no event shall Memorial Sloan-Kettering Cancer Center be
 * liable to any party for direct, indirect, special, incidental or
 * consequential damages, including lost profits, arising out of the use of this
 * software and its documentation, even if Memorial Sloan-Kettering Cancer
 * Center has been advised of the possibility of such damage.
 */
/*
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
oncoprint_utils=function(){var e={};return e.sign=function(e){return e?0>e?-1:1:0},e.invert_array=function(e){return e.reduce(function(e,t,n){return e[t]=n,e},{})},e.cssClassToSelector=function(e){return"."+e.split(" ").join(".")},e.mouseY=function(t){return e.ifndef(t.offsetY,t.originalEvent&&t.originalEvent.layerY)},e.mouseX=function(t){return e.ifndef(t.offsetX,t.originalEvent&&t.originalEvent.layerX)},e.ifndef=function(e,t){return"undefined"==typeof e?t:e},e["extends"]=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},e.makeIdCounter=function(){var e=0;return function(){return e+=1}},e.clamp=function(e,t,n){return Math.max(Math.min(n,e),t)},e.makeD3SVGElement=function(e){return d3.select(document.createElementNS("http://www.w3.org/2000/svg",e))},e.appendD3SVGElement=function(e,t,n){return t.select(function(){return this.appendChild(e.node().cloneNode(!0))})},e.spaceSVGElementsHorizontally=function(t,n){var a=0;e.d3SelectChildren(t,"*").each(function(){if("defs"!==this.tagName){var t=d3.select(this).attr("transform"),o=t&&t.indexOf("translate")>-1&&parseFloat(t.split(",")[1],10);o=o||0,d3.select(this).attr("transform",e.translate(a,o)),a+=this.getBBox().width,a+=n}});return t},e.textWidth=function(e,t){var n=$("<div>"+e+"</div>").css({position:"absolute","float":"left","white-space":"nowrap",visibility:"hidden",font:t}).appendTo($("body")),a=n.width();return n.remove(),a},e.d3SelectChildren=function(e,t){return e.selectAll(t).filter(function(){return this.parentNode===e.node()})},e.warn=function(e,t){console.log("Oncoprint error in "+t+": "+e)},e.stableSort=function(e,t){var n=[];_.each(e,function(e,t){n.push([e,t])});var a=function(e,n){var a=t(e[0],n[0]);return 0===a&&(e[1]<n[1]?a=-1:e[1]>n[1]&&(a=1)),a};return n.sort(a),_.map(n,function(e){return e[0]})},e.lin_interp=function(e,t,n){if("#"===t[0]){var a=[parseInt(t.substring(1,3),16),parseInt(n.substring(1,3),16)],o=[parseInt(t.substring(3,5),16),parseInt(n.substring(3,5),16)],n=[parseInt(t.substring(5,7),16),parseInt(n.substring(5,7),16)],i=Math.round(a[0]*(1-e)+a[1]*e).toString(16),r=Math.round(o[0]*(1-e)+o[1]*e).toString(16),s=Math.round(n[0]*(1-e)+n[1]*e).toString(16);return i=i.length<2?"0"+i:i,r=r.length<2?"0"+r:r,s=s.length<2?"0"+s:s,"#"+i+r+s}if(isNaN(t)&&t.indexOf("%")>-1){var l=parseFloat(t,10),s=parseFloat(n,10);return l*(1-e)+s*e+"%"}return t*(1-e)+n*e},e.translate=function(e,t){return"translate("+e+","+t+")"},e.assert=function(e,t){if(!e)throw t},e}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,r,s){function l(e){if($("#onc").empty(),$("#oncoprintErrorSection").empty(),$(".oncoprint-label-col1").empty(),"error"==e.status)g.errorMessage=JSON.parse(e.payload),console.log("***** errors in dispalyOncoprint",g.errorMessage),b("errors");else{var t=e.payload[1],n=e.payload[0],a=m.create("#onc");a.suppressRendering(),$.when(n).then(function(){function e(e){return e.gene===r}"string"==typeof t&&(t=[t]);for(var o=(t.length,[]),i=0;i<t.length;i++){var r=t[i],s=n.filter(e);Date.now();o[i]=a.addTrack({label:r,removable:!0},0),0===i?a.setRuleSet(o[i],m.GENETIC_ALTERATION):a.useSameRuleSet(o[i],o[0]),a.setTrackData(o[i],s,!0)}a.releaseRendering(),a.sort(),$("#toggle_whitespace").click(function(){a.toggleCellPadding()});var l=1;$("#reduce_cell_width").click(function(){l*=.5,a.setZoom(l)});for(var c=$(".oncoprint-legend-block"),d=$(".oncoprint-legend-label"),u=0;u<c.length;u++)c[u].appendChild(d[u]);$(".oncoprint-label-col1").append(c),$("#oncoprintInstructions").hide()})}}if(angular.isUndefined(n.datasource))return void t.go("datasource");var c=angular.element("#oncoprintControlsDiv"),d=angular.element("#oncoprintInstructions"),u=(angular.element("#oncoprintErrorSection"),angular.element("#legend")),p=e.getCohortGene(),h=e.getCohortPatient(),g=this;g.datasource=n.datasource,g.geneSets=[],g.geneSet=null,g.optCohortGenes=p.get(),g.optCohortGene=g.optCohortGenes[0],g.optCohortPatients=h.get(),g.optCohortPatient=g.optCohortPatients[0],g.geneAndPatients=g.optCohortGene.ids+","+g.optCohortPatient.ids,g.errorMessage;var m=function(){function e(e){var a=this,o=n.makeIdCounter();a.config=e,a.id_order=[],a.inverted_id_order={},a.visible_id_order=[],a.visible_inverted_id_order={},a.hidden_ids={},a.track_groups=[[],[]],a.track_group_sort_order=[0,1],a.sort_direction={},a.tracks={},a.sort_config={type:"track"},a.cell_padding_on=!0,a.true_cell_width=e.cell_width,a.zoomed_cell_width=a.true_cell_width,a.zoom=1,a.toggleCellPadding=function(){a.cell_padding_on=!a.cell_padding_on,$(a).trigger(t.SET_CELL_PADDING)},a.getCellPadding=function(){return Math.ceil(a.config.cell_padding*a.getZoom())*+a.cell_padding_on},a.getZoom=function(){return a.zoom},a.setZoom=function(e){return a.zoom=n.clamp(e,0,1),l(),i(),$(a).trigger(t.SET_ZOOM),a.zoom};var i=function(){a.zoom=(a.zoomed_cell_width-1)/(a.true_cell_width-1)},l=function(){a.zoomed_cell_width=Math.round(a.zoom*(a.true_cell_width-1)+1)};a.increaseZoom=function(){return a.zoomed_cell_width=n.clamp(a.zoomed_cell_width+1,1,a.true_cell_width),i(),$(a).trigger(t.SET_ZOOM),a.zoom},a.decreaseZoom=function(){return a.zoomed_cell_width=n.clamp(a.zoomed_cell_width-1,1,a.true_cell_width),i(),$(a).trigger(t.SET_ZOOM),a.zoom},a.getFullCellWidth=function(){return a.true_cell_width},a.getZoomedCellWidth=function(){return a.zoomed_cell_width},a.getCellHeight=function(e){return a.tracks[e].config.cell_height},a.getTrackHeight=function(e){return a.tracks[e].config.track_height},a.getTrackPadding=function(e){return a.tracks[e].config.track_padding},a.getFilteredIdOrder=function(e,t){var n=t||a.getTracks();return s.filter(a.id_order,function(t){var o=s.map(n,function(e){return a.getTrackDatum(e,t)});return e(o)})},a.getIdOrder=function(){return a.id_order},a.getInvertedIdOrder=function(){return a.inverted_id_order},a.getVisibleIdOrder=function(){return a.visible_id_order},a.getVisibleInvertedIdOrder=function(){return a.visible_inverted_id_order};var c=function(){a.visible_id_order=s.filter(a.id_order,function(e){return!a.hidden_ids[e]}),a.visible_inverted_id_order=n.invert_array(a.visible_id_order),$(a).trigger(t.SET_VISIBLE_ID_ORDER)};a.setIdOrder=function(e){a.id_order=e.slice(),a.inverted_id_order=n.invert_array(a.id_order),c(),$(a).trigger(t.SET_ID_ORDER)},a.hideIds=function(e,t){t&&(a.hidden_ids={}),s.each(e,function(e){a.hidden_ids[e]=!0}),c()},a.showIds=function(e){e?s.each(e,function(e){delete a.hidden_ids[e]}):a.hidden_ids={},c()},a.getTopmostTrack=function(){return a.track_groups[0].length>0?a.track_groups[0][0]:a.track_groups[1][0]},a.setTrackSortComparator=function(e,t){a.tracks[e].config.sort_cmp=t},a.getTrackSortComparator=function(e){return a.tracks[e].config.sort_cmp},a.getTrackSortDirection=function(e){return a.sort_direction[e]},a.setTrackSortDirection=function(e,t){a.sort_direction[e]=t,a.sort()},a.setTrackGroupSortOrder=function(e){a.track_group_sort_order=e.slice()},a.getTrackGroupSortOrder=function(){return a.track_group_sort_order.slice()},a.getTrackSortOrder=function(){var e=[],t=a.getTrackGroups();return s.each(a.getTrackGroupSortOrder(),function(n){e=e.concat(t[n])}),e},a.setSortConfig=function(e){a.sort_config=e};var d=function(e){var t=s.sortBy(a.getIdOrder(),s.identity);e&&t.reverse(),a.setIdOrder(t)},u=function(){var e=a.getTrackSortOrder(),t=s.map(e,function(e){return a.getTrackSortComparator(e)}),o={},i=a.getIdOrder();s.each(i,function(t){o[t]={},s.each(e,function(e){o[t][e]=a.getTrackDatum(e,t)})});var r=function(n,i){for(var r=0,s=0,l=e.length;l>s;s++){var c=e[s],d=t[s],u=o[n][c],p=o[i][c],h="undefined"==typeof u,g="undefined"==typeof p;if(r=h||g?h&&g?0:h?1:-1:d(u,p),isFinite(r)&&(r*=a.sort_direction[c]),0!==r)break}return r};a.setIdOrder(n.stableSort(a.getIdOrder(),r))};a.sort=function(){var e=a.sort_config;"track"===e.type?u():"id"===e.type&&d(e.desc)},a.addTrack=function(e,i){i=n.ifndef(i,1);var s=o();return a.tracks[s]={id:s,data:[],config:$.extend({},r,e),id_data_map:{}},a.track_groups[i].push(s),a.sort_direction[s]=1,$(a).trigger(t.ADD_TRACK,{track_id:s}),s},a.removeTrack=function(e){var n=a.tracks[e];delete a.tracks[e],delete a.sort_direction[e];var o=a.getContainingTrackGroup(e,!0);if(o){var i=o.indexOf(e);return o.splice(i,1),$(a).trigger(t.REMOVE_TRACK,{track:n,track_id:e}),!0}return!1},a.getTrackGroups=function(e){return e===!0?a.track_groups:$.extend(!0,[],a.track_groups)},a.getTracks=function(){return s.flatten(a.getTrackGroups())},a.getContainingTrackGroup=function(e,t){var n=!1;return s.find(a.track_groups,function(t){return t.indexOf(e)>-1?(n=t,!0):!1}),t===!0?n:n.slice()},a.moveTrack=function(e,o){var i=a.getContainingTrackGroup(e,!0);if(!i)return!1;var r=i.indexOf(e);o=n.clamp(o,0,i.length-1),i.splice(r,1),i.splice(o,0,e);var s=i.slice(Math.min(r,o),Math.max(r,o)+1);$(a).trigger(t.MOVE_TRACK,{moved_tracks:s})},a.getTrackLabel=function(e){return a.tracks[e].config.label},a.getTrackTooltip=function(e){return a.tracks[e].config.tooltip},a.setTrackTooltip=function(e,t){a.tracks[e].config.tooltip=t},a.getTrackData=function(e){return a.tracks[e].data},a.setTrackData=function(e,n){var o=a.getTrackDatumIdAccessor(e);a.tracks[e].data=n;var i=a.getIdOrder(),r=a.getInvertedIdOrder();s.each(s.map(n,o),function(e){e in r||i.push(e)}),a.setIdOrder(i),a.tracks[e].id_data_map={};var l=a.tracks[e].id_data_map;s.each(a.tracks[e].data,function(e){l[o(e)]=e}),$(a).trigger(t.SET_TRACK_DATA,{track_id:e})},a.getTrackDatum=function(e,t){return a.tracks[e].id_data_map[t]},a.getTrackDatumDataKey=function(e){return a.tracks[e].config.datum_data_key},a.getTrackDatumIdAccessor=function(e){var t=a.getTrackDatumIdKey(e);return function(e){return e[t]}},a.getTrackDatumIdKey=function(e){return a.tracks[e].config.datum_id_key},a.setTrackDatumIdKey=function(e,t){a.tracks[e].config.datum_id_key=t},a.isTrackRemovable=function(e){return a.tracks[e].config.removable},a.isTrackSortDirectionChangable=function(e){return a.tracks[e].config.sort_direction_changable},a.clearData=function(){s.each(a.getTracks(),function(e){a.setTrackData(e,[])}),a.setIdOrder([])}}var t=oncoprint_events,n=oncoprint_utils,a=oncoprint_RuleSet,o={cell_width:6,cell_padding:2.5,legend:!0},i={pre_track_padding:0},r={label:"Gene",datum_id_key:"patient",cell_height:23,track_height:20,track_padding:5,sort_cmp:void 0,tooltip:function(e){return e.patient},removable:!1,sort_direction_changable:!1};return{CATEGORICAL_COLOR:a.CATEGORICAL_COLOR,GRADIENT_COLOR:a.GRADIENT_COLOR,GENETIC_ALTERATION:a.GENETIC_ALTERATION,BAR_CHART:a.BAR_CHART,create:function(n,a){a=$.extend({},o,a||{}),a=$.extend(a,i);var r=new e(a),s=new f(n,r,{label_font:"Arial",legend:a.legend}),l={onc_dev:r,ren_dev:s,addTrack:function(e,t){var n=r.addTrack(e,t);return n},removeTrack:function(e){r.removeTrack(e)},moveTrack:function(e,t){r.moveTrack(e,t)},setTrackDatumIdKey:function(e,t){r.setTrackDatumIdKey(e,t)},setTrackData:function(e,t){r.setTrackData(e,t)},setRuleSet:function(e,t,n){s.setRuleSet(e,t,n)},useSameRuleSet:function(e,t){s.useSameRuleSet(e,t)},toggleCellPadding:function(){r.toggleCellPadding()},toSVG:function(){return s.toSVG()},setTrackGroupSortOrder:function(e){r.setTrackGroupSortOrder(e)},sort:function(){r.sort()},setSortConfig:function(e){r.setSortConfig(e)},setIdOrder:function(e){r.setIdOrder(e)},getTrackSortDirection:function(e){return r.getTrackSortDirection(e)},setTrackSortDirection:function(e,t){r.setTrackSortDirection(e,t)},setZoom:function(e){return r.setZoom(e)},increaseZoom:function(){return r.increaseZoom()},decreaseZoom:function(){return r.decreaseZoom()},suppressRendering:function(){s.suppressRendering()},releaseRendering:function(){s.releaseRendering()},setLegendVisible:function(e,t){s.setLegendVisible(e,t)},getFilteredIdOrder:function(e,t){return r.getFilteredIdOrder(e,t)},getVisibleIdOrder:function(){return r.getVisibleIdOrder()},hideIds:function(e){r.hideIds(e)},showIds:function(e){r.showIds(e)},clearData:function(){r.clearData()},setTrackTooltip:function(e,t){r.setTrackTooltip(e,t)}};return $(r).on(t.MOVE_TRACK,function(){$(l).trigger(t.MOVE_TRACK)}),$(s).on(t.FINISHED_RENDERING,function(){$(l).trigger(t.FINISHED_RENDERING)}),$(r).on(t.REMOVE_TRACK,function(e,n){$(l).trigger(t.REMOVE_TRACK,{track_id:n.track_id})}),$(s).on(t.CONTENT_AREA_MOUSEENTER,function(e,n){$(l).trigger(t.CONTENT_AREA_MOUSEENTER)}),$(s).on(t.CONTENT_AREA_MOUSELEAVE,function(e,n){$(l).trigger(t.CONTENT_AREA_MOUSELEAVE)}),l}}}(),f=function(){function e(e,c,u){OncoprintRenderer.call(this,c,u);var p=this;this.track_cell_selections={},this.track_cells={},this.active_rule_set_rules={},this.toolbar_container,this.label_div,this.label_drag_div,this.label_container,this.cell_container,this.cell_container_node,this.cell_div,this.legend_table,this.document_fragment,this.percent_altered_max_width=n.textWidth("100%",p.getLabelFont()),this.altered_data_percentage={},this.cell_tooltip_html="",this.container=i.select(e),this.container.classed("noselect",!0).selectAll("*").remove(),this.container.append("br"),function(){u.legend&&(p.legend_table=i.select(e).append("table").style("border-collapse","collapse"))}();var h=i.select(e).append("div").classed("oncoprint-content-area",!0);!function(){p.label_container=h.append("div").classed(a,!0).style("position","relative"),p.label_div=p.label_container.append("div").style("position","relative").style("overflow","hidden"),p.label_drag_div=p.label_container.append("div").style("position","absolute").style("overflow","hidden").style("top","0px").style("left","0px").style("display","none")}(),function(){p.cell_container=h.append("div").classed(o,!0),p.cell_column_highlight=p.cell_container.append("div").classed(l,!0).style("height",p.getCellAreaHeight()).style("visibility","hidden"),p.cell_container_node=p.cell_container.node(),p.cell_div=p.cell_container.append("div").classed(r,!0),p.cell_mouseover_div=p.cell_container.append("div").style("position","absolute").style("overflow","hidden").style("top","0px").style("left","0px"),p.cell_container_node.addEventListener("scroll",function(){p.calculateVisibleInterval(),p.clipAndPositionCells()});var e,t;!function(){var a,o,i,r,l=[];$(p.cell_div.node()).qtip({content:"SHARED QTIP",position:{target:"event",my:"bottom middle",at:"top middle",viewport:$(window)},style:{classes:d,border:"none"},show:{event:"cell-mouseover"},hide:{fixed:!0,delay:100,event:"cell-mouseout"},events:{show:function(){$(this).find(".qtip-content").html(p.cell_tooltip_html)},render:function(){$(this).find(".qtip-content").html(p.cell_tooltip_html)}}});var u=function(e){$("."+d).finish(),$(e).trigger("cell-mouseover")},h=function(e){$("."+d).finish(),$(e).trigger("cell-mouseout")},g=function(){a=void 0,o=void 0,i&&h(i),i=void 0,r&&clearTimeout(r),s.each(l,function(e){e&&(e.style.border="",e.style.margin="")}),l=[]};t=function(){g()},e=function(e){var t=n.mouseX(e),h=n.mouseY(e),m=p.getTrackCellTops(),f=function(){var e=Number.POSITIVE_INFINITY,t=void 0;return s.each(m,function(n,a){var o=h-n;o>=0&&e>o&&(e=o,t=a)}),t}();if(!f)return void g();var v=c.getCellHeight(f);if(h>m[f]+v)return void g();var b=c.getZoomedCellWidth(),y=b+c.getCellPadding();if(t%y>b)return void g();var w=Math.floor(t/y);if(w!==o||f!==a){r&&clearTimeout(r),g();var _=c.getVisibleIdOrder()[w],C=p.track_cells[f][_];if(!C)return;$("."+d).finish().hide(),o=w,a=f,i=C.dom,p.cell_tooltip_html=c.getTrackTooltip(f)(C.d),u(i),r=setTimeout(function(){l=s.map(p.track_cells,function(e,t){var n=e[_].dom;return n&&(t===f?(n.style.border="1px solid #000000",n.style.margin="-1px"):(n.style.border="1px solid #999999",n.style.margin="-1px")),n})},200)}}}(),p.cell_mouseover_div.node().addEventListener("mousemove",e),p.cell_mouseover_div.node().addEventListener("mouseout",t),p.cell_div.style("max-width","1000px")}(),$(h.node()).hover(function(){$(p.label_div.node()).find("."+p.getTrackButtonCSSClass()).stop().fadeTo(80,1)},function(){$(p.label_div.node()).find("."+p.getTrackButtonCSSClass()).stop().fadeOut(500)}),function(){$(c).on(t.REMOVE_TRACK,function(e,t){var n=t.track_id;delete p.rule_sets[n],delete p.track_cell_selections[n],delete p.altered_data_percentage[n],p.removeTrackCells(n),p.removeTrackLabels(n),p.removeTrackButtons(n),p.computeTrackCellTops(),p.renderLegend(),p.renderTrackLabels(),p.renderTrackButtons(),p.resizeLabelDiv(),p.resizeCellDiv(),c.sort()}),$(c).on(t.MOVE_TRACK,function(e,t){p.computeTrackCellTops(),p.clipAndPositionCells(t.moved_tracks,"top",!0),p.renderTrackLabels(),p.renderTrackButtons(),c.sort()}),$(c).on(t.ADD_TRACK,function(e,t){p.drawCells(t.track_id),p.clipAndPositionCells(void 0,"top",!0),p.computeTrackCellTops(),p.renderTrackLabels(),p.renderTrackButtons(),p.resizeLabelDiv()}),$(c).on(t.SET_TRACK_DATA,function(e,t){p.drawCells(t.track_id),p.clipAndPositionCells(t.track_id,void 0,!0),p.computeAlteredDataPercentage(t.track_id),p.renderTrackLabels(t.track_id),p.resizeCellDiv(),p.renderLegend()}),$(c).on(t.SET_CELL_PADDING,function(e,t){p.clipAndPositionCells(void 0,void 0,!0),p.resizeCellDiv()}),$(c).on(t.SET_ZOOM,function(e,t){p.clipAndPositionCells(void 0,void 0,!0),p.resizeCells(),p.resizeCellDiv()}),$(c).on(t.SET_VISIBLE_ID_ORDER,function(){p.clipAndPositionCells(void 0,void 0,!0),p.resizeCellDiv()})}()}var t=oncoprint_events,n=oncoprint_utils,a="oncoprint-label-area-ctr",o="oncoprint-cell-area-ctr",r="oncoprint-cell-area",l="oncoprint-column-highlight",c="oncoprint-label-dragging",d="oncoprint-cell-qtip";return n["extends"](e,OncoprintRenderer),e.prototype.computeAlteredDataPercentage=function(e){var t=this.getRuleSet(e);if(t&&t.alteredData){var n=this.oncoprint.getTrackData(e),a=t.alteredData(n).length,o=Math.floor(100*a/n.length);this.altered_data_percentage[e]=o}},e.prototype.getAlteredDataPercentage=function(e){return this.altered_data_percentage[e]},e.prototype.calculateVisibleInterval=function(){var e=(this.oncoprint.getZoomedCellWidth()+this.oncoprint.getCellPadding(),this.cell_container_node.getBoundingClientRect());return this.visible_interval=[this.cell_container_node.scrollLeft,this.cell_container_node.scrollLeft+e.right-e.left],this.visible_interval},e.prototype.getVisibleInterval=function(){return this.visible_interval||this.calculateVisibleInterval()},e.prototype.cellRenderTarget=function(){return i.select(this.document_fragment||this.cell_div.node())},e.prototype.suppressRendering=function(){this.document_fragment=document.createDocumentFragment()},e.prototype.releaseRendering=function(){this.cell_div.node().appendChild(this.document_fragment),this.document_fragment=void 0;var e=this;$(this.cell_div.node()).ready(function(){e.resizeCells(),e.clipAndPositionCells(void 0,void 0,!0)})},e.prototype.setRuleSet=function(e,t,n){OncoprintRenderer.prototype.setRuleSet.call(this,e,t,n),this.active_rule_set_rules[this.getRuleSet(e).getRuleSetId()]={},this.drawCells(e),this.clipAndPositionCells(e,void 0,!0),this.renderLegend(),this.computeAlteredDataPercentage(e),this.renderTrackLabels(e)},e.prototype.useSameRuleSet=function(e,t){OncoprintRenderer.prototype.useSameRuleSet.call(this,e,t),this.drawCells(e),this.clipAndPositionCells(e,void 0,!0),this.renderLegend(),this.computeAlteredDataPercentage(e),this.renderTrackLabels(e)},e.prototype.getLabelDiv=function(){return this.label_div},e.prototype.getLabelDragDiv=function(){return this.label_drag_div},e.prototype.resizeCellDiv=function(){this.cell_div.style("min-width",this.getCellAreaWidth()+"px").style("min-height",this.getCellAreaHeight()+"px"),this.cell_mouseover_div.style("min-width",this.getCellAreaWidth()+"px").style("min-height",this.getCellAreaHeight()+"px"),this.cell_column_highlight.style("height",this.getCellAreaHeight()+"px")},e.prototype.resizeLabelDiv=function(){this.getLabelDiv().style("width",this.getLabelAreaWidth()+"px").style("height",this.getLabelAreaHeight()+"px"),this.getLabelDragDiv().style("width",this.getLabelAreaWidth()+"px").style("height",this.getLabelAreaHeight()+"px")},e.prototype.removeTrackLabels=function(e){e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var t=this.label_div,n=this;s.each(e,function(e){t.selectAll(n.getTrackLabelCSSSelector(e)).remove()})},e.prototype.renderTrackLabels=function(e,t,n){var a=this.label_div;if("undefined"!=typeof t)a.selectAll(this.getTrackLabelCSSSelector(e)).style("top",t+"px");else{e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var o=this.getTrackLabelTops(),i=this,r=this.getLabelAreaWidth(),l=r-this.percent_altered_max_width;s.each(e,function(e){var t=o[e],r=(i.getTrackLabelCSSClass(e),i.oncoprint.getTrackLabel(e)),c=r;r.length>i.max_label_length&&!n&&(c=r.substring(0,i.max_label_length-3)+"..."),s.each(a.selectAll(i.getTrackLabelCSSSelector(e)),function(e){$(e).qtip("destroy")}),a.selectAll(i.getTrackLabelCSSSelector(e)).remove();var d=a.append("span").style("position","absolute").classed(i.getTrackLabelCSSClass(e),!0).classed("oncoprint-track-label-draggable",!0).classed("oncoprint-track-label-main",!0).classed("oncoprint-track-label",!0).classed("noselect",!0).style("font-family",i.getLabelFont()).style("font-weight","bold").text(c).style("top",t+"px").on("mousedown",function(){i.dragLabel(e)});$(d.node()).qtip({content:{text:r.length>i.max_label_length?r+"<br> hold to drag":"hold to drag"},position:{my:"middle right",at:"middle left",viewport:$(window)},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow"},show:{event:"mouseover"}});var u=i.getAlteredDataPercentage(e);"undefined"!=typeof u&&a.append("span").style("position","absolute").classed(i.getTrackLabelCSSClass(e),!0).classed("oncoprint-track-label",!0).classed("noselect",!0).style("font-family",i.getLabelFont()).text(u+"%").style("top",t+"px").style("left",l+"px")})}},e.prototype.getTrackButtonCSSClass=function(e){return"oncoprint-track-button"+n.ifndef(e,"")},e.prototype.removeTrackButtons=function(e){var t=this.label_div;e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var n=this;s.each(e,function(e){t.selectAll("."+n.getTrackButtonCSSClass(e)).remove()})},e.prototype.renderTrackButtons=function(e){var t=this.label_div;e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var n=this.getTrackLabelTops(),a=this,o=this.getLabelAreaWidth();s.each(e,function(e){var i=a.getTrackButtonCSSClass(e);t.selectAll("."+i).remove();var r=o-15;a.oncoprint.isTrackRemovable(e)&&(!function(){var o=t.append("span").classed("noselect",!0).style("font-size","12px").style("color","#87CEFA").style("cursor","pointer").classed(i,!0).classed(a.getTrackButtonCSSClass(),!0).on("click",function(){a.oncoprint.removeTrack(e)}).style("position","absolute").style("left",r+"px").style("top",n[e]+"px");o.text("X"),$(o.node()).hover(function(){o.style("font-size","15px").style("color","#0000FF")},function(){o.style("font-size","12px").style("color","#87CEFA")}).qtip({content:{text:"Click to remove"},position:{my:"bottom middle",at:"top middle",viewport:$(window)},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow"},show:{event:"mouseover"},hide:{fixed:!0,delay:100,event:"mouseout"}})}(),r-=35),a.oncoprint.isTrackSortDirectionChangable(e)&&!function(){var o=["images/decreaseSort.svg","images/increaseSort.svg","images/nonSort.svg"],s=["Click to sort in descending order","Click to not sort on this track","Click to sort in ascending order"],l=[1,-1,0],c=l.indexOf(a.oncoprint.getTrackSortDirection(e)),d=t.append("img");d.attr("src",o[c]).style("cursor","pointer"),$(d.node()).qtip({content:{text:function(){return s[c]}},position:{my:"bottom middle",at:"top middle",viewport:$(window)},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow"},show:{event:"mouseover"},hide:{fixed:!0,delay:100,event:"mouseout"}}),d.classed(i,!0).classed(a.getTrackButtonCSSClass(),!0).on("click",function(){c=(c+1)%3,a.oncoprint.setTrackSortDirection(e,l[c]),d.attr("src",o[c])}).style("position","absolute").style("left",r+"px").style("top",n[e]+"px")}()})},e.prototype.resizeCells=function(e){this.cell_div.selectAll("svg."+this.getCellCSSClass()).style("width",this.oncoprint.getZoomedCellWidth()+"px")},e.prototype.removeTrackCells=function(e){this.cell_div.selectAll("svg."+this.getTrackCellCSSClass(e)).remove()},e.prototype.drawTrackCells=function(e,t){var n=this.oncoprint,a=n.getTrackData(e),o=(n.getTrackDatumIdKey(e),n.getTrackDatumIdAccessor(e)),r=this.getRuleSet(e);if(r){var s=this;this.track_cells[e]={};var l=this.getCellCSSClass(),c=this.getTrackCellCSSClass(e),d=this.track_cells[e],u=i.select(t).selectAll("svg."+c).data(a);u.enter().append("svg").classed(c,!0).classed(l,!0).attr("shape-rendering","geometricPrecision").attr("preserveAspectRatio","none").attr("viewBox","0 0 "+n.getFullCellWidth()+" "+n.getCellHeight(e)).style("width",n.getZoomedCellWidth()+"px").style("height",n.getCellHeight(e)+"px"),u.exit().remove();n.getTrackTooltip(e);u.each(function(e,t){var n=o(e);d[n]={dom:this,d:e}}),u.selectAll("*").remove(),this.active_rule_set_rules[r.getRuleSetId()][e]=r.apply(u,n.getFullCellWidth(),n.getCellHeight(e)),s.track_cell_selections[e]=u}},e.prototype.drawCells=function(e){var n;n=this.document_fragment?document.createDocumentFragment():this.cell_div.node(),e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var a=this;s.each(e,function(e){a.drawTrackCells(e,n)}),this.document_fragment&&this.cellRenderTarget().node().appendChild(n),setTimeout(function(){$(a).trigger(t.FINISHED_RENDERING)},0)},e.prototype.clipAndPositionCells=function(e,t,n,a){this.cell_div.node().display="none",e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var o=this.getVisibleInterval(),i=4*(o[1]-o[0]),r=Math.floor(o[0]/i);o=s.map([-i,2*i],function(e){return Math.max(e+r*i,0)});var l=this,c=this.getTrackCellTops(),d=this.oncoprint.getVisibleInvertedIdOrder(),u=this.getCellXArray(Object.keys(d).length);s.each(e,function(e){var i;t&&"top"!==t||(i=c[e]);var s=l.oncoprint.getTrackDatumIdKey(e);(r!==l.prev_interval_number||n)&&l.track_cell_selections.hasOwnProperty(e)&&l.track_cell_selections[e].each(function(e,n){var r=u[d[e[s]]],l=this.style.display,c=(isNaN(r)||r<o[0]||r>o[1])&&!a?"none":"inherit";l!==c&&(this.style.display=c),t&&"left"!==t||"none"===c||(this.style.left=r+"px"),t&&"top"!==t||"none"===c||(this.style.top=i+"px")})}),this.prev_interval_number=r,this.cell_div.node().display="block"},e.prototype.setLegendVisible=function(e,t){var n=this;e="undefined"==typeof e?this.oncoprint.getTracks():[].concat(e),s.each(e,function(e){n.getRuleSet(e).exclude_from_legend=!t}),this.renderLegend()},e.prototype.renderLegend=function(e){var t=this.oncoprint.getFullCellWidth(),a=this,o={};a.legend_table.selectAll("*").remove(),s.each(this.rule_sets,function(r,l){if(!r.exclude_from_legend||e){var c=r.getRuleSetId(),d={};if(s.each(a.active_rule_set_rules[c],function(e,t){$.extend(d,e)}),!o.hasOwnProperty(c)){var u=a.legend_table.append("tr"),p=u.append("td").style("padding-top","1em").style("padding-bottom","1em").append("span").classed("oncoprint-legend-header",!0);p.text(r.getLegendLabel());var h=u.append("td"),g=r.getLegendDiv(d,t,a.oncoprint.getCellHeight(l));h.node().appendChild(g),n.d3SelectChildren(i.select(g),"*").classed("oncoprint-legend-block-span",!0),o[c]=!0}}})},e.prototype.dragLabel=function(e){this.getLabelDragDiv().style("display","block");var t=this.oncoprint.getContainingTrackGroup(e),a=t[0],o=t[t.length-1],r=this.getTrackLabelTops(),l={};s.each(t,function(e){l[e]=r[e]}),t.splice(t.indexOf(e),1);var d=s.map(t,function(e){return l[e]}),u=this.getLabelAreaHeight(),p=[void 0,void 0];p[0]=n.clamp(l[a],0,u),p[1]=n.clamp(l[o]+this.getRenderedTrackHeight(o),0,u);var h=this,g=$(h.getLabelDragDiv().node());delete l[e],function(e){var a=-1,o=function(o){o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault();var r=n.clamp(n.mouseY(o),p[0],p[1]);h.renderTrackLabels(e,r),i.selectAll(h.getTrackLabelCSSSelector(e)).classed(c,!0),a=s.sortedIndex(d,r),s.each(l,function(e,n){e+=3*+(a<t.length&&t[a]==n),e-=3*+(a>0&&t[a-1]==n),h.renderTrackLabels(n,e)})};g.on("mousemove",o);var r=function(t){g.hide(),g.off("mousemove",o),a>-1&&h.oncoprint.moveTrack(e,a)};$(document).one("mouseup",r)}(e)},e.prototype.toSVG=function(e){var t=this,a=$(this.container.node()).offset(),o=i.select(document.createElementNS("http://www.w3.org/2000/svg","svg"));return o.attr("width",this.getLabelAreaWidth()+this.getCellAreaWidth()+"px"),this.renderLegend(!0),this.renderTrackLabels(void 0,void 0,e),o.attr("height",$(this.container.node()).height()+"px"),function(){t.label_div.selectAll(".oncoprint-track-label").each(function(){var e=i.select(this),t=e.style("font-family")||"Arial",r=e.style("font-weight"),s=e.style("font-size")||"12px",l=$(e.node()).offset(),c=e.text();o.append("text").style("font-family",t).style("font-weight",r).style("font-size",s).attr("transform",n.translate(l.left-a.left,l.top-a.top)).style("alignment-baseline","hanging").text(c)})}(),function(){t.clipAndPositionCells(void 0,void 0,!0,!0),t.cell_div.selectAll(".oncoprint-cell").each(function(){var e=i.select(this),t=e.node().getBoundingClientRect(),r={width:t.width,height:t.height},s=$(e.node()).offset(),l=o.append("g").attr("transform",n.translate(s.left-a.left,s.top-a.top));e.selectAll("*").each(function(){n.appendD3SVGElement(i.select(this),l)});var c={color:e.style("outline-color"),width:e.style("outline-width")};c.color&&l.append("rect").attr("width",r.width+"px").attr("height",r.height+"px").style("fill","none").style("stroke",c.color).style("stroke-width",c.width)}),t.clipAndPositionCells(void 0,void 0,!0)}(),function(){t.legend_table.selectAll("tr").each(function(){i.select(this).selectAll("td").each(function(){i.select(this).selectAll(".oncoprint-legend-header,.oncoprint-legend-element").each(function(){if($(this).text().trim().length){var e=i.select(this),t=e.style("font-family")||"Arial",r=e.style("font-weight"),s=e.style("font-size")||"12px",l=e.text(),c=$(e.node()).offset();o.append("text").style("font-family",t).style("font-weight",r).style("font-size",s).attr("transform",n.translate(c.left-a.left,c.top-a.top)).style("alignment-baseline","hanging").text(l)}else if("svg"===this.tagName.toLowerCase()){var d=i.select(this),c=$(d.node()).offset(),u=o.append("g").attr("transform",n.translate(c.left-a.left,c.top-a.top)),p=d.node().getBoundingClientRect(),h={width:p.width,height:p.height},g={color:d.style("outline-color"),width:d.style("outline-width")};g.color&&u.append("rect").attr("width",h.width+"px").attr("height",h.height+"px").style("fill","none").style("stroke",g.color).style("stroke-width",g.width),d.selectAll("*").each(function(){n.appendD3SVGElement(i.select(this),u)})}})})})}(),this.renderLegend(),this.renderTrackLabels(),o.node()},e}();e.setBusy(!0)("Loading Dataset"),e.setDataset(g.datasource).then(function(t){var n=t.payload.rownames.filter(function(e){return e.indexOf("mtx")>=0}),n=(t.payload.tbl,n[n.length-1].replace(".RData",""));o.$watchGroup(["vm.optCohortPatient","vm.optCohortGene"],function(){var e=g.optCohortPatient.ids.toString()+", "+g.optCohortGene.ids.toString();y(e)}),e.setBusy(!1)});var v="",b=function(e){if(v!=e)switch(e){case"instructions":c.hide(),d.show(),u.hide();break;case"control":c.show(),d.hide(),u.show();break;case"errors":c.hide(),d.show(),u.hide()}},y=function(t){if("*"==g.optCohortPatient.ids||"*"==g.optCohortGene.ids)return void b("instructions");var n=t;n=n.split(","),n.length>350?(g.errorMessage="ERROR: The total number of Patients and Genes are set to be less than 350.",b("errors")):(e.setBusy(!0),e.getOncoprint(n),e.getOncoprint(n).then(function(t){var n=t.payload;l(n),b("control"),e.setBusy(!1)}))}}e.$inject=["osApi","$state","$stateParams","$timeout","$scope","d3","$window","_"];var t={restrict:"E",templateUrl:"app/components/oncoprint/oncoprint.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osOncoprint",e)}(),/*
 * Copyright (c) 2015 Memorial Sloan-Kettering Cancer Center.
 *
 * This library is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY, WITHOUT EVEN THE IMPLIED WARRANTY OF MERCHANTABILITY OR FITNESS
 * FOR A PARTICULAR PURPOSE. The software and documentation provided hereunder
 * is on an "as is" basis, and Memorial Sloan-Kettering Cancer Center has no
 * obligations to provide maintenance, support, updates, enhancements or
 * modifications. In no event shall Memorial Sloan-Kettering Cancer Center be
 * liable to any party for direct, indirect, special, incidental or
 * consequential damages, including lost profits, arising out of the use of this
 * software and its documentation, even if Memorial Sloan-Kettering Cancer
 * Center has been advised of the possibility of such damage.
 */
/*
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
oncoprint_events={ADD_TRACK:"add_track.oncoprint",REMOVE_TRACK:"remove_track.oncoprint",MOVE_TRACK:"move_track.oncoprint",SORT:"sort.oncoprint",SET_CELL_PADDING:"set_cell_padding.oncoprint",SET_CELL_WIDTH:"set_cell_width.oncoprint",SET_TRACK_DATA:"set_track_data.oncoprint",SET_ID_ORDER:"set_id_order.oncoprint",CELL_CLICK:"cell_click.oncoprint",CELL_MOUSEENTER:"cell_mouseenter.oncoprint",CELL_MOUSELEAVE:"cell_mouseleave.oncoprint",ONCOPRINT_MOUSEENTER:"oncoprint_mouseenter.oncoprint",ONCOPRINT_MOUSELEAVE:"oncoprint_mouseleave.oncoprint",SET_PRE_TRACK_PADDING:"set_pre_track_padding.oncoprint",TRACK_INIT:"init.track.oncoprint",UPDATE_RENDER_RULES:"update_render_rules.cell_renderer.oncoprint",FINISHED_RENDERING:"finished_rendering.oncoprint",FINISHED_POSITIONING:"finished_positioning.renderer.oncoprint",SET_ZOOM:"set_zoom.oncoprint",SET_SORT_DIRECTION:"set_sort_direction.oncoprint",SET_VISIBLE_ID_ORDER:"set_visible_ids.oncoprint"},oncoprint_defaults=function(){var e=window.oncoprint_utils,t=function(t){var n="cna",a=e.invert_array(["AMPLIFIED","HOMODELETED","GAINED","HEMIZYGOUSLYDELETED","DIPLOID",void 0]),o="mut_type",i=function(){if(t){var n=e.invert_array(["TRUNC","INFRAME","MISSENSE",void 0]);return function(e){return n[e]}}return function(e){return+("undefined"==typeof e)}}(),r="mrna",s="rppa",l=e.invert_array(["UPREGULATED","DOWNREGULATED",void 0]);return function(t,c){var d=e.sign(a[t[n]]-a[c[n]]);if(0!==d)return d;var u=e.sign(i(t[o])-i(c[o]));if(0!==u)return u;var p=e.sign(l[t[r]]-l[c[r]]);if(0!==p)return p;var h=e.sign(l[t[s]]-l[c[s]]);return 0!==h?h:0}},n={"default":[{shape:"full-rect",color:"#D3D3D3",z_index:-1}],altered:{cna:{AMPLIFIED:{shape:"full-rect",color:"red",legend_label:"Amplification"},GAINED:{shape:"full-rect",color:"#FFB6C1",legend_label:"Gain"},HOMODELETED:{shape:"full-rect",color:"#0000FF",legend_label:"Deep Deletion"},HEMIZYGOUSLYDELETED:{shape:"full-rect",color:"#8FD8D8",legend_label:"Shallow Deletion"}},mrna:{UPREGULATED:{shape:"outline",color:"#FF9999",legend_label:"mRNA Upregulation"},DOWNREGULATED:{shape:"outline",color:"#6699CC",legend_label:"mRNA Downregulation"}},rppa:{UPREGULATED:{shape:"small-up-arrow",color:"black",legend_label:"Protein Upregulation"},DOWNREGULATED:{shape:"small-down-arrow",color:"black",legend_label:"Protein Downregulation"}}},legend_label:"Genetic Alteration"},a=$.extend(!0,{},n);a.altered.mut_type={"*":{shape:"middle-rect",color:"green",legend_label:"Mutation"}};var o=$.extend(!0,{},n);return o.altered.mut_type={MISSENSE:{shape:"middle-rect",color:"green",legend_label:"Missense Mutation"},INFRAME:{shape:"middle-rect",color:"#9F8170",legend_label:"Inframe Mutation"},TRUNC:{shape:"middle-rect",color:"black",legend_label:"Truncating Mutation"},FUSION:{shape:"large-right-arrow",color:"black",legend_label:"Fusion"}},{genetic_alteration_config:o,genetic_alteration_config_nondistinct_mutations:a,genetic_alteration_comparator:t(!0),genetic_alteration_comparator_nondistinct_mutations:t(!1)}}(),oncoprint_RuleSet=function(){function e(e){b.call(this,e),this.type=c;var t=this,n=["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"],a=function(n,a){var o=s.makeD3SVGElement("rect").attr("fill",n),i=function(t){return function(n){return e.getCategory(n)===t}}(a);t.addStaticRule({condition:i,shape:o,legend_label:a})};e.color=e.color||{},_.each(e.color,function(e,t){a(e,t)}),t.addStaticRule(v(function(t){return"NA"===e.getCategory(t)},"NA")),this.sort_cmp=e.sort_cmp||function(t,n){var a=e.getCategory(t),o=e.getCategory(n);return"string"!=typeof a&&(a=a.toString()),"string"!=typeof o&&(o=o.toString()),a===o?0:"NA"===a?Number.POSITIVE_INFINITY:"NA"===o?Number.NEGATIVE_INFINITY:a.localeCompare(o)},t.apply=function(t,o,i){return t.each(function(t,o){var i=e.getCategory(t);if(!e.color.hasOwnProperty(i)&&"NA"!==i){var r=n.pop();e.color[i]=r,a(r,i)}}),b.prototype.apply.call(this,t,o,i)},t.getLegendDiv=function(e,n,a){var o=d3.select(document.createElement("div"));return _.each(t.getRules(),function(t){if(e[t.rule_id]){var i=t.getLegendDiv(n,a);i&&o.node().appendChild(i)}}),s.d3SelectChildren(o,"*").style("padding-right","20px"),o.node()}}function t(e){b.call(this,e),this.type=d,this.data_key=e.data_key;var t=this.addGradientRule({shape:s.makeD3SVGElement("rect"),data_key:e.data_key,data_range:e.data_range,color_range:e.color_range,scale:e.scale,na_color:e.na_color});this.addStaticRule(v(function(t){return isNaN(t[e.data_key])},"NA")),this.sort_cmp=e.sort_cmp||$.proxy(f,this),this.getLegendDiv=function(e,n,a){return e[t]&&this.rule_map[t].getLegendDiv(n,a)||$("<div>")[0]}}function n(e){b.call(this,e);var t=this;t.type=p,t.data_key=e.data_key;var n=this.addBarChartRule({data_key:e.data_key,data_range:e.data_range,scale:e.scale,fill:e.fill,na_color:e.na_color});this.addStaticRule(v(function(t){return isNaN(t[e.data_key])},"NA")),this.sort_cmp=e.sort_cmp||$.proxy(f,this),this.getLegendDiv=function(e,t,a){return e[n]&&this.rule_map[n].getLegendDiv(t,a)||$("<div>")[0]}}function a(e){e=e&&e.dont_distinguish_mutation_color?$.extend({},e,l.genetic_alteration_config_nondistinct_mutations):$.extend({},e,l.genetic_alteration_config),e&&e.distinguish_mutation_order?this.sort_cmp=l.genetic_alteration_comparator:this.sort_cmp=l.genetic_alteration_comparator_nondistinct_mutations,b.call(this,e);var t=this;t.type=u;var n=function(e,n,a){var o,i,r,l,c="undefined"!=typeof n&&"undefined"!=typeof a?function(e,t){return t===g?function(t){return"undefined"!=typeof t[e]}:function(n){return n[e]===t}}(n,a):void 0;switch(e.shape){case"full-rect":o=s.makeD3SVGElement("rect"),i={fill:e.color,width:"100%",height:"100%"},r={},l=s.ifndef(e.z_index,0);break;case"middle-rect":o=s.makeD3SVGElement("rect"),i={fill:e.color,width:"100%",height:"33.33%",y:"33.33%"},r={},l=s.ifndef(e.z_index,1);break;case"large-right-arrow":o=s.makeD3SVGElement("polygon"),i={points:"0%,0% 100%,50% 0%,100%"},r={"stroke-width":"0px",fill:e.color},l=s.ifndef(e.z_index,2);break;case"small-up-arrow":o=s.makeD3SVGElement("polygon"),i={points:"50%,0% 100%,25% 0%,25%"},r={"stroke-width":"0px",fill:e.color},l=s.ifndef(e.z_index,3);break;case"small-down-arrow":o=s.makeD3SVGElement("polygon"),i={points:"50%,100% 100%,75% 0%,75%"},r={"stroke-width":"0px",fill:e.color},l=s.ifndef(e.z_index,4);break;case"outline":o=h,r={"outline-color":e.color,"outline-style":"solid","outline-width":"2px"},l=s.ifndef(e.z_index,5)}var d=t.addStaticRule({condition:c,shape:o,attrs:i,styles:r,z_index:l,legend_label:e.legend_label,exclude_from_legend:"undefined"==typeof e.legend_label});return d},a=[];_.each(e.altered,function(e,t){_.each(e,function(e,o){a.push(n(e,t,o))})}),_.each(e["default"],function(e){n(e)}),t.getLegendDiv=function(e,n,a){var o=d3.select(document.createElement("div"));return _.each(t.getRules(),function(t){if(e[t.rule_id]){var i=t.getLegendDiv(n,a);i&&o.node().appendChild(i)}}),s.d3SelectChildren(o,"*").style("padding-right","20px"),o.node()},t.alteredData=function(e){var n=[];return _.each(a,function(a){n=n.concat(t.getRule(a).filterData(e))}),_.uniq(n)}}function o(e,t){y.call(this,e,t),this.data_key=e.data_key,this.data_range=e.data_range,this.inferred_data_range,this.attrs.fill=function(t){return isNaN(t[e.data_key])?e.na_color:e.fill},this.na_color=e.na_color;var n=function(t){return"log"===e.scale?Math.log10(Math.max(Math.abs(t),.1)):t},a=function(t){var n={};return n[e.data_key]=t,n};this.setUpHelperFunctions=function(t){var a=_.map(t,n),o=function(t){var o=n(t[e.data_key]),i=Math.abs(o-a[0])/Math.abs(a[1]-a[0]);return 100*i},i=function(t){return(isNaN(t[e.data_key])?"0":100-o(t))+"%"},r=function(t){return(isNaN(t[e.data_key])?"100":o(t))+"%"};this.attrs.height=r,this.attrs.y=i},this.inferDataRange=function(e){var t=this,n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;return e.each(function(e,o){var i=e[t.data_key],r=isNaN(i);n=Math.min(n,r?Number.POSITIVE_INFINITY:i),a=Math.max(a,r?Number.NEGATIVE_INFINITY:i)}),[n,a]},this.getEffectiveDataRange=function(){if("undefined"==typeof this.data_range)return this.inferred_data_range;var e=[];return e[0]="undefined"==typeof this.data_range[0]?this.inferred_data_range[0]:this.data_range[0],e[1]="undefined"==typeof this.data_range[1]?this.inferred_data_range[1]:this.data_range[1],e},this.getLegendDiv=function(t,n){if(this.showInLegend()){var o=d3.select(document.createElement("div")),i=this.getEffectiveDataRange();if(!i)return o.node();var r=_.map(i,function(t){var n=Math.pow(10,s.ifndef(e.legend_num_decimal_digits,2));return Math.round(t*n)/n});o.append("span").text(r[0]).classed("oncoprint-legend-label oncoprint-legend-element",!0).style("position","relative").style("bottom","0px");for(var l=50,c=o.append("svg").attr("width",l+"px").attr("height",n+"px").classed("oncoprint-legend-element",!0),d=0;l>=d;d++){var u=d/l,p=(1-u)*i[0]+u*i[1],h=a(p),g=n*parseInt(this.attrs.height(h))/100;c.append("rect").attr("width","1px").attr("height",g+"px").attr("y",n-g+"px").attr("fill",e.fill).attr("x",d+"px")}return o.append("span").text(r[1]).classed("oncoprint-legend-label oncoprint-legend-element",!0).style("position","relative").style("bottom",n-3+"px"),s.d3SelectChildren(o,"*").style("padding-right","10px"),o.node()}},this.apply=function(e,t,n){0!==e[0].length&&(this.inferred_data_range=this.inferDataRange(e),this.setUpHelperFunctions(this.getEffectiveDataRange()),y.prototype.apply.call(this,e,t,n))}}function i(e,t){y.call(this,e,t),this.data_key=e.data_key,this.data_range=e.data_range,this.inferred_data_range,this.color_range=e.color_range,this.na_color=e.na_color;var n=function(t){var n={};return n[e.data_key]=t,n},a=function(t){return"log"===e.scale?Math.log10(Math.max(t,.1)):t};this.setUpHelperFunctions=function(t){var n=_.map(t,a),o=function(t){if(isNaN(t[e.data_key]))return e.na_color;var o=a(t[e.data_key]),i=([n[0],n[1]],(o-n[0])/(n[1]-n[0]));return color_range=[d3.rgb(e.color_range[0]).toString(),d3.rgb(e.color_range[1]).toString()],s.lin_interp(i,e.color_range[0],e.color_range[1])};this.attrs.fill=o},this.inferDataRange=function(e){var t=this,n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;return e.each(function(e,o){var i=e[t.data_key],r=isNaN(i);n=Math.min(n,r?Number.POSITIVE_INFINITY:i),a=Math.max(a,r?Number.NEGATIVE_INFINITY:i)}),[n,a]},this.getLegendDiv=function(t,a){if(this.showInLegend()){var o=d3.select(document.createElement("div")),i=this.data_range||this.inferred_data_range;if(!i)return o.node();var r=_.map(i,function(t){var n=Math.pow(10,s.ifndef(e.legend_num_decimal_digits,2));return Math.round(t*n)/n});o.append("span").text(r[0]).classed("oncoprint-legend-label oncoprint-legend-element",!0).style("position","relative").style("bottom",a/2-3+"px");for(var l=50,c=o.append("svg").attr("width",l+"px").attr("height",a+"px").classed("oncoprint-legend-element",!0),d=0;l>=d;d++){var u=d/l,p=(1-u)*i[0]+u*i[1],h=n(p);c.append("rect").attr("width","1px").attr("height",a+"px").attr("fill",this.attrs.fill(h)).attr("x",d+"px")}return o.append("span").text(r[1]).classed("oncoprint-legend-label oncoprint-legend-element",!0).style("position","relative").style("bottom",a/2-3+"px"),s.d3SelectChildren(o,"*").style("padding-right","10px"),o.node()}},this.apply=function(e,t,n){this.setUpHelperFunctions(this.data_range||(this.inferred_data_range=this.inferDataRange(e))),y.prototype.apply.call(this,e,t,n)}}function r(e,t){y.call(this,e,t),this.getLegendDiv=function(e,t){if(this.showInLegend()){var n=d3.select(document.createElement("div")),a=n.append("div").classed("oncoprint-legend-block",!0),o=a.append("svg").attr("width",e+"px").attr("height",t+"px").classed("oncoprint-legend-element",!0);return this.apply(o,e,t),this.legend_label&&n.append("span").text(this.legend_label).classed("oncoprint-legend-label oncoprint-legend-element",!0).style("position","relative").style("bottom",t/2-3+"px"),s.d3SelectChildren(n,"*").style("padding-right","10px"),n.node()}}}var s=oncoprint_utils,l=oncoprint_defaults,c="categorical_color",d="gradient_color",u="genetic_alteration",p="bar_chart",h="cell",g="*",m=s.makeIdCounter(),f=function(e,t){var n=parseFloat(e[this.data_key],10),a=parseFloat(t[this.data_key],10),o=isNaN(n),i=isNaN(a);return o&&i?0:o||i?o?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:a>n?-1:n>a?1:0},v=function(e,t){return{condition:e,shape:s.makeD3SVGElement("rect"),attrs:{fill:"#eeeeee",width:"100%",height:"100%"},legend_label:t,children:[{condition:e,shape:s.makeD3SVGElement("path"),attrs:{d:"m 0% 0% L 100% 100%"},styles:{"stroke-width":"1px",stroke:"#555555"},legend_label:t}]}},b=function(){function e(e){this.rule_map={},this.rule_set_id=m(),this.legend_label=e.legend_label,this.exclude_from_legend=!1}var t=s.makeIdCounter();return e.prototype.getLegendLabel=function(){return this.legend_label},e.prototype.getRuleSetId=function(){return this.rule_set_id},e.prototype.addRule=function(e){var n=t();return this.rule_map[n]=new y(e,n),n},e.prototype.addStaticRule=function(e){var n=t();return this.rule_map[n]=new r(e,n),n},e.prototype.addGradientRule=function(e){var n=t();return this.rule_map[n]=new i(e,n),n},e.prototype.addBarChartRule=function(e){var n=t();return this.rule_map[n]=new o(e,n),n},e.prototype.removeRule=function(e){delete this.rule_map[e]},e.prototype.getRules=function(){var e=this,t=Object.keys(this.rule_map),n=_.map(t,function(t){return e.rule_map[t]}),a=_.sortBy(n,function(e){return e.z_index});return a},e.prototype.apply=function(e,t,n){var a={};return _.each(this.getRules(),function(o){var i=o.filter(e);i[0].length>0&&(a[o.rule_id]=!0),o.apply(i,t,n)}),a},e.prototype.getRule=function(e){return this.rule_map[e]},e}();e.prototype=Object.create(b.prototype),t.prototype=Object.create(b.prototype),n.prototype=Object.create(b.prototype),a.prototype=Object.create(b.prototype);var y=function(){function e(t,n){this.rule_id=n,this.condition=t.condition||function(e){return!0},this.shape="undefined"==typeof t.shape?s.makeD3SVGElement("rect"):t.shape,this.z_index="undefined"==typeof t.z_index?this.rule_id:t.z_index,this.legend_label=t.legend_label,this.exclude_from_legend=t.exclude_from_legend,this.attrs=t.attrs||{},this.attrs.width=s.ifndef(this.attrs.width,"100%"),this.attrs.height=s.ifndef(this.attrs.height,"100%"),this.attrs.x=s.ifndef(this.attrs.x,0),this.attrs.y=s.ifndef(this.attrs.y,0),this.styles=t.styles||{},this.children=_.map(t.children,function(t){return new e(t)})}var t=function(e,t,n,a){var o=["width","x"],i=["height","y"];return e=parseFloat(e,10)/100,o.indexOf(t)>-1?e*=n:i.indexOf(t)>-1&&(e*=a),e+""},n=function(e,n,a,o,i,r){var s=a;if("function"==typeof s&&(s=s(e,n)),"string"==typeof s&&s.indexOf("%")>-1)if("points"===o)s=_.map(s.split(" "),function(e){var n=e.split(","),a=t(n[0],"x",i,r),o=t(n[1],"y",i,r);return a+","+o}).join(" ");else{if("d"===o){for(var l=s.split(/\s+/),n=0,c=l.length;c>n;n++){var d=l[n].toLowerCase();("m"===d||"l"===d)&&(l[n+1]=t(l[n+1],"x",i,r),l[n+2]=t(l[n+2],"y",i,r),n+=2)}return l.join(" ")}s=t(s,o,i,r)}return s};return e.prototype.apply=function(e,t,a){var o=this.shape,i=o===h?e:s.appendD3SVGElement(o,e),r=this.styles,l=this.attrs;l.x=l.x||0,l.y=l.y||0,_.each(l,function(e,o){i.attr(o,function(i,r){return n(i,r,e,o,t,a)})}),_.each(r,function(e,t){i.style(t,e)}),_.each(this.children,function(n){n.apply(e,t,a)})},e.prototype.filter=function(e){return e.filter(this.condition)},e.prototype.filterData=function(e){return e.filter(this.condition)},e.prototype.showInLegend=function(){return!this.exclude_from_legend},e}();return o.prototype=Object.create(y.prototype),i.prototype=Object.create(y.prototype),r.prototype=Object.create(y.prototype),{CATEGORICAL_COLOR:c,GRADIENT_COLOR:d,GENETIC_ALTERATION:u,BAR_CHART:p,makeRuleSet:function(o,i){return o===c?new e(i):o===d?new t(i):o===u?new a(i):o===p?new n(i):new b}}}(),/*
 * Copyright (c) 2015 Memorial Sloan-Kettering Cancer Center.
 *
 * This library is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY, WITHOUT EVEN THE IMPLIED WARRANTY OF MERCHANTABILITY OR FITNESS
 * FOR A PARTICULAR PURPOSE. The software and documentation provided hereunder
 * is on an "as is" basis, and Memorial Sloan-Kettering Cancer Center has no
 * obligations to provide maintenance, support, updates, enhancements or
 * modifications. In no event shall Memorial Sloan-Kettering Cancer Center be
 * liable to any party for direct, indirect, special, incidental or
 * consequential damages, including lost profits, arising out of the use of this
 * software and its documentation, even if Memorial Sloan-Kettering Cancer
 * Center has been advised of the possibility of such damage.
 */
/*
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
OncoprintRenderer=function(){function e(e,n){this.rule_sets={},this.clipping=!0,this.oncoprint=e,this.config=n,this.upper_padding=t.ifndef(n.upper_padding,0),this.max_label_length=t.ifndef(n.max_label_length,20),this.track_group_separation=12,function(e){var n=e.getLabelFont(),a=t.textWidth((Math.pow(10,e.max_label_length)-1).toString(),n),o=t.textWidth("100%",n),i=20;e.label_area_width=a+i+o}(this)}var t=(oncoprint_events,oncoprint_utils),n=oncoprint_RuleSet;return e.prototype.getCellCSSClass=function(){return"oncoprint-cell"},e.prototype.getTrackCellCSSClass=function(e){return this.getCellCSSClass()+e},e.prototype.getTrackLabelCSSClass=function(e){return"oncoprint-track-label oncoprint-track-label"+e},e.prototype.getTrackLabelCSSSelector=function(e){return"."+this.getTrackLabelCSSClass(e).split(" ").join(".")},e.prototype.getTrackCellCtrCSSClass=function(e){return"oncoprint-track-cell-ctr"+e},e.prototype.getLabelFont=function(){return this.config.label_font},e.prototype.setRuleSet=function(e,t,a){var o=n.makeRuleSet(t,a);this.rule_sets[e]=o,o.sort_cmp&&this.oncoprint.setTrackSortComparator(e,o.sort_cmp)},e.prototype.useSameRuleSet=function(e,t){var n=this.rule_sets[t];this.rule_sets[e]=n,n.sort_cmp&&this.oncoprint.setTrackSortComparator(e,n.sort_cmp)},e.prototype.getRuleSet=function(e){return this.rule_sets[e]},e.prototype.getTrackTops=function(){var e={},t=this.upper_padding,n=this;return _.each(this.oncoprint.getTrackGroups(),function(a){0!==a.length&&(_.each(a,function(a){e[a]=t,t+=n.getRenderedTrackHeight(a)}),t+=n.track_group_separation)}),e},e.prototype.getTrackCellTops=function(){return this.track_cell_tops||this.computeTrackCellTops()},e.prototype.computeTrackCellTops=function(){var e=this.getTrackTops(),t=this;return _.each(e,function(n,a){e[a]=n+t.oncoprint.getTrackPadding(a)}),this.track_cell_tops=e,e},e.prototype.getTrackLabelTops=function(){return this.getTrackCellTops()},e.prototype.getRenderedTrackHeight=function(e){return this.oncoprint.getTrackHeight(e)+2*this.oncoprint.getTrackPadding(e)},e.prototype.getCellX=function(e){return"number"==typeof e?e*(this.oncoprint.getZoomedCellWidth()+this.oncoprint.getCellPadding()):-1},e.prototype.getCellXArray=function(e){var t=this.oncoprint.getZoomedCellWidth()+this.oncoprint.getCellPadding();return _.map(_.range(0,e),function(e){return e*t})},e.prototype.getCellAreaWidth=function(){return this.oncoprint.getVisibleIdOrder().length*(this.oncoprint.getZoomedCellWidth()+this.oncoprint.getCellPadding())},e.prototype.getCellAreaHeight=function(){var e=this.getTrackTops(),t=this.oncoprint.getTracks();if(0===t.length)return 0;var n=t[t.length-1];return e[n]+this.getRenderedTrackHeight(n)},e.prototype.getLabelAreaWidth=function(){return this.label_area_width},e.prototype.getLabelAreaHeight=function(){return this.getCellAreaHeight()},e.prototype.render=function(){throw"not implemented in abstract class"},e}(),function(){"use strict";function e(){function e(e,t,n,a,o){if(angular.isUndefined(o.datasource))return void t.go("datasource");var i=this;i.dataset=o.datasource,i.colnames=[],i.rows=[],i.search="",i.toggleFilter=function(){angular.element(".container-filters").toggleClass("container-filters-collapsed"),angular.element(".container-filter-toggle").toggleClass("container-filter-toggle-collapsed")};var r;e.setBusy(!0),e.getDataManifest(i.dataset).then(function(t){i.colnames=t.payload.colnames,i.rows=t.payload.mtx,n(function(){r=angular.element("#metadata-datatable").dataTable({paging:!1}),a.$watch("vm.search",function(){r.api().search(i.search).draw()}),e.setBusy(!1)},0,!1)})}e.$inject=["osApi","$state","$timeout","$scope","$stateParams"];var t={restrict:"E",templateUrl:"app/components/metadata/metadata.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osMetadata",e)}(),function(){"use strict";function e(){function e(e,t){var n=e.getUserApi(),a=this;a.domains=n.getDomains(),a.user=n.getUser(),a.hasError=!1,a.login=function(){var e=n.login(a.user);angular.isDefined(e)?e.then(function(){a.user.authenticated?t.go("datasource"):a.hasError=!0}):t.go("datasource")}}e.$inject=["osApi","$state"];var t={restrict:"E",templateUrl:"app/components/login/login.html",replace:!0,controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osLogin",e)}(),function(){"use strict";function e(){function e(e,h,g,m,f,v,b,y,w,_){if(angular.isUndefined(f.datasource))return void h.go("datasource");var C,x=angular.element(".markers-chart"),k=e.getCohortPatient(),T=e.getCohortGene(),S=a(this,f);S.resize=function(){var e=w.innerWidth;"true"==angular.element(".tray").attr("locked")&&(e-=300),x.width(e),x.height(w.innerHeight-90),C&&C.resize()},angular.element(w).bind("resize",_.debounce(S.resize,300)),angular.element(w).bind("click",function(e){m.$apply(function(){S.optCtxGeneShow=!1,S.optCtxPatientShow=!1})}),e.setBusy(!0),p(e,S,function(a){S.resize();var p=r();C=i(a,p,v,angular.element("#markers-chart")),o(C,S,e,k,T,m,y),u(C,S,m),d(C,S,m,e,g),l(C,S,m,g),s(C,S,m,g,e,b),t(C,S,m),c(C,_),n(C,S,w,m),e.setBusy(!1)})}function t(e,t,n){n.$watch("vm.searchGene",function(){if(angular.isUndefined(t.searchGene))return void(t.geneSearchResult="");e.startBatch();var n={found:0};e.nodes('node[nodeType="gene"]').forEach(function(e){return""==t.searchGene?void e.deselect():void(0==e.data().name.toLowerCase().indexOf(t.searchGene.toLowerCase())?(e.select(),this.found+=1):e.deselect())},n),e.endBatch(),""==t.searchGene?t.searchGeneResult="":t.searchGeneResult="("+n.found+" Matches)"}),n.$watch("vm.searchPatient",function(){if(!angular.isUndefined(t.searchPatient)){e.startBatch();var n={found:0};e.nodes('node[nodeType="patient"]').forEach(function(e){return""==t.searchPatient?void e.deselect():void(0==e.data().id.toLowerCase().indexOf(t.searchPatient.toLowerCase())?(e.select(),this.found+=1):e.deselect())},n),e.endBatch(),""==t.searchPatient?t.searchPatientResult="":t.searchPatientResult="("+n.found+" Matches)"}})}function n(e,t,n,a){t.optInteractiveMode=t.optInteractiveModes[0],t.optCommandPatient=[{name:"Show Edges",cmd:function(n){t.optCommandPatient.selected.select();var a={};t.optCommandPatient.selected.neighborhood("edge").forEach(function(e){this[e.id()]={display:"element"}},a),e.batchData(a)}},{name:"Hide Edges",cmd:function(n){var a={};t.optCommandPatient.selected.neighborhood("edge").forEach(function(e){this[e.id()]={display:"none"}},a),e.batchData(a)}},{name:"Select Associated Genes",cmd:function(n){e.startBatch(),t.optCommandPatient.selected.select(),t.optCommandPatient.selected.neighborhood("node").forEach(function(e){e.select()}),e.endBatch(),t.optCtxPatientShow=!1}},{name:"Deselect Associated Genes",cmd:function(n){e.startBatch(),t.optCommandPatient.selected.neighborhood("node").forEach(function(e){e.deselect()}),e.endBatch(),t.optCtxPatientShow=!1}},{name:"View Oncoprint",cmd:function(e){if("DEMOdz"!=t.datasource){if(t.datasource.indexOf(!1)){var a=t.datasource.substr(4)+"_tcga",o=t.optCommandPatient.selected.neighborhood("node").map(function(e){return e.data().name}).join("+"),i="http://www.cbioportal.org/ln?cancer_study_id="+a+"&q="+o;n.open(i)}t.optCtxPatientShow=!1}}}],t.optCommandGene=[{name:"Show Edges",cmd:function(n){t.optCommandGene.selected.select();var a={};t.optCommandGene.selected.neighborhood("edge").forEach(function(e){this[e.id()]={display:"element"}},a),e.batchData(a)}},{name:"Hide Edges",cmd:function(n){var a={};t.optCommandGene.selected.neighborhood("edge").forEach(function(e){this[e.id()]={display:"none"}},a),e.batchData(a)}},{name:"Select Associated Patients",cmd:function(n){e.startBatch(),t.optCommandGene.selected.select(),t.optCommandGene.selected.neighborhood("node").forEach(function(e){e.select()}),e.endBatch(),t.optCtxGeneShow=!1}},{name:"Deselect Associated Patients",cmd:function(n){e.startBatch(),t.optCommandGene.selected.neighborhood("node").forEach(function(e){e.deselect()}),e.endBatch(),t.optCtxPatientShow=!1}},{name:"View Gene Card",cmd:function(e){n.open("http://www.genecards.org/cgi-bin/carddisp.pl?gene="+t.optCommandGene.selected.data().name),t.optCtxGeneShow=!1}}],t.optCommands={zoomReset:function(){e.fit(),e.center()},zoomFit:function(){e.fit(e.$(":selected"),50)},showPatientsInCommon:function(){var t=e.$('node[nodeType="gene"]:selected'),n=t.map(function(e){return e.data().name}),a=t.neighborhood("node");e.startBatch(),a.filter(function(e,t){var a=t.neighborhood("node").map(function(e){return e.data().name});return n.forEach(function(e){return-1==a.indexOf(e)?!1:void 0}),!0}).forEach(function(e){e.select()}),e.endBatch()},showGenesInCommon:function(){var t,n=e.$('node[nodeType="patient"]:selected');n.each(function(e,n){var a=n.neighborhood("node").map(function(e){return e.data().name});t=0==e?a:t.filter(function(e){return a.indexOf(e)>=0},a)}),e.startBatch(),e.$('node[nodeType="gene"]').forEach(function(e){t.indexOf(e.data().name)>=0&&e.select()}),e.endBatch()},showPatientEdges:function(){var t={};e.$('node[nodeType="patient"]:selected').forEach(function(e){e.neighborhood("edge").forEach(function(e){this[e.id()]={display:"element"}},this)},t),e.batchData(t)},hidePatientEdges:function(){var t={};e.$('node[nodeType="patient"]:selected').forEach(function(e){e.neighborhood("edge").forEach(function(e){this[e.id()]={display:"none"}},this)},t),e.batchData(t)},showGeneEdges:function(){var t={};e.$('node[nodeType="gene"]:selected').forEach(function(e){e.neighborhood("edge").forEach(function(e){this[e.id()]={display:"element"}},this)},t),e.batchData(t)},hideGeneEdges:function(){var t={};e.$('node[nodeType="gene"]:selected').forEach(function(e){e.neighborhood("edge").forEach(function(e){this[e.id()]={display:"none"}},this)},t),e.batchData(t)},selectConnectedGenes:function(){console.log("SELECT CONNECTED GENES"),e.startBatch(),e.$('node[nodeType="patient"]:selected').neighborhood("node").forEach(function(e){e.select()}),e.endBatch()},selectConnectedPatients:function(){console.log("CONNECTED PTS"),e.startBatch(),e.$('node[nodeType="gene"]:selected').neighborhood("node").forEach(function(e){e.select()}),e.endBatch()},selectPatients:function(){e.startBatch(),e.$('node[nodeType="patient"]').forEach(function(e){e.select()}),e.endBatch()},selectGenes:function(){e.startBatch(),e.$('node[nodeType="gene"]').forEach(function(e){e.select()}),e.endBatch()},deselectPatients:function(){e.startBatch(),e.$('node[nodeType="patient"]:selected').forEach(function(e){e.deselect()}),e.endBatch()},deselectGenes:function(){e.startBatch(),e.$('node[nodeType="gene"]:selected').forEach(function(e){e.deselect()}),e.endBatch()},invertPatientSelection:function(){e.startBatch(),e.$('node[nodeType="patient"]').forEach(function(e){e[e._private.selected?"deselect":"select"]()}),e.endBatch()},invertGeneSelection:function(){e.startBatch(),e.$('node[nodeType="gene"]').forEach(function(e){e[e._private.selected?"deselect":"select"]()}),e.endBatch()},invertAll:function(){e.startBatch(),e.$('node[nodeType="patient"]').forEach(function(e){e[e._private.selected?"deselect":"select"]()}),e.$('node[nodeType="gene"]').forEach(function(e){e[e._private.selected?"deselect":"select"]()}),e.endBatch()},deselectAll:function(){e.startBatch(),e.$("node:selected").forEach(function(e){e.deselect()}),e.endBatch()},hideAllEdges:function(){var t={};e.$('edge[edgeType!="chromosome"]').forEach(function(e){this[e.id()]={display:"none"}},t),e.batchData(t)}}}function a(e,t){return e.datasource=t.datasource,e.optCommandGene=!1,e.optCtxGeneShow,e.optCommandPatient,e.optCtxPatientShow=!1,e.optInteractiveModes,e.optInteractiveMode,e.optPatientLayouts,e.optPatientLayout,e.optNodeColors,e.optNodeColor,e.optEdgeColors,e.legandNodes,e.legandPatient,e.legandChromosomes,e.searchGene,e.searchGeneResult="",e.searchPatient,e.searchPatientResult="",e.optCohortModes,e.optCohortMode="",e.optCohortPatients,e.optCohortPatient,e.optCohortGenes,e.optCohortGene,e.optCommands,e.patient,e.gene,e.frame,e}function o(e,t,n,a,o,i,r){t.optCohortModes=[{name:"Highlight"},{name:"Filter"}],t.optCohortMode=t.optCohortModes[0],t.optCohortPatients=a.get(),t.optCohortPatient=t.optCohortPatients[0],t.optCohortGenes=o.get(),t.optCohortGene=t.optCohortGenes[0],t.addCohorts=function(){t.addCohortGene(),t.addCohortPatient()},t.addCohortGene=function(){var n="P+M "+r().format("- H:mm - M/D/YY"),a=e.$('node[nodeType="gene"]:selected').map(function(e){return e.data().id.toUpperCase()}),i={name:n,ids:a};0!=a.length&&(o.add(i),t.optCohortGene=i)},t.addCohortPatient=function(){var n="P+M "+r().format("- H:mm - M/D/YY"),o=e.$('node[nodeType="patient"]:selected').map(function(e){return e.data().id.toUpperCase()}),i={name:n,ids:o};0!=o.length&&(a.add(i),t.optCohortPatient=i)};var s=function(){var n={},a="Highlight"==t.optCohortMode.name;e.startBatch(),"*"==t.optCohortPatient.ids?e.$('node[nodeType="patient"]:selected').forEach(function(e){e.deselect(),n[e.id()]={display:"element"}},n):e.$('node[nodeType="patient"]').forEach(function(e){this.ids.indexOf(e.id())>=0?(e.select(),this.degmap[e.id()]={display:"element"}):(e.deselect(),this.degmap[e.id()]={display:a?"element":"none"})},{degmap:n,ids:t.optCohortPatient.ids}),e.batchData(n),e.endBatch()},l=function(){var n={},a="Highlight"==t.optCohortMode.name;e.startBatch(),"*"==t.optCohortGene.ids?e.$('node[nodeType="gene"]:selected').forEach(function(e){e.deselect(),n[e.id()]={display:"element"}},n):e.$('node[nodeType="gene"]').forEach(function(e){this.ids.indexOf(e.id())>=0?(e.select(),this.degmap[e.id()]={display:"element"}):(e.deselect(),this.degmap[e.id()]={display:a?"element":"none"})},{degmap:n,ids:t.optCohortGene.ids}),e.batchData(n),e.endBatch()},c=function(){s(),l()};i.$watch("vm.optCohortPatient",s),i.$watch("vm.optCohortGene",l),i.$watch("vm.optCohortMode",c)}function i(e,t,n,a){return n({container:a,elements:e,style:t,hideEdgesOnViewport:!1,hideLabelsOnViewport:!1,textureOnViewport:!1,motionBlur:!0,minZoom:.05,maxZoom:40,layout:{name:"preset",fit:!0}})}function r(){return[{selector:"core",style:{"selection-box-color":"#3993fa","selection-box-border-color":"#3993fa","selection-box-border-width":"1px","selection-box-opacity":".2"}},{selector:"node",style:{display:"data(display)",height:"mapData(sizeEle, 0, 50, 10, 100)",width:"mapData(sizeEle, 0, 50, 10, 100)","font-size":"data(sizeLbl)","text-valign":"center"}},{selector:'node[nodeType="patient"]',style:{"background-color":"data(color)","text-halign":"center","border-width":1,"border-color":"#FFFFFF"}},{selector:'node[nodeType="patient"]:selected',style:{"border-color":"#FF0000","border-width":10}},{selector:'node[nodeType="gene"]',style:{"background-color":"#FFFFFF","border-color":"#38347b","text-halign":"right",label:"data(id)","border-width":"data(sizeBdr)"}},{selector:'node[nodeType="gene"]:selected',style:{"border-color":"#FF0000","border-width":10}},{selector:'node[nodeType="centromere"]',style:{"font-size":"24px","text-halign":"center","background-color":"#3993fa",color:"#FFFFFF","border-color":"rgb(19, 150, 222)",height:"40px",width:"120px",shape:"roundrectangle",label:"  data(id)"}},{selector:"edge",style:{display:"data(display)","line-color":"data(color)",width:"data(sizeEle)"}}]}function s(e,t,n,a,o,i){var r=function(e){var t=new e.Signal,n=new e.Signal,a=new e.Signal,o=new e.Signal,i=new e.Signal,r=new e.Signal,s=new e.Signal,l=new e.Signal,c=function(){t.removeAll(),n.removeAll(),a.removeAll(),o.removeAll(),i.removeAll(),r.removeAll(),s.removeAll(),l.removeAll()},d=function(e){t.add(e),i.add(e)},u=function(e){n.add(e),r.add(e)},p=function(e){a.add(e),s.add(e)};return{geneOver:t,geneOut:n,geneClick:a,geneCtx:o,patientOver:i,patientOut:r,patientClick:s,patientCtx:l,over:d,out:u,click:p,removeAll:c}}(i);e.on("click",'node[nodeType="gene"]',r.geneClick.dispatch).on("click",'node[nodeType="patient"]',r.patientClick.dispatch).on("mouseover",'node[nodeType="gene"]',r.geneOver.dispatch).on("mouseover",'node[nodeType="patient"]',r.patientOver.dispatch).on("mouseout",'node[nodeType="gene"]',r.geneOut.dispatch).on("mouseout",'node[nodeType="patient"]',r.patientOut.dispatch).on("cxttap",'node[nodeType="gene"]',r.geneCtx.dispatch).on("cxttap",'node[nodeType="patient"]',r.patientCtx.dispatch);var s={};e.$('edge[edgeType!="chromosome"]').forEach(function(e){this[e.id()]={display:"none"}},s);var l={showGeneCtxMenu:function(e){t.optCommandGene.selected=e.cyTarget;var a=e.originalEvent,o=angular.element("#gene-ctx-menu");return o.show(),n.$apply(function(){t.optCtxGeneShow=!0}),o.css({left:a.pageX-20,top:a.pageY-20}),o.find(".title").text(t.optCommandGene.selected.data().name),this},showPatientCtxMenu:function(e){t.optCommandPatient.selected=e.cyTarget;var a=e.originalEvent,o=angular.element("#patient-ctx-menu");return o.show(),n.$apply(function(){t.optCtxPatientShow=!0}),o.css({left:a.pageX-20,top:a.pageY-20}),o.find(".title").text(t.optCommandPatient.selected.data().name),this},showPatientInfo:function(e){if("patient"==e.cyTarget.data().nodeType)t.patient=e.cyTarget.attr("patient"),t.patientChromosomes=e.cyTarget.neighborhood("node").map(function(e){return e.data().id}),n.$apply();else{var a={name:e.cyTarget.data().name,mutation:e.cyTarget.neighbourhood("edge[edgeType='mutation']").length,cnl1:e.cyTarget.neighbourhood("edge[edgeType='cnLoss.1']").length,cnl2:e.cyTarget.neighbourhood("edge[edgeType='cnLoss.2']").length,cng1:e.cyTarget.neighbourhood("edge[edgeType='cnGain.1']").length,cng2:e.cyTarget.neighbourhood("edge[edgeType='cnGain.2']").length};a.mutations=a.cnl1+a.cnl2+a.cng1+a.cng2,t.gene=a,n.$apply()}return this},hidePatientInfo:function(){return n.$apply(function(){t.gene=t.patient=t.patientChromosomes=null}),this},showDegreeOne:function(t){var n={},a="patient"==t.cyTarget.data().nodeType?"target":"source";e.startBatch(),t.cyTarget.neighborhood("edge").forEach(function(e){this.degmap[e.id()]={display:"element"},e[this.target]().css({"background-color":e.data().color,"border-color":e.data().color,"border-width":60,"border-opacity":.3})},{degmap:n,target:a}),e.endBatch(),e.batchData(n)},hideDegreeOne:function(t){var n={},a="patient"==t.cyTarget.data().nodeType?"target":"source",o={"background-color":"","border-color":"","border-width":"","border-opacity":""};e.startBatch(),t.cyTarget.neighborhood("edge").forEach(function(e){this.degmap[e.id()]={display:"none"},e[a]().style(this.css)},{degmap:n,css:o,target:a}),e.endBatch(),e.batchData(n)},showDegreeTwo:function(t){var n={};t.cyTarget.neighborhood("node").forEach(function(e){e.neighborhood("edge").forEach(function(e){this[e.id()]={display:"element"}},this)},n),e.batchData(n)},hideDegreeTwo:function(t){var n={};t.cyTarget.neighborhood("node").forEach(function(e){e.neighborhood("edge").forEach(function(e){this[e.id()]={display:"none"}},this)},n),e.batchData(n)}},c=[{name:"Commands",register:function(){r.geneCtx.add(l.showGeneCtxMenu),r.patientCtx.add(l.showPatientCtxMenu),r.over(function(e){l.showPatientInfo(e)}),r.out(function(e){l.hidePatientInfo(e)})},unregister:function(){r.removeAll(),e.batchData(s)}},{name:"Selection Highlight",register:function(){var t={};e.$('node[nodeType="patient"]:selected').forEach(function(e){e.neighborhood("edge").forEach(function(e){this[e.id()]={display:"element"}},t)},t),e.batchData(t),e.on("select","node",{ui:!0},function(e){l.showDegreeOne(e)}),e.on("unselect","node",{ui:!0},function(e){l.hideDegreeOne(e)}),r.over(function(e){l.showPatientInfo(e)}),r.out(function(e){l.hidePatientInfo(e)})},unregister:function(){e.batchData(s),e.off("select","node"),e.off("unselect","node")}},{name:"Roll Over Highlight",register:function(){r.over(function(e){l.showPatientInfo(e).showDegreeOne(e)}),r.out(function(e){l.hidePatientInfo(e).hideDegreeOne(e)})},unregister:function(){r.removeAll()}}];t.optInteractiveModes=c,t.optInteractiveMode=t.optInteractiveModes[0],n.$watch("vm.optInteractiveMode",function(e,t){angular.isDefined(t)&&t.unregister(),angular.isDefined(e)&&e.register()})}function l(e,t,n,a){var o=[{name:"mutation","class":"edgeMutation",color:"#004358",state:"Highlight"},{name:"cnGain.1","class":"edgeCnGain1",color:"#1F8A70",state:"Highlight"},{name:"cnLoss.1","class":"edgeCnLoss1",color:"#BEDB39",state:"Highlight"},{name:"cnGain.2","class":"edgeCnGain2",color:"purple",state:"Highlight"},{name:"cnLoss.2","class":"edgeCnLoss2",color:"#FD7400",state:"Highlight"}],i={mutation:o[0],"cnGain.1":o[1],"cnLoss.1":o[2],"cnGain.2":o[3],"cnLoss.2":o[4]};a(function(){o.forEach(function(e){angular.element("."+e["class"]).css("border-color",e.color)});var t={};e.edges('edge[edgeType!="chromosome"]').forEach(function(e){this[e.id()]={color:i[e.data("edgeType")].color,sizeEle:3}},t),e.batchData(t)}),t.optEdgeColors=o,t.updateEdge=function(t,n){if(t.state!=n){t.state=n;var a;switch(n){case"Highlight":a={color:t.color,sizeEle:3};break;case"Hide":a={color:"#FFFFFF",sizeEle:0};break;case"Show":a={color:"#3993fa",sizeEle:3}}angular.element("."+t["class"]).css("border-color",a.color);var o={};e.edges('edge[edgeType="'+t.name+'"]').forEach(function(e){this.degmap[e.id()]=this.state},{degmap:o,state:a}),e.batchData(o)}}}function c(e,t){e.on("pan",t.debounce(function(t){var n=Math.max(t.cy.zoom(),1),a={},o=Math.ceil(Math.max(12/n,1)),i=Math.ceil(Math.max(5/n,.5));e.nodes().forEach(function(e){this.degmap[e.id()]={sizeEle:e.degree()/this.zoom,sizeLbl:o,sizeBdr:i}},{degmap:a,zoom:n,font:o,sizeBdr:i}),e.batchData(a)},300))}function d(e,t,n,a,o){function i(){var n=e.$('node[nodeType="patient"]:selected'),a={};n.each(function(e,t){angular.isUndefined(a[t.data().color])?a[t.data().color]=1:a[t.data().color]+=1}),o(function(){for(var e=0;e<t.legandNodes.length;e++){var n=t.legandNodes[e].color;t.legandNodes[e].cnt=angular.isDefined(a[n])?a[n]:0}})}e.on("select",_.debounce(i,300)),e.on("unselect",_.debounce(i,300)),a.getSampleCategorizationNames().then(function(o){var r=[{name:"Default"},{name:"Gender"},{name:"Age At Diagnosis"}];angular.isDefined(o.payload.length)&&(r=r.concat(o.payload.map(function(e){return{name:e}}))),t.optNodeColors=r,t.optNodeColor=t.optNodeColors[0],n.$watch("vm.optNodeColor",function(){var n={};switch(t.optNodeColor.name){case"Default":t.legandNodes=[{name:"Patients",color:"#3993fa",cnt:0}],e.$('node[nodeType="patient"]').forEach(function(e){n[e.id()]={color:"#3993fa"}}),e.batchData(n);break;case"Gender":t.legandNodes=[{name:"Male",color:"purple",cnt:0},{name:"Female",color:"green",cnt:0}],e.$('node[nodeType="patient"]').forEach(function(e){try{var t=e.data("patient")[0][2];n[e.id()]={color:"male"===t?"purple":"green"}}catch(a){n[e.id()]={color:"#EEEEEE"}}}),e.batchData(n);break;case"Age At Diagnosis":t.legandNodes=[{name:"Young",color:"green",cnt:0},{name:"Old",color:"red",cnt:0}],e.$('node[nodeType="patient"]').forEach(function(e){try{var t=Number(e.data("patient")[0][4]);n[e.id()]={color:"rgb("+255*t/100+","+255*(100-t)/100+",0)"}}catch(a){n[e.id()]={color:"#000000"}}}),e.batchData(n);break;default:a.getSampleCategorization(t.optNodeColor.name).then(function(a){t.legandNodes=a.payload.tbl.map(function(e){return e[0]+"|"+e[1]}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(e){var t=e.split("|");return{name:t[0],color:t[1],cnt:0}});for(var o=a.payload.rownames,i=a.payload.tbl,r=e.$('node[nodeType="patient"]'),s=0;s<r.length;s++){var l=r[s].id();n[l]={color:"#DDDDDD"};for(var c=0;c<o.length;c++)l==o[c]&&(n[l]={color:i[c][1]})}e.batchData(n)})}i()})}),t.updateNode=function(t,n){e.startBatch(),e.nodes('node[nodeType="patient"]').forEach(function(e){e.style("background-color")==t.color&&e[n?"select":"deselect"]()}),e.endBatch()}}function u(e,t,n){t.optPatientLayouts=[{name:"Hobo"},{name:"Age At Diagnosis"}],t.optPatientLayout=t.optPatientLayouts[0],n.$watch("vm.optPatientLayout",function(t){var n=e.nodes('node[nodeType="patient"]');switch(e.startBatch(),t.name){case"Hobo":n.forEach(function(e){e.position(e.data("hobo"))});break;case"Age At Diagnosis":n.forEach(function(e){try{var t=Number(e.data("patient")[0][4]);t=t.map(0,100,-3e3,3e3),e.position({y:t,x:Math.pow(t,2)/5e3-200})}catch(n){e.position({x:100,y:0})}});break;case"Gender":n.filter(function(e,t){try{return"male"==t.data("patient")[0][2].toLowerCase()}catch(n){return!1}}).forEach(function(e,t){var n=10,a=100,o=.1*(t+1),i=-1e3+(n+a*o)*Math.cos(o),r=-1200+(n+a*o)*Math.sin(o);e.position({x:i,y:r})}),n.filter(function(e,t){return angular.isUndefined(t.data("patient")[0])}).forEach(function(e,t){var n=400,a=400,o=.1*(t+1),i=-2500+(n+a*o)*Math.cos(o),r=0+(n+a*o)*Math.sin(o);e.position({x:i,y:r})}),n.filter(function(e,t){try{return"female"==t.data("patient")[0][2].toLowerCase()}catch(n){return!1}}).forEach(function(e,t){var n=400,a=400,o=.1*(t+1),i=-1e3+(n+a*o)*Math.cos(o),r=1200+(n+a*o)*Math.sin(o);e.position({x:i,y:r})})}e.endBatch()})}function p(e,t,n){e.setDataset(t.datasource).then(function(){e.getPatientHistoryTable(t.datasource).then(function(t){var a=t.payload.tbl;e.getMarkersNetwork(t.payload).then(function(e){var t=angular.fromJson(e.payload).elements;t.nodes.filter(function(e){return"patient"===e.data.nodeType}).map(function(e){var t=e.data;t.display="element",t.color="#FFFF00",t.sizeEle=t.degree,t.sizeLbl=12,t.sizeBdr=5,t.hobo={x:e.position.x,y:e.position.y},t.patient=this.filter(function(t){return t[0]===e.data.id})},a),t.nodes.filter(function(e){return"patient"!=e.data.nodeType}).map(function(e){var t=e.data;return t.display="element",t.color="rgb(19, 150, 222)",t.sizeEle=t.degree,t.sizeLbl=12,t.sizeBdr=5,e.locked="gene"!==e.data.nodeType,e.selectable="gene"===e.data.nodeType,e.grabbable="gene"===e.data.nodeType,e}),t.edges.map(function(e){var t=e.data;return t.display="chromosome"==t.edgeType?"element":"none",t.color="rgb(19, 150, 222)",t.sizeEle=3,t.sizeLbl=12,e.locked=!0,e.selectable=!1,e.grabbable=!1,e}),n(t)})})})}e.$inject=["osApi","$state","$timeout","$scope","$stateParams","cytoscape","signals","moment","$window","_"];var h={restrict:"E",templateUrl:"app/components/markers/markers.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return h}angular.module("oncoscape").directive("osMarkers",e)}(),function(){"use strict";function e(){var e={restrict:"E",templateUrl:"app/components/loader/loader.html",replace:!0};return e}angular.module("oncoscape").directive("osLoader",e)}(),function(){"use strict";function e(){function e(e){var t=this;t.login=function(){e.go("login")}}e.$inject=["$state"];var t={restrict:"E",templateUrl:"app/components/landing/landing.html",replace:!0,controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osLanding",e)}(),function(){"use strict";function e(){function e(e,t){var n=this;n.datasets=[],n.explore=function(n,a){e.setDataSource(a),t.go(n,{datasource:a})};var a={DEMOdz:"Glioblastoma (DEMO)",TCGAbrain:"Brain (TCGA)",TCGAbrca:"Breast (TCGA)",TCGAcoadread:"Colorectal (TCGA)",TCGAgbm:"Glioblastoma (TCGA)",TCGAhnsc:"Head + Neck (TCGA)",TCGAlgg:"Lower Grade Glioma (TCGA)",TCGAluad:"Lung Adenocarcinoma (TCGA)",TCGAlung:"Lung (TCGA)",TCGAlusc:"Lung Sasquamous Cell (TCGA)",TCGApaad:"Pancreas (TCGA)",TCGAprad:"Prostate (TCGA)",UWbrain:"Brain (UW)",MSKbrain:"Brain (MSK)"};n.datasets=e.getUserApi().getUser().datasets.map(function(e){return{name:this[e],id:e}},a)}e.$inject=["osApi","$state"];var t={restrict:"E",templateUrl:"app/components/datasource/datasource.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osDatasource",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i){function r(){if(!angular.isUndefined(s)&&(s.fnClearTable(),c=l.tbl,"*"!=u.optCohortPatient.ids&&(c=c.filter(function(e){return u.optCohortPatient.ids.indexOf(e[0])>=0})),0!=c.length)){var e=c.map(function(e){return e[4]}),t=c.map(function(e){return e[3]});n(function(){u.diagnosisMin=u.diagnosisMinValue=Math.floor(Math.min.apply(null,e)),u.diagnosisMax=u.diagnosisMaxValue=Math.ceil(Math.max.apply(null,e)),u.survivalMin=u.survivalMinValue=Math.floor(Math.min.apply(null,t)),u.survivalMax=u.survivalMaxValue=Math.floor(Math.max.apply(null,t)),s.fnAddData(c),s.api().draw()})}}if(angular.isUndefined(i.datasource))return void t.go("datasource");var s,l,c,d=e.getCohortPatient(),u=this;u.datasource=i.datasource,u.filter,u.colnames=[],u.diagnosisMin=u.diagnosisMinValue=1,u.diagnosisMax=u.diagnosisMaxValue=99,u.survivalMin=u.survivalMinValue=0,u.survivalMax=u.survivalMaxValue=10,u.optCohortPatients=d.get(),u.optCohortPatient=u.optCohortPatients[0],u.search="",u.addCohortPatient=function(){var e="Patient "+o().format("- H:mm - M/D/YY"),t=s._("tr",{filter:"applied"}).map(function(e){return e[0].toUpperCase()}),n={name:e,ids:t};0!=t.length&&(d.add(n),u.optCohortPatient=n)},a.$watch("vm.optCohortPatient",r),u.applyFilter=function(){angular.element.fn.DataTable.ext.search=[function(e,t){var n=parseFloat(t[3]),a=parseFloat(t[4]);return isNaN(n)||isNaN(a)?!1:a>=u.diagnosisMin&&a<=u.diagnosisMax&&n>=u.survivalMin&&n<=u.survivalMax}],s.api().draw()},e.setBusy(!0),e.setDataset(u.datasource).then(function(){e.getPatientHistoryTable(u.datasource).then(function(t){l=t.payload,u.colnames=l.colnames,n(function(){s=angular.element("#history-datatable").dataTable({paging:!1}),a.$watch("vm.search",function(){s.api().search(u.search).draw()}),r(),e.setBusy(!1)},0,!1)})})}e.$inject=["osApi","$state","$timeout","$scope","moment","$stateParams"];var t={restrict:"E",templateUrl:"app/components/history/history.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osHistory",e)}(),function(){"use strict";function e(){function e(){var e=this;e.videos=[{name:"Oncoscape + Github",desc:"Description Lorum Ipsum eos et sid al accusamus et iusto odio",img:""},{name:"Creating Cohorts",desc:"Description Lorum Ipsum eos et sid al accusamus et iusto odio",img:""},{name:"Patients + Markers",desc:"Description Lorum Ipsum eos et sid al accusamus et iusto odio",img:""},{name:"Timelines",desc:"Description Lorum Ipsum eos et sid al accusamus et iusto odio",img:""}]}var t={restrict:"E",templateUrl:"app/components/help/help.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osHelp",e)}(),function(){"use strict";function e(){function e(e,t,n,a){e.onDataSource.add(function(){a(function(){i.showTools=!0})});var o=e.getUserApi();o.onLogin.add(function(){a(function(){i.showMenu=!0})}),o.onLogout.add(function(){a(function(){i.showMenu=!1})});var i=this;i.showMenu=!1,i.showTools=!1,i.toolsClick=function(){n.go("tools",{datasource:e.getDataSource()})},i.cohortClick=function(){e.toggleFilter()},i.logoutClick=function(){o.logout(),n.transitionTo("landing")}}e.$inject=["osApi","$stateParams","$state","$timeout"];var t={restrict:"E",templateUrl:"app/components/header/header.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osHeader",e)}(),function(){"use strict";function e(){function e(){}var t={restrict:"E",templateUrl:"app/components/footer/footer.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osFooter",e)}(),function(){"use strict";function e(){function e(){}var t={restrict:"E",templateUrl:"app/components/compare/compare.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osCompare",e)}(),function(){"use strict";function e(e,t,n,a,o){n.onerror=function(e,t,n,o,i){i||(i=new Error(e),i.fileName=t,i.lineNumber=n,i.columnNumber=o||0),a(i)};var i=e.$on("$stateChangeStart",function(e,t){o.setBusy(!1),angular.element.fn.DataTable.ext.search=[]});e.$on("$destroy",i)}e.$inject=["$rootScope","$state","$window","$exceptionHandler","osApi"],angular.module("oncoscape").run(e)}(),function(){"use strict";function e(e,t){e.state("test",{url:"/test",template:"<os-test>",authenticate:!1}).state("landing",{url:"/",template:"<os-landing>",authenticate:!1}).state("help",{url:"/help",template:"<os-help>",
authenticate:!1}).state("datasource",{url:"/datasource",template:"<os-datasource>",authenticate:!0}).state("tools",{url:"/tools/{datasource}",template:"<os-tools>",authenticate:!0}).state("metadata",{url:"/metadata/{datasource}",template:"<os-metadata>",authenticate:!0}).state("history",{url:"/history/{datasource}",template:"<os-history>",authenticate:!0}).state("plsr",{url:"/plsr/{datasource}",template:"<os-plsr>",authenticate:!0}).state("pca",{url:"/pca/{datasource}",template:"<os-pca>",authenticate:!0}).state("pca3d",{url:"/pca3d/{datasource}",template:"<os-pca3d>",authenticate:!0}).state("markers",{url:"/markers/{datasource}",template:"<os-markers>",authenticate:!0}).state("pathways",{url:"/pathways/{datasource}",template:"<os-pathways>",authenticate:!0}).state("timelines",{url:"/timelines/{datasource}",template:"<os-timelines>",authenticate:!0}).state("survival",{url:"/survival/{datasource}",template:"<os-survival>",authenticate:!0}).state("oncoprint",{url:"/oncoprint/{datasource}",template:"<os-oncoprint>",authenticate:!1}).state("compare",{url:"/compare/{datasource}",template:"<os-compare>",authenticate:!0}),t.otherwise("/")}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("oncoscape").config(e)}(),function(){"use strict";angular.module("oncoscape").constant("moment",moment).constant("d3",d3).constant("cytoscape",cytoscape).constant("signals",signals).constant("SockJS",SockJS).constant("THREE",THREE).constant("$",$).constant("_",_),Number.prototype.map=function(e,t,n,a){return(this-e)*(a-n)/(t-e)+n}}(),function(){"use strict";function e(e){e.debugEnabled(!0)}e.$inject=["$logProvider"],angular.module("oncoscape").config(e)}(),angular.module("oncoscape").run(["$templateCache",function(e){e.put("app/components/datasource/datasource.html",'<section class="datasource container-fluid"><div class="row"><div class="col-sm-8 col-md-6"><h1>Data Sources</h1><p>Oncoscape has analyzed and curated the following datasets hosted by The Cancer Genome Atlas (TCGA). Raw data sets for these and other available disease sites can be found at <a href="https://tcga-data.nci.nih.gov/tcga/">TCGA Data Portal</a>.</p></div></div><div class="row"><ul><li ng-repeat="dataset in vm.datasets" class="col-xs-12 col-sm-6 col-lg-4" ng-click="vm.explore(\'tools\',dataset.id)"><img class="datasource-img" ng-src="/assets/images/datasets/{{dataset.id}}.png"><h3 class="datasource-lbl">{{dataset.name}}</h3><nobr><a href="">Explore</a></nobr></li></ul></div></section>'),e.put("app/components/compare/compare.html",'<section class="compare-v50"><os-plsr></os-plsr></section><section class="compare-v50"><os-pca></os-pca></section>'),e.put("app/components/help/help.html",'<section class="tools container"><div class="row"><div class="col-sm-8 col-md-6"><br><br><br></div></div><div class="row"><div class="col-xs-12 col-md-7"><h2 style="margin:0px;margin-bottom: 20px;">Now Playing &mdash; Lorum Ipsum</h2><div style="background-color:#000;text-align: center;"><video width="640" height="360" controls="" style="background-color: #000;max-width: 100%;"></video></div><h2>Video Title</h2><p>Transcription At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat</p></div><div class="col-xs-12 col-md-5" style="padding-left: 40px;"><h2 style="margin:0px;">Oncoscape Videos</h2><ul><li ng-repeat="video in vm.videos" style="clear: both;"><div style="width:30%;height:90px;background-color:#EEE;display:inline-block;float:left;margin-bottom: 20px;text-align: center;cursor: pointer;"><span class="glyphicon glyphicon-play-circle" style="font-size: 30px;padding-top:30px; color:#FFF"></span></div><div style="width:69%;display: inline-block;float:left;padding-left: 10px;"><h3 class="tools-lbl" style="margin:0px;">{{video.name}}</h3><p>{{video.desc}}</p><a href="" ng-click="vm.explore(tool.route, vm.datasource)">Watch Video</a></div></li></ul></div></div></section>'),e.put("app/components/footer/footer.html",'<footer class="footer container"><div class="row"><div class="col-xs-12 col-sm-6"><img class="footer-logo" src="/assets/images/logo-fred-hutchinson-cancer-research-center.png" alt="Fred Hutchinson Cancer Research Center"> <img class="footer-logo" src="/assets/images/logo-university-of-washington-medicine.png" alt="UW Medicine"> <img class="footer-logo" src="/assets/images/logo-seattle-cancer-care-alliance.png" alt="Seattle Cancer Care Alliance"></div><div class="col-xm-12 col-sm-6 text-right"><a href="https://www.facebook.com/STTRCancer" target="_blank"><img class="footer-icon" src="/assets/images/sttr-facebook-out.png" alt="Facebook"></a> <a href="https://twitter.com/sttrcancer" target="_blank"><img class="footer-icon" src="/assets/images/sttr-twitter-out.png" alt="Twitter"></a> <a href="https://plus.google.com/+fredhutch/videos" target="_blank"><img class="footer-icon" src="/assets/images/sttr-youtube-out.png" alt="YouTube"></a> <a href="http://instagram.com/FredHutch" target="_blank"><img class="footer-icon" src="/assets/images/sttr-instagram-out.png" alt="Instagram"></a> <a href="http://www.linkedin.com/company/fred-hutchinson-cancer-research-center/careers?trk=top_nav_careers" target="_blank"><img class="footer-icon" src="/assets/images/sttr-linkedin-out.png" alt="LinkedIn"></a> <a href="https://plus.google.com/116048577052683099154/posts" target="_blank"><img class="footer-icon" src="/assets/images/sttr-google-out.png" alt="Google+"></a></div></div></footer>'),e.put("app/components/header/header.html",'<div class="header"><nav class="navbar navbar-inverse navbar-fixed-top"><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="#"><img alt="Brand" src="/assets/images/logo.png" style="max-height:50px;"></a></div><div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" ng-if="vm.showMenu"><ul class="nav navbar-nav navbar-right"><li><a href="#datasource"><span class="glyphicon glyphicon-th"></span>Data Sources</a></li><li><a href="#help"><span class="glyphicon glyphicon-question-sign"></span>Help</a></li><li><a href="" ng-click="vm.logoutClick()"><span class="glyphicon glyphicon-user"></span>Logout</a></li></ul></div></div><div class="nav-divider"></div></nav></div><a href="https://github.com/FredHutch/Oncoscape/labels/help%20wanted" class="github" tooltip="Submit Issues" style="text-align: right;"><div class="logo"><svg aria-hidden="true" class="octicon octicon-mark-github" height="28" role="img" version="1.1" viewbox="0 0 16 16" width="28"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59 0.4 0.07 0.55-0.17 0.55-0.38 0-0.19-0.01-0.82-0.01-1.49-2.01 0.37-2.53-0.49-2.69-0.94-0.09-0.23-0.48-0.94-0.82-1.13-0.28-0.15-0.68-0.52-0.01-0.53 0.63-0.01 1.08 0.58 1.23 0.82 0.72 1.21 1.87 0.87 2.33 0.66 0.07-0.52 0.28-0.87 0.51-1.07-1.78-0.2-3.64-0.89-3.64-3.95 0-0.87 0.31-1.59 0.82-2.15-0.08-0.2-0.36-1.02 0.08-2.12 0 0 0.67-0.21 2.2 0.82 0.64-0.18 1.32-0.27 2-0.27 0.68 0 1.36 0.09 2 0.27 1.53-1.04 2.2-0.82 2.2-0.82 0.44 1.1 0.16 1.92 0.08 2.12 0.51 0.56 0.82 1.27 0.82 2.15 0 3.07-1.87 3.75-3.65 3.95 0.29 0.25 0.54 0.73 0.54 1.48 0 1.07-0.01 1.93-0.01 2.2 0 0.21 0.15 0.46 0.55 0.38C13.71 14.53 16 11.53 16 8 16 3.58 12.42 0 8 0z"></path></svg></div></a>'),e.put("app/components/history/history.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortPatient()"></os-tool-menu><os-tray caption="Patients" content="tray-content-block"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Filters</h2></div><div class="col-xs-12 form-item"><label>Age At Diagnosis</label><div range-slider="" min="vm.diagnosisMinValue" model-min="vm.diagnosisMin" max="vm.diagnosisMaxValue" model-max="vm.diagnosisMax" show-values="true" attach-handle-values="true" on-handle-up="vm.applyFilter()"></div></div><div class="col-xs-12 form-item"><label>Survival</label><div range-slider="" min="vm.survivalMinValue" model-min="vm.survivalMin" max="vm.survivalMaxValue" model-max="vm.survivalMax" show-values="true" attach-handle-values="true" on-handle-up="vm.applyFilter()"></div></div><div class="col-xs-12 form-item"><label>Search</label> <input type="text" class="ngrs-range-slider" style="width: 100%;" ng-model="vm.search"></div><div class="col-xs-12 form-label"><h2>Patient Cohort</h2></div><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" style="width: 34px;display: inline-block; margin-right:0px; float:right" ng-click="vm.addCohortPatient()">+</button> <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="width: 220px;display: inline-block; margin-right:0px;">{{vm.optCohortPatient.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optCohortPatients" ng-click="vm.optCohortPatient=item">{{item.name}}</li></ul></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Patient Data</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><table id="history-datatable" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%"><thead><tr><th ng-repeat="col in vm.colnames">{{col}}</th></tr></thead><tbody><tr ng-repeat="row in vm.rows"><td ng-repeat="datum in row track by $index">{{datum}}</td></tr></tbody></table></div></section>'),e.put("app/components/landing/landing.html",'<div class="landing container"><div class="row" style="padding-top:20px;"><h2>Bridging Cancer Research and Clinical Care</h2></div><div class="row" style="padding-top:20px;"><div class="col-sm-8"><p>Oncoscape is developed at the Fred Hutchinson Cancer Research Center under the auspices of the Solid Tumor Translational Research initiative. Oncoscape is a web-based, menu-driven analysis and visualization platform for large-scale, heterogeneous clinical and molecular patient timeline data as exemplified by the Fred Hutch HIDRA database. Oncoscape vision and development is managed by a small team comprising: <a href="https://www.fredhutch.org/en/labs/profiles/holland-eric.html">Eric Holland</a>, <a href="http://www.sttrcancer.org/en/contact-us/horse-grant-bio.html">Desert Horse-Grant</a>, <a href="https://www.linkedin.com/in/lisa-mcferrin-9758b029">Lisa McFerrin</a>, <a href="https://www.linkedin.com/in/hbolouri">Hamid Bolouri</a>, <a href="https://www.linkedin.com/in/jenny-zhang-ba62a2104">Jenny Zhang</a>, <a href="https://www.linkedin.com/in/gretchenh">Gretchen Heinrich</a>, <a href="https://www.linkedin.com/in/robert-mcdermott-a77b9011">Robert McDermott</a> and <a href="https://www.linkedin.com/in/zager">Michael Zager</a>.</p><p class="">Through its easy point-and-click browser interface, Oncoscape will become an essential tool for doctors and researchers interested in:</p><ul class=""><li>Comparing patients or populations across an array of features, like genetic alterations (CNV, IHC, sequencing, expression) or clinical elements (treatment regimens, diagnostics, outcomes)</li><li>Defining cohorts based on selected traits  identifying patients like me</li><li>Aligning patient histories according to timeline events: diagnosis, treatment, progression, survival</li><li>Performing powerful and integrated statistical analysis: Principle Component Analysis, Partial least squares regression, Kaplan-Meier curves, enrichment scores</li><li>Creating high quality visualizations of molecular/clinical data</li></ul><p class="">By providing a portal equipped with rich data, powerful statistics and a simple interface, Oncoscape not only empowers users to quickly answer questions themselves but also expedites the process of discovering novel patterns and relationships. This can lead to numerous possible findings, including optimized drug therapies for individual patients, identification of novel regulatory pathways, or even the need to reassess adherence strategies.</p></div><div class="col-sm-4"><os-login></os-login></div></div></div>'),e.put("app/components/loader/loader.html",'<div class="loader-modal"><div class="loader"><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__ball"></div></div></div>'),e.put("app/components/login/login.html",'<form class="login"><h3 class="login-header">Login</h3><div class="login-body"><div class="alert alert-danger" role="alert" ng-show="vm.hasError"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> <span class="sr-only">Error:</span> Invalid Credentials</div><fieldset class="form-group"><span for="domain" class="small">Affiliation</span><select id="domain" class="form-control" ng-options="option.name for option in vm.domains track by option.name" ng-model="vm.user.domain"></select></fieldset><fieldset class="form-group"><span class="form-control-label small" for="username">Username</span> <input id="username" class="form-control input-sm" type="text" placeholder="Username" ng-model="vm.user.name"></fieldset><fieldset class="form-group" ng-show="vm.user.domain.name!=\'Guest\'"><span class="form-control-label small" for="password">Password</span> <input id="password" class="form-control" type="password" placeholder="Password" ng-model="vm.user.password"></fieldset><button class="btn btn-default" ng-click="vm.login()">Login</button></div></form>'),e.put("app/components/markers/markers.html",'<os-tool-menu datasource="{{vm.datasource}}"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize()"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Options</h2></div><div class="col-xs-12 form-item"><label>Interactive Mode</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.optInteractiveMode.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optInteractiveModes" ng-click="vm.optInteractiveMode=item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item" ng-if="vm.optInteractiveMode.name==\'Commands\'"><label>Patients</label><br><div class="btn-group btn-group-md" role="group"><button type="button" class="btn btn-default btn-no-focus" title="Select Connected Genes" ng-click="vm.optCommands.selectConnectedGenes()"><span class="fa fa-code-fork" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Invert Patient Selection" ng-click="vm.optCommands.invertPatientSelection()"><span class="fa fa-random" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Select All Patients" ng-click="vm.optCommands.selectPatients()"><span class="fa fa-dot-circle-o" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Deselect Patients" ng-click="vm.optCommands.deselectPatients()"><span class="fa fa-circle-o" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Show Selected Patient Edges" ng-click="vm.optCommands.showPatientEdges()"><span class="fa fa-link" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Hide Edges" ng-click="vm.optCommands.hidePatientEdges()"><span class="fa fa-unlink" aria-hidden="true"></span></button><div class="btn-group" role="group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="More Options"><span class="caret"></span></button><ul class="dropdown-menu pull-right"><li ng-click="vm.optCommand.showGenesInCommon()">Select Genes In Common</li></ul></div></div></div><div class="col-xs-12 form-item" ng-if="vm.optInteractiveMode.name==\'Commands\'"><label>Genes</label><br><div class="btn-group btn-group-md" role="group"><button type="button" class="btn btn-default btn-no-focus" title="Select Connected Patients" ng-click="vm.optCommands.selectConnectedPatients()"><span class="fa fa-code-fork" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Invert Gene Selection" ng-click="vm.optCommands.invertGeneSelection()"><span class="fa fa-random" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Select All Genes" ng-click="vm.optCommands.selectGenes()"><span class="fa fa-dot-circle-o" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Deselect Genes" ng-click="vm.optCommands.deselectGenes()"><span class="fa fa-circle-o" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Show Selected Gene Edges" ng-click="vm.optCommands.showGeneEdges()"><span class="fa fa-link" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Hide Selected Gene Edges" ng-click="vm.optCommands.hideGeneEdges()"><span class="fa fa-unlink" aria-hidden="true"></span></button><div class="btn-group" role="group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="More Options"><span class="caret"></span></button><ul class="dropdown-menu pull-right"><li ng-click="vm.optCommand.showPatientsInCommon()">Select Patients In Common</li></ul></div></div></div><div class="col-xs-6 form-item" style="padding-right:5px"><label>Global</label><div class="btn-group" role="group" style="display: block"><button class="btn btn-default btn-no-focus" type="button" ng-click="vm.optCommands.invertAll()" style="width:33.333%" title="Invert Selections"><span class="fa fa-random" aria-hidden="true"></span></button> <button class="btn btn-default btn-no-focus" type="button" ng-click="vm.optCommands.deselectAll()" style="width:33.333%" title="Deselect All"><span class="fa fa-circle-o" aria-hidden="true"></span></button> <button class="btn btn-default btn-no-focus" type="button" ng-click="vm.optCommands.hideAllEdges()" style="width:33.333%" title="Hide All Edges"><span class="fa fa-unlink" aria-hidden="true"></span></button></div></div><div class="col-xs-6 form-item" style="padding-left:5px"><label>Zoom</label><div class="btn-group" role="group" style="display: block"><button class="btn btn-default btn-no-focus" type="button" ng-click="vm.optCommands.zoomReset()" style="width:50%; font-weight: 300;" title="Zoom Reset">Reset</button> <button class="btn btn-default btn-no-focus" type="button" ng-click="vm.optCommands.zoomFit()" style="width:50%; font-weight: 300;" title="Zoom Selection">Fit</button></div></div><div class="col-xs-6 form-item" style="padding-right:5px"><label>Patient Layout</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.optPatientLayout.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optPatientLayouts" ng-click="vm.optPatientLayout=item">{{item.name}}</li></ul></div></div><div class="col-xs-6 form-item" style="padding-left:5px"><label>Patient Color</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.optNodeColor.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optNodeColors" ng-click="vm.optNodeColor=item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Patient Options</label><div ng-repeat="item in vm.legandNodes" class="legend-bar btn btn-default filter-button" style="border-color:{{item.color}};position:relative">{{item.name}} ({{item.cnt}} Selected)<div class="markers-button-slider"><div class="markers-button-slider-circle" ng-click="vm.updateNode(item, true); $event.stopPropagation();" style="background-color:{{item.color}};border-color:red;"></div><div class="markers-button-slider-circle" ng-click="vm.updateNode(item, false); $event.stopPropagation();" style="background-color:{{item.color}};"></div></div></div></div><div class="col-xs-12 form-item"><label>Edge Options</label><div ng-repeat="item in vm.optEdgeColors" class="legend-bar btn btn-default filter-button {{item.class}}" style="position:relative">{{item.name}}<div class="markers-button-slider"><div class="markers-button-slider-rect" ng-click="vm.updateEdge(item, \'Highlight\'); $event.stopPropagation();" style="background-color:{{item.color}};"></div><div class="markers-button-slider-rect" ng-click="vm.updateEdge(item, \'Show\'); $event.stopPropagation();" style="background-color:#3993fa"></div><div class="markers-button-slider-rect" ng-click="vm.updateEdge(item, \'Hide\'); $event.stopPropagation();" style="background-color:#FFF"></div></div></div></div><div class="col-xs-12 form-item"><label>Patient Search {{vm.searchPatientResult}}</label> <input type="text" class="form-control" ng-model="vm.searchPatient" placeholder="Patient Id"></div><div class="col-xs-12 form-item"><label>Gene Search {{vm.searchGeneResult}}</label> <input type="text" class="form-control" ng-model="vm.searchGene" placeholder="Gene Name"></div><div class="col-xs-12 form-label"><h2>Cohorts</h2></div><div class="col-xs-12 form-item"><label>Patient Cohorts</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" style="width: 34px;display: inline-block; margin-right:0px; float:right" ng-click="vm.addCohortPatient()">+</button> <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="width: 220px;display: inline-block; margin-right:0px;">{{vm.optCohortPatient.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optCohortPatients" ng-click="vm.optCohortPatient=item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item" style="padding-bottom: 100px;"><label>Gene Cohorts</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" style="width: 34px;display: inline-block; margin-right:0px; float:right" ng-click="vm.addCohortGene()">+</button> <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="width: 220px;display: inline-block; margin-right:0px;">{{vm.optCohortGene.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optCohortGenes" ng-click="vm.optCohortGene=item">{{item.name}}</li></ul></div></div></div></section></os-tray><section class="tray-content-block"><div id="markers-chart" class="markers-chart"></div><div style="position:absolute;top:10px;left:50px;"><h2 class="h2-tool">Patients + Markers</h2><h3 class="h3-datasource">{{vm.datasource}}</h3></div></section><ul id="gene-ctx-menu" class="dropdown-menu markers-ctx-menu" role="menu" ng-show="vm.optCtxGeneShow"><li class="title"></li><li ng-repeat="item in vm.optCommandGene" ng-click="item.cmd()">{{item.name}}</li></ul><ul id="patient-ctx-menu" class="dropdown-menu markers-ctx-menu" role="menu" ng-show="vm.optCtxPatientShow"><li class="title"></li><li ng-repeat="item in vm.optCommandPatient" ng-click="item.cmd()">{{item.name}}</li></ul><section ng-show="vm.gene" class="container-fluid" style="position:absolute;bottom:0px;margin-right: 300px;z-index: 999;pointer-events: none;"><div class="row"><div class="col-xs-12 legend" style="background-color: rgba(255,255,255,.8)"><ul style="float:left;"><li class="legend-section">{{vm.gene.name}}</li><li>CnGain.1: {{vm.gene.cng1}}</li><li>CnGain.2: {{vm.gene.cng2}}</li><li>CnLoss.1: {{vm.gene.cnl1}}</li><li>CnLoss.2: {{vm.gene.cnl2}}</li></ul></div></div></section><section ng-show="vm.patient" class="container-fluid" style="position:absolute;bottom:0px;margin-right: 300px;z-index: 999;pointer-events: none;"><div class="row"><div class="col-xs-12 legend" style="background-color: rgba(255,255,255,.8)"><ul style="float:left;"><li class="legend-section">{{vm.patient[0][0]}}</li><li>GENDER: {{vm.patient[0][2]}}</li><li>STATUS: {{vm.patient[0][6]}}</li><li>DIAGNOSED: {{vm.patient[0][4]}} years old</li><li>SURVIVED: {{vm.patient[0][3]}} years</li><li>PROGRESSION: {{vm.patient[0][5]}}</li></ul></div></div></section>'),e.put("app/components/metadata/metadata.html",'<os-tool-menu datasource="{{vm.datasource}}"></os-tool-menu><os-tray caption="Patients" content="tray-content-block"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Search</h2></div><div class="col-xs-12 form-item"><input type="text" class="ngrs-range-slider ngrs-range-slider-no-pad" style="width:100%" ng-model="vm.search"></div><div class="col-xs-12 form-label"><h2>Information</h2><label>Raw data was provided by <a href="http://cancergenome.nih.gov/">The Cancer Genome Atlas</a>. Processing of data was conducted by the <a href="http://www.sttrcancer.org/en.html">Solid Tumor Translational Research Organization</a> in conjuntion with the <a href="http://www.fhcrc.org">Fred Hutchinson Cancer Research Center</a>, <a href="http://www.uwmedicine.org/">UW Medicine</a> and <a href="http://www.scca.org">The Seattle Cancer Care Alliance</a>.</label></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">{{vm.dataset}} Metadata</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><table id="metadata-datatable" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%"><thead><tr><th ng-repeat="col in vm.colnames">{{col}}</th></tr></thead><tbody><tr ng-repeat="row in vm.rows"><td ng-repeat="datum in row track by $index">{{datum}}</td></tr></tbody></table></div></section>'),e.put("app/components/oncoprint/oncoprint.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortPatient()"></os-tool-menu><os-tray content="tray-content-block"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Cohorts</h2></div><div class="col-sm-12 form-item"><label>Patient Cohorts</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" style="width: 34px;display: inline-block; margin-right:0px; float:right" ng-click="vm.addCohortPatient()">+</button> <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="width: 220px;display: inline-block; margin-right:0px;">{{vm.optCohortPatient.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optCohortPatients" ng-click="vm.optCohortPatient=item">{{item.name}}</li></ul></div></div><div class="col-sm-12 form-item"><label>Gene Cohorts</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" style="width: 34px;display: inline-block; margin-right:0px; float:right" ng-click="vm.addCohortGene()">+</button> <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="width: 220px;display: inline-block; margin-right:0px;">{{vm.optCohortGene.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optCohortGenes" ng-click="vm.optCohortGene=item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-label"><h2>Legend</h2><span class="legend"></span> <span class="oncoprint-label-col1" id="legend"></span></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><div id="oncoprintDiv" class="oncoprint"><div id="oncoprintInstructions" style="font-size:150%">Please select and send up to 350 genes and patients from another tab, such as Markers &amp Patients, to populate the display.</div><div id="oncoprintErrorSection" style="font-size:150%" ng-show="vm.errorMessage!=\'\'">{{vm.errorMessage}}</div><div id="oncoprintControlsDiv"><div id="onc"></div><button id="toggle_whitespace">Toggle Whitespace</button> <button id="reduce_cell_width">Reduce Cell Width</button></div></div></div></section>'),e.put("app/components/pathways/pathways.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortGene()"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Options</h2></div><div class="col-xs-12 form-item"><label>Search</label> <input type="text" class="form-control" ng-model="vm.search"></div><div class="col-sm-12 form-item"><label>Cohorts</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" style="width: 34px;display: inline-block; margin-right:0px; float:right" ng-click="vm.addCohortGene()">+</button> <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="width: 220px;display: inline-block; margin-right:0px;">{{vm.optCohortGene.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optCohortGenes" ng-click="vm.optCohortGene=item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-label"><h2>Legend</h2><span class="legend-bar" style="border-color: green">Activation</span> <span class="legend-bar" style="border-color: red">Inhibition</span> <span class="legend-bar" style="border-color: #38347B">Modification</span> <span class="legend-bar" style="border-color: #056ce1">Genes</span></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Pathways</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div id="gbm-chart" class="pathways-chart"></div></div></section><div class="modal fade pathways" id="gbm-webpage" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">{{vm.tip}}</h4></div><iframe class="modal-iframe" ng-src="{{vm.frame}}"></iframe></div></div></div>'),
e.put("app/components/pca3d/pca3d.html",'<section id="pca-chart" class="pca container-fluid" style="position: absolute;left:0px;top:0px;right: 0px;bottom: 0px;padding:0px;margin:0px;overflow: hidden;"></section>'),e.put("app/components/pca/pca.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortPatient()"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Filters</h2></div><div class="col-xs-12 form-item"><label>Gene Set</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.geneSet}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li ng-repeat="item in vm.geneSets" ng-click="vm.geneSet=item">{{item}}</li></ul></div></div></div><div class="col-xs-12 form-item"><label>Search</label> <input type="text" class="ngrs-range-slider" style="width: 100%;" ng-model="vm.search"></div><div class="col-xs-12 form-label"><h2>Cohorts</h2></div><div class="col-sm-12 form-item"><label>Patient Cohorts</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" style="width: 34px;display: inline-block; margin-right:0px; float:right" ng-click="vm.addCohortPatient()">+</button> <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="width: 220px;display: inline-block; margin-right:0px;">{{vm.optCohortPatient.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optCohortPatients" ng-click="vm.optCohortPatient=item">{{item.name}}</li></ul></div></div><div class="col-xs-6 form-label"><h2>Legend</h2><span class="circle" style="background-color:black;width:10px;height: 10px;margin-right:10px;"></span>Patients</div><div class="col-xs-6 form-label"><h2>Variance</h2>PC1: {{vm.pc1}}%<br>PC2: {{vm.pc2}}%</div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Principal Component Analysis</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div id="pca-chart" class="pca"></div></div></section>'),e.put("app/components/plsr/plsr.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortGene()"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Filters</h2></div><div class="col-xs-12 form-item"><label>Gene Set</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.geneSet}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li ng-repeat="item in vm.geneSets" ng-click="vm.geneSet=item">{{item}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Age At Diagnosis</label><div range-slider="" min="vm.deathMinValue" model-min="vm.deathMinFilter" max="vm.deathMaxValue" model-max="vm.deathMaxFilter" prevent-equal-min-max="true" show-values="true" attach-handle-values="true" on-handle-up="vm.update()"></div></div><div class="col-xs-12 form-item"><label>Survival</label><div range-slider="" min="vm.survivalMinValue" model-min="vm.survivalMinFilter" max="vm.survivalMaxValue" model-max="vm.survivalMaxFilter" prevent-equal-min-max="" show-values="true" attach-handle-values="true" on-handle-up="vm.update()"></div></div><div class="col-xs-12 form-label"><h2>Cohorts</h2></div><div class="col-sm-12 form-item"><label>Gene Cohorts</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" style="width: 34px;display: inline-block; margin-right:0px; float:right" ng-click="vm.addCohortGene()">+</button> <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="width: 220px;display: inline-block; margin-right:0px;">{{vm.optCohortGene.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optCohortGenes" ng-click="vm.optCohortGene=item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-label"><h2>Legend</h2><span class="legend-bar" style="border-color: #1396de">Age At Diagnosis</span> <span class="legend-bar" style="border-color: #38347b">Survial</span> <span class="legend"><span class="legend-dot" style="background-color:#000"></span>Genes</span></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Partial Least Squares Regression</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div id="plsr-chart" class="plsr"></div></div></section><div class="modal fade plsr-webpage" id="plsr-webpage" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">{{vm.tip}}</h4></div><iframe class="modal-iframe" ng-src="{{vm.frame}}"></iframe></div></div></div>'),e.put("app/components/subnav/subnav.html",'<div class="subnav"><div class="btn-group" style="float:right"><button type="button" class="btn btn-primary" ng-click="vm.toolsClick()">Analysis Tools</button> <button type="button" class="btn btn-primary" ng-click="vm.cohortClick()">Cohorts</button></div><h2>{{vm.tool}} &mdash; {{vm.filter}}</h2></div>'),e.put("app/components/survival/survival.html",'<os-tool-menu datasource="{{vm.datasource}}"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Patient Cohort</h2></div><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.optCohortPatient.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optCohortPatients" ng-click="vm.optCohortPatient=item">{{item.name}}</li></ul></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Patient Survival</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div style="text-align: center;"><img id="survival-img" style="width:100%; height: auto; margin:auto;"></div></div></section>'),e.put("app/components/test/test.html",'<div class="test"><input ng-model="vm.message"><br>Hello {{vm.message}}<div ng-repeat="item in vm.datasets">{{item}}</div></div>'),e.put("app/components/timelines/timelines.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortPatient()"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Options</h2></div><div class="col-xs-12 form-item"><label>Align By</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.align.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.events" ng-click="vm.align = item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Order By</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.sort.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.features" ng-click="vm.sort = item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Filter</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.filter.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.filters" ng-click="vm.filter = item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Timescale</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.timescale.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.timescales" ng-click="vm.timescale=item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Event Colors</label> <span ng-repeat="item in vm.events" class="legend-bar btn btn-default filter-button {{item.color}}" ng-style="{\'border-color\':item.color}" ng-click="vm.updateEventColor(item); $event.stopPropagation();">{{item.name}} ({{item.selected ? \'Visible\' : \'Hidden\'}})</span></div><div class="col-xs-12 form-label"><h2>Cohorts</h2></div><div class="col-xs-12 form-item"><label>Display Mode</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.optCohortMode.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optCohortModes" ng-click="vm.optCohortMode=item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Patient Cohorts</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" style="width: 34px;display: inline-block; margin-right:0px; float:right" ng-click="vm.addCohortPatient()">+</button> <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="width: 220px;display: inline-block; margin-right:0px;">{{vm.optCohortPatient.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optCohortPatients" ng-click="vm.optCohortPatient=item">{{item.name}}</li></ul></div></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Timelines</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div id="timelines-chart"></div></div><div class="timeline-hover" ng-if="vm.selShow"><dl><dt>Event</dt><dd>{{vm.selEvent}}</dd></dl><dl><dt>Patient Id</dt><dd>{{vm.selPatient}}</dd></dl><dl ng-repeat="item in vm.selFields"><dt>{{item.name}}</dt><dd>{{item.value}}</dd></dl></div></section>'),e.put("app/components/toolmenu/toolmenu.html",'<div><label class="tray-label tray-label-left">Tools</label><section class="tool-menu tray tray-collapsed-left"><div class="row"><div class="col-xs-12 form-label"><h2>Tools</h2></div></div><div class="row tool-menu-row" ng-repeat="tool in vm.tools"><a href="" ng-click="vm.explore(tool.route)"><img class="tool-menu-img" ng-src="/assets/images/datasets/{{tool.img}}"> <span class="tool-menu-lbl">{{tool.name}}</span></a></div></section></div>'),e.put("app/components/tools/tools.html",'<section class="tools container-fluid"><div class="row"><div class="col-sm-8 col-md-6"><h1>Analysis Tools</h1></div></div><div class="row"><ul><li ng-repeat="tool in vm.tools" class="col-xs-12 col-sm-6 col-md-4 col-lg-3" ng-click="vm.explore(tool.route, vm.datasource)"><img class="tools-img" ng-src="/assets/images/datasets/{{tool.img}}"><div class="tools-copy"><h3 class="tools-lbl">{{tool.name}}</h3><a href="">Explore</a></div></li></ul></div></section>'),e.put("app/components/tray/tray.html",'<div><label class="tray-label tray-label-right">Options</label><div class="tray {{vm.trayClass}} tray-right" locked="true"><ng-transclude></ng-transclude><i class="fa fa-lock tray-sticky-icon {{vm.iconClass}}" ng-click="vm.toggle()"></i></div></div>')}]);
//# sourceMappingURL=../maps/scripts/app-1d3214392c.js.map
