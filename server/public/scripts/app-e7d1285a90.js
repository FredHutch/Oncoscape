!function(){"use strict";angular.module("oncoscape",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngMessages","ngAria","ngResource","ui.router","ui.bootstrap","ui-rangeSlider","ui.bootstrap.contextMenu","nvd3ChartDirectives","toastr"])}(),function(){"use strict";function e(){function e(e){var t=this;t.trayClass=Math.random().toString(36).substring(3),t.iconClass=Math.random().toString(36).substring(3);var n=!0;t.toggle=function(){var i=angular.element("."+t.trayClass),r=angular.element("."+t.iconClass),s=angular.element("."+t.content);n=!n,r.addClass(n?"fa-lock":"fa-unlock-alt").removeClass(n?"fa-unlock-alt":"fa-lock"),i.attr("locked",n?"true":"false"),n?(s.removeClass("tray-content-block-collapsed"),i.unbind("mouseover",a).unbind("mouseout",o).removeClass("tray-collapsed"),e(function(){t.change()})):(s.addClass("tray-content-block-collapsed"),i.addClass("tray-collapsed").bind("mouseover",a).bind("mouseout",o),e(function(){t.change()}))};var a=function(){angular.element("."+t.trayClass).removeClass("tray-collapsed")},o=function(){angular.element("."+t.trayClass).addClass("tray-collapsed")}}e.$inject=["$timeout"];var t={restrict:"E",templateUrl:"app/components/tray/tray.html",scope:{caption:"@",content:"@",change:"&"},controller:e,controllerAs:"vm",bindToController:!0,replace:!0,transclude:!0};return t}angular.module("oncoscape").directive("osTray",e)}(),function(){"use strict";function e(){function e(e,t){var n=function(){angular.element(".tool-menu").removeClass("tray-collapsed-left")},a=function(){angular.element(".tool-menu").addClass("tray-collapsed-left")},o=angular.element(".tool-menu");o.bind("mouseover",n).bind("mouseout",a);var i=this;i.tools=e.getTools(),i.explore=function(e){i.change(),t.go(e,{datasource:i.datasource})}}e.$inject=["osApi","$state"];var t={restrict:"E",templateUrl:"app/components/toolmenu/toolmenu.html",controller:e,controllerAs:"vm",scope:{datasource:"@",change:"&"},bindToController:!0};return t}angular.module("oncoscape").directive("osToolMenu",e)}(),function(){"use strict";function e(){function e(e,t,n){if(angular.isUndefined(n.datasource))return void t.go("datasource");var a=this;a.datasource=n.datasource,a.tools=e.getTools(),a.explore=function(e,n){t.go(e,{datasource:n})}}e.$inject=["osApi","$state","$stateParams"];var t={restrict:"E",templateUrl:"app/components/tools/tools.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osTools",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,r,s,l){function c(){T=k.selectAll(".timeline-selected")[0].map(function(e){return e.__data__.id}),0==T.length&&(T=k.selectAll()[0].map(function(e){return e.__data__.id})),t.addPatientSelection("Timelines","Manual Selection",T),"Filter"==f.optCohortMode.name&&M()}if(angular.isUndefined(o.datasource))return void n.go("datasource");var d,u,p,m,g,h=0,f=this;f.selShow=!1,f.selPatient,f.selEvent,f.selFields=[],f.datasource=o.datasource,f.optCohortModes,f.optCohortMode,f.timescaleunit,f.timescales,f.timescale,f.features,f.feature,f.filters,f.filter,f.events,f.sorts,f.sort,f.align,f.optCohortModes=[{name:"Highlight"},{name:"Filter"}],f.optCohortMode=f.optCohortModes[0];var v,b,y=angular.element("#timelines-chart"),w=l.select("#timelines-chart").append("svg").attr("id","chart").style({width:"100%"}),A=w.append("g").attr({"class":"axis"}).style({"shape-rendering":"crispEdges","stroke-width":"1.0",stroke:"#000",fill:"none"}),x=w.append("svg").attr({"class":"bars-svg"}),C=x.append("rect").attr({width:y.width(),height:i.innerHeight-75-10-130-50}).style({fill:"#FFFFFF"}),k=x.append("g").attr({"class":"bars"}),T=null==t.getPatientSelection()?null:t.getPatientSelection().ids,S=function(){if(!l.event.shiftKey){var e=h*l.event.scale;h>e&&(e=h);var t=l.event.translate[1],n=i.innerHeight-75-10-130-50,a=20*d.patients.length*e,o=n-a;t>0&&(t=0),o>t&&(t=o),v.translate([l.event.translate[0],t]);var r=20*e,s=n/r,c=Math.abs(t/r);b.y(l.scale.linear().range([0,n]).domain([c,c+s])),k.attr("transform","translate(1,"+t+")scale(1,"+e+")")}},_=!1,E=function(){l.event.sourceEvent.shiftKey?_=!0:(l.event.target.clear(),l.select(this).call(l.event.target))},D=function(){if(_){var e=b.extent(),t=Math.floor(e[0][1]),n=Math.floor(e[1][1]);k.selectAll("g.timeline").each(function(e,a){l.select(this.firstChild).classed("timeline-selected",a>=t&&n>=a)})}},P=function(){_&&(_=!1,l.event.target.clear(),l.select(this).call(l.event.target),c())},M=function(){var e=20,t=i.innerHeight-75-10-130,n=i.innerWidth-300;n>760&&(n-=140),"false"==angular.element(".tray-right").attr("locked")&&(n+=300),d=$(u,f.align,f.sort),m=l.scale.linear().domain(d.bounds).range([10,n-10]).nice(),g=l.scale.linear().domain([0,d.patients.length]).range(0,t-50).nice(),h=(t-50)/(20*d.patients.length),w.attr({height:t+"px"}),x.attr({height:t-50+"px",width:n+"px"}),C.attr({height:t-50+"px",width:n+"px"}),k.attr("transform","scale(1,"+h+")");var o=k.selectAll("g.timeline").data(d.patients);o.exit().remove(),o.enter().append("g").attr({"class":"timeline"}).on("mousedown",function(){l.event.shiftKey||k.selectAll(".timeline-selected").classed("timeline-selected",!1)}).attr({width:n,height:e,transform:function(t,n){return"translate(0,"+n*e+")"}}).append("rect").attr({"class":"timeline-row",width:0,height:e}),"Highlight"==f.optCohortMode.name&&T.length>0?o.each(function(e){var t=T.indexOf(e.id)>=0,n=l.select(this.firstChild);n.classed("timeline-selected",t)}):o.each(function(){var e=l.select(this.firstChild);e.classed("timeline-selected",!1)});var r=o.selectAll("rect.event").data(function(e){return e.filteredEvents});r.exit().remove(),r.enter().append("rect").attr({"class":"event"}).on("mouseover",function(){var e=p[this.__data__.id];f.selPatient=e.PatientID,f.selEvent=e.Name;var t=[];for(var n in e.Fields)null!=e.Fields[n]&&("date"==n&&angular.isArray(e.Fields[n])?(t.push({name:"Start Date",value:e.Fields[n][0]}),t.push({name:"End Start",value:e.Fields[n][1]})):t.push({name:n,value:e.Fields[n]}));f.selShow=!0,f.selFields=t,a.$apply()}).on("mouseout",function(){f.selShow=!1,a.$apply()}),r.transition().style({fill:function(e){return e.color}}).attr({height:function(t){return"Radiation"==t.name||"Drug"==t.name?e/2:e},width:function(e){return null==e.endValue?3:m(e.endValue)-m(e.startValue)},x:function(e){return Math.round(m(e.startValue))},y:function(t){return"Radiation"==t.name?e/2:0}});var s=function(e){return 0==Math.abs(e)?e:Math.abs(e)<30?e+" Days":Math.abs(e)<360?Math.round(e/30.4*10)/10+" Months":Math.round(e/365*10)/10+" Years"},c=l.svg.axis().scale(m).orient("bottom").ticks(8);c="Log"==f.timescale.name?c.tickFormat(function(e){return s(Math.round((0>e?-1:1)*(Math.pow(2,Math.abs(e))-1)*100)/100)}):c.tickFormat(function(e){return s(e)}),b=l.svg.brush().x(m).y(l.scale.linear().range([0,t]).domain([0,d.patients.length])).on("brush",D).on("brushstart",E).on("brushend",P),C.call(b),C.on("mousedown",function(){l.event.shiftKey||k.selectAll(".timeline-selected").classed("timeline-selected",!1)}),v=l.behavior.zoom().x(m).y(g).translate([0,0]).scale(1,h).on("zoom",S),C.call(v),A.attr({"class":"timeline-axis",width:100,transform:function(){return"translate(0,"+(t-50)+")"}}),A.call(c)},$=function(e,t,n){var a={};return a.events=f.events.filter(function(e){return e.selected}),a.patients=e.filter(function(e){return"Only Alive"==f.filter.name&&e.dead?!1:("Only Dead"!=f.filter.name||e.dead)&&e.hasOwnProperty("__"+this.align)?this.filter&&this.ids&&-1==this.ids.indexOf(e.id)?!1:!0:!1},{align:t.name,filter:"Filter"==f.optCohortMode.name,ids:T}),"Survival"==n.name?a.patients=a.patients.sort(function(e,t){return e.dead==t.dead?e.calcEvents[n.index].value>t.calcEvents[n.index].value?1:-1:e.dead?1:-1},n):a.patients=a.patients.sort(function(e,t){return e.calcEvents[n.index].value>t.calcEvents[n.index].value?1:-1},n),a.patients.forEach(function(e){e.filteredEvents=e.dateEvents.filter(function(e){for(var t=0;t<this.length;t++)if(this[t].name==e.name)return!0;return!1},a.events),e.filteredEvents.forEach(function(e){e.startValue=f.timescale.timeFn(e.start+this),e.endValue=null!=e.end?f.timescale.timeFn(e.end+this):null},-e["__"+this.align.name].start)},{align:t,events:a.events}),a.bounds=a.patients.reduce(function(e,t){var n=t.filteredEvents.reduce(function(e,t){return[Math.min(t.startValue,e[0]),Math.max(null==t.endValue?t.startValue:t.endValue,e[1])]},[1/0,-(1/0)]);return[Math.min(n[0],e[0]),Math.max(n[1],e[1])]},[1/0,-(1/0)]),a};!function(){var n=function(e){var t=e.name,n="Birth"===t?"#17becf":"Diagnosis"===t?"#8c564b":"Pathology"===t?"#7f7f7f":"Progression"===t?"#1f77b4":"Absent"===t?"#000000":"Status"===t?"#bcbd22":"Radiation"===t?"#e7969c":"Procedure"===t?"#ff7f0e":"Encounter"===t?"#d62728":"Drug"===t?"#9467bd":"black";return n},o=function(e){return Object.keys(e).map(function(e){var t={name:e,selected:!0};return t.color=t.__color=n(t),t})},r=function(e){return e[0].calcEvents.map(function(e,t){return{name:e.name,index:t}})},l=function(e,t){e=Object.keys(e).map(function(t){var n=e[t];return n.id=t,n});for(var a=0;a<e.length;a++){var o=e[a],i=s,r="YYYY-MM-DD",l=o.dateEvents.filter(function(e){return"single"===e.eventOrder}).map(function(e){return{start:i(e.date,r).unix(),end:null,name:e.name,id:e.eventID}}),c=o.dateEvents.filter(function(e){return"end"===e.eventOrder}).map(function(e){return{end:i(e.date,r).unix(),id:e.eventID}}),d=o.dateEvents.filter(function(e){return"start"===e.eventOrder}).map(function(e){return{start:i(e.date,r).unix(),name:e.name,id:e.eventID}});d.forEach(function(e){e.end=c.filter(function(t){return t.id==e.id})[0].end}),o.dateEvents=d.length>0?d.concat(l):l,o.dateEvents.forEach(function(e){e.color=n(e),o["__"+e.name]=e,"Status"==e.name&&(o.dead=-1!=t.indexOf(e.id))})}return e};e.setBusy(!0)("Loading Dataset"),e.setDataset(f.datasource).then(function(){e.getTimelines().then(function(n){f.timescales=[{name:"Log",timeFn:function(e){return(0>e?-1:1)*Math.log(Math.abs(1e3*e/864e5)+1)/Math.log(2)}},{name:"Linear",timeFn:function(e){return s.duration(1e3*e).asDays()}}],f.timescale=f.timescales[0],u=l(n.payload.pts,n.payload.eventTypes.Status.status.Dead),p=n.payload.events,f.sorts=r(u),f.filters=[{name:"Alive + Dead"},{name:"Only Alive"},{name:"Only Dead"}],f.filter=f.filters[0];var c=r(u);c.unshift({index:-1,name:"None"}),f.features=c,f.feature=f.features[0],f.events=o(n.payload.eventTypes),f.sort=f.sorts[1],f.events.forEach(function(e){"Birth"==e.name&&(e.selected=!1,e.color="#FEFEFE"),"Diagnosis"==e.name&&(this.align=e)},f),a.$watchGroup(["vm.feature","vm.sort","vm.align","vm.timescale","vm.filter"],M),angular.element(i).bind("resize",M),a.$watch("vm.optCohortMode",M),t.onPatientSelectionChange.add(function(e){T=e.ids,M()}),e.setBusy(!1)})})}(),f.resize=function(){M()},f.updateEventColor=function(e){e.selected=!e.selected,e.color=e.selected?e.__color:"#FEFEFE",M()}}e.$inject=["osApi","osHistory","$state","$scope","$stateParams","$window","$document","moment","d3"];var t={restrict:"E",templateUrl:"app/components/timelines/timelines.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osTimelines",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i){if(angular.isUndefined(i.datasource))return void n.go("datasource");var r=this;r.datasource=i.datasource,e.setBusy(!0),e.setDataset(r.datasource).then(function(){null==t.getPatientSelection()?e.getPatientHistoryTable(r.datasource).then(function(e){s(e.payload.tbl.map(function(e){return e[0]}))}):s(t.getPatientSelection().ids)}),t.onPatientSelectionChange.add(function(e){s(e.ids)});var s=function(t){e.setBusy(!0),e.getCalculatedSurvivalCurves(t,"").then(function(t){angular.element("#survival-img").attr("src",t.payload),e.setBusy(!1)})}}e.$inject=["osApi","osHistory","$state","$timeout","$scope","$stateParams"];var t={restrict:"E",templateUrl:"app/components/survival/survival.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osSurvival",e)}(),function(){"use strict";function e(){function e(e,t){var n=this;n.tool="Pathways",n.filter="DemoDZ",n.toolsClick=function(){t.go("tools",{datasource:n.datasource})},n.cohortClick=function(){e.toggleFilter()}}e.$inject=["osApi","$state"];var t={restrict:"E",templateUrl:"app/components/subnav/subnav.html",replace:!0,controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osSubnav",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,r,s,l,c,d){function u(){var e=w.selectAll(".plsr-node-selected")[0];0!=e.length&&t.addGeneSelection("PLSR","Manual Selection",w.selectAll(".plsr-node-selected")[0].map(function(e){return e.__data__.name.toUpperCase()}))}function p(){0==C.length?w.selectAll(".plsr-node-selected").classed("plsr-node-selected",!1):w.selectAll("circle").classed("plsr-node-selected",function(){return C.indexOf(this.__data__.name)>=0})}if(angular.isUndefined(a.datasource))return void n.go("datasource");var m,g,h,f,v,b,y,w=r.select("#plsr-chart").append("svg").attr("id","chart"),A=r.select("body").append("div").attr("class","tooltip plsr-tooltip"),x=this;x.datasource=a.datasource,x.deathMinFilter=x.deathMinValue=45,x.deathMaxFilter=x.deathMaxValue=66,x.survivalMinFilter=x.survivalMinValue=3,x.survivalMaxFilter=x.survivalMaxValue=7,x.geneSets=[],x.geneSet=null,x.frame,x.tip=null;var C=null==t.getGeneSelection()?[]:t.getGeneSelection().ids;e.setBusy(!0)("Loading Dataset"),e.setDataset(x.datasource).then(function(n){var a=n.payload.rownames.filter(function(e){return e.indexOf("mtx.mrna")>=0});a=a[a.length-1].replace(".RData",""),e.setBusyMessage("Creating PLSR Matrix"),e.getPLSR(x.datasource,a).then(function(){e.setBusyMessage("Loading Gene Sets"),e.getGeneSetNames().then(function(n){x.geneSets=n.payload,x.geneSet=x.geneSets[0],e.setBusyMessage("Loading Patients"),e.getSummarizedPLSRPatientAttributes().then(function(e){var n=e.payload;x.deathMinValue=Math.floor(n.AgeDx[0]/365.24),x.deathMaxValue=Math.floor(n.AgeDx[4]/365.24),x.survivalMinValue=Math.floor(n.Survival[0]/365.24),x.survivalMaxValue=Math.floor(n.Survival[4]/365.24),i.$watch("vm.geneSet",function(){x.update()}),t.onGeneSelectionChange.add(function(e){C=e.ids,p()})})})})}),x.update=function(){function t(){m=c.innerWidth-400,"false"==angular.element(".tray-right").attr("locked")&&(m+=300),g=c.innerHeight-190,"true"==angular.element(".tray").attr("locked")&&(m-=300),w.attr("width","100%").attr("height",g),h=r.scale.linear().domain([-v,v]).range([0,m]).nice(),f=r.scale.linear().domain([-b,b]).range([g,0]).nice()}function n(e,n,a){v=.9*e,b=.9*e,t(),y=r.svg.brush().x(h).y(f).on("brushend",function(){var e=y.extent();w.selectAll("circle").classed("plsr-node-selected",function(t){return t[0]>e[0][0]&&t[0]<e[1][0]&&t[1]>e[0][1]&&t[1]<e[1][1]}),r.select(this).transition().duration(300).call(y.extent([[0,0],[0,0]])),u()}),w.call(y);var o=w.selectAll("circle").data(a,function(e){return e});o.enter().append("circle").attr({"class":"plsr-node",cx:.5*m,cy:.5*g,r:3}).style("fill-opacity","0").on("mouseover",function(e){A.transition().duration(200).style("opacity",1),A.html(e.name).style("left",r.event.pageX+15+"px").style("top",r.event.pageY-15+"px")}).on("mouseout",function(){A.transition().duration(500).style("opacity",0)}).on("click",function(e){angular.element("#plsr-webpage").modal();var t="https://www.genecards.org/cgi-bin/carddisp.pl?gene="+e.name;i.$apply(function(){x.frame=l.trustAsResourceUrl(t)})}),o.transition().duration(750).delay(function(e,t){return t/300*500}).attr("cx",function(e){return h(e[0])}).attr("cy",function(e){return f(e[1])}).style("fill-opacity",1),o.exit().transition().duration(600).delay(function(e,t){return t/300*500}).attr("cx",.5*m).attr("cy",.5*g).style("fill-opacity","0").remove();var s=w.selectAll("line").data(n);s.enter().append("line").attr({"class":"line","stroke-width":3,x1:h(0),y1:f(0),x2:h(0),y2:f(0)}).style("stroke",function(e){return e.name.indexOf("Age")?"#1396de":"#38347b"}),s.transition().duration(900).attr({x1:h(0),y1:f(0),x2:function(e){return h(e[0])},y2:function(e){return f(e[1])}}),s.exit().remove();var c=w.selectAll("text").data(n);c.enter().append("text").attr({"class":"text",x:.5*m,y:.5*g,"text-anchor":function(e){return e[0]>0?"start":"end"}}).text(function(e){return e.name}).style({fill:"black","text-anchor":"middle"}),c.transition().duration(900).attr({x:function(e){return h(e[0])},y:function(e){return f(e[1])}}),c.exit().remove(),p()}e.setBusyMessage("Calculating PLSR");var a=[{name:"Survival",low:365.24*Number(x.survivalMinFilter),high:365.24*Number(x.survivalMaxFilter)},{name:"AgeDx",low:365.24*Number(x.deathMinFilter),high:365.24*Number(x.deathMaxFilter)}];e.getCalculatedPLSR(x.geneSet,a).then(function(t){e.setBusyMessage("Rendering PLSR");var a=t.payload,o=a.loadings.map(function(e,t){return e.name=this[t],e},a.loadingNames),i=a.vectors.map(function(e,t){return e.name=this[t],e},a.vectorNames),r=1.2*a.maxValue;n(r,i,o),e.setBusy(!1)}),x.resize=function(){t(),w.selectAll("circle").attr({cx:function(e){return h(e[0])},cy:function(e){return f(e[1])}}),w.selectAll("text").attr({x:function(e){return h(e[0])},y:function(e){return f(e[1])}}),w.selectAll("line").attr({x1:h(0),y1:f(0),x2:function(e){return h(e[0])},y2:function(e){return f(e[1])}})},angular.element(c).bind("resize",d.debounce(x.resize,300))}}e.$inject=["osApi","osHistory","$state","$stateParams","$timeout","$scope","d3","moment","$sce","$window","_"];var t={restrict:"E",templateUrl:"app/components/plsr/plsr.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osPlsr",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,r,s){function l(){requestAnimationFrame(l),b.update()}if(angular.isUndefined(n.datasource))return void t.go("datasource");var c=this;c.datasource=n.datasource,c.geneSets=[],c.geneSet=null,c.toggleFilter=function(){angular.element(".container-filters").toggleClass("container-filters-collapsed"),angular.element(".container-filter-toggle").toggleClass("container-filter-toggle-collapsed")};var d,u=angular.element("#pca-chart");e.setBusy(!0)("Loading Dataset"),e.setDataset(c.datasource).then(function(t){var n=t.payload.rownames.filter(function(e){return e.indexOf("mtx.mrna")>=0});n=n[n.length-1].replace(".RData",""),e.setBusyMessage("Creating PCA Matrix"),e.getPCA(c.datasource,n).then(function(){e.setBusyMessage("Loading Gene Sets"),e.getGeneSetNames().then(function(e){c.geneSets=e.payload,c.geneSet=c.geneSets[0],o.$watch("vm.geneSet",function(){p()})})})});var p=function(){e.setBusyMessage("Calculating PCA"),e.getCalculatedPCA2(c.geneSet).then(function(t){e.setBusyMessage("Rendering PCA");var n=t.payload;c.pc1=t.payload["importance.PC1"],c.pc2=t.payload["importance.PC2"];var a=n.scores,o=n.ids;d=a.map(function(e,t){return e.id=o[t],e},n.ids),f(),e.setBusy(!1)})},m=new r.Scene,g=new r.PerspectiveCamera(50,s.innerWidth/s.innerHeight,.1,1e3);g.position.z=60;var h=s.WebGLRenderingContext?new r.WebGLRenderer({antialias:!0}):new r.CanvasRenderer;h.setPixelRatio(s.devicePixelRatio),h.setSize(s.innerWidth,s.innerHeight),u.append(h.domElement);var f=function(){for(var e=[],t=d.length,n=new r.SphereGeometry(.1,8,8),a=new r.MeshBasicMaterial({color:"#59a5fb"}),o=0;t>o;o++){e[o]=new r.Mesh(n,a);var i=d[o];e[o].position.x=i[0],e[o].position.y=i[1],e[o].position.z=i[2],m.add(e[o])}v()},v=function(){h.render(m,g)},b=new r.OrbitControls(g);b.addEventListener("change",v),l()}e.$inject=["osApi","$state","$stateParams","$timeout","$scope","d3","THREE","$window"];var t={restrict:"E",templateUrl:"app/components/pca3d/pca3d.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osPca3d",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,r,s,l,c){function d(){var e=C.selectAll(".pca-node-selected")[0];0!=e.length&&t.addPatientSelection("PCA","Manual Selection",C.selectAll(".pca-node-selected")[0].map(function(e){return e.__data__.id.toUpperCase()}))}function u(){0==E.length?C.selectAll(".pca-node-selected").classed("pca-node-selected",!1):C.selectAll("circle").classed("pca-node-selected",function(){return E.indexOf(this.__data__.id)>=0})}function p(){g=l.innerWidth-400,"false"==angular.element(".tray-right").attr("locked")&&(g+=300),h=l.innerHeight-190,"true"==angular.element(".tray").attr("locked")&&(g-=300),C.attr("width","100%").attr("height",h),f=r.scale.linear().domain([-b,b]).range([0,g]).nice(),v=r.scale.linear().domain([-y,y]).range([h,0]).nice()}function m(){var e,t,n=x;e=Math.abs(r.max(n,function(e){return+e[0]})),t=Math.abs(r.min(n,function(e){return+e[0]})),b=1.2*(e>t?e:t),e=Math.abs(r.max(n,function(e){return+e[1]})),t=Math.abs(r.min(n,function(e){return+e[1]})),y=1.2*(e>t?e:t),p(),w=r.svg.axis().scale(f).orient("top").ticks(5),A=r.svg.axis().scale(v).orient("left").ticks(5);var a=r.svg.brush().x(f).y(v).on("brushend",function(){var e=a.extent();C.selectAll("circle").classed("pca-node-selected",function(t){return t[0]>e[0][0]&&t[0]<e[1][0]&&t[1]>e[0][1]&&t[1]<e[1][1]}),r.select(this).transition().duration(300).call(a.extent([[0,0],[0,0]])),d()});C.call(a);var o=C.selectAll("circle").data(x,function(e){return e});o.enter().append("circle").attr({"class":"pca-node",cx:.5*g,cy:.5*h,r:3}).style("fill-opacity","0").on("mouseover",function(e){S.transition().duration(200).style("opacity",1),S.html(e.id).style("left",r.event.pageX+10+"px").style("top",r.event.pageY-5+"px")}).on("mouseout",function(){S.transition().duration(500).style("opacity",0)}).transition().duration(750).delay(function(e,t){return t/300*500}).attr("cx",function(e){return f(e[0])}).attr("cy",function(e){return v(e[1])}).style("fill-opacity",1),o.exit().transition().duration(600).delay(function(e,t){return t/300*500}).attr("cx",.5*g).attr("cy",.5*h).style("fill-opacity","0").remove(),T.attr("class","axis").attr("transform","translate(0, "+v(0)+")").call(w).append("text").text("PC1"),k.attr("class","axis").attr("transform","translate("+f(0)+", 0)").call(A).append("text").attr("y",10).attr("dy",".71em").text("PC2"),u()}if(angular.isUndefined(a.datasource))return void n.go("datasource");var g,h,f,v,b,y,w,A,x,C=r.select("#pca-chart").append("svg").attr("id","chart"),k=C.append("g"),T=C.append("g"),S=r.select("body").append("div").attr("class","tooltip pca-tooltip"),_=this;_.datasource=a.datasource,_.geneSets=[],_.geneSet=null,_.search="";var E=null==t.getPatientSelection()?[]:t.getPatientSelection().ids;e.setBusy(!0)("Loading Dataset"),e.setDataset(_.datasource).then(function(n){var a=n.payload.rownames.filter(function(e){return e.indexOf("mtx.mrna")>=0});a=a[0].replace(".RData",""),e.setBusyMessage("Creating PCA Matrix"),e.getPCA(_.datasource,a).then(function(){e.setBusyMessage("Loading Gene Sets"),e.getGeneSetNames().then(function(e){_.geneSets=e.payload,_.geneSets.unshift("All"),_.geneSet=_.geneSets[0],i.$watch("vm.geneSet",function(){D()}),t.onPatientSelectionChange.add(function(e){E=e.ids,_.search="",u()})})})});var D=function(){e.setBusyMessage("Calculating PCA"),e.getCalculatedPCA("All"==_.geneSet?null:_.geneSet).then(function(t){e.setBusyMessage("Rendering PCA");var n=t.payload;_.pc1=Math.round(100*t.payload["importance.PC1"]),_.pc2=Math.round(100*t.payload["importance.PC2"]);var a=n.scores,o=n.ids;x=a.map(function(e,t){return e.id=o[t],e},n.ids),m(),e.setBusy(!1)})};_.resize=function(){p(),w.scale(f),A.scale(v),T.attr("transform","translate(0, "+v(0)+")").call(w),k.attr("transform","translate("+f(0)+", 0)").call(A),C.selectAll("circle").attr("cx",function(e){return f(e[0])}).attr("cy",function(e){return v(e[1])})},angular.element(l).bind("resize",c.debounce(_.resize,300))}e.$inject=["osApi","osHistory","$state","$stateParams","$timeout","$scope","d3","moment","$window","_"];var t={restrict:"E",templateUrl:"app/components/pca/pca.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osPca",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,r,s,l,c){function d(){if(v)return void(v=!1);var e=g.$('node[nodeType="gene"]:selected').map(function(e){return e.data().id.toUpperCase()});t.addGeneSelection("Pathways","Manual Selection",e)}function u(){v=!0,g.startBatch(),null==b?g.$('node[nodeType="gene"]:selected').forEach(function(e){e.deselect()}):g.$('node[nodeType="gene"]').forEach(function(e){e[-1==this.indexOf(e.id())?"deselect":"select"]()},b),g.endBatch()}function p(){var e="rgb(5, 108, 225)",t="red",n="rgb(56, 52,123)",a="green";return[{selector:"node",style:{content:"data(label)","text-valign":"center","text-halign":"center",shape:"ellipse",width:"60px",height:"50px",color:e,"background-color":"rgb(250, 250, 250)","border-width":"2px","border-color":e}},{selector:"edge",style:{width:"2px","line-color":e,"line-style":"solid"}},{selector:'node[nodeType="class"], node[nodeType="family"], node[nodeType="complex"]',style:{content:"","background-color":"white",shape:"roundrectangle"}},{selector:'edge[edgeType="activates"], edge[edgeType="indirectly activates"]',style:{"line-color":a,"target-arrow-shape":"triangle","target-arrow-color":a}},{selector:'edge[edgeType="inhibits"], edge[edgeType="ubiquitinylates"]',style:{"line-color":t,"target-arrow-shape":"tee","target-arrow-color":t}},{selector:'edge[edgeType="fusion"]',style:{"line-color":a}},{selector:'edge[edgeType="contains"]',style:{display:"none"}},{selector:'node[nodeType="process"]',style:{}},{selector:'node[nodeType="gene"]:selected',style:{"overlay-opacity":"0.5","overlay-color":"red"}},{selector:'node[nodeType="rtk"]',style:{content:"data(label)","background-color":"rgb(224, 209, 178)","border-color":"black","border-width":"0px","font-size":"48px",shape:"roundrectangle",width:"40px",height:"160px"}},{selector:'node[nodeType="kinase"]',style:{content:"data(label)","background-color":"rgb(255, 206, 194)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="dimer"]',style:{content:"","background-color":"rgb(234, 219, 188)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"0px"}},{selector:'node[nodeType="loop"]',style:{content:"","background-color":"rgb(255, 255, 255)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px","border-style":"dotted"}},{selector:'node[nodeType="gtpase"]',style:{content:"data(label)","background-color":"rgb(194, 194, 255)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="adaptor"]',style:{content:"data(label)","background-color":"rgb(77, 184, 255)",shape:"ellipse",width:"60px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="GEF"]',style:{content:"data(label)","background-color":"rgb(77, 184, 255)",shape:"ellipse",width:"60px",height:"60px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="process"]',style:{content:"data(label)","background-color":"rgb(255, 255, 255)",shape:"roundrectangle",width:"100px",height:"40px","font-size":"24px","border-color":"black","border-width":"0px"}},{selector:'node[nodeType="TF"]',style:{content:"data(label)","background-color":"rgb(255, 206, 94)",shape:"diamond",width:"160px",height:"60px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="gene fusion"]',style:{content:"data(label)",shape:"roundrectangle","font-size":"24px","border-color":"red","border-width":"3px"}},{selector:"edge:selected",style:{"overlay-color":"grey","overlay-opacity":"0.3"}},{selector:'edge[edgeType="recruits"]',style:{width:"2px"}},{selector:'edge[edgeType="fusion"]',style:{"line-color":n}},{selector:'edge[edgeType="recruits"]',style:{"line-color":"red",width:"1px","line-style":"dashed","target-arrow-shape":"triangle","target-arrow-color":"black"}},{selector:'edge[edgeType="cycles"]',style:{"line-color":"black",width:"1px","line-style":"dashed","target-arrow-shape":"triangle","source-arrow-shape":"triangle","target-arrow-color":"green","source-arrow-color":"red"}},{selector:'edge[edgeType="associates"]',style:{"line-color":"black",width:"1px","line-style":"solid"}},{selector:'edge[edgeType="activation"]',style:{"line-color":"green",width:"1px"}},{selector:'edge[edgeType="inhibition"]',style:{"line-color":"red",width:"1px"}}]}if(angular.isUndefined(a.datasource))return void n.go("datasource");var m,g,h=this,f=angular.element("#gbm-chart"),v=!1,b=null==t.getGeneSelection()?null:t.getGeneSelection().ids;h.datasource=a.datasource,h.search="",h.frame,h.tip=null,h.linkTitle="",h.links=[],h.resize=function(){var e=r.innerWidth;e>760&&(e-=140),"true"==angular.element(".tray").attr("locked")&&(e-=300),f.width(e),f.height(r.innerHeight-90),g&&(g.resize(),g.center())},angular.element(r).bind("resize",c.debounce(h.resize,300)),o.$watch("vm.search",function(){if(!angular.isUndefined(g)){var e=h.search.toUpperCase(),t=e.length;g.startBatch(),g.nodes().map(function(n){0==t?n.unselect():n.attr("name").substr(0,t)===e?n.select():n.unselect()}),g.endBatch()}}),e.setBusy(!0),e.setDataset(h.datasource).then(function(){e.getPathway().then(function(n){m=angular.fromJson(n.payload),g=l({container:f,elements:m.elements,style:p(),minZoom:.2,maxZoom:5,layout:{name:"preset",fit:!0}}).on("select","node",c.debounce(d,300)).on("click","node",function(){}).on("click","edge",function(){}).on("mouseover","edge",function(e){o.$apply(function(){h.tip=e.cyTarget.data().source+" Extract"}),e.cyTarget.style({width:"4px"})}).on("mouseout","edge",function(e){o.$apply(function(){h.tip=null}),e.cyTarget.style({width:"2px"})}).on("mouseover","node",function(e){o.$apply(function(){h.tip=e.cyTarget.data().name+" Gene Card"})}).on("mouseout","node",function(){o.$apply(function(){h.tip=null})}),t.onGeneSelectionChange.add(function(e){b=e.ids,u()}),u(),e.setBusy(!1)})})}e.$inject=["osApi","osHistory","$state","$stateParams","$scope","$sce","$window","moment","cytoscape","_"];var t={restrict:"E",templateUrl:"app/components/pathways/pathways.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osPathways",e)}(),function(){"use strict";function e(){function e(){t.play()}var t=new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");
return{beep:e}}angular.module("oncoscape").service("osSound",e)}(),function(){"use strict";function e(e,t,n,a,o){var i,r={},s=function(){return i},l=function(e){i=e},c=1,d=function(){return 9999==c&&(c=1),c++},u=new e(o.protocol()+"://"+o.host()+":"+("3002"==o.port()?80:o.port())+"/oncoscape","",{debug:!1,devel:!1});u.onmessage=function(e){var t=angular.fromJson(e.data);if(angular.isDefined(r[t.cmd])){var n=r[t.cmd];delete r[t.cmd],n.resolve(t)}else a.error("Unhandled message: %o",t)};var p=function(e){e.callback=d(),e.status="request",e.payload=e.payload||"",e.ds=s();var t=n.defer();return r[e.callback]=t,0===u.readyState?u.onopen=function(){u.send(angular.toJson(e))}:u.send(angular.toJson(e)),t.promise.then(function(t){return e.response=t,t})};return{request:p,setDataSource:l}}e.$inject=["SockJS","$rootScope","$q","$log","$location"],angular.module("oncoscape").factory("osSocket",e)}(),function(){"use strict";function e(e,t){var n=t.protocol()+"://"+t.host()+":"+("3002"==t.port()?80:t.port())+"/api/",a=function(e){var t=n+e.table;return angular.isDefined(e.query)&&(t+="/?q="+encodeURIComponent(JSON.stringify(e.query))),t},o=function(t){return e({method:"GET",url:a(t)})};return{queryString:a,query:o}}e.$inject=["$http","$location"],angular.module("oncoscape").factory("osHttp",e)}(),function(){"use strict";function e(e,t,n,a){var o=[{ids:[],tool:"Application",desc:"Load"}],i=0,r=[{ids:[],tool:"Application",desc:"Load"}],s=0,l=new t.Signal,c=new t.Signal,d=new t.Signal,u=new t.Signal,p=function(e){var t=o.indexOf(e);t>=0&&(i=t,u.dispatch(g()))},m=function(){return o},g=function(){return 0>i&&(i=0),i>=o.length&&(i=o.length-1),o[i]},h=function(t,n,r){if(r=r.sort(),r.length!=g().ids.length||0!=a.difference(r,g().ids).length){var s=e();o.push({tool:t,desc:n,ids:r,date:s.unix(),time:s.format("H:mm")}),i+=o.length-1,d.dispatch(g())}},f=function(){if(i-=1,0>i)return n.beep(),void(i=0);var e=g();return u.dispatch(e),e},v=function(){if(i+=1,i==o.length)return n.beep(),void(i=o.length-1);var e=g();return u.dispatch(e),e},b=function(e){var t=r.indexOf(e);t>=0&&(s=t,c.dispatch(w()))},y=function(){return r},w=function(){return 0>s&&(s=0),s>=r.length&&(s=r.length-1),r[s]},A=function(t,n,o){if(o=o.sort(),o.length!=w().ids.length||0!=a.difference(o,w().ids).length){var i=e();r.push({tool:t,desc:n,ids:o,date:i.unix(),time:i.format("H:mm")}),s=r.length-1,l.dispatch(w())}},x=function(){if(s-=1,0>s)return n.beep(),void(s=0);var e=w();return c.dispatch(e),e},C=function(){},k=function(){if(s+=1,s==r.length)return n.beep(),void(s=r.length-1);var e=w();return c.dispatch(e),e},T=function(){},S=function(){},_={onPatientAdd:l,onPatientSelectionChange:c,onGeneAdd:d,onGeneSelectionChange:u,addGeneSelection:h,setGeneSelection:p,getGeneSelection:g,getGeneSelections:m,getGeneSelectionLast:f,getGeneSelectionNext:v,addPatientSelection:A,setPatientSelection:b,getPatientSelection:w,getPatientSelections:y,getPatientSelectionNext:k,getPatientSelectionLast:x,getPatientSelectionSecondLast:C,removeListeners:T,clear:S};return _}e.$inject=["moment","signals","osSound","_"],angular.module("oncoscape").service("osHistory",e)}(),function(){"use strict"}(),function(){"use strict";function e(e,t,n,a,o){function i(){return Z}function r(t){e.setDataSource(t),Z=t,Q.dispatch(Z)}function s(){var e=new a.Signal,t=new a.Signal,i={name:"",password:"",domain:{name:"Guest"},authenticated:!1,token:null,datasets:[]},r=[{name:"Guest"},{name:"FHCRC"},{name:"UW"}],s=function(){i.name="",i.password="",i.domain={name:"Guest"},i.authenticated=!1,i.token=null,i.datasets=[],t.dispatch()},l=function(t){i=t;var a={method:"POST",url:o.protocol()+"://"+o.host()+":"+("3002"==o.port()?80:o.port())+"/login",data:{username:i.name,password:i.password,domain:i.domain.name}};return n(a).then(function(t){t.data.success?(i.authenticated=!0,i.token=t.data.token,i.datasets=t.data.datasets,e.dispatch(i)):(i.authenticated=!1,i.token=null)})};return{getDomains:function(){return r},getUser:function(){return i},login:l,logout:s,onLogin:e,onLogout:t}}function l(){return K}function c(e){return e?angular.element(".loader-modal").show():angular.element(".loader-modal").hide(),d}function d(){}function u(){angular.element("#filter-dropdown").slideToggle()}function p(){angular.element("#filter-dropdown").slideToggle()}function m(){angular.element("#filter-dropdown").slideToggle()}function g(){return[{name:"Markers + Patients",route:"markers",img:"markers.png",beta:!0,copy:"Link copy number variation and mutation data to patients."},{name:"Timelines",route:"timelines",img:"timelines.png",beta:!0,copy:""},{name:"Pathways",route:"pathways",img:"pathways.png",beta:!0,copy:"Map patient specific expression levels on a hand curated network of genes."},{name:"PLSR",route:"plsr",img:"plsr.png",beta:!0,copy:"Use linear regression to correlate genes with clinical features using RNA expression."},{name:"PCA",route:"pca",img:"pca.png",beta:!0,copy:"Two dimensional view of per sample expression data."},{name:"Survival",route:"survival",img:"survival.png",beta:!0,copy:"Compare survival rates of selected patients against the remaining population in a Kaplan Meier plot."},{name:"Patient Data",route:"history",img:"history.png",beta:!0,copy:""},{name:"Oncoprint",route:"oncoprint",img:"history.png",beta:!0,copy:""},{name:"Geneset Test",route:"genesettest",img:"history.png",beta:!0},{name:"Data Explorer",route:"dataexplorer",img:"dataexplorer.png",beta:!0,copy:""},{name:"Cohort Builder",route:"cohortbuilder",img:"dataexplorer.png",beta:!0,copy:""},{name:"MetaData",route:"metadata",img:"metadata.png",beta:!0,copy:""}]}function h(e,n){return t.queryString({table:e,query:n})}function f(e,n){return t.query({table:e,query:n})}function v(t){return e.setDataSource(t),e.request({cmd:"specifyCurrentDataset",payload:t})}function b(t){return e.request({cmd:"getDataManifest",payload:t})}function y(t){return e.request({cmd:"getPatientHistoryTable",payload:{datasetName:t,durationFormat:"byYear"}})}function w(){}function A(){}function x(){return e.request({cmd:"getGeneSetNames"})}function C(){return e.request({cmd:"getSampleCategorizationNames"})}function k(t){return e.request({cmd:"getSampleCategorization",payload:t})}function T(t){return e.request({cmd:"getMarkersNetwork",payload:t})}function S(){}function _(t){return e.request({cmd:"getCanonicalizePatientIDsInDataset",payload:t})}function E(){}function D(){}function P(t,n){var a={dataPackage:t,matrixName:n};return e.request({cmd:"createPCA",payload:a})}function M(t){var n={genes:t};return e.request({cmd:"calculatePCA",payload:n})}function $(t){var n={genes:t};return e.request({cmd:"calculatePCA2",payload:n})}function G(t,n){var a={dataPackage:t,matrixName:n};return e.request({cmd:"createPLSR",payload:a})}function L(t,n){var a={genes:t,factorCount:n.length,factors:n};return e.request({cmd:"calculatePLSR",payload:a})}function I(t){return t=t||["AgeDx","Survival"],e.request({cmd:"summarizePLSRPatientAttributes",payload:t})}function R(t,n){return e.request({cmd:"calculateSurvivalCurves",payload:{sampleIDs:t,title:n}})}function B(){return e.request({cmd:"createTimelines"})}function O(){}function F(){return e.request({cmd:"getModuleModificationDate",payload:"gbmPathways"})}function z(){return e.request({cmd:"getPathway",payload:"g.gbmPathways.json"})}function N(t,n){return e.request({cmd:"get_mRNA_data",payload:{entities:t,features:n}})}function U(t,n){return e.request({cmd:"get_cnv_data",payload:{entities:t,features:n}})}function q(t,n){return e.request({cmd:"get_mutation_data",payload:{entities:t,features:n}})}function H(t){return e.request({cmd:"oncoprint_data_selection",payload:{patientIdsAndGenes:t}})}function V(t,n){var a={dataPackage:t,matrixName:n};return e.request({cmd:"createGeneSetTest",payload:a})}function W(t,n,a){return e.request({cmd:"geneSetScoreTest",payload:{group1:t,group2:n,geneset:a}})}var Z,Q=new a.Signal,K=s();return{query:f,queryString:h,setDataSource:r,getDataSource:i,onDataSource:Q,getTools:g,getUserApi:l,showFilter:u,hideFilter:p,toggleFilter:m,setBusy:c,setBusyMessage:d,setDataset:v,getDataManifest:b,getPatientHistoryTable:y,getPatientHistoryDxAndSurvivalMinMax:w,getSampleDataFrame:A,getGeneSetNames:x,getSampleCategorizationNames:C,getSampleCategorization:k,getMarkersNetwork:T,getPathway:z,getDrugGeneInteractions:S,getCanonicalizePatientIDsInDataset:_,getGeneSetGenes:E,getOncoprintDataSelection:D,getPCA:P,getCalculatedPCA:M,getCalculatedPCA2:$,getPLSR:G,getCalculatedPLSR:L,getSummarizedPLSRPatientAttributes:I,getCalculatedSurvivalCurves:R,getTimelines:B,getCalculatedTimelines:O,getMrnaData:N,getCnvData:U,getMutationData:q,getModuleModificationDate:F,getOncoprint:H,getGeneSetTest:V,getGeneSetScore:W}}e.$inject=["osSocket","osHttp","$http","signals","$location"],angular.module("oncoscape").service("osApi",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,r,s,l){function c(e){if($("#onc").empty(),$("#oncoprintErrorSection").empty(),$(".oncoprint-label-col1").empty(),"error"==e.status)h.errorMessage=JSON.parse(e.payload),console.log("***** errors in dispalyOncoprint",h.errorMessage),y("errors");else{var t=e.payload[1],n=e.payload[0],a=f.create("#onc");a.suppressRendering(),$.when(n).then(function(){function e(e){return e.gene===r}"string"==typeof t&&(t=[t]);for(var o=(t.length,[]),i=0;i<t.length;i++){var r=t[i],s=n.filter(e);Date.now();o[i]=a.addTrack({label:r,removable:!0},0),0===i?a.setRuleSet(o[i],f.GENETIC_ALTERATION):a.useSameRuleSet(o[i],o[0]),a.setTrackData(o[i],s,!0)}a.releaseRendering(),a.sort(),$("#toggle_whitespace").click(function(){a.toggleCellPadding()});var l=1;$("#reduce_cell_width").click(function(){l*=.5,a.setZoom(l)});for(var c=$(".oncoprint-legend-block"),d=$(".oncoprint-legend-label"),u=0;u<c.length;u++)c[u].appendChild(d[u]);$(".oncoprint-label-col1").append(c),$("#oncoprintInstructions").hide()})}}if(angular.isUndefined(a.datasource))return void n.go("datasource");var d=angular.element("#oncoprintControlsDiv"),u=angular.element("#oncoprintInstructions"),p=(angular.element("#oncoprintErrorSection"),angular.element("#legend")),m=(r.select("#onc"),null==t.getPatientSelection()?null:t.getPatientSelection().ids),g=null==t.getGeneSelection()?null:t.getGeneSelection().ids,h=this;h.datasource=a.datasource,h.geneAndPatients=m+","+g,h.errorMessage;var f=function(){function e(e){var a=this,o=n.makeIdCounter();a.config=e,a.id_order=[],a.inverted_id_order={},a.visible_id_order=[],a.visible_inverted_id_order={},a.hidden_ids={},a.track_groups=[[],[]],a.track_group_sort_order=[0,1],a.sort_direction={},a.tracks={},a.sort_config={type:"track"},a.cell_padding_on=!0,a.true_cell_width=e.cell_width,a.zoomed_cell_width=a.true_cell_width,a.zoom=1,a.toggleCellPadding=function(){a.cell_padding_on=!a.cell_padding_on,$(a).trigger(t.SET_CELL_PADDING)},a.getCellPadding=function(){return Math.ceil(a.config.cell_padding*a.getZoom())*+a.cell_padding_on},a.getZoom=function(){return a.zoom},a.setZoom=function(e){return a.zoom=n.clamp(e,0,1),s(),i(),$(a).trigger(t.SET_ZOOM),a.zoom};var i=function(){a.zoom=(a.zoomed_cell_width-1)/(a.true_cell_width-1)},s=function(){a.zoomed_cell_width=Math.round(a.zoom*(a.true_cell_width-1)+1)};a.increaseZoom=function(){return a.zoomed_cell_width=n.clamp(a.zoomed_cell_width+1,1,a.true_cell_width),i(),$(a).trigger(t.SET_ZOOM),a.zoom},a.decreaseZoom=function(){return a.zoomed_cell_width=n.clamp(a.zoomed_cell_width-1,1,a.true_cell_width),i(),$(a).trigger(t.SET_ZOOM),a.zoom},a.getFullCellWidth=function(){return a.true_cell_width},a.getZoomedCellWidth=function(){return a.zoomed_cell_width},a.getCellHeight=function(e){return a.tracks[e].config.cell_height},a.getTrackHeight=function(e){return a.tracks[e].config.track_height},a.getTrackPadding=function(e){return a.tracks[e].config.track_padding},a.getFilteredIdOrder=function(e,t){var n=t||a.getTracks();return l.filter(a.id_order,function(t){var o=l.map(n,function(e){return a.getTrackDatum(e,t)});return e(o)})},a.getIdOrder=function(){return a.id_order},a.getInvertedIdOrder=function(){return a.inverted_id_order},a.getVisibleIdOrder=function(){return a.visible_id_order},a.getVisibleInvertedIdOrder=function(){return a.visible_inverted_id_order};var c=function(){a.visible_id_order=l.filter(a.id_order,function(e){return!a.hidden_ids[e]}),a.visible_inverted_id_order=n.invert_array(a.visible_id_order),$(a).trigger(t.SET_VISIBLE_ID_ORDER)};a.setIdOrder=function(e){a.id_order=e.slice(),a.inverted_id_order=n.invert_array(a.id_order),c(),$(a).trigger(t.SET_ID_ORDER)},a.hideIds=function(e,t){t&&(a.hidden_ids={}),l.each(e,function(e){a.hidden_ids[e]=!0}),c()},a.showIds=function(e){e?l.each(e,function(e){delete a.hidden_ids[e]}):a.hidden_ids={},c()},a.getTopmostTrack=function(){return a.track_groups[0].length>0?a.track_groups[0][0]:a.track_groups[1][0]},a.setTrackSortComparator=function(e,t){a.tracks[e].config.sort_cmp=t},a.getTrackSortComparator=function(e){return a.tracks[e].config.sort_cmp},a.getTrackSortDirection=function(e){return a.sort_direction[e]},a.setTrackSortDirection=function(e,t){a.sort_direction[e]=t,a.sort()},a.setTrackGroupSortOrder=function(e){a.track_group_sort_order=e.slice()},a.getTrackGroupSortOrder=function(){return a.track_group_sort_order.slice()},a.getTrackSortOrder=function(){var e=[],t=a.getTrackGroups();return l.each(a.getTrackGroupSortOrder(),function(n){e=e.concat(t[n])}),e},a.setSortConfig=function(e){a.sort_config=e};var d=function(e){var t=l.sortBy(a.getIdOrder(),l.identity);e&&t.reverse(),a.setIdOrder(t)},u=function(){var e=a.getTrackSortOrder(),t=l.map(e,function(e){return a.getTrackSortComparator(e)}),o={},i=a.getIdOrder();l.each(i,function(t){o[t]={},l.each(e,function(e){o[t][e]=a.getTrackDatum(e,t)})});var r=function(n,i){for(var r=0,s=0,l=e.length;l>s;s++){var c=e[s],d=t[s],u=o[n][c],p=o[i][c],m="undefined"==typeof u,g="undefined"==typeof p;if(r=m||g?m&&g?0:m?1:-1:d(u,p),isFinite(r)&&(r*=a.sort_direction[c]),0!==r)break}return r};a.setIdOrder(n.stableSort(a.getIdOrder(),r))};a.sort=function(){var e=a.sort_config;"track"===e.type?u():"id"===e.type&&d(e.desc)},a.addTrack=function(e,i){i=n.ifndef(i,1);var s=o();return a.tracks[s]={id:s,data:[],config:$.extend({},r,e),id_data_map:{}},a.track_groups[i].push(s),a.sort_direction[s]=1,$(a).trigger(t.ADD_TRACK,{track_id:s}),s},a.removeTrack=function(e){var n=a.tracks[e];delete a.tracks[e],delete a.sort_direction[e];var o=a.getContainingTrackGroup(e,!0);if(o){var i=o.indexOf(e);return o.splice(i,1),$(a).trigger(t.REMOVE_TRACK,{track:n,track_id:e}),!0}return!1},a.getTrackGroups=function(e){return e===!0?a.track_groups:$.extend(!0,[],a.track_groups)},a.getTracks=function(){return l.flatten(a.getTrackGroups())},a.getContainingTrackGroup=function(e,t){var n=!1;return l.find(a.track_groups,function(t){return t.indexOf(e)>-1?(n=t,!0):!1}),t===!0?n:n.slice()},a.moveTrack=function(e,o){var i=a.getContainingTrackGroup(e,!0);if(!i)return!1;var r=i.indexOf(e);o=n.clamp(o,0,i.length-1),i.splice(r,1),i.splice(o,0,e);var s=i.slice(Math.min(r,o),Math.max(r,o)+1);$(a).trigger(t.MOVE_TRACK,{moved_tracks:s})},a.getTrackLabel=function(e){return a.tracks[e].config.label},a.getTrackTooltip=function(e){return a.tracks[e].config.tooltip},a.setTrackTooltip=function(e,t){a.tracks[e].config.tooltip=t},a.getTrackData=function(e){return a.tracks[e].data},a.setTrackData=function(e,n){var o=a.getTrackDatumIdAccessor(e);a.tracks[e].data=n;var i=a.getIdOrder(),r=a.getInvertedIdOrder();l.each(l.map(n,o),function(e){e in r||i.push(e)}),a.setIdOrder(i),a.tracks[e].id_data_map={};var s=a.tracks[e].id_data_map;l.each(a.tracks[e].data,function(e){s[o(e)]=e}),$(a).trigger(t.SET_TRACK_DATA,{track_id:e})},a.getTrackDatum=function(e,t){return a.tracks[e].id_data_map[t]},a.getTrackDatumDataKey=function(e){return a.tracks[e].config.datum_data_key},a.getTrackDatumIdAccessor=function(e){var t=a.getTrackDatumIdKey(e);return function(e){return e[t]}},a.getTrackDatumIdKey=function(e){return a.tracks[e].config.datum_id_key},a.setTrackDatumIdKey=function(e,t){a.tracks[e].config.datum_id_key=t},a.isTrackRemovable=function(e){return a.tracks[e].config.removable},a.isTrackSortDirectionChangable=function(e){return a.tracks[e].config.sort_direction_changable},a.clearData=function(){l.each(a.getTracks(),function(e){a.setTrackData(e,[])}),a.setIdOrder([])}}var t=oncoprint_events,n=oncoprint_utils,a=oncoprint_RuleSet,o={cell_width:6,cell_padding:2.5,legend:!0},i={pre_track_padding:0},r={label:"Gene",datum_id_key:"patient",cell_height:23,track_height:20,track_padding:5,sort_cmp:void 0,tooltip:function(e){return e.patient},removable:!1,sort_direction_changable:!1};return{CATEGORICAL_COLOR:a.CATEGORICAL_COLOR,GRADIENT_COLOR:a.GRADIENT_COLOR,GENETIC_ALTERATION:a.GENETIC_ALTERATION,BAR_CHART:a.BAR_CHART,create:function(n,a){a=$.extend({},o,a||{}),a=$.extend(a,i);var r=new e(a),s=new v(n,r,{label_font:"Arial",legend:a.legend}),l={onc_dev:r,ren_dev:s,addTrack:function(e,t){var n=r.addTrack(e,t);return n},removeTrack:function(e){r.removeTrack(e)},moveTrack:function(e,t){r.moveTrack(e,t)},setTrackDatumIdKey:function(e,t){r.setTrackDatumIdKey(e,t)},setTrackData:function(e,t){r.setTrackData(e,t)},setRuleSet:function(e,t,n){s.setRuleSet(e,t,n)},useSameRuleSet:function(e,t){s.useSameRuleSet(e,t)},toggleCellPadding:function(){r.toggleCellPadding()},toSVG:function(){return s.toSVG()},setTrackGroupSortOrder:function(e){r.setTrackGroupSortOrder(e)},sort:function(){r.sort()},setSortConfig:function(e){r.setSortConfig(e)},setIdOrder:function(e){r.setIdOrder(e)},getTrackSortDirection:function(e){return r.getTrackSortDirection(e)},setTrackSortDirection:function(e,t){r.setTrackSortDirection(e,t)},setZoom:function(e){return r.setZoom(e)},increaseZoom:function(){return r.increaseZoom()},decreaseZoom:function(){return r.decreaseZoom()},suppressRendering:function(){s.suppressRendering()},releaseRendering:function(){s.releaseRendering()},setLegendVisible:function(e,t){s.setLegendVisible(e,t)},getFilteredIdOrder:function(e,t){return r.getFilteredIdOrder(e,t)},getVisibleIdOrder:function(){return r.getVisibleIdOrder()},hideIds:function(e){r.hideIds(e)},showIds:function(e){r.showIds(e)},clearData:function(){r.clearData()},setTrackTooltip:function(e,t){r.setTrackTooltip(e,t)}};return $(r).on(t.MOVE_TRACK,function(){$(l).trigger(t.MOVE_TRACK)}),$(s).on(t.FINISHED_RENDERING,function(){$(l).trigger(t.FINISHED_RENDERING)}),$(r).on(t.REMOVE_TRACK,function(e,n){$(l).trigger(t.REMOVE_TRACK,{track_id:n.track_id})}),$(s).on(t.CONTENT_AREA_MOUSEENTER,function(e,n){$(l).trigger(t.CONTENT_AREA_MOUSEENTER)}),$(s).on(t.CONTENT_AREA_MOUSELEAVE,function(e,n){$(l).trigger(t.CONTENT_AREA_MOUSELEAVE)}),l}}}(),v=function(){function e(e,c,u){OncoprintRenderer.call(this,c,u);var p=this;this.track_cell_selections={},this.track_cells={},this.active_rule_set_rules={},this.toolbar_container,this.label_div,this.label_drag_div,this.label_container,this.cell_container,this.cell_container_node,this.cell_div,this.legend_table,this.document_fragment,this.percent_altered_max_width=n.textWidth("100%",p.getLabelFont()),this.altered_data_percentage={},this.cell_tooltip_html="",this.container=r.select(e),this.container.classed("noselect",!0).selectAll("*").remove(),this.container.append("br"),function(){u.legend&&(p.legend_table=r.select(e).append("table").style("border-collapse","collapse"))}();var m=r.select(e).append("div").classed("oncoprint-content-area",!0);!function(){p.label_container=m.append("div").classed(a,!0).style("position","relative"),p.label_div=p.label_container.append("div").style("position","relative").style("overflow","hidden"),p.label_drag_div=p.label_container.append("div").style("position","absolute").style("overflow","hidden").style("top","0px").style("left","0px").style("display","none")}(),function(){p.cell_container=m.append("div").classed(o,!0),p.cell_column_highlight=p.cell_container.append("div").classed(s,!0).style("height",p.getCellAreaHeight()).style("visibility","hidden"),p.cell_container_node=p.cell_container.node(),p.cell_div=p.cell_container.append("div").classed(i,!0),p.cell_mouseover_div=p.cell_container.append("div").style("position","absolute").style("overflow","hidden").style("top","0px").style("left","0px"),p.cell_container_node.addEventListener("scroll",function(){p.calculateVisibleInterval(),p.clipAndPositionCells()});var e,t;!function(){var a,o,i,r,s=[];$(p.cell_div.node()).qtip({content:"SHARED QTIP",position:{target:"event",my:"bottom middle",at:"top middle",viewport:$(window)},style:{classes:d,border:"none"},show:{event:"cell-mouseover"},hide:{fixed:!0,delay:100,event:"cell-mouseout"},events:{show:function(){$(this).find(".qtip-content").html(p.cell_tooltip_html)},render:function(){$(this).find(".qtip-content").html(p.cell_tooltip_html)}}});var u=function(e){$("."+d).finish(),$(e).trigger("cell-mouseover")},m=function(e){$("."+d).finish(),$(e).trigger("cell-mouseout")},g=function(){a=void 0,o=void 0,i&&m(i),i=void 0,r&&clearTimeout(r),l.each(s,function(e){e&&(e.style.border="",e.style.margin="")}),s=[]};t=function(){g()},e=function(e){var t=n.mouseX(e),m=n.mouseY(e),h=p.getTrackCellTops(),f=function(){var e=Number.POSITIVE_INFINITY,t=void 0;return l.each(h,function(n,a){var o=m-n;o>=0&&e>o&&(e=o,t=a)}),t}();if(!f)return void g();var v=c.getCellHeight(f);if(m>h[f]+v)return void g();var b=c.getZoomedCellWidth(),y=b+c.getCellPadding();if(t%y>b)return void g();var w=Math.floor(t/y);if(w!==o||f!==a){r&&clearTimeout(r),g();var A=c.getVisibleIdOrder()[w],x=p.track_cells[f][A];if(!x)return;$("."+d).finish().hide(),o=w,a=f,i=x.dom,p.cell_tooltip_html=c.getTrackTooltip(f)(x.d),u(i),r=setTimeout(function(){s=l.map(p.track_cells,function(e,t){var n=e[A].dom;return n&&(t===f?(n.style.border="1px solid #000000",n.style.margin="-1px"):(n.style.border="1px solid #999999",n.style.margin="-1px")),n})},200)}}}(),p.cell_mouseover_div.node().addEventListener("mousemove",e),p.cell_mouseover_div.node().addEventListener("mouseout",t),p.cell_div.style("max-width","1000px")}(),$(m.node()).hover(function(){$(p.label_div.node()).find("."+p.getTrackButtonCSSClass()).stop().fadeTo(80,1)},function(){$(p.label_div.node()).find("."+p.getTrackButtonCSSClass()).stop().fadeOut(500)}),function(){$(c).on(t.REMOVE_TRACK,function(e,t){var n=t.track_id;delete p.rule_sets[n],delete p.track_cell_selections[n],delete p.altered_data_percentage[n],p.removeTrackCells(n),p.removeTrackLabels(n),p.removeTrackButtons(n),p.computeTrackCellTops(),p.renderTrackLabels(),p.renderTrackButtons(),p.resizeLabelDiv(),p.resizeCellDiv(),c.sort()}),$(c).on(t.MOVE_TRACK,function(e,t){p.computeTrackCellTops(),p.clipAndPositionCells(t.moved_tracks,"top",!0),p.renderTrackLabels(),p.renderTrackButtons(),c.sort()}),$(c).on(t.ADD_TRACK,function(e,t){p.drawCells(t.track_id),p.clipAndPositionCells(void 0,"top",!0),p.computeTrackCellTops(),p.renderTrackLabels(),p.renderTrackButtons(),p.resizeLabelDiv()}),$(c).on(t.SET_TRACK_DATA,function(e,t){p.drawCells(t.track_id),p.clipAndPositionCells(t.track_id,void 0,!0),p.computeAlteredDataPercentage(t.track_id),p.renderTrackLabels(t.track_id),p.resizeCellDiv(),p.renderLegend()}),$(c).on(t.SET_CELL_PADDING,function(e,t){p.clipAndPositionCells(void 0,void 0,!0),p.resizeCellDiv()}),$(c).on(t.SET_ZOOM,function(e,t){p.clipAndPositionCells(void 0,void 0,!0),p.resizeCells(),p.resizeCellDiv()}),$(c).on(t.SET_VISIBLE_ID_ORDER,function(){p.clipAndPositionCells(void 0,void 0,!0),p.resizeCellDiv()})}()}var t=oncoprint_events,n=oncoprint_utils,a="oncoprint-label-area-ctr",o="oncoprint-cell-area-ctr",i="oncoprint-cell-area",s="oncoprint-column-highlight",c="oncoprint-label-dragging",d="oncoprint-cell-qtip";return n["extends"](e,OncoprintRenderer),e.prototype.computeAlteredDataPercentage=function(e){var t=this.getRuleSet(e);if(t&&t.alteredData){var n=this.oncoprint.getTrackData(e),a=t.alteredData(n).length,o=Math.floor(100*a/n.length);this.altered_data_percentage[e]=o}},e.prototype.getAlteredDataPercentage=function(e){return this.altered_data_percentage[e]},e.prototype.calculateVisibleInterval=function(){var e=(this.oncoprint.getZoomedCellWidth()+this.oncoprint.getCellPadding(),this.cell_container_node.getBoundingClientRect());return this.visible_interval=[this.cell_container_node.scrollLeft,this.cell_container_node.scrollLeft+e.right-e.left],this.visible_interval},e.prototype.getVisibleInterval=function(){return this.visible_interval||this.calculateVisibleInterval()},e.prototype.cellRenderTarget=function(){return r.select(this.document_fragment||this.cell_div.node())},e.prototype.suppressRendering=function(){this.document_fragment=document.createDocumentFragment()},e.prototype.releaseRendering=function(){this.cell_div.node().appendChild(this.document_fragment),this.document_fragment=void 0;var e=this;$(this.cell_div.node()).ready(function(){e.resizeCells(),e.clipAndPositionCells(void 0,void 0,!0)})},e.prototype.setRuleSet=function(e,t,n){OncoprintRenderer.prototype.setRuleSet.call(this,e,t,n),this.active_rule_set_rules[this.getRuleSet(e).getRuleSetId()]={},this.drawCells(e),this.clipAndPositionCells(e,void 0,!0),this.renderLegend(),this.computeAlteredDataPercentage(e),this.renderTrackLabels(e)},e.prototype.useSameRuleSet=function(e,t){OncoprintRenderer.prototype.useSameRuleSet.call(this,e,t),this.drawCells(e),this.clipAndPositionCells(e,void 0,!0),this.renderLegend(),this.computeAlteredDataPercentage(e),this.renderTrackLabels(e)},e.prototype.getLabelDiv=function(){return this.label_div},e.prototype.getLabelDragDiv=function(){return this.label_drag_div},e.prototype.resizeCellDiv=function(){this.cell_div.style("min-width",this.getCellAreaWidth()+"px").style("min-height",this.getCellAreaHeight()+"px"),this.cell_mouseover_div.style("min-width",this.getCellAreaWidth()+"px").style("min-height",this.getCellAreaHeight()+"px"),this.cell_column_highlight.style("height",this.getCellAreaHeight()+"px")},e.prototype.resizeLabelDiv=function(){this.getLabelDiv().style("width",this.getLabelAreaWidth()+"px").style("height",this.getLabelAreaHeight()+"px"),this.getLabelDragDiv().style("width",this.getLabelAreaWidth()+"px").style("height",this.getLabelAreaHeight()+"px")},e.prototype.removeTrackLabels=function(e){e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var t=this.label_div,n=this;l.each(e,function(e){t.selectAll(n.getTrackLabelCSSSelector(e)).remove()})},e.prototype.renderTrackLabels=function(e,t,n){var a=this.label_div;if("undefined"!=typeof t)a.selectAll(this.getTrackLabelCSSSelector(e)).style("top",t+"px");else{e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var o=this.getTrackLabelTops(),i=this,r=this.getLabelAreaWidth(),s=r-this.percent_altered_max_width;l.each(e,function(e){var t=o[e],r=(i.getTrackLabelCSSClass(e),i.oncoprint.getTrackLabel(e)),c=r;r.length>i.max_label_length&&!n&&(c=r.substring(0,i.max_label_length-3)+"..."),l.each(a.selectAll(i.getTrackLabelCSSSelector(e)),function(e){$(e).qtip("destroy")}),a.selectAll(i.getTrackLabelCSSSelector(e)).remove();var d=a.append("span").style("position","absolute").classed(i.getTrackLabelCSSClass(e),!0).classed("oncoprint-track-label-draggable",!0).classed("oncoprint-track-label-main",!0).classed("oncoprint-track-label",!0).classed("noselect",!0).style("font-family",i.getLabelFont()).style("font-weight","bold").text(c).style("top",t+"px").on("mousedown",function(){i.dragLabel(e)});$(d.node()).qtip({content:{text:r.length>i.max_label_length?r+"<br> hold to drag":"hold to drag"},position:{my:"middle right",at:"middle left",viewport:$(window)},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow"},show:{event:"mouseover"}});var u=i.getAlteredDataPercentage(e);"undefined"!=typeof u&&a.append("span").style("position","absolute").classed(i.getTrackLabelCSSClass(e),!0).classed("oncoprint-track-label",!0).classed("noselect",!0).style("font-family",i.getLabelFont()).text(u+"%").style("top",t+"px").style("left",s+"px")})}},e.prototype.getTrackButtonCSSClass=function(e){return"oncoprint-track-button"+n.ifndef(e,"")},e.prototype.removeTrackButtons=function(e){var t=this.label_div;e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var n=this;l.each(e,function(e){t.selectAll("."+n.getTrackButtonCSSClass(e)).remove()})},e.prototype.renderTrackButtons=function(e){var t=this.label_div;e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var n=this.getTrackLabelTops(),a=this,o=this.getLabelAreaWidth();l.each(e,function(e){var i=a.getTrackButtonCSSClass(e);t.selectAll("."+i).remove();var r=o-15;a.oncoprint.isTrackRemovable(e)&&(!function(){var o=t.append("span").classed("noselect",!0).style("font-size","12px").style("color","#87CEFA").style("cursor","pointer").classed(i,!0).classed(a.getTrackButtonCSSClass(),!0).on("click",function(){a.oncoprint.removeTrack(e)}).style("position","absolute").style("left",r+"px").style("top",n[e]+"px");o.text("X"),$(o.node()).hover(function(){o.style("font-size","15px").style("color","#0000FF")},function(){o.style("font-size","12px").style("color","#87CEFA")}).qtip({position:{my:"bottom middle",at:"top middle",viewport:$(window)},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow"},show:{event:"mouseover"},hide:{fixed:!0,delay:100,event:"mouseout"}})}(),r-=35),a.oncoprint.isTrackSortDirectionChangable(e)&&!function(){var o=["images/decreaseSort.svg","images/increaseSort.svg","images/nonSort.svg"],s=["Click to sort in descending order","Click to not sort on this track","Click to sort in ascending order"],l=[1,-1,0],c=l.indexOf(a.oncoprint.getTrackSortDirection(e)),d=t.append("img");d.attr("src",o[c]).style("cursor","pointer"),$(d.node()).qtip({content:{text:function(){return s[c]}},position:{my:"bottom middle",at:"top middle",viewport:$(window)},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow"},show:{event:"mouseover"},hide:{fixed:!0,delay:100,event:"mouseout"}}),d.classed(i,!0).classed(a.getTrackButtonCSSClass(),!0).on("click",function(){c=(c+1)%3,a.oncoprint.setTrackSortDirection(e,l[c]),d.attr("src",o[c])}).style("position","absolute").style("left",r+"px").style("top",n[e]+"px")}()})},e.prototype.resizeCells=function(e){this.cell_div.selectAll("svg."+this.getCellCSSClass()).style("width",this.oncoprint.getZoomedCellWidth()+"px")},e.prototype.removeTrackCells=function(e){this.cell_div.selectAll("svg."+this.getTrackCellCSSClass(e)).remove()},e.prototype.drawTrackCells=function(e,t){var n=this.oncoprint,a=n.getTrackData(e),o=(n.getTrackDatumIdKey(e),n.getTrackDatumIdAccessor(e)),i=this.getRuleSet(e);if(i){var s=this;this.track_cells[e]={};var l=this.getCellCSSClass(),c=this.getTrackCellCSSClass(e),d=this.track_cells[e],u=r.select(t).selectAll("svg."+c).data(a);u.enter().append("svg").classed(c,!0).classed(l,!0).attr("shape-rendering","geometricPrecision").attr("preserveAspectRatio","none").attr("viewBox","0 0 "+n.getFullCellWidth()+" "+n.getCellHeight(e)).style("width",n.getZoomedCellWidth()+"px").style("height",n.getCellHeight(e)+"px"),u.exit().remove();n.getTrackTooltip(e);u.each(function(e,t){var n=o(e);d[n]={dom:this,d:e}}),u.selectAll("*").remove(),this.active_rule_set_rules[i.getRuleSetId()][e]=i.apply(u,n.getFullCellWidth(),n.getCellHeight(e)),s.track_cell_selections[e]=u}},e.prototype.drawCells=function(e){var n;n=this.document_fragment?document.createDocumentFragment():this.cell_div.node(),e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var a=this;l.each(e,function(e){a.drawTrackCells(e,n)}),this.document_fragment&&this.cellRenderTarget().node().appendChild(n),setTimeout(function(){$(a).trigger(t.FINISHED_RENDERING)},0)},e.prototype.clipAndPositionCells=function(e,t,n,a){this.cell_div.node().display="none",e="undefined"==typeof e?this.oncoprint.getTracks():e,e=[].concat(e);var o=this.getVisibleInterval(),i=4*(o[1]-o[0]),r=Math.floor(o[0]/i);o=l.map([-i,2*i],function(e){return Math.max(e+r*i,0)});var s=this,c=this.getTrackCellTops(),d=this.oncoprint.getVisibleInvertedIdOrder(),u=this.getCellXArray(Object.keys(d).length);
l.each(e,function(e){var i;t&&"top"!==t||(i=c[e]);var l=s.oncoprint.getTrackDatumIdKey(e);(r!==s.prev_interval_number||n)&&s.track_cell_selections.hasOwnProperty(e)&&s.track_cell_selections[e].each(function(e,n){var r=u[d[e[l]]],s=this.style.display,c=(isNaN(r)||r<o[0]||r>o[1])&&!a?"none":"inherit";s!==c&&(this.style.display=c),t&&"left"!==t||"none"===c||(this.style.left=r+"px"),t&&"top"!==t||"none"===c||(this.style.top=i+"px")})}),this.prev_interval_number=r,this.cell_div.node().display="block"},e.prototype.setLegendVisible=function(e,t){var n=this;e="undefined"==typeof e?this.oncoprint.getTracks():[].concat(e),l.each(e,function(e){n.getRuleSet(e).exclude_from_legend=!t}),this.renderLegend()},e.prototype.renderLegend=function(e){var t=this.oncoprint.getFullCellWidth(),a=this,o={};a.legend_table.selectAll("*").remove(),l.each(this.rule_sets,function(i,s){if(!i.exclude_from_legend||e){var c=i.getRuleSetId(),d={};if(l.each(a.active_rule_set_rules[c],function(e,t){$.extend(d,e)}),!o.hasOwnProperty(c)){var u=a.legend_table.append("tr"),p=u.append("td").style("padding-top","1em").style("padding-bottom","1em").append("span").classed("oncoprint-legend-header",!0);p.text(i.getLegendLabel());var m=u.append("td"),g=i.getLegendDiv(d,t,a.oncoprint.getCellHeight(s));m.node().appendChild(g),n.d3SelectChildren(r.select(g),"*").classed("oncoprint-legend-block-span",!0),o[c]=!0}}})},e.prototype.dragLabel=function(e){this.getLabelDragDiv().style("display","block");var t=this.oncoprint.getContainingTrackGroup(e),a=t[0],o=t[t.length-1],i=this.getTrackLabelTops(),s={};l.each(t,function(e){s[e]=i[e]}),t.splice(t.indexOf(e),1);var d=l.map(t,function(e){return s[e]}),u=this.getLabelAreaHeight(),p=[void 0,void 0];p[0]=n.clamp(s[a],0,u),p[1]=n.clamp(s[o]+this.getRenderedTrackHeight(o),0,u);var m=this,g=$(m.getLabelDragDiv().node());delete s[e],function(e){var a=-1,o=function(o){o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault();var i=n.clamp(n.mouseY(o),p[0],p[1]);m.renderTrackLabels(e,i),r.selectAll(m.getTrackLabelCSSSelector(e)).classed(c,!0),a=l.sortedIndex(d,i),l.each(s,function(e,n){e+=3*+(a<t.length&&t[a]==n),e-=3*+(a>0&&t[a-1]==n),m.renderTrackLabels(n,e)})};g.on("mousemove",o);var i=function(t){g.hide(),g.off("mousemove",o),a>-1&&m.oncoprint.moveTrack(e,a)};$(document).one("mouseup",i)}(e)},e.prototype.toSVG=function(e){var t=this,a=$(this.container.node()).offset(),o=r.select(document.createElementNS("http://www.w3.org/2000/svg","svg"));return o.attr("width",this.getLabelAreaWidth()+this.getCellAreaWidth()+"px"),this.renderLegend(!0),this.renderTrackLabels(void 0,void 0,e),o.attr("height",$(this.container.node()).height()+"px"),function(){t.label_div.selectAll(".oncoprint-track-label").each(function(){var e=r.select(this),t=e.style("font-family")||"Arial",i=e.style("font-weight"),s=e.style("font-size")||"12px",l=$(e.node()).offset(),c=e.text();o.append("text").style("font-family",t).style("font-weight",i).style("font-size",s).attr("transform",n.translate(l.left-a.left,l.top-a.top)).style("alignment-baseline","hanging").text(c)})}(),function(){t.clipAndPositionCells(void 0,void 0,!0,!0),t.cell_div.selectAll(".oncoprint-cell").each(function(){var e=r.select(this),t=e.node().getBoundingClientRect(),i={width:t.width,height:t.height},s=$(e.node()).offset(),l=o.append("g").attr("transform",n.translate(s.left-a.left,s.top-a.top));e.selectAll("*").each(function(){n.appendD3SVGElement(r.select(this),l)});var c={color:e.style("outline-color"),width:e.style("outline-width")};c.color&&l.append("rect").attr("width",i.width+"px").attr("height",i.height+"px").style("fill","none").style("stroke",c.color).style("stroke-width",c.width)}),t.clipAndPositionCells(void 0,void 0,!0)}(),function(){t.legend_table.selectAll("tr").each(function(){r.select(this).selectAll("td").each(function(){r.select(this).selectAll(".oncoprint-legend-header,.oncoprint-legend-element").each(function(){if($(this).text().trim().length){var e=r.select(this),t=e.style("font-family")||"Arial",i=e.style("font-weight"),s=e.style("font-size")||"12px",l=e.text(),c=$(e.node()).offset();o.append("text").style("font-family",t).style("font-weight",i).style("font-size",s).attr("transform",n.translate(c.left-a.left,c.top-a.top)).style("alignment-baseline","hanging").text(l)}else if("svg"===this.tagName.toLowerCase()){var d=r.select(this),c=$(d.node()).offset(),u=o.append("g").attr("transform",n.translate(c.left-a.left,c.top-a.top)),p=d.node().getBoundingClientRect(),m={width:p.width,height:p.height},g={color:d.style("outline-color"),width:d.style("outline-width")};g.color&&u.append("rect").attr("width",m.width+"px").attr("height",m.height+"px").style("fill","none").style("stroke",g.color).style("stroke-width",g.width),d.selectAll("*").each(function(){n.appendD3SVGElement(r.select(this),u)})}})})})}(),this.renderLegend(),this.renderTrackLabels(),o.node()},e}();e.setBusy(!0)("Loading Dataset"),e.setDataset(h.datasource).then(function(t){var n=t.payload.rownames.filter(function(e){return e.indexOf("mtx")>=0}),n=(t.payload.tbl,n[n.length-1].replace(".RData",""));i.$watchGroup(["vm.geneAndPatients"],function(){w(h.geneAndPatients)}),e.setBusy(!1)});var b="",y=function(e){if(b!=e)switch(e){case"instructions":d.hide(),u.show(),p.hide();break;case"control":d.show(),u.hide(),p.show();break;case"errors":d.hide(),u.show(),p.hide()}},w=function(t){if(null==m||null==g)return void y("instructions");var n=t;n=n.split(","),n.length>350?(h.errorMessage="ERROR: The total number of Patients and Genes are set to be less than 350.",y("errors")):(e.setBusy(!0),e.getOncoprint(n),e.getOncoprint(n).then(function(t){var n=t.payload;c(n),y("control"),e.setBusy(!1)}))}}e.$inject=["osApi","osHistory","$state","$stateParams","$timeout","$scope","d3","$window","_"];var t={restrict:"E",templateUrl:"app/components/oncoprint/oncoprint.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osOncoprint",e)}(),function(){"use strict";function e(){function e(e,m,g,h,f,v,b,y,w,A,x){if(angular.isUndefined(v.datasource))return void g.go("datasource");var C,k=angular.element(".markers-chart"),T=a(this,v);T.resize=function(){var e=A.innerWidth;"true"==angular.element(".tray").attr("locked")&&(e-=300),k.width(e),k.height(A.innerHeight-90),C&&C.resize()},angular.element(A).bind("resize",x.debounce(T.resize,300)),angular.element(A).bind("click",function(){f.$apply(function(){T.optCtxGeneShow=!1,T.optCtxPatientShow=!1})}),e.setBusy(!0),p(e,T,function(a){T.resize();var p=r();C=i(a,p,b,angular.element("#markers-chart")),u(C,T,f),d(C,T,f,e,h,x),l(C,T,f,h),s(C,T,f,h,e,y),t(C,T,f),c(C,x),n(C,T,A),o(C,m,x,f),e.setBusy(!1)})}function t(e,t,n){n.$watch("vm.searchGene",function(){if(angular.isUndefined(t.searchGene))return void(t.geneSearchResult="");e.startBatch();var n={found:0};e.nodes('node[nodeType="gene"]').forEach(function(e){return""==t.searchGene?void e.deselect():void(0==e.data().name.toLowerCase().indexOf(t.searchGene.toLowerCase())?(e.select(),this.found+=1):e.deselect())},n),e.endBatch(),""==t.searchGene?t.searchGeneResult="":t.searchGeneResult="("+n.found+" Matches)"}),n.$watch("vm.searchPatient",function(){if(!angular.isUndefined(t.searchPatient)){e.startBatch();var n={found:0};e.nodes('node[nodeType="patient"]').forEach(function(e){return""==t.searchPatient?void e.deselect():void(0==e.data().id.toLowerCase().indexOf(t.searchPatient.toLowerCase())?(e.select(),this.found+=1):e.deselect())},n),e.endBatch(),""==t.searchPatient?t.searchPatientResult="":t.searchPatientResult="("+n.found+" Matches)"}})}function n(e,t,n){t.optInteractiveMode=t.optInteractiveModes[0],t.optCommandPatient=[{name:"Show Edges",cmd:function(){t.optCommandPatient.selected.select();var n={};t.optCommandPatient.selected.neighborhood("edge").forEach(function(e){this[e.id()]={display:"element"}},n),e.batchData(n)}},{name:"Hide Edges",cmd:function(){var n={};t.optCommandPatient.selected.neighborhood("edge").forEach(function(e){this[e.id()]={display:"none"}},n),e.batchData(n)}},{name:"Select Associated Genes",cmd:function(){e.startBatch(),t.optCommandPatient.selected.select(),t.optCommandPatient.selected.neighborhood("node").forEach(function(e){e.select()}),e.endBatch(),t.optCtxPatientShow=!1}},{name:"Deselect Associated Genes",cmd:function(){e.startBatch(),t.optCommandPatient.selected.neighborhood("node").forEach(function(e){e.deselect()}),e.endBatch(),t.optCtxPatientShow=!1}},{name:"View Oncoprint",cmd:function(){if("DEMOdz"!=t.datasource){if(t.datasource.indexOf(!1)){var e=t.datasource.substr(4)+"_tcga",a=t.optCommandPatient.selected.neighborhood("node").map(function(e){return e.data().name}).join("+"),o="http://www.cbioportal.org/ln?cancer_study_id="+e+"&q="+a;n.open(o)}t.optCtxPatientShow=!1}}}],t.optCommandGene=[{name:"Show Edges",cmd:function(){t.optCommandGene.selected.select();var n={};t.optCommandGene.selected.neighborhood("edge").forEach(function(e){this[e.id()]={display:"element"}},n),e.batchData(n)}},{name:"Hide Edges",cmd:function(){var n={};t.optCommandGene.selected.neighborhood("edge").forEach(function(e){this[e.id()]={display:"none"}},n),e.batchData(n)}},{name:"Select Associated Patients",cmd:function(){e.startBatch(),t.optCommandGene.selected.select(),t.optCommandGene.selected.neighborhood("node").forEach(function(e){e.select()}),e.endBatch(),t.optCtxGeneShow=!1}},{name:"Deselect Associated Patients",cmd:function(){e.startBatch(),t.optCommandGene.selected.neighborhood("node").forEach(function(e){e.deselect()}),e.endBatch(),t.optCtxPatientShow=!1}},{name:"View Gene Card",cmd:function(){n.open("http://www.genecards.org/cgi-bin/carddisp.pl?gene="+t.optCommandGene.selected.data().name),t.optCtxGeneShow=!1}}],t.optCommands={zoomReset:function(){e.fit(),e.center()},zoomFit:function(){e.fit(e.$(":selected"),50)},showPatientsInCommon:function(){var t=e.$('node[nodeType="gene"]:selected'),n=t.map(function(e){return e.data().name}),a=t.neighborhood("node");e.startBatch(),a.filter(function(e,t){var a=t.neighborhood("node").map(function(e){return e.data().name});return n.forEach(function(e){return-1==a.indexOf(e)?!1:void 0}),!0}).forEach(function(e){e.select()}),e.endBatch()},showGenesInCommon:function(){var t,n=e.$('node[nodeType="patient"]:selected');n.each(function(e,n){var a=n.neighborhood("node").map(function(e){return e.data().name});t=0==e?a:t.filter(function(e){return a.indexOf(e)>=0},a)}),e.startBatch(),e.$('node[nodeType="gene"]').forEach(function(e){t.indexOf(e.data().name)>=0&&e.select()}),e.endBatch()},showPatientEdges:function(){var t={};e.$('node[nodeType="patient"]:selected').forEach(function(e){e.neighborhood("edge").forEach(function(e){this[e.id()]={display:"element"}},this)},t),e.batchData(t)},hidePatientEdges:function(){var t={};e.$('node[nodeType="patient"]:selected').forEach(function(e){e.neighborhood("edge").forEach(function(e){this[e.id()]={display:"none"}},this)},t),e.batchData(t)},showGeneEdges:function(){var t={};e.$('node[nodeType="gene"]:selected').forEach(function(e){e.neighborhood("edge").forEach(function(e){this[e.id()]={display:"element"}},this)},t),e.batchData(t)},hideGeneEdges:function(){var t={};e.$('node[nodeType="gene"]:selected').forEach(function(e){e.neighborhood("edge").forEach(function(e){this[e.id()]={display:"none"}},this)},t),e.batchData(t)},selectConnectedGenes:function(){e.startBatch(),e.$('node[nodeType="patient"]:selected').neighborhood("node").forEach(function(e){e.select()}),e.endBatch()},selectConnectedPatients:function(){e.startBatch(),e.$('node[nodeType="gene"]:selected').neighborhood("node").forEach(function(e){e.select()}),e.endBatch()},selectPatients:function(){e.startBatch(),e.$('node[nodeType="patient"]').forEach(function(e){e.select()}),e.endBatch()},selectGenes:function(){e.startBatch(),e.$('node[nodeType="gene"]').forEach(function(e){e.select()}),e.endBatch()},deselectPatients:function(){e.startBatch(),e.$('node[nodeType="patient"]:selected').forEach(function(e){e.deselect()}),e.endBatch()},deselectGenes:function(){e.startBatch(),e.$('node[nodeType="gene"]:selected').forEach(function(e){e.deselect()}),e.endBatch()},invertPatientSelection:function(){e.startBatch(),e.$('node[nodeType="patient"]').forEach(function(e){e[e._private.selected?"deselect":"select"]()}),e.endBatch()},invertGeneSelection:function(){e.startBatch(),e.$('node[nodeType="gene"]').forEach(function(e){e[e._private.selected?"deselect":"select"]()}),e.endBatch()},invertAll:function(){e.startBatch(),e.$('node[nodeType="patient"]').forEach(function(e){e[e._private.selected?"deselect":"select"]()}),e.$('node[nodeType="gene"]').forEach(function(e){e[e._private.selected?"deselect":"select"]()}),e.endBatch()},deselectAll:function(){e.startBatch(),e.$("node:selected").forEach(function(e){e.deselect()}),e.endBatch()},hideAllEdges:function(){var t={};e.$('edge[edgeType!="chromosome"]').forEach(function(e){this[e.id()]={display:"none"}},t),e.batchData(t)}}}function a(e,t){return e.datasource=t.datasource,e.optCommandGene=!1,e.optCtxGeneShow,e.optCommandPatient,e.optCtxPatientShow=!1,e.optInteractiveModes,e.optInteractiveMode,e.optPatientLayouts,e.optPatientLayout,e.optNodeColors,e.optNodeColor,e.optEdgeColors,e.legandNodes,e.legandPatient,e.legandChromosomes,e.searchGene,e.searchGeneResult="",e.searchPatient,e.searchPatientResult="",e.optCohortModes,e.optCohortMode="",e.optCohortPatients,e.optCohortPatient,e.optCohortGenes,e.optCohortGene,e.optCommands,e.patient,e.gene,e.frame,e}function o(e,t,n,a){function o(){var a=e.$('node[nodeType="gene"]:selected').map(function(e){return e.data().id.toUpperCase()});0!=n.difference(a,l).length&&a.length>0&&t.addGeneSelection("Markers + Patients","Manual",a)}function i(){var a=e.$('node[nodeType="patient"]:selected').map(function(e){return e.data().id.toUpperCase()});0!=n.difference(a,c).length&&a.length>0&&t.addPatientSelection("Markers + Patients","Manual",a)}function r(){var t=[];e.startBatch(),0==l.length?e.$('node[nodeType="gene"]:selected').forEach(function(e){e.deselect(),t[e.id()]={display:"element"}},t):e.$('node[nodeType="gene"]').forEach(function(e){e[-1==this.indexOf(e.id())?"deselect":"select"]()},l),e.batchData(t),e.endBatch()}function s(){var t=[];e.startBatch(),0==c.length?e.$('node[nodeType="patient"]:selected').forEach(function(e){e.deselect(),t[e.id()]={display:"element"}},t):e.$('node[nodeType="patient"]').forEach(function(e){e[-1==this.indexOf(e.id())?"deselect":"select"]()},c),e.batchData(t),e.endBatch()}var l=null==t.getGeneSelection()?[]:t.getGeneSelection().ids,c=null==t.getPatientSelection()?[]:t.getPatientSelection().ids;return e.on("select",'node[nodeType="gene"]',n.debounce(o,900)),e.on("select",'node[nodeType="patient"]',n.debounce(i,900)),r(),s(),t.onGeneSelectionChange.add(function(e){l=null==e?null:e.ids,r()}),t.onPatientSelectionChange.add(function(e){c=null==e?null:e.ids,s()}),a.$on("$destroy",function(){o(),i(),t.removeListeners()}),{saveGenes:o,savePatients:i}}function i(e,t,n,a){return n({container:a,elements:e,style:t,hideEdgesOnViewport:!1,hideLabelsOnViewport:!1,textureOnViewport:!1,motionBlur:!0,minZoom:.05,maxZoom:40,layout:{name:"preset",fit:!0}})}function r(){return[{selector:"core",style:{"selection-box-color":"#3993fa","selection-box-border-color":"#3993fa","selection-box-border-width":"1px","selection-box-opacity":".2"}},{selector:"node",style:{display:"data(display)",height:"mapData(sizeEle, 0, 50, 10, 100)",width:"mapData(sizeEle, 0, 50, 10, 100)","font-size":"data(sizeLbl)","text-valign":"center"}},{selector:'node[nodeType="patient"]',style:{"background-color":"data(color)","text-halign":"center","border-width":1,"border-color":"#FFFFFF"}},{selector:'node[nodeType="patient"]:selected',style:{"border-color":"#FF0000","border-width":10}},{selector:'node[nodeType="gene"]',style:{"background-color":"#FFFFFF","border-color":"#38347b","text-halign":"right",label:"data(id)","border-width":"data(sizeBdr)"}},{selector:'node[nodeType="gene"]:selected',style:{"border-color":"#FF0000","border-width":10}},{selector:'node[nodeType="centromere"]',style:{"font-size":"24px","text-halign":"center","background-color":"#3993fa",color:"#FFFFFF","border-color":"rgb(19, 150, 222)",height:"40px",width:"120px",shape:"roundrectangle",label:"  data(id)"}},{selector:"edge",style:{display:"data(display)","line-color":"data(color)",width:"data(sizeEle)"}}]}function s(e,t,n,a,o,i){var r=function(e){var t=new e.Signal,n=new e.Signal,a=new e.Signal,o=new e.Signal,i=new e.Signal,r=new e.Signal,s=new e.Signal,l=new e.Signal,c=function(){t.removeAll(),n.removeAll(),a.removeAll(),o.removeAll(),i.removeAll(),r.removeAll(),s.removeAll(),l.removeAll()},d=function(e){t.add(e),i.add(e)},u=function(e){n.add(e),r.add(e)},p=function(e){a.add(e),s.add(e)};return{geneOver:t,geneOut:n,geneClick:a,geneCtx:o,patientOver:i,patientOut:r,patientClick:s,patientCtx:l,over:d,out:u,click:p,removeAll:c}}(i);e.on("click",'node[nodeType="gene"]',r.geneClick.dispatch).on("click",'node[nodeType="patient"]',r.patientClick.dispatch).on("mouseover",'node[nodeType="gene"]',r.geneOver.dispatch).on("mouseover",'node[nodeType="patient"]',r.patientOver.dispatch).on("mouseout",'node[nodeType="gene"]',r.geneOut.dispatch).on("mouseout",'node[nodeType="patient"]',r.patientOut.dispatch).on("cxttap",'node[nodeType="gene"]',r.geneCtx.dispatch).on("cxttap",'node[nodeType="patient"]',r.patientCtx.dispatch);var s={};e.$('edge[edgeType!="chromosome"]').forEach(function(e){this[e.id()]={display:"none"}},s);var l={showGeneCtxMenu:function(e){t.optCommandGene.selected=e.cyTarget;var a=e.originalEvent,o=angular.element("#gene-ctx-menu");return o.show(),n.$apply(function(){t.optCtxGeneShow=!0}),o.css({left:a.pageX-20,top:a.pageY-20}),o.find(".title").text(t.optCommandGene.selected.data().name),this},showPatientCtxMenu:function(e){t.optCommandPatient.selected=e.cyTarget;var a=e.originalEvent,o=angular.element("#patient-ctx-menu");return o.show(),n.$apply(function(){t.optCtxPatientShow=!0}),o.css({left:a.pageX-20,top:a.pageY-20}),o.find(".title").text(t.optCommandPatient.selected.data().name),this},showPatientInfo:function(e){if("patient"==e.cyTarget.data().nodeType)t.patient=e.cyTarget.attr("patient"),t.patientChromosomes=e.cyTarget.neighborhood("node").map(function(e){return e.data().id}),n.$apply();else{var a={name:e.cyTarget.data().name,mutation:e.cyTarget.neighbourhood("edge[edgeType='mutation']").length,cnl1:e.cyTarget.neighbourhood("edge[edgeType='cnLoss.1']").length,cnl2:e.cyTarget.neighbourhood("edge[edgeType='cnLoss.2']").length,cng1:e.cyTarget.neighbourhood("edge[edgeType='cnGain.1']").length,cng2:e.cyTarget.neighbourhood("edge[edgeType='cnGain.2']").length};a.mutations=a.cnl1+a.cnl2+a.cng1+a.cng2,t.gene=a,n.$apply()}return this},hidePatientInfo:function(){return n.$apply(function(){t.gene=t.patient=t.patientChromosomes=null}),this},showDegreeOne:function(t){var n={},a="patient"==t.cyTarget.data().nodeType?"target":"source";e.startBatch(),t.cyTarget.neighborhood("edge").forEach(function(e){this.degmap[e.id()]={display:"element"},e[this.target]().css({"background-color":e.data().color,"border-color":e.data().color,"border-width":60,"border-opacity":.3})},{degmap:n,target:a}),e.endBatch(),e.batchData(n)},hideDegreeOne:function(t){var n={},a="patient"==t.cyTarget.data().nodeType?"target":"source",o={"background-color":"","border-color":"","border-width":"","border-opacity":""};e.startBatch(),t.cyTarget.neighborhood("edge").forEach(function(e){this.degmap[e.id()]={display:"none"},e[a]().style(this.css)},{degmap:n,css:o,target:a}),e.endBatch(),e.batchData(n)},showDegreeTwo:function(t){var n={};t.cyTarget.neighborhood("node").forEach(function(e){e.neighborhood("edge").forEach(function(e){this[e.id()]={display:"element"}},this)},n),e.batchData(n)},hideDegreeTwo:function(t){var n={};t.cyTarget.neighborhood("node").forEach(function(e){e.neighborhood("edge").forEach(function(e){this[e.id()]={display:"none"}},this)},n),e.batchData(n)}},c=[{name:"Commands",register:function(){r.geneCtx.add(l.showGeneCtxMenu),r.patientCtx.add(l.showPatientCtxMenu),r.over(function(e){l.showPatientInfo(e)}),r.out(function(e){l.hidePatientInfo(e)})},unregister:function(){r.removeAll(),e.batchData(s)}},{name:"Selection Highlight",register:function(){var t={};e.$('node[nodeType="patient"]:selected').forEach(function(e){e.neighborhood("edge").forEach(function(e){this[e.id()]={display:"element"}},t)},t),e.batchData(t),e.on("select","node",{ui:!0},function(e){l.showDegreeOne(e)}),e.on("unselect","node",{ui:!0},function(e){l.hideDegreeOne(e)}),r.over(function(e){l.showPatientInfo(e)}),r.out(function(e){l.hidePatientInfo(e)})},unregister:function(){e.batchData(s),e.off("select","node"),e.off("unselect","node")}},{name:"Roll Over Highlight",register:function(){r.over(function(e){l.showPatientInfo(e).showDegreeOne(e)}),r.out(function(e){l.hidePatientInfo(e).hideDegreeOne(e)})},unregister:function(){r.removeAll()}}];t.optInteractiveModes=c,t.optInteractiveMode=t.optInteractiveModes[0],n.$watch("vm.optInteractiveMode",function(e,t){angular.isDefined(t)&&t.unregister(),angular.isDefined(e)&&e.register()})}function l(e,t,n,a){var o=[{name:"mutation","class":"edgeMutation",color:"#004358",state:"Highlight"},{name:"cnGain.1","class":"edgeCnGain1",color:"#1F8A70",state:"Highlight"},{name:"cnLoss.1","class":"edgeCnLoss1",color:"#BEDB39",state:"Highlight"},{name:"cnGain.2","class":"edgeCnGain2",color:"purple",state:"Highlight"},{name:"cnLoss.2","class":"edgeCnLoss2",color:"#FD7400",state:"Highlight"}],i={mutation:o[0],"cnGain.1":o[1],"cnLoss.1":o[2],"cnGain.2":o[3],"cnLoss.2":o[4]};a(function(){o.forEach(function(e){angular.element("."+e["class"]).css("border-color",e.color)});var t={};e.edges('edge[edgeType!="chromosome"]').forEach(function(e){this[e.id()]={color:i[e.data("edgeType")].color,sizeEle:3}},t),e.batchData(t)}),t.optEdgeColors=o,t.updateEdge=function(t,n){if(t.state!=n){t.state=n;var a;switch(n){case"Highlight":a={color:t.color,sizeEle:3};break;case"Hide":a={color:"#FFFFFF",sizeEle:0};break;case"Show":a={color:"#3993fa",sizeEle:3}}angular.element("."+t["class"]).css("border-color",a.color);var o={};e.edges('edge[edgeType="'+t.name+'"]').forEach(function(e){this.degmap[e.id()]=this.state},{degmap:o,state:a}),e.batchData(o)}}}function c(e,t){e.on("pan",t.debounce(function(t){var n=Math.max(t.cy.zoom(),1),a={},o=Math.ceil(Math.max(12/n,1)),i=Math.ceil(Math.max(5/n,.5));e.nodes().forEach(function(e){this.degmap[e.id()]={sizeEle:e.degree()/this.zoom,sizeLbl:o,sizeBdr:i}},{degmap:a,zoom:n,font:o,sizeBdr:i}),e.batchData(a)},300))}function d(e,t,n,a,o,i){function r(){var n=e.$('node[nodeType="patient"]:selected'),a={};n.each(function(e,t){angular.isUndefined(a[t.data().color])?a[t.data().color]=1:a[t.data().color]+=1}),o(function(){for(var e=0;e<t.legandNodes.length;e++){var n=t.legandNodes[e].color;t.legandNodes[e].cnt=angular.isDefined(a[n])?a[n]:0}})}e.on("select",i.debounce(r,20)),e.on("unselect",i.debounce(r,20)),a.getSampleCategorizationNames().then(function(o){var i=[{name:"Default"},{name:"Gender"},{name:"Age At Diagnosis"}];angular.isDefined(o.payload.length)&&(i=i.concat(o.payload.map(function(e){return{name:e}}))),t.optNodeColors=i,t.optNodeColor=t.optNodeColors[0],n.$watch("vm.optNodeColor",function(){var n={};switch(t.optNodeColor.name){case"Default":t.legandNodes=[{name:"Patients",color:"#3993fa",cnt:0}],e.$('node[nodeType="patient"]').forEach(function(e){n[e.id()]={color:"#3993fa"}}),e.batchData(n);break;case"Gender":t.legandNodes=[{name:"Male",color:"purple",cnt:0},{name:"Female",color:"green",cnt:0}],e.$('node[nodeType="patient"]').forEach(function(e){try{var t=e.data("patient")[0][2];n[e.id()]={color:"male"===t?"purple":"green"}}catch(a){n[e.id()]={color:"#EEEEEE"}}}),e.batchData(n);break;case"Age At Diagnosis":t.legandNodes=[{name:"Young",color:"green",cnt:0},{name:"Old",color:"red",cnt:0}],e.$('node[nodeType="patient"]').forEach(function(e){try{var t=Number(e.data("patient")[0][4]);n[e.id()]={color:"rgb("+255*t/100+","+255*(100-t)/100+",0)"}}catch(a){n[e.id()]={color:"#000000"}}}),e.batchData(n);break;default:a.getSampleCategorization(t.optNodeColor.name).then(function(a){t.legandNodes=a.payload.tbl.map(function(e){return e[0]+"|"+e[1]}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(e){var t=e.split("|");return{name:t[0],color:t[1],cnt:0}});for(var o=a.payload.rownames,i=a.payload.tbl,r=e.$('node[nodeType="patient"]'),s=0;s<r.length;s++){var l=r[s].id();n[l]={color:"#DDDDDD"};for(var c=0;c<o.length;c++)l==o[c]&&(n[l]={color:i[c][1]})}e.batchData(n)})}r()})}),t.updateNode=function(t,n){e.startBatch(),e.nodes('node[nodeType="patient"]').forEach(function(e){e.style("background-color")==t.color&&e[n?"select":"deselect"]()}),e.endBatch()}}function u(e,t,n){t.optPatientLayouts=[{name:"Hobo"},{name:"Age At Diagnosis"}],t.optPatientLayout=t.optPatientLayouts[0],n.$watch("vm.optPatientLayout",function(t){var n=e.nodes('node[nodeType="patient"]');switch(e.startBatch(),t.name){case"Hobo":n.forEach(function(e){e.position(e.data("hobo"))});break;case"Age At Diagnosis":n.forEach(function(e){try{var t=Number(e.data("patient")[0][4]);t=t.map(0,100,-3e3,3e3),e.position({y:t,x:Math.pow(t,2)/5e3-200})}catch(n){e.position({x:100,y:0})}});break;case"Gender":n.filter(function(e,t){try{return"male"==t.data("patient")[0][2].toLowerCase()}catch(n){return!1}}).forEach(function(e,t){var n=10,a=100,o=.1*(t+1),i=-1e3+(n+a*o)*Math.cos(o),r=-1200+(n+a*o)*Math.sin(o);e.position({x:i,y:r})}),n.filter(function(e,t){return angular.isUndefined(t.data("patient")[0])}).forEach(function(e,t){var n=400,a=400,o=.1*(t+1),i=-2500+(n+a*o)*Math.cos(o),r=0+(n+a*o)*Math.sin(o);e.position({x:i,y:r})}),n.filter(function(e,t){try{return"female"==t.data("patient")[0][2].toLowerCase()}catch(n){return!1}}).forEach(function(e,t){var n=400,a=400,o=.1*(t+1),i=-1e3+(n+a*o)*Math.cos(o),r=1200+(n+a*o)*Math.sin(o);e.position({x:i,y:r})})}e.endBatch()})}function p(e,t,n){e.setDataset(t.datasource).then(function(){e.getPatientHistoryTable(t.datasource).then(function(t){var a=t.payload.tbl;e.getMarkersNetwork(t.payload).then(function(e){var t=angular.fromJson(e.payload).elements;t.nodes.filter(function(e){return"patient"===e.data.nodeType}).map(function(e){var t=e.data;t.display="element",t.color="#FFFF00",t.sizeEle=t.degree,t.sizeLbl=12,t.sizeBdr=5,t.hobo={x:e.position.x,y:e.position.y},t.patient=this.filter(function(t){return t[0]===e.data.id})},a),t.nodes.filter(function(e){return"patient"!=e.data.nodeType}).map(function(e){var t=e.data;return t.display="element",t.color="rgb(19, 150, 222)",t.sizeEle=t.degree,t.sizeLbl=12,t.sizeBdr=5,e.locked="gene"!==e.data.nodeType,e.selectable="gene"===e.data.nodeType,e.grabbable="gene"===e.data.nodeType,e}),t.edges.map(function(e){var t=e.data;return t.display="chromosome"==t.edgeType?"element":"none",t.color="rgb(19, 150, 222)",t.sizeEle=3,t.sizeLbl=12,e.locked=!0,e.selectable=!1,e.grabbable=!1,e}),n(t)})})})}e.$inject=["osApi","osHistory","$state","$timeout","$scope","$stateParams","cytoscape","signals","moment","$window","_"];var m={restrict:"E",templateUrl:"app/components/markers/markers.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return m}angular.module("oncoscape").directive("osMarkers",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o){if(angular.isUndefined(o.datasource))return void t.go("datasource");var i=this;i.dataset=o.datasource,i.colnames=[],i.rows=[],i.search="";var r;e.setBusy(!0),e.getDataManifest(i.dataset).then(function(t){i.colnames=t.payload.colnames,i.rows=t.payload.mtx,n(function(){r=angular.element("#metadata-datatable").dataTable({paging:!1}),a.$watch("vm.search",function(){r.api().search(i.search).draw()}),e.setBusy(!1)},0,!1)})}e.$inject=["osApi","$state","$timeout","$scope","$stateParams"];var t={restrict:"E",templateUrl:"app/components/metadata/metadata.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osMetadata",e)}(),function(){"use strict";function e(){function e(e,t){var n=e.getUserApi(),a=this;a.domains=n.getDomains(),a.user=n.getUser(),a.hasError=!1,a.login=function(){var e=n.login(a.user);angular.isDefined(e)?e.then(function(){a.user.authenticated?t.go("datasource"):a.hasError=!0}):t.go("datasource")}}e.$inject=["osApi","$state"];var t={restrict:"E",templateUrl:"app/components/login/login.html",replace:!0,controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osLogin",e)}(),function(){"use strict";function e(){var e={restrict:"E",templateUrl:"app/components/loader/loader.html",replace:!0};return e}angular.module("oncoscape").directive("osLoader",e)}(),function(){"use strict";function e(){function e(e){var t=this;t.login=function(){e.go("login")}}e.$inject=["$state"];var t={restrict:"E",templateUrl:"app/components/landing/landing.html",replace:!0,controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osLanding",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,r,s,l){if(angular.isUndefined(r.datasource))return void n.go("datasource");var c,d=this,u=null==t.getPatientSelection()?[]:t.getPatientSelection().ids,p=function(e,t){e.datasource=t,e.diagnosisMin=e.diagnosisMinValue=1,e.diagnosisMax=e.diagnosisMaxValue=99,e.survivalMin=e.survivalMinValue=0,e.survivalMax=e.survivalMaxValue=10,e.search=""},m=function(e,t){angular.element.fn.DataTable.ext.search=[function(t,n){var a=parseFloat(n[3]),o=parseFloat(n[4]);return 0!=u.length&&-1==u.indexOf(n[0])?!1:isNaN(a)||isNaN(o)?!1:o>=e.diagnosisMin&&o<e.diagnosisMax+1&&a>=e.survivalMin&&a<e.survivalMax+1}];var n=t.colnames.map(function(e){return{title:e}});c=angular.element("#history-datatable").dataTable({paging:!1,columns:n,data:t.tbl}),c.api().draw()},g=function(e,n){e.applyFilter=function(e){u=[],c.api().draw();var n=c._("tr",{filter:"applied"}).map(function(e){return e[0].toString().toUpperCase()});n=l.map(n,function(e){return[e]}),t.addPatientSelection("Patient History",e,n)};var a=!0;n.$watch("vm.search",s.debounce(function(){return a?void(a=!1):void e.applyFilter("Search")},1e3)),t.onPatientSelectionChange.add(function(e){u=e.ids,c.api().draw()})};e.setBusy(!0),e.setDataset(r.datasource).then(function(){e.getPatientHistoryTable(r.datasource).then(function(t){p(d,r.datasource),m(d,t.payload),g(d,o),e.setBusy(!1)})})}e.$inject=["osApi","osHistory","$state","$timeout","$scope","moment","$stateParams","_","$"];var t={restrict:"E",templateUrl:"app/components/history/history.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osHistory",e)}(),function(){"use strict";function e(){function e(e,t,n,a){e.onDataSource.add(function(){a(function(){i.showTools=!0})});var o=e.getUserApi();o.onLogin.add(function(){a(function(){i.showMenu=!0})}),o.onLogout.add(function(){a(function(){i.showMenu=!1})});var i=this;i.showMenu=!1,i.showTools=!1,i.toolsClick=function(){n.go("tools",{datasource:e.getDataSource()})},i.cohortClick=function(){e.toggleFilter()},i.logoutClick=function(){o.logout(),n.transitionTo("landing")}}e.$inject=["osApi","$stateParams","$state","$timeout"];var t={restrict:"E",templateUrl:"app/components/header/header.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osHeader",e)}(),function(){"use strict";function e(){function e(){var e=this;e.videos=[{name:"Oncoscape + Github",desc:"Description Lorum Ipsum eos et sid al accusamus et iusto odio",img:""},{name:"Creating Cohorts",desc:"Description Lorum Ipsum eos et sid al accusamus et iusto odio",img:""},{name:"Patients + Markers",desc:"Description Lorum Ipsum eos et sid al accusamus et iusto odio",img:""},{name:"Timelines",desc:"Description Lorum Ipsum eos et sid al accusamus et iusto odio",img:""}]}var t={restrict:"E",templateUrl:"app/components/help/help.html",controller:e,controllerAs:"vm",bindToController:!0};return t;
}angular.module("oncoscape").directive("osHelp",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i,r,s,l){if(angular.isUndefined(a.datasource))return void n.go("datasource");var c=(angular.element("#geneSetTestsInputsDiv"),this);c.datasource=a.datasource,c.geneSets=[],c.geneSet=null;var d=t.getPatientSelections()[0],u=t.getPatientSelections()[1];e.setBusy(!0),e.setDataset(c.datasource).then(function(t){var n=t.payload.rownames.filter(function(e){return e.indexOf("mtx.mrna")>=0});if(n=n[n.length-1].replace(".RData",""),console.log("**** mtx is: ",n),null==d||null==u)c.message="Please select two cohorts to test out the Gene Set",c.optCohort1="Empty",c.optCohort2="Empty";else{c.optCohort1=d.tool+" "+d.desc+" "+d.ids.length+" Patients selected",c.optCohort2=u.tool+" "+u.desc+" "+u.ids.length+" Patients selected";var a="random.24";e.getGeneSetTest(c.datasource,n).then(function(){i.$watchGroup(["vm.optCohort1","vm.optCohort2"],function(){m(d,u,a)})})}e.setBusy(!1)});var p=function(e,t,n){console.log(n),angular.element("#heatMap").highcharts({chart:{type:"heatmap",marginTop:40,marginBottom:80,plotBorderWidth:1},title:{text:"Gene Set Expression Heat Map"},xAxis:{categories:t},yAxis:{lineWidth:5,lineColor:"#F33",categories:e,title:null},colorAxis:{min:0,minColor:"#FFFFFF",maxColor:"#CC9933"},legend:{align:"right",layout:"vertical",margin:10,verticalAlign:"top",y:25,symbolHeight:280},tooltip:{formatter:function(){return"<b>"+this.series.yAxis.categories[this.point.y]+" "+this.series.xAxis.categories[this.point.x]+": "+this.point.value+"</b>"}},series:[{name:"Sales per employee",borderWidth:0,data:JSON.parse(n)}]})},m=function(t,n,a){var o=t.ids,i=n.ids;e.setBusy(!0),e.getGeneSetScore(o,i,a).then(function(t){if(console.log(t.payload),"error"==t.status)c.message=t.payload+"Please select two cohorts to test out the Gene Set";else{c.message=t.payload.summary;var n=t.payload.pt,a=t.payload.genes;p(n,a,t.payload.analysisData)}e.setBusy(!1)})}}e.$inject=["osApi","osHistory","$state","$stateParams","$timeout","$scope","d3","$window","_"];var t={restrict:"E",templateUrl:"app/components/genesettest/genesettest.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osGenesettest",e)}(),function(){"use strict";function e(){function e(){}var t={restrict:"E",templateUrl:"app/components/footer/footer.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osFooter",e)}(),function(){"use strict";function e(){function e(e,t){var n=this;n.datasets=[],n.explore=function(n,a){e.setDataSource(a),t.go(n,{datasource:a})};var a={DEMOdz:"DEMO (TCGA)",TCGAbrain:"Glioma (TCGA)",TCGAbrca:"Breast (TCGA)",TCGAcoadread:"Colorectal (TCGA)",TCGAgbm:"Glioblastoma (TCGA)",TCGAhnsc:"Head + Neck (TCGA)",TCGAlgg:"Lower Grade Glioma (TCGA)",TCGAluad:"Lung Adenocarcinoma (TCGA)",TCGAlung:"Lung (TCGA)",TCGAlusc:"Lung Squamous Cell (TCGA)",TCGApaad:"Pancreas (TCGA)",TCGAprad:"Prostate (TCGA)",UWbrain:"Brain (UW)",MSKbrain:"Brain (MSK)"};n.datasets=e.getUserApi().getUser().datasets.map(function(e){return{name:this[e],id:e}},a)}e.$inject=["osApi","$state"];var t={restrict:"E",templateUrl:"app/components/datasource/datasource.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osDatasource",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i){if(angular.isUndefined(o.datasource))return void t.go("datasource");var r=this;r.dataSources,r.dataSource,r.dataDiseases,r.dataDisease,r.dataTables,r.dataTable,r.dataFields,r.chartOptions={chart:{type:"discreteBarChart",height:450,margin:{top:20,right:20,bottom:50,left:55},x:function(e){return e.label},y:function(e){return e.value+1e-10},showValues:!0,valueFormat:function(e){return d3.format(",.4f")(e)},duration:500,xAxis:{axisLabel:"X Axis"},yAxis:{axisLabel:"Y Axis",axisLabelDistance:-10}}},r.toolTipContentFunction=function(){return function(e,t,n,a,o){return"Super New Tooltip<h1>"+e+"</h1><p>"+n+" at "+t+"</p>"}},r.xFunction=function(){return function(e){return e.label}},r.yFunction=function(){return function(e){return e.value}},e.setBusy(!0),e.query("_collections").then(function(t){var n=t.data;r.dataSources=i.chain(n).pluck("source").uniq().map(function(e){return{name:e,diseases:i.chain(n).where({source:e}).pluck("disease").uniq().map(function(e){return{name:e,tables:i.chain(n).where({source:"tcga",disease:e}).map(function(e){return{created:e.created,name:e.table,records:e.records,collection:e.collection}}).value()}}).value()}}).value(),r.dataSource=r.dataSources[0],a.$watch("vm.dataSource",function(){r.dataDiseases=r.dataSource.diseases,r.dataDisease=r.dataSource.diseases[0]}),a.$watch("vm.dataDisease",function(){r.dataTables=r.dataDisease.tables,r.dataTable=r.dataTables[0]}),a.$watch("vm.dataTable",function(){e.query("_stats",{collection:r.dataTable.collection}).then(function(e){r.dataFields=e.data[0].fields})}),e.setBusy(!1)})}e.$inject=["osApi","$state","$timeout","$scope","$stateParams","_"];var t={restrict:"E",templateUrl:"app/components/dataexplorer/dataexplorer.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osDataExplorer",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,i){if(angular.isUndefined(o.datasource))return void t.go("datasource");var r=this;r.dataSources,r.dataSource,r.dataDiseases,r.dataDisease,r.dataTables,r.dataTable,r.dataFields,r.toolTipContentFunction=function(){return function(e,t,n,a,o){return"Super New Tooltip<h1>"+e+"</h1><p>"+n+" at "+t+"</p>"}},r.xFunction=function(){return function(e){return e.label}},r.yFunction=function(){return function(e){return e.value}},e.setBusy(!0),e.query("_collections").then(function(t){var n=t.data;r.dataSources=i.chain(n).pluck("source").uniq().map(function(e){return{name:e,diseases:i.chain(n).where({source:e}).pluck("disease").uniq().map(function(e){return{name:e,tables:i.chain(n).where({source:"tcga",disease:e}).map(function(e){return{created:e.created,name:e.table,records:e.records,collection:e.collection}}).value()}}).value()}}).value(),r.dataSource=r.dataSources[0],a.$watch("vm.dataSource",function(){r.dataDiseases=r.dataSource.diseases,r.dataDisease=r.dataSource.diseases[0]}),a.$watch("vm.dataDisease",function(){r.dataTables=r.dataDisease.tables,r.dataTable=r.dataTables[0]}),a.$watch("vm.dataTable",function(){console.log(e.queryString("_stats",{collection:r.dataTable.collection})),e.query("_stats",{collection:r.dataTable.collection}).then(function(e){r.dataFields=e.data[0].fields})}),e.setBusy(!1)})}e.$inject=["osApi","$state","$timeout","$scope","$stateParams","_"];var t={restrict:"E",templateUrl:"app/components/cohortbuilder/cohortbuilder.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osCohortBuilder",e)}(),function(){"use strict";function e(){function e(e,t,n){var a=this;a.selection,a.selections,a.close=function(){angular.element(".cohorts-"+a.type).hide()},a.setSelection=function(t){e["set"+a.type+"Selection"](t)};var o=function(){n(function(){a.selections=e["get"+a.type+"Selections"](),a.selection=e["get"+a.type+"Selection"]()})};e["on"+a.type+"Add"].add(function(){o(!0)}),e["on"+a.type+"SelectionChange"].add(function(){o(!1)});var i=!1,r=function(){angular.element(".cohorts-"+a.type).show(),i||(i=!0,angular.element(".cohorts-"+a.type).draggable())};angular.element(document).keypress(function(t){if(t.ctrlKey)if("Gene"==a.type)switch(t.keyCode){case 12:r();break;case 39:e.getGeneSelectionNext();break;case 59:e.getGeneSelectionLast()}else switch(t.keyCode){case 16:r();break;case 27:e.getPatientSelectionLast();break;case 29:e.getPatientSelectionNext()}})}e.$inject=["osHistory","$state","$timeout"];var t={restrict:"E",templateUrl:"app/components/cohorts/cohorts.html",controller:e,scope:{type:"@"},controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osCohorts",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o){if(angular.isUndefined(o.datasource))return void t.go("datasource");e.setBusy(!0);(new Date).getTime();e.query("TCGA_BRCA_PT",{gender:"MALE"}).then(function(e){})}e.$inject=["osApi","$state","$timeout","$scope","$stateParams"];var t={restrict:"E",templateUrl:"app/components/apiexplorer/apiexplorer.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osApiExplorer",e)}(),function(){"use strict";function e(e,t,n,a,o){n.onerror=function(e,t,n,o,i){i||(i=new Error(e),i.fileName=t,i.lineNumber=n,i.columnNumber=o||0),a(i)};var i=e.$on("$stateChangeStart",function(e,t){o.setBusy(!1),angular.element.fn.DataTable.ext.search=[]});e.$on("$destroy",i)}e.$inject=["$rootScope","$state","$window","$exceptionHandler","osApi"],angular.module("oncoscape").run(e)}(),function(){"use strict";function e(e,t){e.state("landing",{url:"/",template:"<os-landing>",authenticate:!1}).state("help",{url:"/help",template:"<os-help>",authenticate:!1}).state("datasource",{url:"/datasource",template:"<os-datasource>",authenticate:!0}).state("tools",{url:"/tools/{datasource}",template:"<os-tools>",authenticate:!0}).state("metadata",{url:"/metadata/{datasource}",template:"<os-metadata>",authenticate:!0}).state("history",{url:"/history/{datasource}",template:"<os-history>",authenticate:!0}).state("plsr",{url:"/plsr/{datasource}",template:"<os-plsr>",authenticate:!0}).state("pca",{url:"/pca/{datasource}",template:"<os-pca>",authenticate:!0}).state("pca3d",{url:"/pca3d/{datasource}",template:"<os-pca3d>",authenticate:!0}).state("markers",{url:"/markers/{datasource}",template:"<os-markers>",authenticate:!0}).state("pathways",{url:"/pathways/{datasource}",template:"<os-pathways>",authenticate:!0}).state("timelines",{url:"/timelines/{datasource}",template:"<os-timelines>",authenticate:!0}).state("survival",{url:"/survival/{datasource}",template:"<os-survival>",authenticate:!0}).state("dataexplorer",{url:"/dataexplorer/{datasource}",template:"<os-data-explorer>",authenticate:!0}).state("oncoprint",{url:"/oncoprint/{datasource}",template:"<os-oncoprint>",authenticate:!0}).state("genesettest",{url:"/genesettest/{datasource}",template:"<os-genesettest>",authenticate:!0}).state("cohortbuilder",{url:"/cohortbuilder/{datasource}",template:"<os-cohort-builder>",authenticate:!0}),t.otherwise("/")}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("oncoscape").config(e)}(),function(){"use strict";angular.module("oncoscape").constant("moment",moment).constant("d3",d3).constant("cytoscape",cytoscape).constant("signals",signals).constant("SockJS",SockJS).constant("THREE",THREE).constant("$",$).constant("_",_),Number.prototype.map=function(e,t,n,a){return(this-e)*(a-n)/(t-e)+n}}(),function(){"use strict";function e(e){e.debugEnabled(!0)}e.$inject=["$logProvider"],angular.module("oncoscape").config(e)}(),angular.module("oncoscape").run(["$templateCache",function(e){e.put("app/components/apiexplorer/apiexplorer.html","Hello There"),e.put("app/components/cohortbuilder/cohortbuilder.html",'<os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content cohortbuilider"><div class="row"></div></section></os-tray><section class="tray-content-block dataexplorer"><div class="container-fluid"><h2>Cohort Builder</h2><button>+</button> <button>-</button></div></section>'),e.put("app/components/cohorts/cohorts.html",'<div class="cohorts panel panel-default cohorts-{{vm.type}}"><div class="panel-heading">{{vm.type}} History <span class="pull-right fa fa-times" ng-click="vm.close()"></span></div><div class="panel-body cohorts-panel-body"><table><tr ng-click="vm.setSelection(item)" ng-repeat="item in vm.selections" ng-class="{\'cohort-selected\' : item==vm.selection}"><td>{{item.tool}}</td><td>{{item.desc}}</td><td>{{item.ids.length}}</td></tr></table></div></div>'),e.put("app/components/dataexplorer/dataexplorer.html",'<os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content dataexplorer"><div class="row"><div class="col-xs-12 form-label"><h2>Data Source</h2></div><div class="col-xs-12 form-item"><label>Origin</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.dataSource.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.dataSources" ng-click="vm.dataSource = item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Disease</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.dataDisease.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.dataDiseases" ng-click="vm.dataDisease = item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Table</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.dataTable.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.dataTables" ng-click="vm.dataTable = item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-label"><h2>Metadata</h2><dl><dt>Date Uploaded</dt><dd>{{vm.dataTable.created}}</dd><dt>Record Count</dt><dd>{{vm.dataTable.records}}</dd><dt>Field Count</dt><dd>{{vm.dataFields.length}}</dd></dl></div></div></section></os-tray><section class="tray-content-block dataexplorer"><div class="container-fluid"><h2>Data Explorer</h2><div ng-repeat="item in vm.dataFields" class="row" style="padding-bottom:50px;"><div class="col-sm-9"><h2>{{item.name}}</h2><p style="text-transform: capitalize;">{{item.desc}}</p><div class="row"><div class="col-sm-3"><b>Availibility</b><br>{{item.percent}}%</div><div class="col-sm-3"><b>Distinct Values</b><br>{{item.distinct}}</div><div class="col-sm-3"><b>Data Type</b><br>{{item.type}}</div></div><div class="row" style="padding-top:10px;"><div class="col-sm-12"><b>TCGA Value Mappings</b><br>{{item.map}}</div></div></div><div class="col-sm-3"><nvd3-pie-chart ng-if="item.values" data="item.values" x="vm.xFunction()" y="vm.yFunction()" showlabels="false" showlegend="false" tooltips="true" labeltype="percent" nodata="Data is not available" height="250" width="250"></nvd3-pie-chart></div></div></div></section>'),e.put("app/components/datasource/datasource.html",'<section class="datasource container-fluid"><div class="row"><div class="col-sm-8 col-md-6"><h1>Data Sources</h1><p>Oncoscape has analyzed and curated the following datasets hosted by The Cancer Genome Atlas (TCGA). Raw data sets for these and other available disease sites can be found at <a href="https://tcga-data.nci.nih.gov/tcga/">TCGA Data Portal</a>.</p></div></div><div class="row"><ul><li ng-repeat="dataset in vm.datasets" class="col-xs-12 col-sm-6 col-lg-4" ng-click="vm.explore(\'tools\',dataset.id)"><img class="datasource-img" ng-src="/assets/images/datasets/{{dataset.id}}.png"><h3 class="datasource-lbl">{{dataset.name}}</h3><nobr><a href="">Explore</a></nobr></li></ul></div></section>'),e.put("app/components/footer/footer.html",'<footer class="footer container"><div class="row"><div class="col-xs-12 col-sm-6"><img class="footer-logo" src="/assets/images/logo-fred-hutchinson-cancer-research-center.png" alt="Fred Hutchinson Cancer Research Center"> <img class="footer-logo" src="/assets/images/logo-university-of-washington-medicine.png" alt="UW Medicine"> <img class="footer-logo" src="/assets/images/logo-seattle-cancer-care-alliance.png" alt="Seattle Cancer Care Alliance"></div><div class="col-xm-12 col-sm-6 text-right"><a href="https://www.facebook.com/STTRCancer" target="_blank"><img class="footer-icon" src="/assets/images/sttr-facebook-out.png" alt="Facebook"></a> <a href="https://twitter.com/sttrcancer" target="_blank"><img class="footer-icon" src="/assets/images/sttr-twitter-out.png" alt="Twitter"></a> <a href="https://plus.google.com/+fredhutch/videos" target="_blank"><img class="footer-icon" src="/assets/images/sttr-youtube-out.png" alt="YouTube"></a> <a href="http://instagram.com/FredHutch" target="_blank"><img class="footer-icon" src="/assets/images/sttr-instagram-out.png" alt="Instagram"></a> <a href="http://www.linkedin.com/company/fred-hutchinson-cancer-research-center/careers?trk=top_nav_careers" target="_blank"><img class="footer-icon" src="/assets/images/sttr-linkedin-out.png" alt="LinkedIn"></a> <a href="https://plus.google.com/116048577052683099154/posts" target="_blank"><img class="footer-icon" src="/assets/images/sttr-google-out.png" alt="Google+"></a></div></div></footer>'),e.put("app/components/genesettest/genesettest.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortPatient()"></os-tool-menu><script src="https://cdn.plot.ly/plotly-latest.min.js"></script><script src="/bower_components/highcharts/modules/heatmap.js"></script><script src="/bower_components/highcharts/modules/exporting.js"></script><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="col-xs-12 form-label"><h2>Cohorts</h2></div><div class="col-sm-12 form-item"><label>Patient Cohort 1</label><p>{{vm.optCohort1}}</p></div><div class="col-sm-12 form-item"><label>Patient Cohort 2</label><p>{{vm.optCohort2}}</p></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Gene Set Binomial Test</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div id="geneSetTestsModuleDiv" class="genesettest"><div id="geneSetTests_Div"><div id="geneSetTestsControlsDiv"><div class="navbar-collapse collapse navbar-inverse-collapse"><div id="geneSetTestsInputsDiv"><div id="geneSetTestsLaunchButtonDiv"><form><div>{{vm.message}}</div><div id="heatMap"></div></form></div></div></div></div></div></div></div></section>'),e.put("app/components/header/header.html",'<div class="header"><nav class="navbar navbar-inverse navbar-fixed-top"><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="#"><img alt="Brand" src="/assets/images/logo.png" style="max-height:50px;"></a></div><div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" ng-if="vm.showMenu"><ul class="nav navbar-nav navbar-right"><li><a href="#datasource"><span class="glyphicon glyphicon-th"></span>Data Sources</a></li><li><a href="" ng-click="vm.logoutClick()"><span class="glyphicon glyphicon-user"></span>Logout</a></li></ul></div></div><div class="nav-divider"></div></nav></div><a href="https://github.com/FredHutch/Oncoscape/labels/help%20wanted" class="github" tooltip="Submit Issues" style="text-align: right;"><div class="logo"><svg aria-hidden="true" class="octicon octicon-mark-github" height="28" role="img" version="1.1" viewbox="0 0 16 16" width="28"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59 0.4 0.07 0.55-0.17 0.55-0.38 0-0.19-0.01-0.82-0.01-1.49-2.01 0.37-2.53-0.49-2.69-0.94-0.09-0.23-0.48-0.94-0.82-1.13-0.28-0.15-0.68-0.52-0.01-0.53 0.63-0.01 1.08 0.58 1.23 0.82 0.72 1.21 1.87 0.87 2.33 0.66 0.07-0.52 0.28-0.87 0.51-1.07-1.78-0.2-3.64-0.89-3.64-3.95 0-0.87 0.31-1.59 0.82-2.15-0.08-0.2-0.36-1.02 0.08-2.12 0 0 0.67-0.21 2.2 0.82 0.64-0.18 1.32-0.27 2-0.27 0.68 0 1.36 0.09 2 0.27 1.53-1.04 2.2-0.82 2.2-0.82 0.44 1.1 0.16 1.92 0.08 2.12 0.51 0.56 0.82 1.27 0.82 2.15 0 3.07-1.87 3.75-3.65 3.95 0.29 0.25 0.54 0.73 0.54 1.48 0 1.07-0.01 1.93-0.01 2.2 0 0.21 0.15 0.46 0.55 0.38C13.71 14.53 16 11.53 16 8 16 3.58 12.42 0 8 0z"></path></svg></div></a>'),e.put("app/components/help/help.html",'<section class="tools container"><div class="row"><div class="col-sm-8 col-md-6"><br><br><br></div></div><div class="row"><div class="col-xs-12 col-md-7"><h2 style="margin:0px;margin-bottom: 20px;">Now Playing &mdash; Lorum Ipsum</h2><div style="background-color:#000;text-align: center;"><video width="640" height="360" controls="" style="background-color: #000;max-width: 100%;"></video></div><h2>Video Title</h2><p>Transcription At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat</p></div><div class="col-xs-12 col-md-5" style="padding-left: 40px;"><h2 style="margin:0px;">Oncoscape Videos</h2><ul><li ng-repeat="video in vm.videos" style="clear: both;"><div style="width:30%;height:90px;background-color:#EEE;display:inline-block;float:left;margin-bottom: 20px;text-align: center;cursor: pointer;"><span class="glyphicon glyphicon-play-circle" style="font-size: 30px;padding-top:30px; color:#FFF"></span></div><div style="width:69%;display: inline-block;float:left;padding-left: 10px;"><h3 class="tools-lbl" style="margin:0px;">{{video.name}}</h3><p>{{video.desc}}</p><a href="" ng-click="vm.explore(tool.route, vm.datasource)">Watch Video</a></div></li></ul></div></div></section>'),e.put("app/components/history/history.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortPatient()"></os-tool-menu><os-tray caption="Patients" content="tray-content-block"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Filters</h2></div><div class="col-xs-12 form-item"><label>Age At Diagnosis</label><div range-slider="" min="vm.diagnosisMinValue" model-min="vm.diagnosisMin" max="vm.diagnosisMaxValue" model-max="vm.diagnosisMax" show-values="true" attach-handle-values="true" on-handle-up="vm.applyFilter(\'Diagnosis\')"></div></div><div class="col-xs-12 form-item"><label>Survival</label><div range-slider="" min="vm.survivalMinValue" model-min="vm.survivalMin" max="vm.survivalMaxValue" model-max="vm.survivalMax" show-values="true" attach-handle-values="true" on-handle-up="vm.applyFilter(\'Survival\')"></div></div><div class="col-xs-12 form-item"><label>Search</label> <input type="text" class="ngrs-range-slider" style="width: 100%;" ng-model="vm.search"></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Patient Data</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><table id="history-datatable" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%"></table></div></section>'),e.put("app/components/landing/landing.html",'<div class="landing container"><div class="row" style="padding-top:20px;"><h2>Bridging Cancer Research and Clinical Care</h2></div><div class="row" style="padding-top:20px;"><div class="col-sm-8"><p>Oncoscape is developed at the Fred Hutchinson Cancer Research Center under the auspices of the Solid Tumor Translational Research initiative. Oncoscape is a web-based, menu-driven analysis and visualization platform for large-scale, heterogeneous clinical and molecular patient timeline data as exemplified by the Fred Hutch HIDRA database. Oncoscape vision and development is managed by a small team comprising: <a href="https://www.fredhutch.org/en/labs/profiles/holland-eric.html">Eric Holland</a>, <a href="http://www.sttrcancer.org/en/contact-us/horse-grant-bio.html">Desert Horse-Grant</a>, <a href="https://www.linkedin.com/in/lisa-mcferrin-9758b029">Lisa McFerrin</a>, <a href="https://www.linkedin.com/in/hbolouri">Hamid Bolouri</a>, <a href="https://www.linkedin.com/in/jenny-zhang-ba62a2104">Jenny Zhang</a>, <a href="https://www.linkedin.com/in/gretchenh">Gretchen Heinrich</a>, <a href="https://www.linkedin.com/in/robert-mcdermott-a77b9011">Robert McDermott</a> and <a href="https://www.linkedin.com/in/zager">Michael Zager</a>.</p><p class="">Through its easy point-and-click browser interface, Oncoscape will become an essential tool for doctors and researchers interested in:</p><ul class=""><li>Comparing patients or populations across an array of features, like genetic alterations (CNV, IHC, sequencing, expression) or clinical elements (treatment regimens, diagnostics, outcomes)</li><li>Defining cohorts based on selected traits  identifying patients like me</li><li>Aligning patient histories according to timeline events: diagnosis, treatment, progression, survival</li><li>Performing powerful and integrated statistical analysis: Principle Component Analysis, Partial least squares regression, Kaplan-Meier curves, enrichment scores</li><li>Creating high quality visualizations of molecular/clinical data</li></ul><p class="">By providing a portal equipped with rich data, powerful statistics and a simple interface, Oncoscape not only empowers users to quickly answer questions themselves but also expedites the process of discovering novel patterns and relationships. This can lead to numerous possible findings, including optimized drug therapies for individual patients, identification of novel regulatory pathways, or even the need to reassess adherence strategies.</p></div><div class="col-sm-4"><os-login></os-login></div></div></div>'),e.put("app/components/loader/loader.html",'<div class="loader-modal"><div class="loader"><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__ball"></div></div></div>'),e.put("app/components/login/login.html",'<form class="login"><h3 class="login-header">Login</h3><div class="login-body"><div class="alert alert-danger" role="alert" ng-show="vm.hasError"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> <span class="sr-only">Error:</span> Invalid Credentials</div><fieldset class="form-group"><span for="domain" class="small">Affiliation</span><select id="domain" class="form-control" ng-options="option.name for option in vm.domains track by option.name" ng-model="vm.user.domain"></select></fieldset><fieldset class="form-group" ng-show="vm.user.domain.name!=\'Guest\'"><span class="form-control-label small" for="username">Username</span> <input id="username" class="form-control input-sm" type="text" placeholder="Username" ng-model="vm.user.name"></fieldset><fieldset class="form-group" ng-show="vm.user.domain.name!=\'Guest\'"><span class="form-control-label small" for="password">Password</span> <input id="password" class="form-control" type="password" placeholder="Password" ng-model="vm.user.password"></fieldset><button class="btn btn-default" ng-click="vm.login()">Login</button></div></form>'),e.put("app/components/markers/markers.html",'<os-tool-menu datasource="{{vm.datasource}}"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize()"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Options</h2></div><div class="col-xs-12 form-item"><label>Interactive Mode</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.optInteractiveMode.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optInteractiveModes" ng-click="vm.optInteractiveMode=item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item" ng-if="vm.optInteractiveMode.name==\'Commands\'"><label>Patients</label><br><div class="btn-group btn-group-md" role="group"><button type="button" class="btn btn-default btn-no-focus" title="Select Connected Genes" ng-click="vm.optCommands.selectConnectedGenes()"><span class="fa fa-code-fork" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Invert Patient Selection" ng-click="vm.optCommands.invertPatientSelection()"><span class="fa fa-random" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Select All Patients" ng-click="vm.optCommands.selectPatients()"><span class="fa fa-dot-circle-o" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Deselect Patients" ng-click="vm.optCommands.deselectPatients()"><span class="fa fa-circle-o" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Show Selected Patient Edges" ng-click="vm.optCommands.showPatientEdges()"><span class="fa fa-link" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Hide Edges" ng-click="vm.optCommands.hidePatientEdges()"><span class="fa fa-unlink" aria-hidden="true"></span></button><div class="btn-group" role="group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="More Options"><span class="caret"></span></button><ul class="dropdown-menu pull-right"><li ng-click="vm.optCommand.showGenesInCommon()">Select Genes In Common</li></ul></div></div></div><div class="col-xs-12 form-item" ng-if="vm.optInteractiveMode.name==\'Commands\'"><label>Genes</label><br><div class="btn-group btn-group-md" role="group"><button type="button" class="btn btn-default btn-no-focus" title="Select Connected Patients" ng-click="vm.optCommands.selectConnectedPatients()"><span class="fa fa-code-fork" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Invert Gene Selection" ng-click="vm.optCommands.invertGeneSelection()"><span class="fa fa-random" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Select All Genes" ng-click="vm.optCommands.selectGenes()"><span class="fa fa-dot-circle-o" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Deselect Genes" ng-click="vm.optCommands.deselectGenes()"><span class="fa fa-circle-o" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Show Selected Gene Edges" ng-click="vm.optCommands.showGeneEdges()"><span class="fa fa-link" aria-hidden="true"></span></button> <button type="button" class="btn btn-default btn-no-focus" title="Hide Selected Gene Edges" ng-click="vm.optCommands.hideGeneEdges()"><span class="fa fa-unlink" aria-hidden="true"></span></button><div class="btn-group" role="group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="More Options"><span class="caret"></span></button><ul class="dropdown-menu pull-right"><li ng-click="vm.optCommand.showPatientsInCommon()">Select Patients In Common</li></ul></div></div></div><div class="col-xs-6 form-item" style="padding-right:5px"><label>Global</label><div class="btn-group" role="group" style="display: block"><button class="btn btn-default btn-no-focus" type="button" ng-click="vm.optCommands.invertAll()" style="width:33.333%" title="Invert Selections"><span class="fa fa-random" aria-hidden="true"></span></button> <button class="btn btn-default btn-no-focus" type="button" ng-click="vm.optCommands.deselectAll()" style="width:33.333%" title="Deselect All"><span class="fa fa-circle-o" aria-hidden="true"></span></button> <button class="btn btn-default btn-no-focus" type="button" ng-click="vm.optCommands.hideAllEdges()" style="width:33.333%" title="Hide All Edges"><span class="fa fa-unlink" aria-hidden="true"></span></button></div></div><div class="col-xs-6 form-item" style="padding-left:5px"><label>Zoom</label><div class="btn-group" role="group" style="display: block"><button class="btn btn-default btn-no-focus" type="button" ng-click="vm.optCommands.zoomReset()" style="width:50%; font-weight: 300;" title="Zoom Reset">Reset</button> <button class="btn btn-default btn-no-focus" type="button" ng-click="vm.optCommands.zoomFit()" style="width:50%; font-weight: 300;" title="Zoom Selection">Fit</button></div></div><div class="col-xs-6 form-item" style="padding-right:5px"><label>Patient Layout</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.optPatientLayout.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optPatientLayouts" ng-click="vm.optPatientLayout=item">{{item.name}}</li></ul></div></div><div class="col-xs-6 form-item" style="padding-left:5px"><label>Patient Color</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.optNodeColor.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optNodeColors" ng-click="vm.optNodeColor=item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Patient Options</label><div ng-repeat="item in vm.legandNodes" class="legend-bar btn btn-default filter-button" style="border-color:{{item.color}};position:relative">{{item.name}} ({{item.cnt}} Selected)<div class="markers-button-slider"><div class="markers-button-slider-circle" ng-click="vm.updateNode(item, true); $event.stopPropagation();" style="background-color:{{item.color}};border-color:red;"></div><div class="markers-button-slider-circle" ng-click="vm.updateNode(item, false); $event.stopPropagation();" style="background-color:{{item.color}};"></div></div></div></div><div class="col-xs-12 form-item"><label>Edge Options</label><div ng-repeat="item in vm.optEdgeColors" class="legend-bar btn btn-default filter-button {{item.class}}" style="position:relative">{{item.name}}<div class="markers-button-slider"><div class="markers-button-slider-rect" ng-click="vm.updateEdge(item, \'Highlight\'); $event.stopPropagation();" style="background-color:{{item.color}};"></div><div class="markers-button-slider-rect" ng-click="vm.updateEdge(item, \'Show\'); $event.stopPropagation();" style="background-color:#3993fa"></div><div class="markers-button-slider-rect" ng-click="vm.updateEdge(item, \'Hide\'); $event.stopPropagation();" style="background-color:#FFF"></div></div></div></div><div class="col-xs-12 form-item"><label>Patient Search {{vm.searchPatientResult}}</label> <input type="text" class="form-control" ng-model="vm.searchPatient" placeholder="Patient Id"></div><div class="col-xs-12 form-item"><label>Gene Search {{vm.searchGeneResult}}</label> <input type="text" class="form-control" ng-model="vm.searchGene" placeholder="Gene Name"></div></div></section></os-tray><section class="tray-content-block"><div id="markers-chart" class="markers-chart"></div><div style="position:absolute;top:10px;left:50px;"><h2 class="h2-tool">Patients + Markers</h2><h3 class="h3-datasource">{{vm.datasource}}</h3></div></section><ul id="gene-ctx-menu" class="dropdown-menu markers-ctx-menu" role="menu" ng-show="vm.optCtxGeneShow"><li class="title"></li><li ng-repeat="item in vm.optCommandGene" ng-click="item.cmd()">{{item.name}}</li></ul><ul id="patient-ctx-menu" class="dropdown-menu markers-ctx-menu" role="menu" ng-show="vm.optCtxPatientShow"><li class="title"></li><li ng-repeat="item in vm.optCommandPatient" ng-click="item.cmd()">{{item.name}}</li></ul><section ng-show="vm.gene" class="container-fluid" style="position:absolute;bottom:0px;margin-right: 300px;z-index: 999;pointer-events: none;"><div class="row"><div class="col-xs-12 legend" style="background-color: rgba(255,255,255,.8)"><ul style="float:left;"><li class="legend-section">{{vm.gene.name}}</li><li>CnGain.1: {{vm.gene.cng1}}</li><li>CnGain.2: {{vm.gene.cng2}}</li><li>CnLoss.1: {{vm.gene.cnl1}}</li><li>CnLoss.2: {{vm.gene.cnl2}}</li></ul></div></div></section><section ng-show="vm.patient" class="container-fluid" style="position:absolute;bottom:0px;margin-right: 300px;z-index: 999;pointer-events: none;"><div class="row"><div class="col-xs-12 legend" style="background-color: rgba(255,255,255,.8)"><ul style="float:left;"><li class="legend-section">{{vm.patient[0][0]}}</li><li>GENDER: {{vm.patient[0][2]}}</li><li>STATUS: {{vm.patient[0][6]}}</li><li>DIAGNOSED: {{vm.patient[0][4]}} years old</li><li>SURVIVED: {{vm.patient[0][3]}} years</li><li>PROGRESSION: {{vm.patient[0][5]}}</li></ul></div></div></section>'),
e.put("app/components/metadata/metadata.html",'<os-tool-menu datasource="{{vm.datasource}}"></os-tool-menu><os-tray caption="Patients" content="tray-content-block"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Search</h2></div><div class="col-xs-12 form-item"><input type="text" class="ngrs-range-slider ngrs-range-slider-no-pad" style="width:100%" ng-model="vm.search"></div><div class="col-xs-12 form-label"><h2>Information</h2><label>Raw data was provided by <a href="http://cancergenome.nih.gov/">The Cancer Genome Atlas</a>. Processing of data was conducted by the <a href="http://www.sttrcancer.org/en.html">Solid Tumor Translational Research Organization</a> in conjuntion with the <a href="http://www.fhcrc.org">Fred Hutchinson Cancer Research Center</a>, <a href="http://www.uwmedicine.org/">UW Medicine</a> and <a href="http://www.scca.org">The Seattle Cancer Care Alliance</a>.</label></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">{{vm.dataset}} Metadata</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><table id="metadata-datatable" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%"><thead><tr><th ng-repeat="col in vm.colnames">{{col}}</th></tr></thead><tbody><tr ng-repeat="row in vm.rows"><td ng-repeat="datum in row track by $index">{{datum}}</td></tr></tbody></table></div></section>'),e.put("app/components/oncoprint/oncoprint.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortPatient()"></os-tool-menu><os-tray content="tray-content-block"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Cohorts</h2></div><div class="col-xs-12 form-label"><h2>Legend</h2><span class="legend"></span> <span class="oncoprint-label-col1" id="legend"></span></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><div id="oncoprintDiv" class="oncoprint"><div id="oncoprintInstructions" style="font-size:150%">Please select and send up to 350 genes and patients from another tab, such as Markers and Patients, to populate the display.</div><div id="oncoprintErrorSection" style="font-size:150%" ng-show="vm.errorMessage!=\'\'">{{vm.errorMessage}}</div><div id="oncoprintControlsDiv"><div id="onc"></div><button id="toggle_whitespace">Toggle Whitespace</button> <button id="reduce_cell_width">Reduce Cell Width</button></div></div></div></section>'),e.put("app/components/pathways/pathways.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortGene()"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Options</h2></div><div class="col-xs-12 form-item"><label>Search</label> <input type="text" class="form-control" ng-model="vm.search"></div><div class="col-xs-12 form-label"><h2>Legend</h2><span class="legend-bar" style="border-color: green">Activation</span> <span class="legend-bar" style="border-color: red">Inhibition</span> <span class="legend-bar" style="border-color: #38347B">Modification</span> <span class="legend-bar" style="border-color: #056ce1">Genes</span></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Pathways</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div id="gbm-chart" class="pathways-chart"></div></div></section><div class="modal fade pathways" id="gbm-webpage" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">{{vm.tip}}</h4></div><iframe class="modal-iframe" ng-src="{{vm.frame}}"></iframe></div></div></div>'),e.put("app/components/pca/pca.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortPatient()"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Filters</h2></div><div class="col-xs-12 form-item"><label>Gene Set</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.geneSet}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li ng-repeat="item in vm.geneSets" ng-click="vm.geneSet=item">{{item}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Search</label> <input type="text" class="ngrs-range-slider" style="width: 100%;" ng-model="vm.search"></div><div class="col-xs-6 form-label"><h2>Legend</h2><span class="circle" style="background-color:black;width:10px;height: 10px;margin-right:10px;"></span>Patients</div><div class="col-xs-6 form-label"><h2>Variance</h2>PC1: {{vm.pc1}}%<br>PC2: {{vm.pc2}}%</div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Principal Component Analysis</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div id="pca-chart" class="pca"></div></div></section>'),e.put("app/components/plsr/plsr.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortGene()"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Filters</h2></div><div class="col-xs-12 form-item"><label>Gene Set</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.geneSet}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li ng-repeat="item in vm.geneSets" ng-click="vm.geneSet=item">{{item}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Age At Diagnosis</label><div range-slider="" min="vm.deathMinValue" model-min="vm.deathMinFilter" max="vm.deathMaxValue" model-max="vm.deathMaxFilter" prevent-equal-min-max="true" show-values="true" attach-handle-values="true" on-handle-up="vm.update()"></div></div><div class="col-xs-12 form-item"><label>Survival</label><div range-slider="" min="vm.survivalMinValue" model-min="vm.survivalMinFilter" max="vm.survivalMaxValue" model-max="vm.survivalMaxFilter" prevent-equal-min-max="" show-values="true" attach-handle-values="true" on-handle-up="vm.update()"></div></div><div class="col-xs-12 form-label"><h2>Legend</h2><span class="legend-bar" style="border-color: #1396de">Age At Diagnosis</span> <span class="legend-bar" style="border-color: #38347b">Survial</span> <span class="legend"><span class="legend-dot" style="background-color:#000"></span>Genes</span></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Partial Least Squares Regression</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div id="plsr-chart" class="plsr"></div></div></section><div class="modal fade plsr-webpage" id="plsr-webpage" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">{{vm.tip}}</h4></div><iframe class="modal-iframe" ng-src="{{vm.frame}}"></iframe></div></div></div>'),e.put("app/components/pca3d/pca3d.html",'<section id="pca-chart" class="pca container-fluid" style="position: absolute;left:0px;top:0px;right: 0px;bottom: 0px;padding:0px;margin:0px;overflow: hidden;"></section>'),e.put("app/components/subnav/subnav.html",'<div class="subnav"><div class="btn-group" style="float:right"><button type="button" class="btn btn-primary" ng-click="vm.toolsClick()">Analysis Tools</button> <button type="button" class="btn btn-primary" ng-click="vm.cohortClick()">Cohorts</button></div><h2>{{vm.tool}} &mdash; {{vm.filter}}</h2></div>'),e.put("app/components/survival/survival.html",'<os-tool-menu datasource="{{vm.datasource}}"></os-tool-menu><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Patient Survival</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div style="text-align: center;"><img id="survival-img" style="width:100%; height: auto; margin:auto;"></div></div></section>'),e.put("app/components/toolmenu/toolmenu.html",'<div><label class="tray-label tray-label-left">Tools</label><section class="tool-menu tray tray-collapsed-left"><div class="row"><div class="col-xs-12 form-label"><h2>Tools</h2></div></div><div class="row tool-menu-row" ng-repeat="tool in vm.tools"><a href="" ng-click="vm.explore(tool.route)"><img class="tool-menu-img" ng-src="/assets/images/datasets/{{tool.img}}"> <span class="tool-menu-lbl">{{tool.name}}</span> <span class="tool-menu-beta" ng-if="tool.beta" style="color:red">(Beta)</span></a></div></section></div>'),e.put("app/components/timelines/timelines.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortPatient()"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Options</h2></div><div class="col-xs-12 form-item"><label>Align By</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.align.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.events" ng-click="vm.align = item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Order By</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.sort.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.features" ng-click="vm.sort = item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Filter</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.filter.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.filters" ng-click="vm.filter = item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Timescale</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.timescale.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.timescales" ng-click="vm.timescale=item">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Event Colors</label> <span ng-repeat="item in vm.events" class="legend-bar btn btn-default filter-button {{item.color}}" ng-style="{\'border-color\':item.color}" ng-click="vm.updateEventColor(item); $event.stopPropagation();">{{item.name}} ({{item.selected ? \'Visible\' : \'Hidden\'}})</span></div><div class="col-xs-12 form-item"><label>Selected Patients Display</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.optCohortMode.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li ng-repeat="item in vm.optCohortModes" ng-click="vm.optCohortMode=item">{{item.name}}</li></ul></div></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Timelines</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div id="timelines-chart"></div></div><div class="timeline-hover" ng-if="vm.selShow"><dl><dt>Event</dt><dd>{{vm.selEvent}}</dd></dl><dl><dt>Patient Id</dt><dd>{{vm.selPatient}}</dd></dl><dl ng-repeat="item in vm.selFields"><dt>{{item.name}}</dt><dd>{{item.value}}</dd></dl></div></section>'),e.put("app/components/tools/tools.html",'<section class="tools container-fluid"><div class="row"><div class="col-sm-8 col-md-6"><h1>Analysis Tools</h1></div></div><div class="row"><ul><li ng-repeat="tool in vm.tools" class="col-xs-12 col-sm-6 col-md-4 col-lg-3" ng-click="vm.explore(tool.route, vm.datasource)"><img class="tools-img" ng-src="/assets/images/datasets/{{tool.img}}"><div class="tools-copy"><h3 class="tools-lbl">{{tool.name}}</h3><a href="" ng-if="!tool.beta">Explore</a> <a href="" ng-if="tool.beta" style="color:red">(Beta)</a></div></li></ul></div></section>'),e.put("app/components/tray/tray.html",'<div><label class="tray-label tray-label-right">Options</label><div class="tray {{vm.trayClass}} tray-right" locked="true"><ng-transclude></ng-transclude><i class="fa fa-lock tray-sticky-icon {{vm.iconClass}}" ng-click="vm.toggle()"></i></div></div>')}]);
//# sourceMappingURL=../maps/scripts/app-e7d1285a90.js.map
