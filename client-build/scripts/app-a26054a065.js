!function(){"use strict";angular.module("oncoscape",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngMessages","ngAria","ngResource","ui.router","ui.bootstrap","ui.grid","ui.grid.selection","ui.grid.cellNav","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.pinning","ui.grid.grouping","ui.grid.autoResize","toastr"])}(),function(){"use strict";function e(e){function t(t,n){var a=e.select(n[0]).append("svg").attr("class","tray-chart").style("height",t.height+"px"),o=a.append("g").classed("chartLayer",!0),r=a.append("g").classed("chartLayer",!0);t.$watch("data1",function(e){s(o,e,0)}),t.$watch("data2",function(e){s(r,e,t.height-10)});var s=function(n,a,o){var r=e.pie().sort(null).value(function(e){return e.value})(a),s=e.arc().outerRadius(t.height/3+3).innerRadius(t.height/3-13).padAngle(.03).cornerRadius(0);n.attr("transform","translate("+[t.height/2+o,t.height/2]+")");var i=["#039BE5","#EAEAEA"],l=n.selectAll(".arc").data(r).attr("d",s).attr("id",function(e,t){return"arc-"+t}).attr("fill",function(e,t){return i[t]}),c=l.enter().append("g").classed("arc",!0);c.append("path").attr("d",s).attr("id",function(e,t){return"arc-"+t}).attr("fill",function(e,t){return i[t]})}}t.$inject=["scope","element"];var n={restrict:"E",scope:{data1:"=chartData1",data2:"=chartData2",height:"=chartHeight"},link:t,replace:!1};return n}e.$inject=["d3"],angular.module("oncoscape").directive("osTrayPiechart",e)}(),function(){"use strict";function e(){function e(e,t){var n=this;n.trayClass=Math.random().toString(36).substring(3),n.iconClass=Math.random().toString(36).substring(3);var a=!0;n.toggle=function(){var s=angular.element("."+n.trayClass),i=angular.element("."+n.iconClass);a=!a,i.addClass(a?"fa-lock":"fa-unlock-alt").removeClass(a?"fa-unlock-alt":"fa-lock").attr("locked",a?"true":"false"),s.attr("locked",a?"true":"false"),a?(s.unbind("mouseover",o).unbind("mouseout",r).removeClass("tray-collapsed"),t(function(){n.change()})):(s.addClass("tray-collapsed").bind("mouseover",o).bind("mouseout",r),t(function(){n.change()})),e.onResize.dispatch()};var o=function(){angular.element("."+n.trayClass).removeClass("tray-collapsed")},r=function(){angular.element("."+n.trayClass).addClass("tray-collapsed")}}e.$inject=["osApi","$timeout"];var t={restrict:"E",templateUrl:"app/components/tray/tray.html",scope:{caption:"@",content:"@",change:"&"},controller:e,controllerAs:"vm",bindToController:!0,replace:!0,transclude:!0};return t}angular.module("oncoscape").directive("osTray",e)}(),function(){"use strict";function e(e){function t(t,n){var a=e.select(n[0]).append("svg").attr("class","tray-chart").style("height",t.height+"px"),o=e.tip().attr("class","tip").offset([-8,0]).html(function(e){return e.tip});a.call(o),t.$watch("data",function(e){var n=t.height-10,r=250/e.length-1,s=a.selectAll("rect").data(t.data);s.enter().append("rect").on("mouseover",o.show).on("mouseout",o.hide).transition().attr("class","tray-bar").style("width",r+"px").style("x",function(e,t){return(r+1)*t+5+"px"}).style("height",function(e){return e.value*n+"px"}).style("y",function(e){return n-e.value*n+5+"px"}).text(function(e){return e.label}),s.exit().remove(),s.transition().style("width",r+"px").style("x",function(e,t){return(r+1)*t+5+"px"}).style("height",function(e){return e.value*n+"px"}).style("y",function(e){return n-e.value*n+5+"px"})})}t.$inject=["scope","element"];var n={restrict:"E",scope:{data:"=chartData",height:"=chartHeight"},link:t,replace:!1};return n}e.$inject=["d3"],angular.module("oncoscape").directive("osTrayBarchart",e)}(),function(){"use strict";function e(){function e(e,t){var n=this;n.tools=e.getTools(),n.explore=function(n){t.go(n,{datasource:e.getDataSource().disease})},e.setBusy(!1)}e.$inject=["osApi","$state"];var t={restrict:"E",templateUrl:"app/components/tools/tools.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osTools",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,r,s,i,l){function c(){g(),h(),p(),u(),N(),q()}function d(){if(null!==i.event.selection){var t=Math.round(Math.round(i.event.selection[0]-b)/v/20),n=Math.round(Math.round(i.event.selection[1]-b)/v/20);0>t&&(t=0),n>=A.length&&(n=A.length-1),t==n&&(n=t+1);for(var a=[],o=t;n>=o;o++)a.push(A[o].id);e.setCohort(a,"Timelines",e.PATIENT),z.call(i.event.target.move,null)}}function u(){}function p(){var t=e.getLayout(),n=o.innerWidth-t.left-t.right-80;x=i.scaleLinear().domain(C).range([0,n]).nice();var a=R.selectAll("g.patient").data(A);a.exit().transition().delay(200).duration(500).style("opacity",0).remove();var r=a.enter().append("g").attr("class","patient").attr("transform",function(e,t){return"translate(0,"+t*k+")"});m(a.selectAll(".event").data(function(e){return e.events.filter(function(e){return e.visible})})),m(r.selectAll(".event").data(function(e){return e.events.filter(function(e){return e.visible})}))}function m(e){e.exit().on("mouseover",null).on("mouseout",null).remove(),e.enter().append("rect").attr("class","event").attr("width",function(e){return Math.max(x(e.tsEndAligned)-x(e.tsStartAligned),2)}).attr("height",function(e){return"Radiation"==e.name||"Drug"==e.name?(k-2)/2:k-2}).attr("y",function(e){return"Radiation"==e.name?k/2:1}).attr("x",function(e){return x(e.tsStartAligned)}).style("fill",function(e){return e.color}).on("mouseover",I.show).on("mouseout",I.hide),e.attr("width",function(e){return Math.max(x(e.tsEndAligned)-x(e.tsStartAligned),2)}).attr("height",function(e){return"Radiation"==e.name||"Drug"==e.name?k/2:k}).attr("y",function(e){return"Radiation"==e.name?k/2:0}).attr("x",function(e){return x(e.tsStartAligned)}).style("fill",function(e){return e.color})}function h(){var t=e.getLayout(),n=o.innerWidth-t.left-t.right-80,a=o.innerHeight-200;F.css("background","#FAFAFA").css("margin-left",t.left+30).css("margin-right",t.right).css("width",n+20).css("height",a+20),B.attr("height",a),O.attr("width",n),$.attr("height",a).attr("width",n).attr("fill","blue").attr("transform","translate(0,0)"),R.attr("height",a).attr("width",n),G.attr("height",a).attr("width",n),L.style("top",a+20).attr("width",n),z.attr("width",n).attr("height",a),E=a/(A.length*k),S=1,f=S,v=E,y=0,b=0,E==1/0&&(E=10),R.attr("transform","translate("+y+","+b+") scale("+f+","+v+")"),G.attr("transform","translate("+y+","+b+") scale("+f+","+v+")")}function g(){P.cohort=e.getCohort();var t=P.align.name,n=P.sort.name,a=P.filter.name,o=P.events.filter(function(e){return e.selected}).map(function(e){return e.name.toLowerCase()});C=[1/0,-(1/0)],w.forEach(function(e){if(0===P.cohort.patientIds.length?e.visible=!0:e.visible=-1!==P.cohort.patientIds.indexOf(e.id),!e.hash.hasOwnProperty(this.align)||!e.hash.hasOwnProperty(this.sort)||!e.hash.hasOwnProperty("Status"))return void(e.visible=!1);var t=e.hash.Status.data.status;return"Only Alive"==this.filter&&"Dead"==t||"Only Dead"==this.filter&&"Dead"!=t?void(e.visible=!1):(this.offset=0-e.hash[this.align].tsStart,void e.events.forEach(function(e){e.visible=-1!=this.events.indexOf(e.name.toLowerCase()),e.visible&&(e.tsStartAligned=P.timescale.valFn(e.tsStart+this.offset),e.tsEndAligned=P.timescale.valFn(e.tsEnd+this.offset),this.domain[0]=Math.min(this.domain[0],e.tsStartAligned),this.domain[1]=Math.max(this.domain[1],e.tsEndAligned))},this))},{align:t,sort:n,filter:a,events:o,domain:C,offset:0}),A=w.filter(function(e){return e.visible}).sort(function(e,t){if(e.status==t.status){var a=e.events.filter(function(e){return e.name==n&&1==e.order})[0].tsStartAligned,o=t.events.filter(function(e){return e.name==n&&1==e.order})[0].tsStartAligned;return a>o?1:o>a?-1:0}return"dead"==e.status?1:-1})}e.setBusy(!0);var f,v,y,b,x,w=[],A=[],C=[],k=20,S=1,E=1,P=this;P.datasource=e.getDataSource(),P.cohort=e.getCohort(),P.timescales=[{name:"Log",valFn:function(e){return(0>e?-1:1)*Math.log(Math.abs(1e3*e/864e5)+1)/Math.log(2)}},{name:"Linear",valFn:function(e){return s.duration(1e3*e).asDays()}}],P.filters=[{name:"Alive + Dead"},{name:"Only Alive"},{name:"Only Dead"}],P.modes=[{name:"Highlight"},{name:"Filter"}],P.displayModes=[{name:"All Patients"},{name:"Selected Patients"}],P.timescale=P.timescales[0],P.filter=P.filters[0],P.mode=P.modes[0],P.displayMode=P.displayModes[0],P.events=null,P.align=null,P.sort=null,P.resetZoom=function(){e.setCohort([],e.ALL,e.PATIENT),B.call(M.move,null),O.call(D.move,null)};var M=i.brushY().handleSize(3),D=i.brushX().handleSize(3),T=i.brushY().handleSize(1),F=i.select(".timelines-content"),L=F.append("svg").attr("class","timeline-axis"),B=F.append("svg").attr("class","timeline-scroll-y"),O=F.append("svg").attr("class","timeline-scroll-x"),$=F.append("svg").attr("class","timeline-chart"),G=$.append("g"),z=$.append("g"),R=$.append("g"),I=i.tip().attr("class","tip").offset([-8,0]).html(function(e){return e.tip});$.call(I),F=angular.element(".timelines-content");var N=function(){var t=e.getLayout(),n=o.innerWidth-t.left-t.right-80,a=o.innerHeight-200;B.call(M.on("end",function(){if(null!==i.event.selection){var e=i.event.selection[0],t=i.event.selection[1],n=a,o=e/n,r=t/n,s=r-o;v=E/s,b=k*A.length*v*-o}else{if(v==E&&0===b)return;v=E,b=0,B.call(M.move,null)}R.transition().duration(750).attr("transform","translate("+y+","+b+") scale("+f+","+v+")"),G.transition().duration(750).attr("transform","translate("+y+","+b+") scale("+f+","+v+")")})),O.call(D.on("end",function(){if(null!==i.event.selection){var e=i.event.selection[0],t=i.event.selection[1],a=n-20,o=e/a,r=t/a,s=r-o;f=S/s,y=n*f*-o}else{if(f==S&&0===y)return;f=S,y=0,O.call(D.move,null)}R.transition().duration(750).attr("transform","translate("+y+","+b+") scale("+f+","+v+")"),q()}))},U=function(e){return 0===Math.abs(e)?e:Math.abs(e)<30?e+" Days":Math.abs(e)<360?Math.round(e/30.4*10)/10+" Months":Math.round(e/365*10)/10+" Years"},q=function(){var e=i.zoomIdentity.translate(y).scale(f),t=e.rescaleX(x),n=i.axisBottom(t).ticks(5);"Linear"==P.timescale.name?n.tickFormat(function(e){return U(e)}):n.tickFormat(function(e){return U(Math.round((0>e?-1:1)*(Math.pow(2,Math.abs(e))-1)*100)/100)}),L.transition().duration(900).call(n)};e.query(e.getDataSource().clinical.events,{}).then(function(t){var n=function(e){return"Birth"==e?"#E91E63":"Diagnosis"==e?"#673AB7":"Pathology"==e?"#2196F3":"Progression"==e?"#00BCD4":"Absent"==e?"#CDDC39":"Status"==e?"#FFC107":"Radiation"==e?"#FF5722":"Procedure"==e?"#795548":"Encounter"==e?"#607D8B":"Drug"==e?"#03A9F4":"black"},a=t.data[0],o={};a=Object.keys(a).map(function(e){var t=this.data[e].filter(function(e){return null!==e.start&&"undefined"!=typeof e.start}).map(function(e){return this.events[e.name]=null,e.hasOwnProperty("data")?e.tip=Object.keys(e.data).reduce(function(t,n){try{null!==e.data[n]&&(t+="<br>"+n.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/\w\S*/g,function(e){return e})+": "+e.data[n].toString().replace(/\w\S*/g,function(e){return e}))}catch(a){return""}return t},e.name):e.hasOwnProperty("name")?e.tip=e.name:e.tip="Unknown",e.tsStart=s(e.start,"MM/DD/YYYY").unix(),e.tsEnd=null===e.end||"undefined"==typeof e.end?e.tsStart:s(e.end,"MM/DD/YYYY").unix(),e.tsStartAligned="",e.tsEndAligned="",e.end=null===e.end||"undefined"==typeof e.end?e.start:e.end,e.color=this.colorFn(e.name),e.visible=!0,e.order=1,e},{events:this.events,colorFn:this.colorFn}),n=t.reduce(function(e,t){return e.hasOwnProperty(t.name)?e[t.name].tsStart>t.tsStart&&(e[t.name]=t):e[t.name]=t,e},{});return{id:e,events:t,hash:n}},{data:a,events:o,colorFn:n}),a.forEach(function(e){var t=l.groupBy(e.events,"name"),n=Object.keys(t).filter(function(e){return this[e].length>1},t);n.forEach(function(t){var n=1;e.events.filter(function(e){return e.name==t}).sort(function(e,t){return e.tsStart-t.tsStart}).forEach(function(e){e.order=n,n++})})}),w=a.filter(function(e){try{return e.status=e.hash.Status.data.status.toLowerCase(),!0}catch(t){return!1}}),P.events=Object.keys(o).map(function(e){return{name:e,selected:-1==["Birth","Pathology","Absent","Procedure"].indexOf(e),color:this(e)}},n),P.align=P.events.filter(function(e){return"Diagnosis"==e.name?!0:void 0})[0],P.sort=P.events.filter(function(e){return"Status"==e.name?!0:void 0})[0],g(),h(),p(),u(),N(),q(),z.call(T),T.on("end",d),e.onCohortChange.add(c),e.setBusy(!1)}),P.update=function(){B.call(M.move,null),O.call(D.move,null),g(),h(),q(),p(),N(),u()},e.onResize.add(P.update),n.$on("$destroy",function(){e.onCohortChange.remove(c),D.on("end",null),M.on("end",null),T.on("end",null),e.onResize.remove(P.update)})}e.$inject=["osApi","$state","$scope","$stateParams","$window","$document","moment","d3","_"];var t={restrict:"E",templateUrl:"app/components/timelines/timelines.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osTimelines",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,r,s,i){t.setBusy(!0);var l=this;l.datasource=t.getDataSource(),l.cohort=t.getCohort(),l.cohorts=-1==t.getCohorts().indexOf(l.cohort)?t.getCohorts().concat([l.cohort]):t.getCohorts(),l.pValues=[],l.setCohort=function(e){t.setCohort(e)};var c=function(e){return Math.round(100*e)+"%"},d=function(e){return 0===Math.abs(e)?e:Math.abs(e)<30?e+" Days":Math.abs(e)<360?Math.round(e/30.4*10)/10+" Months":Math.round(e/365*10)/10+" Years"},u=angular.element("#survival-chart"),p=e.select("#survival-chart").append("svg").attr("width","100%").attr("height","100%"),m=p.append("g"),h=p.append("g").attr("class","axis"),g=p.append("g").attr("class","axis").attr("transform","translate(50, 10)"),f=(e.brush(),{width:0,height:0,xScale:e.scaleLinear(),yScale:e.scaleLinear(),xDomain:[0,1],yDomain:[0,1],xAxis:e.axisBottom().ticks(5).tickFormat(d),yAxis:e.axisLeft().ticks(5).tickFormat(c)}),v=e.line().curve(e.curveStepAfter).x(function(e){return Math.round(f.xScale(e.t))}).y(function(e){return f.yScale(e.s)}),y=function(){},b=function(){},x=function(e){var n=m.append("g").attr("class","curve").attr("transform","translate(0, 10)"),a=e.survival.compute.filter(function(e){return e.c.length>0});a.forEach(function(t){var a=Math.round(f.xScale(t.t)),o=Math.round(f.yScale(t.s));n.append("line").attr("class","survival-tick").style("stroke",e.color).attr("x1",a).attr("x2",a).attr("y1",o-3).attr("y2",o+3)}),n.append("path").datum(e.survival.compute).attr("tip",e.name+" Vs. All Patients + Samples<br> p : "+e.survival.logrank.pValue).attr("class","survival-line").style("stroke",e.color).attr("d",v).on("mouseover",y).on("mouseout",b).on("click",function(){t.setCohort(e)})},w=function(){f.xDomain=l.cohorts.filter(function(e){return e.show}).reduce(function(e,t){return e[0]=Math.min(e[0],t.survival.compute[0].t),e[1]=Math.max(e[1],t.survival.compute[t.survival.compute.length-1].t),e},[1/0,-(1/0)]),A()},A=function(){var n=t.getLayout();f.width=s.innerWidth-n.left-n.right-(0===n.left?20:0)-(0===n.right?20:0),f.height=s.innerHeight-125,u.css({width:f.width,height:f.height,"margin-left":0===n.left?20:n.left}),f.xScale.domain(f.xDomain).range([40,f.width-40]),f.yScale.domain(f.yDomain).range([f.height-40,10]),f.xAxis.scale(f.xScale),f.yAxis.scale(f.yScale),h.attr("transform","translate(0, "+(f.height-30)+")").call(f.xAxis),g.attr("transform","translate(40, 10)").call(f.yAxis),m.selectAll(".curve").remove(),l.cohorts.filter(function(e){return e.show}).map(x),-1==l.cohorts.indexOf(l.cohort)&&x(l.cohort);var a=e.rgb(l.cohort.color).toString();m.selectAll(".curve").each(function(){var t=e.select(this),n=e.select(this).select(".survival-line").style("stroke")==a;t.classed("survival-line-selected",n)});var o=l.cohorts.filter(function(e){return e!=l.cohort}).map(function(e){return{c:[l.cohort.color,e.color],n:e.name,p:t.km.logranktest([l.cohort.survival.data,e.survival.data]).pValue}}),r=l.cohorts.filter(function(e){return e.show});1!==r.length&&(-1==l.cohorts.indexOf(l.cohort)&&r.unshift(l.cohort),r.sort(function(e){return l.cohort.color==e.color?-1:"#E91E63"==e.color?-1:0})),o.unshift({c:r.map(function(e){return e.color}),n:"Visible Cohorts",p:t.km.logranktest(r.map(function(e){return e.survival.data})).pValue}),l.pValues=o},C=function(){l.cohorts=t.getCohorts(),l.cohort=t.getCohort(),l.cohort.show=!0,l.cohortsLegend=l.cohorts.filter(function(e){return e!=l.cohort}),A()},k=function(){C()};l.toggle=function(e){if(0===l.cohorts.reduce(function(e,t){return e+=t.show?1:0},0))return alert("You must have at least one cohort visible"),void(e.show=!0);w();var n=t.km.logranktest(l.cohorts.filter(function(e){return e.show}).map(function(e){return e.survival.data}));l.pSelected="P: "+n.pValue+" DOF: "+n.dof},t.onResize.add(A),t.onCohortChange.add(k),t.onCohortsChange.add(C),w(),k(t.getCohort()),t.setBusy(!1),o.$on("$destroy",function(){t.onResize.remove(A),t.onCohortChange.remove(k)})}e.$inject=["d3","osApi","$state","$timeout","$scope","$stateParams","$window","_"];var t={restrict:"E",templateUrl:"app/components/survival/survival.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osSurvival",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,r,s,i){var l,c=this;c.patients=[],c.patient=null,c.datasource=t.getDataSource(),c.charts=[];var d=function(e){var t=["#F44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#0277BD","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548","#C51162","#B388FF"],n=e.reduce(function(e,t){return n=t.groups.reduce(function(e,t){return i.union(e,t.tags)},[]),i.union(e,n)},[]);t.length=n.length;var a=i.object(n,t);return a.Tumor="#FEFEFE",a.Normal="#EAEAEA",a};t.setBusy(!0),t.query("biomarker_immune_tree").then(function(e){t.setBusy(!1),l=d(e.data[0].barcharts),e.data.forEach(function(e){e.barcharts.forEach(function(e){e.groups.forEach(function(e){e.show=!0,e.tags=e.tags.map(function(e){return{name:e,color:l[e]}})})})}),c.patients=e.data,c.patient=c.patients[0],c.draw()}),c.draw=function(){u.draw(c,l),p.draw(c,l)};var u=function(){var n,a,o,r,i,l,c,d,u,p,m=e.scaleOrdinal(e.schemeCategory20),h=e.select("#sunburst-chart").append("div").attr("class","tooltip").style("opacity",0),g=e.select(window),f=function(e){l=e,c=l.append("text").text("Tumor"),d=l.append("text").text("Normal"),u=l.append("g"),p=l.append("g")},v=function(){h.style("top",e.event.layerY+10+"px").style("left",e.event.layerX+10+"px")},y=function(t){h.html(t.data.name).style("opacity",1).style("top",e.event.layerY+10+"px").style("left",e.event.layerX+10+"px"),g.on("mousemove",v).on("mouseup",null)},b=function(e){h.html(e.data.Name).style("opacity",0)},x=function(t){for(var s=t;s.parent;)s=s.parent;var i="Normal"==s.data.name?u:p;i.transition().duration(750).tween("scale",function(){var n=e.interpolate(o.domain(),[t.x0,t.x1]),s=e.interpolate(r.domain(),[t.y0,1]),i=e.interpolate(r.range(),[t.y0?20:0,a]);return function(e){o.domain(n(e)),r.domain(s(e)).range(i(e))}}).selectAll("path").attrTween("d",function(e){return function(){return n(e)}})},w=function(t,a){var o=e.partition(),r=e.hierarchy(t);r.sum(function(e){return e.size});var s=o(r).descendants(),i=a.selectAll("path").data(s).enter().append("g");i.append("path").attr("d",n).style("fill",function(e){return m((e.children?e:e.parent).data.name)}).style("stroke","#FFF").style("stroke-width","2").on("click",x).on("mouseover",y).on("mouseout",b)},A=function(m){i=m.patient;var h=t.getLayout(),g=s.innerHeight-180,f=s.innerWidth-h.left-h.right;a=Math.min(.5*f,g-200)/2-10,o=e.scaleLinear().range([0,2*Math.PI]),r=e.scaleSqrt().range([0,a]),n=e.arc().startAngle(function(e){return Math.max(0,Math.min(2*Math.PI,o(e.x0)))}).endAngle(function(e){return Math.max(0,Math.min(2*Math.PI,o(e.x1)))}).innerRadius(function(e){return Math.max(0,r(e.y0))}).outerRadius(function(e){return Math.max(0,r(e.y1))}),l.attr("width",f).attr("height",g),d.attr("transform","translate("+(a+10)+",20)"),c.attr("transform","translate("+(f-a-10)+",20)"),u.attr("transform","translate("+(a+10)+","+a+")"),p.attr("transform","translate("+(f-a-10)+","+a+")"),w(i.tumor,p,o,r),w(i.normal,u,o,r)};return{init:f,draw:A}}(),p=function(){var n,a,o,r,l,c=function(e,t){n=e,a=n.append("g"),l=t},d=function(e){var n=t.getLayout(),a=s.innerWidth-n.left-n.right-40,o=Math.floor(a/e.length),r=200,i=Math.min(.5*(s.innerWidth-n.left-n.right),s.innerHeight-50-200)-10,l=20;return{layout:n,widthTotal:a,widthChart:o,heightChart:r,yChart:i,xChart:l,numCharts:e.length}},u=function(e,t){function n(){return i.reduce(arguments,function(e,t){return i.flatten(i.map(e,function(e){return i.map(t,function(t){return e.concat([t])})}),!0)},[[]])}return e.map(function(e){var a=n.apply(this,e.groups.filter(function(e){return e.show}).map(function(e){return e.tags.map(function(e){return e.name})})).map(function(e){return{value:0,tags:e}});a.sort(function(e,t){for(var n=e.tags.length-1;n>=0;n--){if(e.tags[n]>t.tags[n])return 1;if(e.tags[n]<t.tags[n])return-1}return 0}),a.forEach(function(t){e.values.forEach(function(e){0==i.difference(t.tags,e.tags).length&&(t.value+=e.data)})});var o=a.reduce(function(e,n){var a=e;return n.tags.reverse().forEach(function(e){var n=a.children.map(function(e){return e.name}).indexOf(e.name);-1==n?(a.children.push({name:e,children:[],value:1,color:t[e]}),a=a.children[a.children.length-1]):(a=a.children[n],a.value+=1)}),n.tags.reverse(),e},{name:e.name,children:[],value:a.length,color:"#DDD"});return{bars:a,tree:o}})},p=function(t){var n=e.select(this);n.append("rect").style("fill","#EEE").attr("width",o.widthChart-5).attr("height",o.heightChart),n.append("text").text(t.tree.name).attr("y",20).attr("x",Math.round((o.widthChart-5)/2)).attr("text-anchor","middle");var a=n.selectAll(".cat-bar").data(t.bars),r=i.max(t.bars,function(e){return e.value}).value,s=i.min(t.bars,function(e){return e.value}).value,l=e.scaleLinear();l.range([0,110]),l.domain([s,r]);var c=o.widthChart/t.bars.length;a.enter().append("rect").attr("x",function(e,t){return c*t}).attr("y",function(e){return 140-l(e.value)}).attr("width",c).attr("height",function(e){return l(e.value)}).attr("fill",function(e){return"Normal"==e.tags[0].name?"#1476b6":"#adc7ea"});var d=e.hierarchy(t.tree,function(e){return e.children}),u=60*(1/d.height+1),p=e.partition().size([o.widthChart-5,u]),m=p(d).descendants(),h=n.selectAll(".cat-node").data(m);h.enter().append("rect").attr("class","cat-node").attr("x",function(e){return e.x0}).attr("y",function(e){return 200-u-(e.y0-u)}).attr("width",function(e){return e.x1-e.x0}).attr("height",function(e){return e.y1-e.y0}).attr("fill",function(e){return e.data.color}).style("visibility",function(e){return"chart"==e.data.name?"hidden":"visible"})},m=function(e,t){l.charts=e=l.patient.barcharts,o=d(e),r=u(e,t);var n=a.selectAll(".sunburst-barchart").data(r);n.enter().append("g").attr("class","sun-chart-g").attr("transform",function(e,t){return"translate("+(t*o.widthChart+o.xChart)+","+(s.innerHeight-380)+")"}),a.selectAll(".sun-chart-g").each(p)};return{init:c,draw:m}}(),m=e.select("#sunburst-chart").append("svg");u.init(m),p.init(m,c)}e.$inject=["d3","osApi","$state","$timeout","$scope","$stateParams","$window","_"];var t={restrict:"E",templateUrl:"app/components/sunburst/sunburst.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osSunburst",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,r,s,i,l,c,d,u){e.setBusy(!0);var p="",m=this;m.showPanelColumns=!1,m.closePanelColumns=function(){m.showPanelColumns=!1,m.gridApi.grid.refresh()},m.setSize=function(){var t=angular.element("#spreadsheet-grid")[0],n=e.getLayout(),a=n.left-1,o=n.right-1;-1===a&&(a=19),-1===o&&(o=19),t.style["margin-left"]=a+"px",t.style["margin-right"]=o+"px",t.style.width=c.innerWidth-a-o-2+"px",t.style.height=c.innerHeight-140+"px",m.gridApi.core.handleWindowResize()},m.collections=Object.keys(e.getDataSource().clinical).map(function(e){var t=this.data[e];return{name:e,collection:t}},{data:e.getDataSource().clinical}).filter(function(e){return"events"!=e.name&&"samplemap"!=e.name}),m.collection=m.collections.reduce(function(e,t){return"patient"==t.name&&(e=t),e},m.collections[0]),m.options={treeRowHeaderAlwaysVisible:!1,showTreeExpandNoChildren:!1,enableSelectionBatchEvent:!1,enableGridMenu:!1,enableSelectAll:!0,onRegisterApi:function(e){m.gridApi=e,e.selection.on.rowSelectionChanged(a,s.debounce(v,300))}},m.exportCsv=function(t){var n=m.options.columnDefs.filter(function(e){return e.visible}).map(function(e){return e.field}),a='"'+n.join('","')+'"\n',o="selected"==t?m.gridApi.grid.api.selection.getSelectedRows():m.options.data;o.forEach(function(e){var t=n.map(function(e){return this[e]},e);a+='"'+t.join('","')+'"\n'});var r=e.getDataSource(),s=r.source+"-"+r.name+"-"+p.toLowerCase()+".csv".replace(/\s/g,"_"),i=new Blob([a],{type:"text/csv;charset=windows-1252;"});u(i,s)},m.showColumns=function(){m.options.columnDefs.forEach(function(e){e.visible=!0}),m.gridApi.grid.refresh()},m.hideColumns=function(){m.options.columnDefs.forEach(function(e){e.visible=!1}),m.gridApi.grid.refresh()};var h=function(e,t,n,a){return n.hasOwnProperty("isSelected")||(n.isSelected=!1),a.hasOwnProperty("isSelected")||(a.isSelected=!1),n.isSelected===a.isSelected?0:n.isSelected?-1:1};m.sortSelected=function(){var e=m.gridApi.grid.columns[0];e.sortingAlgorithm=h,m.gridApi.grid.sortColumn(e,"asc",!1),m.gridApi.core.notifyDataChange(d.dataChange.OPTIONS),m.gridApi.core.notifyDataChange(d.dataChange.COLUMN)};var g=[],f=!0,v=function(){return g=m.gridApi.grid.api.selection.getSelectedRows().map(function(e){return e.patient_ID}),f?void(f=!1):void(g.length==m.options.data.length||0==g.length?e.setCohort([],e.ALL,e.PATIENT):e.setCohort(g,"Spreadsheet",e.PATIENT))};m.datasource=e.getDataSource(),e.onResize.add(m.setSize);var y=function(e){p=e.name,f=!0,m.gridApi.grid.api.selection.clearSelectedRows(),g=e.patientIds;var t=m.options.data.filter(function(e){return-1!=g.indexOf(e.patient_ID)});t.forEach(function(e){m.gridApi.grid.api.selection.selectRow(e)})};e.onCohortChange.add(y),a.$watch("vm.collection",function(){e.setBusy(!0),e.query(m.collection.collection).then(function(t){angular.element(".ui-grid-icon-menu").text("Columns");var a=Object.keys(t.data[0]).map(function(e){return{field:e,name:e.replace(/_/gi," "),width:250,visible:!0}});m.options.columnDefs=a,m.options.data=t.data.map(function(e){return e.color="#F0DDC0",e.selected=!1,e}),n(function(){y(e.getCohort())},1),m.setSize(),e.setBusy(!1)})}),a.$on("$destroy",function(){e.onResize.remove(m.setSize),e.onCohortChange.remove(y)})}e.$inject=["osApi","$state","$timeout","$scope","moment","$stateParams","_","$","$q","$window","uiGridConstants","saveAs"];var t={restrict:"E",templateUrl:"app/components/spreadsheet/spreadsheet.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osSpreadsheet",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,r,s,i,l,c,d,u){function p(e){for(var t=[],n=0;n<e.length;n+=3)t[n/3]=new u.Vector3(e[n],e[n+1],e[n+2]);return t}function m(){var e=new u.BufferGeometry;return e.addAttribute("position",new u.BufferAttribute(h,3)),e.addAttribute("color",new u.BufferAttribute(g,3)),e.computeBoundingSphere(),e}t.setBusy(!0);var h,g,f,v,y={difference:"#cbcbcb",eigen:"#cbcbcb",primary:"#FF9800",quaternary:"#f1c40f",quinary:"#2c3e50",secondary:"#673AB7",senary:"#039BE5",shy:"rgba(0, 0, 0, 0.2)",tertiary:"#4CAF50"},b=function(){function e(){requestAnimationFrame(e),g.update(),m.updateMatrixWorld(!0);var t=new u.Vector3(1,0,-9/11).unproject(m),a=new u.Vector3(0,1,-9/11).unproject(m);v.setDirection(t.clone().normalize()),v.setLength(4,1,.5),y.setDirection(a.clone().normalize()),y.setLength(4,1,.5),b.setDirection(n().position.clone().normalize()),b.setLength(4,1,.5),p.render(i,m)}function t(t,n,a){k=t,x=240,w=240,A=s.scaleLinear().domain([-10,10]).range([0,x]),C=s.scaleLinear().domain([10,-10]).range([0,w]),i=new u.Scene,p=new u.WebGLRenderer({alpha:!0,antialias:!0}),p.setPixelRatio(l.devicePixelRatio),t.node().append(p.domElement),s.select(p.domElement).style("cursor","move"),m=new u.OrthographicCamera(A.invert(0),A.invert(x),C.invert(0),C.invert(w),1,100),m.position.z=10,m.zoom=1.5,m.updateProjectionMatrix(),g=new u.OrthographicTrackballControls(m,p.domElement),g.dynamicDampingFactor=.4,g.noZoom=!0,g.noPan=!0,g.noRoll=!0,g.addEventListener("change",d.debounce(S.dispatch,300)),h=new u.ShaderMaterial({uniforms:{color:{type:"c",value:new u.Color(n.senary)},alpha:{type:"f",value:.4},pointSize:{type:"f",value:10},shouldResize:{type:"1i",value:0}},vertexShader:s.select("#vertexshader").node().textContent,fragmentShader:s.select("#fragmentshader").node().textContent,transparent:!0}),f=new u.Points(a,h),i.add(f),v=new u.ArrowHelper(new u.Vector3(1,0,0),new u.Vector3(0,0,0),2.5,new u.Color(n.primary).getHex(),.5,.5),i.add(v),y=new u.ArrowHelper(new u.Vector3(1,0,0),new u.Vector3(0,0,0),2.5,new u.Color(n.secondary).getHex(),.5,.5),i.add(y),b=new u.ArrowHelper(new u.Vector3(1,0,0),new u.Vector3(0,0,0),2.5,new u.Color(n.tertiary).getHex(),.5,.5),i.add(b),m.left=x/-2,m.right=x/2,m.top=w/2,m.bottom=w/-2,m.near=1,m.far=100,p.setSize(x,w),g.handleResize(),e()}function n(){return m}function a(e){}function o(e){i.remove(f),f=new u.Points(e,h),i.add(f)}function r(t,n,a){x=t,w=n,m.left=x/-2,m.right=x/2,m.top=w/2,m.bottom=w/-2,p.setSize(x,w),k.style({left:a+"px"}),A.range([0,x]),C.range([0,w]),e()}var i,p,m,h,g,f,v,y,b,x,w,A,C,k,S=new c.Signal;return{onChange:S,init:t,setSelected:a,getCamera:n,setData:o,resize:r}}(c),x=function(){function e(){requestAnimationFrame(e),y+=25*Math.PI/180*b.getDelta();var t=new u.Matrix4;t.setPosition(new u.Vector3(0,0,25));var n=new u.Matrix4;n.makeRotationFromEuler(new u.Euler(0,y,0,"XYZ"));var a=new u.Matrix4;a.multiplyMatrices(n,t);var s=new u.Matrix4;a=s.multiplyMatrices(s,a),i.matrix=a,i.updateMatrixWorld(!0),r.render(o,i);var l=new u.Vector3(1,0,-9/11).unproject(d),c=new u.Vector3(0,1,-9/11).unproject(d);h.setDirection(l.clone().normalize()),h.setLength(4,1,.5),g.setDirection(c.clone().normalize()),g.setLength(4,1,.5),f.setDirection(i.position.clone().normalize()),f.setLength(4,1,.5),h.setDirection(l.clone().normalize()),h.setLength(4,1,.5),g.setDirection(c.clone().normalize()),g.setLength(4,1,.5),f.setDirection(d.position.clone().normalize()),f.setLength(4,1,.5)}function t(t,n,a,c){d=c.getCamera(),o=new u.Scene,r=new u.WebGLRenderer({alpha:!0,antialias:!0}),r.setPixelRatio(l.devicePixelRatio),r.setSize(260,260),t.node().append(r.domElement),i=new u.PerspectiveCamera(50,1,.1,1e3),i.zoom=1.2,i.setLens(50),i.aspect=1,i.matrixAutoUpdate=!1,p=new u.ShaderMaterial({uniforms:{color:{type:"c",value:new u.Color(n.senary)},alpha:{type:"f",value:.4},pointSize:{type:"f",value:10},shouldResize:{type:"1i",value:1}},vertexShader:s.select("#vertexshader").node().textContent,fragmentShader:s.select("#fragmentshader").node().textContent,transparent:!0}),m=new u.Points(a,p),o.add(m),h=new u.ArrowHelper(new u.Vector3(1,0,0),new u.Vector3(0,0,0),2.5,new u.Color(n.primary).getHex(),.5,.5),o.add(h),g=new u.ArrowHelper(new u.Vector3(1,0,0),new u.Vector3(0,0,0),2.5,new u.Color(n.secondary).getHex(),.5,10),o.add(g),f=new u.ArrowHelper(new u.Vector3(1,0,0),new u.Vector3(0,0,0),2.5,new u.Color(n.tertiary).getHex(),.5,.5),o.add(f);var v={x:-2,y:-2,z:-4},y=new u.GridHelper(20,20,12303291,15395562);y.position.x=v.x,y.position.z=v.y,y.position.y=v.z,o.add(y),e()}function n(e){}function a(e){o.remove(m),m=new u.PointCloud(e,p),o.add(m)}var o,r,i,d,p,m,h,g,f,v=new c.Signal,y=0,b=new u.Clock;return{onChange:v,init:t,setSelected:n,setData:a}}(),w=function(){function e(e){var t=e.clone().project(m),n=(t.x+1)/2,a=(-t.y+1)/2,o=(t.z+1)/2,r=120*n,s=120*a,i=720*o;return[2*r,2*s,2*i]}function t(){g=h.map(e);var t=u.selectAll(".scatter-bottom").data(g);t.exit().remove(),t.enter().append("rect").attr("width",1).attr("height",10).style("fill",y.primary).attr("class","scatter-bottom").attr("y",250).attr("x",function(e){return e[0]}),t.transition(500).duration(500).attr("x",function(e){
return e[0]}),t=u.selectAll(".scatter-left").data(g),t.exit().remove(),t.enter().append("rect").attr("width",10).attr("height",1).style("fill",y.secondary).attr("class","scatter-left").attr("x",0).attr("y",function(e){return e[1]}),t.transition(500).duration(500).attr("y",function(e){return e[1]}),t=u.selectAll(".scatter-right").data(g),t.exit().remove(),t.enter().append("rect").attr("width",10).attr("height",1).style("fill",y.tertiary).attr("class","scatter-right").attr("x",250).attr("y",function(e){return e[2]}),t.transition(500).duration(500).attr("y",function(e){return e[2]})}function n(e,t){s.event.selection&&(v[e]=t)}function a(e,a,o,r){h=o,m=r.getCamera(),r.onChange.add(t),i=e.append("svg"),l=i.append("rect").style("shape-rendering","crispEdges").style("stroke-width",1).style("stroke","#EAEAEA").style("fill","#FFF").attr("x",0).attr("y",0),d=i.append("rect").style("shape-rendering","crispEdges").style("stroke-width",1).style("stroke","#EAEAEA").style("fill","#FFF").attr("x",10).attr("y",0),u=i.append("g"),p=i.append("g");var c=p.append("g"),g=p.append("g"),f=p.append("g"),v=s.brushX().extent([[10,250],[250,260]]).handleSize(3).on("start",function(){n("x",null)}).on("end",function(){n("x",s.event.selection)});c.call(v);var y=s.brushY().extent([[0,10],[10,250]]).handleSize(3).on("start",function(){n("y",null)}).on("end",function(){n("y",s.event.selection)});g.call(y);var b=s.brushY().extent([[250,10],[260,250]]).handleSize(3).on("start",function(){n("z",null)}).on("end",function(){n("z",s.event.selection)});f.call(b),t(h)}function o(e){v={x:null,y:null,z:null},h=e,t()}function r(e,n,a){i.attr("height",n+"px"),i.attr("width",e+"px"),l.attr("width",e).attr("height",n),d.attr("width",e-20).attr("height",n-10),t()}var i,l,d,u,p,m,h,g,f=new c.Signal,v={x:null,y:null,z:null};return{onChange:f,init:a,setData:o,resize:r}}(c),A=this;A.datasource=t.getDataSource(),A.loadings=A.pc1=A.pc2=A.layouts=[],A.layout={};var C=!1;A.setLayout=function(e){A.layout=e,t.query(t.getDataSource().disease+"_cluster",{disease:A.datasource.disease,geneset:A.layout.geneset,input:A.layout.input,source:A.layout.source}).then(function(e){var n=e.data[0];A.pc1=[{name:"PC1",value:n.metadata.variance[0]},{name:"",value:100-n.metadata.variance[0]}],A.pc2=[{name:"PC2",value:n.metadata.variance[1]},{name:"",value:100-n.metadata.variance[1]}];var a=e.data[0].loadings.map(function(e){return e.max=Math.max.apply(null,e.d.map(function(e){return Math.abs(e)})),e}).sort(function(e,t){return t.max-e.max}).slice(0,50),o=s.scaleLinear().domain([a[a.length-1].max,a[0].max]).range([.1,1]);A.loadings=a.map(function(e){return{tip:e.d.reduce(function(e,t){return e.index+=1,e.text+="<br>PC"+e.index+": "+(100*t).toFixed(2),e},{text:e.id,index:0}).text,value:this(e.max)}},o);var r=[-5,5],i=n.scores.reduce(function(e,t){return e[0]=Math.min(e[0],t.d[0],t.d[1],t.d[2]),e[1]=Math.max(e[1],t.d[0],t.d[1],t.d[2]),e},[1/0,-(1/0)]),c=s.scaleLinear().range(r).domain(i);if(h=new Float32Array(3*n.scores.length),g=new Float32Array(3*n.scores.length),n.scores.forEach(function(e,t){var n=3*t;h[n]=c(e.d[0]),h[n+1]=c(e.d[1]),h[n+2]=c(e.d[2]),g[n]=90,g[n+1]=90,g[n+2]=90}),v=p(h),f=m(),C)b.setData(f),w.setData(v),x.setData(f);else{b.init(s.select(angular.element("#scatter-axis-controller")[0]),y,f),w.init(s.select(angular.element("#scatter-select-controller")[0]),y,v,b),x.init(s.select(angular.element("#scatter-chart")[0]),y,f,b);var d=t.getLayout(),u=l.innerWidth-d.left-d.right,k=l.innerHeight-130;b.resize(u,k,d.left),w.resize(u,k,d.left),C=!0}t.setBusy(!1)})},t.query(t.getDataSource().disease+"_cluster",{dataType:"PCA",$fields:["input","geneset","source"]}).then(function(e){A.layouts=e.data.map(function(e){return e.name=e.geneset+" "+e.input+" "+e.source,e}),A.setLayout(A.layouts[2])}),r.$on("$destroy",function(){})}e.$inject=["$q","osApi","$state","$stateParams","$timeout","$scope","d3","moment","$window","signals","_","THREE"];var t={restrict:"E",templateUrl:"app/components/scatter/scatter.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osScatter",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,r,s,i,l,c,d){function u(){var e=x.selectAll(".plsr-node-selected")[0];0!=e.length&&t.addGeneSelection("PLSR","Manual Selection",x.selectAll(".plsr-node-selected")[0].map(function(e){return e.__data__.name.toUpperCase()}))}function p(){0==C.length?x.selectAll(".plsr-node-selected").classed("plsr-node-selected",!1):x.selectAll("circle").classed("plsr-node-selected",function(){return C.indexOf(this.__data__.name)>=0})}if(angular.isUndefined(a.datasource))return void n.go("datasource");var m,h,g,f,v,y,b,x=s.select("#plsr-chart").append("svg").attr("id","chart"),w=s.select("body").append("div").attr("class","tooltip plsr-tooltip"),A=this;A.datasource=a.datasource,A.deathMinFilter=A.deathMinValue=45,A.deathMaxFilter=A.deathMaxValue=66,A.survivalMinFilter=A.survivalMinValue=3,A.survivalMaxFilter=A.survivalMaxValue=7,A.geneSets=[],A.geneSet=null,A.frame,A.tip=null;var C=null==t.getGeneSelection()?[]:t.getGeneSelection().ids;e.setBusy(!0)("Loading Dataset"),e.setDataset(A.datasource).then(function(n){var a=n.payload.rownames.filter(function(e){return e.indexOf("mtx.mrna")>=0});a=a[a.length-1].replace(".RData",""),e.getPLSR(A.datasource,a).then(function(){e.getGeneSetNames().then(function(n){A.geneSets=n.payload,A.geneSet=A.geneSets[0],e.getSummarizedPLSRPatientAttributes().then(function(e){var n=e.payload;A.deathMinValue=Math.floor(n.AgeDx[0]/365.24),A.deathMaxValue=Math.floor(n.AgeDx[4]/365.24),A.survivalMinValue=Math.floor(n.Survival[0]/365.24),A.survivalMaxValue=Math.floor(n.Survival[4]/365.24),r.$watch("vm.geneSet",function(){A.update()}),t.onGeneSelectionChange.add(function(e){C=e.ids,p()})})})})}),A.update=function(){function t(){m=c.innerWidth-400,"false"==angular.element(".tray-right").attr("locked")&&(m+=300),h=c.innerHeight-190,"true"==angular.element(".tray").attr("locked")&&(m-=300),x.attr("width","100%").attr("height",h),g=s.scale.linear().domain([-v,v]).range([0,m]).nice(),f=s.scale.linear().domain([-y,y]).range([h,0]).nice()}function n(e,n,a){v=.9*e,y=.9*e,t(),b=s.svg.brush().x(g).y(f).on("brushend",function(){var e=b.extent();x.selectAll("circle").classed("plsr-node-selected",function(t){return t[0]>e[0][0]&&t[0]<e[1][0]&&t[1]>e[0][1]&&t[1]<e[1][1]}),s.select(this).transition().duration(300).call(b.extent([[0,0],[0,0]])),u()}),x.call(b);var o=x.selectAll("circle").data(a,function(e){return e});o.enter().append("circle").attr({"class":"plsr-node",cx:.5*m,cy:.5*h,r:3}).style("fill-opacity","0").on("mouseover",function(e){w.transition().duration(200).style("opacity",1),w.html(e.name).style("left",s.event.pageX+15+"px").style("top",s.event.pageY-15+"px")}).on("mouseout",function(){w.transition().duration(500).style("opacity",0)}).on("click",function(e){angular.element("#plsr-webpage").modal();var t="https://www.genecards.org/cgi-bin/carddisp.pl?gene="+e.name;r.$apply(function(){A.frame=l.trustAsResourceUrl(t)})}),o.transition().duration(750).delay(function(e,t){return t/300*500}).attr("cx",function(e){return g(e[0])}).attr("cy",function(e){return f(e[1])}).style("fill-opacity",1),o.exit().transition().duration(600).delay(function(e,t){return t/300*500}).attr("cx",.5*m).attr("cy",.5*h).style("fill-opacity","0").remove();var i=x.selectAll("line").data(n);i.enter().append("line").attr({"class":"line","stroke-width":3,x1:g(0),y1:f(0),x2:g(0),y2:f(0)}).style("stroke",function(e){return e.name.indexOf("Age")?"#1396de":"#38347b"}),i.transition().duration(900).attr({x1:g(0),y1:f(0),x2:function(e){return g(e[0])},y2:function(e){return f(e[1])}}),i.exit().remove();var c=x.selectAll("text").data(n);c.enter().append("text").attr({"class":"text",x:.5*m,y:.5*h,"text-anchor":function(e){return e[0]>0?"start":"end"}}).text(function(e){return e.name}).style({fill:"black","text-anchor":"middle"}),c.transition().duration(900).attr({x:function(e){return g(e[0])},y:function(e){return f(e[1])}}),c.exit().remove(),p()}var a=[{name:"Survival",low:365.24*Number(A.survivalMinFilter),high:365.24*Number(A.survivalMaxFilter)},{name:"AgeDx",low:365.24*Number(A.deathMinFilter),high:365.24*Number(A.deathMaxFilter)}];e.getCalculatedPLSR(A.geneSet,a).then(function(t){var a=t.payload,o=a.loadings.map(function(e,t){return e.name=this[t],e},a.loadingNames),r=a.vectors.map(function(e,t){return e.name=this[t],e},a.vectorNames),s=1.2*a.maxValue;n(s,r,o),e.setBusy(!1)}),A.resize=function(){t(),x.selectAll("circle").attr({cx:function(e){return g(e[0])},cy:function(e){return f(e[1])}}),x.selectAll("text").attr({x:function(e){return g(e[0])},y:function(e){return f(e[1])}}),x.selectAll("line").attr({x1:g(0),y1:f(0),x2:function(e){return g(e[0])},y2:function(e){return f(e[1])}})},angular.element(c).bind("resize",d.debounce(A.resize,300))}}e.$inject=["osApi","osHistory","$state","$stateParams","$timeout","$scope","d3","moment","$sce","$window","_"];var t={restrict:"E",templateUrl:"app/components/plsr/plsr.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osPlsr",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,r,s,i,l,c,d){function u(){var e=B.sampleIds;f.selectAll("circle").classed("pca-node-selected",function(){return e.indexOf(this.__data__.id)>=0})}function p(){if(T.legendCaption=D.name,"None"==D.name)T.legendCaption="",k.forEach(function(e){e.color="#0096d5"});else{var e=D.data.reduce(function(e,t){for(var n=0;n<t.values.length;n++)e[t.values[n]]=t.color;return e},{});k=k.map(function(e){if(e.color=angular.isDefined(this[e.id])?this[e.id]:"#DDDDDD",angular.isUndefined(this[e.id])){var t=D.data.filter(function(e){return"Null"==e.name});t.length>0?t[0].values.push(e.id):D.data.push({name:"Null",color:"#DDDDDD",values:[e.id],id:"legend-DDDDDD"})}return e},e)}var t=d.uniq(k.map(function(e){return e.color}));T.legendNodes=D.data.filter(function(e){return d.contains(t,e.color)}),r(F)}function m(){p();var e=t.getLayout();E=c.innerWidth-e.left-e.right,P=c.innerHeight-120,angular.element("#pca-chart").css({width:E+"px","padding-left":e.left+"px"}),g.attr("width",E).attr("height",P),b.attr("width",E).attr("height",P),f.attr("width",E).attr("height",P),x=i.scaleLinear().domain([S.xMin,S.xMax]).range([50,E-50]).nice(),w=i.scaleLinear().domain([S.yMin,S.yMax]).range([50,P-50]).nice();var n=f.selectAll("circle").data(k);n.enter().append("svg:circle").attr("class","pca-node").attr("cx",function(e){return x(e[0])}).attr("cy",function(e){return w(e[1])}).attr("r",3).style("fill",function(e){return e.color}),n.exit().transition().duration(200).delay(function(e,t){return t/300*100}).style("fill-opacity","0").remove(),n.style("fill",function(e){return e.color}).transition().duration(750).delay(function(e,t){return t/300*100}).attr("r",3).attr("cx",function(e){return x(e[0])}).attr("cy",function(e){return w(e[1])}).style("fill",function(e){return e.color}).style("fill-opacity",.8),A=i.axisTop().scale(x).ticks(3),C=i.axisLeft().scale(w).ticks(3),v.attr("class","axis").attr("transform","translate(0, "+.5*P+")").call(A),y.attr("class","axis").attr("transform","translate("+.5*E+", 0)").call(C),h=i.brush().on("end",function(){if(!i.event.selection)return void t.setCohort([],t.ALL,t.SAMPLE);var e=i.event.selection,n=e[0][0],a=e[1][0],o=e[0][1],r=e[1][1],s=f.selectAll("circle").data().filter(function(e){var t=x(e[0]),s=w(e[1]);return t>n&&a>t&&s>o&&r>s}).map(function(e){return e.id});t.setCohort(s,"PCA",t.SAMPLE)}),b.attr("class","brush").call(h),O(t.getCohort()),t.setBusy(!1)}t.setBusy(!0);var h,g=i.select("#pca-chart").append("svg"),f=g.append("g"),v=g.append("g"),y=g.append("g"),b=g.append("g");v.append("text").attr("x",50).attr("y",15).text("PC1"),y.append("text").attr("y",55).attr("x",25).text("PC2");var x,w,A,C,k,S,E,P,M=t.getDataSource().disease+"_cluster",D={data:[],dataset:t.getDataSource().disease,name:"None",type:"color"},T=function(e,t){return e.loadings=[],e.pcs=[],e.pc1=e.pc2=[],e.datasource=t.getDataSource(),e.description={geneset:"G",source:"S",data:"D"},e.geneSets=[],e.geneSet=null,e.search="",e.selectColor=function(e){var n=e.values,a=[];i.selectAll("circle").each(function(e){-1!=n.indexOf(e.id)?(i.select(this).classed("pca-node-selected",!0),a.push(e.id)):i.select(this).classed("pca-node-selected")&&a.push(e.id)}),t.setCohort(a,"PCA",t.SAMPLE)},e.deselectColor=function(e){var n=e.values,a=[];i.selectAll("circle").each(function(e){-1!=n.indexOf(e.id)?i.select(this).classed("pca-node-selected",!1):i.select(this).classed("pca-node-selected")&&a.push(e.id)}),t.setCohort(a,"PCA",t.SAMPLE)},e}(this,t);s.$watch("vm.geneSet",function(){if(null!==T.geneSet){var e=T.geneSet.sources;if(T.sources=e.map(function(e){var n=t.getSourceInfo(e.name),a=n.d;return{name:e.name,tip:a,types:e.types}}),angular.isUndefined(T.source))T.source=T.sources[0];else{var n=T.sources.filter(function(e){return e.name===T.source.name});T.source=1===n.length?n[0]:T.sources[0]}}}),s.$watch("vm.source",function(){if(null!==T.geneSet)if(T.pcaTypes=T.source.types,angular.isUndefined(T.pcaType))T.pcaType=T.pcaTypes[0];else{var e=T.pcaTypes.filter(function(e){return e.name===T.pcaType.name});T.pcaType=1===e.length?e[0]:T.pcaTypes[0]}}),s.$watch("vm.pcaType",function(e){angular.isUndefined(e)||t.query(M,{disease:T.datasource.disease,geneset:T.geneSet.name,input:T.pcaType.name,source:T.source.name}).then(function(e){var t,a=e.data[0],o=a.metadata.variance;t=null==o[0]?[{x:"PC1",y:1,tip:"NA"},{x:"PC2",y:1,tip:"NA"},{x:"PC3",y:1,tip:"NA"}]:[{x:"PC1",y:o[0],tip:o[0]+"%"},{x:"PC2",y:o[1],tip:o[1]+"%"},{x:"PC3",y:o[2],tip:o[2]+"%"}],t.map(function(e){return e.y<10&&(e.color="grey"),e});var r={title:"Percent Variance Explained",container:"percVar",html:"#percVar",f:"Bar Plot",data:t,labels:{x:"",y:""},color:"#0096d5",margin:{top:10,right:10,bottom:35,left:30},width:200,height:100,domain:{x:[0,3],y:[0,Math.max(o[0],50)]}};n.makeBarPlot(r);for(var s=a.loadings.map(function(e){return e.max=Math.max.apply(null,e.d.map(function(e){return Math.abs(e)})),e}).slice(0,200),l=i.scaleLinear().domain([s[s.length-1].value,s[0].value]).range([.1,1]),c=0;c<s.length;c++)s[c].value=l(s[c].value);T.loadingsPc1=s,T.loadings=s.map(function(e){return{tip:e.d.reduce(function(e,t){return e.index+=1,e.text+="<br>PC"+e.index+": "+(100*t).toFixed(2),e},{text:e.id,index:0}).text,value:this(e.max)}},l),k=a.scores.map(function(e){return e.d.id=e.id,e.d}),S=k.reduce(function(e,t){return e.xMin=Math.min(e.xMin,t[0]),e.xMax=Math.max(e.xMax,t[0]),e.yMin=Math.min(e.yMin,t[1]),e.yMax=Math.max(e.yMax,t[1]),e},{xMin:1/0,yMin:1/0,xMax:-(1/0),yMax:-(1/0)}),m()})});var F=function(){angular.element(".legend-count").text("");var e=t.getCohort().sampleIds;0===e.length&&(e=k.map(function(e){return e.id}));var n=k.filter(function(t){return-1!==e.indexOf(t.id)}).reduce(function(e,t){var n=t.color;return e.hasOwnProperty(n)||(e[n]=0),e[n]+=1,e},{});Object.keys(n).forEach(function(e){angular.element("#legend-"+e.substr(1)).text(" ("+this[e]+")")},n)};t.onResize.add(m);var L=function(e){D=e,T.showPanelColor=!1,m()};t.onPatientColorChange.add(L);var B=t.getCohorts(),O=function(e){B=e,u()};t.onCohortChange.add(O),t.onCohortChange.add(F),t.query(M,{dataType:"PCA",$fields:["input","geneset","source"]}).then(function(e){var n=e.data,a=n.map(function(e){return{a:e.geneset,b:e.source,c:e.input}}),o=d.reduce(a,function(e,t){var n=e;return d.each(t,function(e){d.has(n,e)||(n[e]={}),n=n[e]}),e},{});T.geneSets=Object.keys(o).map(function(e){var n=t.getGenesetInfo(e),a=n.d;return"0"!==n.g&&(a+=" ("+n.g+" Genes)"),{name:e,tip:a,sources:Object.keys(o[e]).map(function(n){return{name:n,types:Object.keys(o[e][n]).map(function(e){var n={name:e};return n.tip=t.getDataTypeInfo(e).desc,n})}})}}),T.geneSet=T.geneSets[0]}),s.$on("$destroy",function(){t.onResize.remove(m),t.onPatientColorChange.remove(L),t.onCohortChange.remove(O)})}e.$inject=["$q","osApi","osWidget","$state","$stateParams","$timeout","$scope","d3","moment","$window","_"];var t={restrict:"E",templateUrl:"app/components/pca/pca.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osPca",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,r,s,i){function l(){var e="rgb(5, 108, 225)",t="red",n="rgb(56, 52,123)",a="green";return[{selector:"node",style:{content:"data(label)","text-valign":"center","text-halign":"center",shape:"ellipse",width:"60px",height:"50px",color:e,"background-color":"rgb(250, 250, 250)","border-width":"2px","border-color":e}},{selector:"edge",style:{width:"2px","line-color":e,"line-style":"solid"}},{selector:'node[nodeType="class"], node[nodeType="family"], node[nodeType="complex"]',style:{content:"","background-color":"white",shape:"roundrectangle"}},{selector:'edge[edgeType="activates"], edge[edgeType="indirectly activates"]',style:{"line-color":a,"target-arrow-shape":"triangle","target-arrow-color":a}},{selector:'edge[edgeType="inhibits"], edge[edgeType="ubiquitinylates"]',style:{"line-color":t,"target-arrow-shape":"tee","target-arrow-color":t}},{selector:'edge[edgeType="fusion"]',style:{"line-color":a}},{selector:'edge[edgeType="contains"]',style:{display:"none"}},{selector:'node[nodeType="process"]',style:{}},{selector:'node[nodeType="gene"]:selected',style:{"overlay-opacity":"0.5","overlay-color":"red"}},{selector:'node[nodeType="rtk"]',style:{content:"data(label)","background-color":"rgb(224, 209, 178)","border-color":"black","border-width":"0px","font-size":"48px",shape:"roundrectangle",width:"40px",height:"160px"}},{selector:'node[nodeType="kinase"]',style:{content:"data(label)","background-color":"rgb(255, 206, 194)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="dimer"]',style:{content:"","background-color":"rgb(234, 219, 188)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"0px"}},{selector:'node[nodeType="loop"]',style:{content:"","background-color":"rgb(255, 255, 255)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px","border-style":"dotted"}},{selector:'node[nodeType="gtpase"]',style:{content:"data(label)","background-color":"rgb(194, 194, 255)",shape:"ellipse",width:"160px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="adaptor"]',style:{content:"data(label)","background-color":"rgb(77, 184, 255)",shape:"ellipse",width:"60px",height:"120px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="GEF"]',style:{content:"data(label)","background-color":"rgb(77, 184, 255)",shape:"ellipse",width:"60px",height:"60px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="process"]',style:{content:"data(label)","background-color":"rgb(255, 255, 255)",shape:"roundrectangle",width:"100px",height:"40px","font-size":"24px","border-color":"black","border-width":"0px"}},{selector:'node[nodeType="TF"]',style:{content:"data(label)","background-color":"rgb(255, 206, 94)",shape:"diamond",width:"160px",height:"60px","font-size":"48px","border-color":"black","border-width":"1px"}},{selector:'node[nodeType="gene fusion"]',style:{content:"data(label)",shape:"roundrectangle","font-size":"24px","border-color":"red","border-width":"3px"}},{selector:"edge:selected",style:{"overlay-color":"grey","overlay-opacity":"0.3"}},{selector:'edge[edgeType="recruits"]',style:{width:"2px"}},{selector:'edge[edgeType="fusion"]',style:{"line-color":n}},{selector:'edge[edgeType="recruits"]',style:{"line-color":"red",width:"1px","line-style":"dashed","target-arrow-shape":"triangle","target-arrow-color":"black"}},{selector:'edge[edgeType="cycles"]',style:{"line-color":"black",width:"1px","line-style":"dashed","target-arrow-shape":"triangle","source-arrow-shape":"triangle","target-arrow-color":"green","source-arrow-color":"red"}},{selector:'edge[edgeType="associates"]',style:{"line-color":"black",width:"1px","line-style":"solid"}},{selector:'edge[edgeType="activation"]',style:{"line-color":"green",width:"1px"}},{selector:'edge[edgeType="inhibition"]',style:{"line-color":"red",width:"1px"}}]}var c,d,u=this,p=angular.element("#pathways-chart");u.datasource=e.getDataSource(),u.search="",u.tip=null,u.linkTitle="",u.links=[],u.resize=function(){p.width("100%"),p.height(r.innerHeight-90),d&&(d.resize(),d.center())},a.$watch("vm.search",function(){if(!angular.isUndefined(d)){var e=u.search.toUpperCase(),t=e.length;d.startBatch(),d.nodes().map(function(n){0===t?n.unselect():n.attr("name").substr(0,t)===e?n.select():n.unselect()}),d.endBatch()}}),e.setBusy(!0),e.query("render_pathways").then(function(t){c=t.data[0],d=i({container:p,elements:c.elements,style:l(),minZoom:.1,maxZoom:5,zoom:.2,wheelSensitivity:.5,layout:{name:"preset",fit:!0}}).on("click","node",function(e){"gene"==e.cyTarget.data().nodeType&&(angular.element("#gbm-webpage").modal(),a.$apply(function(){u.frame=o.trustAsResourceUrl("https://www.genecards.org/cgi-bin/carddisp.pl?gene="+e.cyTarget.data().id)}))}).on("click","edge",function(e){angular.element("#gbm-webpage").modal(),a.$apply(function(){u.frame=o.trustAsResourceUrl("https://www.ncbi.nlm.nih.gov/pubmed/?term="+e.cyTarget.data().pmid)})}).on("mouseover","edge",function(e){a.$apply(function(){u.tip=e.cyTarget.data().source+" Extract"}),e.cyTarget.style({width:"4px"})}).on("mouseout","edge",function(e){a.$apply(function(){u.tip=null}),e.cyTarget.style({width:"2px"})}).on("mouseover","node",function(e){a.$apply(function(){u.tip=e.cyTarget.data().name+" Gene Card"})}).on("mouseout","node",function(){a.$apply(function(){u.tip=null})}),u.resize(),e.setBusy(!1)}),e.onResize.add(u.resize)}e.$inject=["osApi","$state","$stateParams","$scope","$sce","$window","moment","cytoscape"];var t={restrict:"E",templateUrl:"app/components/pathways/pathways.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osPathways",e)}(),function(){"use strict";function e(e,t,n,a){var o=function(e){switch(e.f){case"Bar Plot":i(e);break;case"Line Plot":r(e);break;case"Scatter Plot":l(e);break;case"Matrix":s(e)}},r=function(e){var t=e.margin,a=e.width,o=e.height,r=e.data,s={x:n.extent(r,function(e){return e.x}),y:n.extent(r,function(e){return e.y})};angular.isDefined(e.domain.x)&&(s.x=e.domain.x),angular.isDefined(e.domain.y)&&(s.y=e.domain.y),n.selectAll(e.html+" svg").remove();var i=n.select(e.html).append("svg").attr("width",a+t.left+t.right).attr("height",o+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")"),l=n.scaleLinear().rangeRound([0,a]),c=n.scaleLinear().rangeRound([o,0]),d=n.line().x(function(e){return l(e.x)}).y(function(e){return c(e.y)});l.domain(s.x),c.domain(s.y),i.append("g").attr("transform","translate(0,"+o+")").call(n.axisBottom(l)).select(".domain").remove(),i.append("g").call(n.axisLeft(c)).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("text-anchor","end").text(e.labels.y),i.append("path").datum(r).attr("fill","none").attr("stroke","steelblue").attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("stroke-width",1.5).attr("d",d)},s=function(e){var t=e.width,a=e.height,o=e.data,r=e.container,s=e.html,i=e.labels,l=e.start_color,c=e.end_color,d=e.margin,u=70;if(!o)throw new Error("Please pass data");if(!Array.isArray(o)||!o.length||!Array.isArray(o[0]))throw new Error("It should be a 2-D array");var p=n.max(o,function(e){return n.max(e,function(e){return e})}),m=n.min(o,function(e){return n.min(e,function(e){return e})}),h=o.length,g=o[0].length;n.select(s+"-mtx").remove(),n.select(s+"-legend").remove();var f=n.select(s);f.append("div").attr("id",r+"-mtx").attr("style","display:inline-block"),f.append("div").attr("id",r+"-legend").attr("style","display:inline-block");var v=n.select(s+"-mtx").append("svg").attr("width",t+d.left+d.right).attr("height",a+d.top+d.bottom).append("g").attr("transform","translate("+d.left+","+d.top+")"),y=(v.append("rect").style("stroke","black").style("stroke-width","2px").attr("width",t).attr("height",a),n.scaleBand().domain(n.range(g)).rangeRound([0,t])),b=n.scaleBand().domain(n.range(h)).rangeRound([0,a]),x=n.scaleLinear().domain([m,p]).range([l,c]),w=v.selectAll(".row").data(o).enter().append("g").attr("class","row").attr("transform",function(e,t){return"translate(0,"+b(t)+")"}),A=w.selectAll(".cell").data(function(e){return e}).enter().append("g").attr("class","cell").attr("transform",function(e,t){return"translate("+y(t)+", 0)"});A.append("rect").attr("width",y.bandwidth()).attr("height",b.bandwidth()).style("stroke-width",0),w.selectAll(".cell").data(function(e,t){return o[t]}).style("fill",x);var C=v.append("g").attr("class","labels"),k=C.selectAll(".column-label").data(i.col).enter().append("g").attr("class","column-label").attr("transform",function(e,t){return"translate("+y(t)+","+a+")"});k.append("text").attr("x",30).attr("y",b.bandwidth()).attr("dy",".2em").attr("text-anchor","end").text(function(e,t){return e});var S=C.selectAll(".row-label").data(i.row).enter().append("g").attr("class","row-label").attr("transform",function(e,t){return"translate(0,"+b(t)+")"});S.append("line").style("stroke","black").style("stroke-width","1px").attr("x1",0).attr("x2",-5).attr("y1",b.bandwidth()/2).attr("y2",b.bandwidth()/2),S.append("text").attr("x",-8).attr("y",b.bandwidth()/2).attr("dy",".32em").attr("text-anchor","end").attr("font-size","smaller").text(function(e,t){return e});var E=n.select(s+"-legend").append("svg").attr("width",u).attr("height",a+d.top+d.bottom),P=E.append("defs").append("svg:linearGradient").attr("id","gradient").attr("x1","100%").attr("y1","0%").attr("x2","100%").attr("y2","100%").attr("spreadMethod","pad");P.append("stop").attr("offset","0%").attr("stop-color",c).attr("stop-opacity",1),P.append("stop").attr("offset","100%").attr("stop-color",l).attr("stop-opacity",1),E.append("rect").attr("width",u/2-10).attr("height",a).style("fill","url(#gradient)").attr("transform","translate(0,"+d.top+")");var b=n.scaleLinear().range([a,0]).domain([m,p]),M=n.axisRight(b);E.append("g").attr("class","y axis").attr("transform","translate(41,"+d.top+")").call(M)},i=function(e){var t=e.container,a=e.data,o=e.labels,r=e.width,s=e.height,i=e.margin,l=n.tip().attr("class","tip "+t).offset([-8,0]).html(function(e){return e.tip});angular.isDefined(e.color)||(e.color="#0096d5"),a.map(function(t){return angular.isDefined(t.color)||(t.color=e.color),t}),n.selectAll(e.html+" svg").remove(),n.selectAll(".tip."+t).remove();var c=n.select(e.html).append("svg").attr("width",r+i.left+i.right).attr("height",s+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")"),d=n.scaleBand().rangeRound([0,r]).padding(.1),u=n.scaleLinear().rangeRound([s,0]);d.domain(a.map(function(e){return e.x})),u.domain([0,n.max(a,function(e){return e.y})]),c.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+s+")").attr("dy","0.71em").call(n.axisBottom(d)).selectAll("text").attr("y",0).attr("x",9).attr("dy",".35em").attr("transform","rotate(90)").style("text-anchor","start"),c.append("g").attr("class","axis axis--y").call(n.axisLeft(u).ticks(5)).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("text-anchor","end").text(o.y),c.selectAll(".bar").data(a).enter().append("rect").on("mouseover",l.show).on("mouseout",l.hide).attr("class","bar").attr("x",function(e){return d(e.x)}).attr("y",function(e){return u(e.y)}).attr("width",d.bandwidth()).attr("height",function(e){return s-u(e.y)}).attr("fill",function(e){return e.color}),c.exit().remove(),c.call(l)},l=function(e){var t,o,r,s,i,l,c=e.layout,d=e.width,u=e.height,p=e.data,m=e.labels,h=e.nodeClass;t=e.html,n.selectAll(t+" svg").remove(),angular.element(t).css({width:d+"px","padding-left":c.left+"px"}),o=n.select(t).append("svg").attr("width",d).attr("height",u),r=o.append("g").attr("width",d).attr("height",u),s=o.append("g").attr("width",d).attr("height",u),i=o.append("g"),l=o.append("g"),i.append("text").attr("x",50).attr("y",15).text(m.x),l.append("text").attr("y",55).attr("x",25).text(m.y);var g=n.scaleLinear().domain(n.extent(p,function(e){return e.x})).range([50,d-50]).nice(),f=n.scaleLinear().domain(n.extent(p,function(e){return e.y})).range([50,u-50]).nice(),v=s.selectAll("circle").data(p);v.enter().append("svg:circle").attr("class",h).attr("cx",function(e){return g(e.x)}).attr("cy",function(e){return f(e.y)}).attr("r",3).style("fill",function(e){return e.color}),v.exit().transition().duration(200).delay(function(e,t){return t/300*100}).style("fill-opacity","0").remove(),v.style("fill",function(e){return e.color}).transition().duration(750).delay(function(e,t){return t/300*100}).attr("r",3).attr("cx",function(e){return g(e.x)}).attr("cy",function(e){return f(e.y)}).style("fill",function(e){return e.color}).style("fill-opacity",.8);var y=n.axisTop().scale(g).ticks(3),b=n.axisLeft().scale(f).ticks(3);i.attr("class","axis").attr("transform","translate(0, "+.5*u+")").call(y),l.attr("class","axis").attr("transform","translate("+.5*d+", 0)").call(b);var x=n.brush().on("end",function(){if(!n.event.selection)return void a.setCohort([],a.ALL,a.SAMPLE);var e=n.event.selection,t=e[0][0],o=e[1][0],r=e[0][1],i=e[1][1],l=s.selectAll("circle").data().filter(function(e){var n=g(e.x),a=f(e.y);return n>t&&o>n&&a>r&&i>a}).map(function(e){return e.s});a.setCohort(l,"PCA",a.SAMPLE)});r.attr("class","brush").call(x)},c=function(e){};return{makePlot:o,makeColoredMatrix:s,makeLinePlot:r,makeBarPlot:i,makeScatterPlot:l,getLegend:c}}e.$inject=["$","_","d3","osApi"],angular.module("oncoscape").service("osWidget",e)}(),function(){"use strict";function e(){function e(){t.play()}var t=new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");
return{beep:e}}angular.module("oncoscape").service("osSound",e)}(),function(){"use strict";function e(e,t){var n="https://oncoscape.sttrcancer.org/api/",a=function(e){var t=n+e.table;return angular.isDefined(e.query)&&(t+="/"+encodeURIComponent(angular.toJson(e.query))),t},o=function(t){return e({method:"GET",url:a(t),headers:{apikey:"password"}})};return{queryString:a,query:o}}e.$inject=["$http","$location"],angular.module("oncoscape").factory("osHttp",e)}(),function(){"use strict";angular.module("oncoscape").directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.ngEnter)}),t.preventDefault())})}})}(),function(){"use strict";function e(e,t,n,a,o,r){var s=new n.Signal,i=new n.Signal,l=null,c=function(){return l},d=function(){return null!=l},u=null,p=[{id:"guest",name:"Guest",icon:"fa fa-user"},{id:"google",name:"Google",icon:"fa fa-google-plus",key:"428912153446-7c82srcvu1bk1nramiqqctne005epl6s.apps.googleusercontent.com",mode:"implicit"},{id:"linkedin",name:"LinkedIn",icon:"fa fa-linkedin",key:"7869gkuwwnacez",mode:"explicit"}],m=function(){return p},h=function(){l={network:"guest",id:"x",name:"Guest",thumb:"Guest.png"},r.init().then(function(){s.dispatch()})},g=function(e){return"guest"==e.id?(l={network:"guest",id:"x",name:"Guest",thumb:"Guest.png"},void r.init().then(function(){s.dispatch()})):void o().login(e.id,{response_type:"code",display:"page",force:!1,scope:"email"})},f=function(){o().logout(u,{force:!1},i.dispatch)};return o.init(p.reduce(function(e,t){return e[t.id]=t.key,e},{}),{oauth_proxy:"/api/auth",redirect_uri:"https://dev.oncoscape.sttrcancer.io/"}),o.on("auth.login",function(e){r.setBusy(),u=e.network,o(u).api("/me","get",null,function(e){l={network:u,id:e.id,name:e.name,thumb:e.thumbnail},r.init().then(function(){s.dispatch()})})}),{isAuthenticated:d,loginGuest:h,getUser:c,getAuthSources:m,login:g,logout:f,onLogin:s,onLogout:i}}e.$inject=["osHttp","$http","signals","$location","auth","osApi"],angular.module("oncoscape").service("osAuth",e)}(),function(){"use strict";function e(e,t,n,a,o,r,s,i,l,c){function d(){return K?new Promise(function(e){e(y)}):(K=!0,Promise.all([new Promise(function(e,t){X("lookup_oncoscape_tools").then(function(t){x=t.data,e()},t)}),new Promise(function(e,t){X("lookup_oncoscape_datasources",{beta:!1}).then(function(t){b={disease:""},y=t.data.filter(function(e){return angular.isDefined(e.img)}).map(function(e){return e.name=e.name.trim(),e}).sort(function(e,t){return e.img<t.img?-1:e.img>t.img?1:e.disease<t.disease?-1:e.disease>t.disease?1:0}),e()},t)})]))}var u=new n.Signal,p=new n.Signal,m=new n.Signal,h=new n.Signal,g=new n.Signal,f=new n.Signal,v=new n.Signal;angular.element(i).bind("resize",l.debounce(p.dispatch,900));var y,b,x,w,A,C,k=function(){var e=angular.element(".tray-right").attr("locked");return angular.isUndefined(e)&&(e="true"),{left:"true"==angular.element("#cohortmenu-lock").attr("locked")?300:0,right:"true"===e?300:0}},S=function(e){e?angular.element(".loader-modal").show():angular.element(".loader-modal").hide()},E=function(e){function t(t,n){var a=t.length,o=2>a?1:6>a?2:9>a?3:18>a?6:36>a?8:10,r=t.map(function(e){return e[n]}),s={type:"numeric",min:e.min(r),max:e.max(r),range:e.range(r),sd:e.stdev(r),count:0,hist:e.histogram(r,o),histRange:[],bins:o};return s.histRange=[e.min(s.hist),e.max(s.hist)],s.count=s.hist.reduce(function(e,t){return e+=t},0),o=Math.round(s.range/o),s.hist=s.hist.map(function(e){var t={label:this.start+"-"+(this.start+this.bin),value:e};return this.start+=this.bin,t},{bin:o,start:s.min}),s}function n(t,n){var a=t.map(function(e){return e[n]}),o=a.reduce(function(e,t){return e[t]=e.hasOwnProperty(t)?e[t]+1:1,e},{});o=Object.keys(o).map(function(e){return{label:e,value:this.factors[e]}},{factors:o});var r=o.map(function(e){return e.value}),s={type:"factor",min:e.min(r),max:e.max(r),range:e.range(r),sd:e.stdev(r),count:0,hist:o,histRange:[],bins:o.length};return s.histRange=[s.min,s.max],s.count=s.hist.reduce(function(e,t){return e+=t.value},0),s}var a=function(e){function t(t,n){var a=e.multiply(t,n);return a.length?a:[[a]]}function n(t){var n=e.transpose(t);return n[0].length?n:[n]}function a(e,t){var n=p(e.map(function(e,n){return{tte:e,ev:t[n]}}),"tte"),a=u(d(n,"tte"),!0),o=m(n,function(e){return e.tte});return a.reduce(function(e,t){var a=o[t],r=h(e)||{n:n.length,e:0},s=a.filter(function(e){return e.ev});return e.push({n:r.n-r.e,e:a.length,d:s.length,t:a[0].tte}),e},[])}function o(e,t){var n=a(e,t);return n.reduce(function(e,t){var n=h(e)||{s:1};return t.d?e.push({t:t.t,e:!0,s:n.s*(1-t.d/t.n),n:t.n,d:t.d,rate:t.d/t.n}):e.push({t:t.t,e:!1,s:n.s,n:t.n,d:t.d,rate:null}),e},[])}function r(e,t,n){var o,r,s=a(t,n),i=[];return e=e.filter(function(e){return e.e}),o=e.reduce(function(e,t){var n=g(s,function(e){return e.t>=t.t});if(n){var a=n.n*t.rate;return i.push(n),e+a}return e},0),r=n.filter(function(e){return e}).length,{expected:o,observed:r,dataByTimeTable:i,timeNumber:i.length}}function s(t,n){var a,o,r,s,i,l,c,d=e.zeros(n.length);for(a=0;a<n.length;a++)for(o=a;o<n.length;o++)for(r=0;r<t.length;r++)s=t[r].n,c=t[r].d,r<n[a].timeNumber&&r<n[o].timeNumber&&(i=n[a].dataByTimeTable[r].n,l=n[o].dataByTimeTable[r].n,a!==o&&1!==s?(d[a][o]-=c*i*l*(s-c)/(s*s*(s-1)),d[o][a]=d[a][o]):1!==s&&(d[a][a]+=c*i*(s-i)*(s-c)/(s*s*(s-1))));return d}function i(a,o){var r=n(o),s=e.inv(a);return t(t(o,s),r)}function l(e){var t=[].concat.apply([],d(e,"tte")),n=[].concat.apply([],d(e,"ev"));return o(t,n).filter(function(e){return e.e})}function c(t){var n,a,o,c,d,u=l(t),p=1;return o=t.map(function(e){return r(u,e.tte,e.ev)}).filter(function(e){return e.expected}),c=o.map(function(e){return e.observed-e.expected}).slice(1),d=s(u,o).slice(1).map(function(e){return e.slice(1)}),a=o.length-1,a>0&&(n=i(d,[c])[0][0],p=1-e.chisquare.cdf(n,a)),{dof:a,KMStats:n,pValue:p}}var d,u,p,m,h,g,f={init:function(e){return d=e.pluck,u=e.uniq,p=e.sortBy,m=e.groupBy,h=e.last,g=e.find,f},compute:o,expectedObservedEventNumber:r,logranktest:c};return f}(e).init(l),o=function(e,a){var o=e.map(function(e){var t=this[e];return null===t?null:t.clinical},a.patientMap).filter(function(e){return null!=e});return{total:Object.keys(a.patientMap).length,selected:o.length,features:[{label:"Age At Diagnosis",data:t(o,"age_at_diagnosis"),prop:"age_at_diagnosis",type:"numeric"},{label:"Gender",data:n(o,"gender"),prop:"gender",type:"factor"},{label:"Race",data:n(o,"race"),prop:"race",type:"factor"},{label:"Ethnicity",data:n(o,"ethnicity"),prop:"ethnicity",type:"factor"},{label:"Vital",data:n(o,"status_vital"),prop:"status_vital",type:"factor"},{label:"Disease Status",data:n(o,"last_known_disease_status"),prop:"last_known_disease_status",type:"factor"}]}},r=function(e,t,n){var o=e.map(function(e){var t=this[e];return null===t?null:t.survival},t.patientMap).filter(function(e){return angular.isDefined(e)});if(0==o.length)return null;var r=o.reduce(function(e,t){return e.tte.push(t.tte),e.ev.push(t.ev),e},{tte:[],ev:[]}),s=a.compute(r.tte,r.ev).map(function(e){return l.omit(e,["rate","e","n","d"])});s.forEach(function(e){var t=this.survival.reduce(function(e,t){return e.time==t.tte&&e[t.ev?"d":"c"].push(t.pid),e},{c:[],d:[],time:e.t});e.c=t.c,e.d=t.d},{survival:o});var i=null===n?{KMStats:"NA",pValue:"NA",dof:"NA"}:a.logranktest([r,n.survival.data]),c={data:r,compute:s,logrank:i},d=c.compute[0];return(1!==d.s||0!==d.t)&&(c.compute.unshift({c:[],d:[],s:1,t:d.t}),c.compute.unshift({c:[],d:[],s:1,t:0})),c};return{km:a,createHistogram:o,createSurvival:r}}(r),P=null,M=null,D=null,T={numSamples:500,numPatients:500},F={numSamples:0,numPatients:0},L=function(){return w},B=function(){return M},O=function(){return D},$=function(){return T},G=function(){return F},z=function(){return P},R=function(){return C},I=function(){return y},N=function(){return b},U=function(e){C=e,v.dispatch(e)},q=function(e){T=e,h.dispatch(T)},_=function(e){return new Promise(function(t){if(angular.isObject(e)){if(b===e)return void t();b=e}else if(angular.isString(e)){if(b.disease===e)return void t();b=y.filter(function(e){return e.disease==this.key},{key:e})[0]}w=x.filter(function(e){return-1!==b.tools.indexOf(e.route)}).sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),Promise.all([X(b.clinical.samplemap),X(b.clinical.patient)]).then(function(e){var n={};n.sampleMap=e[0].data[0],n.patientMap=Object.keys(n.sampleMap).reduce(function(e,t){var a=n.sampleMap[t],o=t;return e.hasOwnProperty(a)?e[a].samples.push(o):e[a]={samples:[o]},e},{}),e[1].data.reduce(function(e,t){return e.hasOwnProperty(t.patient_ID)?e[t.patient_ID].clinical=t:e[t.patient_ID]={clinical:t,samples:[]},e},n.patientMap),F.numSamples=Object.keys(n.sampleMap).length,F.numPatients=Object.keys(n.patientMap).length,e[1].data.map(function(e){if(!e.hasOwnProperty("status_vital"))return null;if(null===e.status_vital)return null;var t,n=e.status_vital.toString().trim().toUpperCase();return"ALIVE"==n?e.hasOwnProperty("days_to_last_follow_up")?(t=parseInt(e.days_to_last_follow_up),0>t&&(t=0),isNaN(t)?null:{pid:e.patient_ID,ev:!1,tte:t}):null:"DEAD"==n&&e.hasOwnProperty("days_to_death")?(t=parseInt(e.days_to_death),0>t&&(t=0),isNaN(t)?null:{pid:e.patient_ID,ev:!0,tte:t}):null}).reduce(function(e,t){return null!==t&&(e[t.pid].survival=t),e},n.patientMap),P=n,A={color:"#039BE5",patientIds:[],sampleIds:[],name:"All Patients + Samples",histogram:E.createHistogram(Object.keys(n.patientMap),n),survival:E.createSurvival(Object.keys(n.patientMap),n,null),numPatients:Object.keys(P.patientMap).length,numSamples:Object.keys(P.sampleMap).length,numClinical:Object.keys(P.patientMap).reduce(function(e,t){return e+=P.patientMap[t].hasOwnProperty("clinical")?1:0},0),show:!0,type:"ALL"},M=localStorage.getItem(b.disease+"Cohorts"),null!==M?(M=angular.fromJson(M),Q(M[0])):(M=[A],Q(A)),f.dispatch(M),g.dispatch(D),u.dispatch(b),t()})})},H=function(e,t,n){if(0===t.length)return A;var a=t.map(function(e){return this.hasOwnProperty(e)?this[e]:null},n.sampleMap).filter(function(e){return null!==e}).filter(function(e,t,n){return n.indexOf(e)===t});return V(e,a,t)},j=function(e,t,n){if(0===t.length)return A;var a=[].concat.apply([],t.map(function(e){return this.hasOwnProperty(e)?this[e].samples:null},n.patientMap)).filter(function(e,t,n){return n.indexOf(e)===t});return V(e,t,a)},V=function(e,t,n){var a=E.createSurvival(t,P,A),o={uuid:Math.random().toString().substr(2),color:"#000",patientIds:t,sampleIds:n,name:e,histogram:E.createHistogram(t,P),survival:null===a?A.survival:a,numPatients:t.length,numSamples:n.length,numClinical:t.reduce(function(e,t){return e+=P.patientMap[t].hasOwnProperty("clinical")?1:0},0),show:!0,type:"UNSAVED"};return o},Q=function(e,t,n){if(angular.isArray(e)&&(t+="  ("+c().format("hh:mm:ss")+")",e="PATIENT"==n?j(t,e,P):H(t,e,P),e.type=0===e.patientIds.length?"ALL":"UNSAVED","ALL"!=e.type)){var a=M.map(function(e){return e.color}),o=["#E91E63","#673AB7","#4CAF50","#CDDC39","#FFC107","#FF5722","#795548","#607D8B","#03A9F4","#03A9F4","#004358","#800080","#BEDB39","#FD7400","#1F8A70","#B71C1C","#880E4F","#4A148C","#311B92","#0D47A1","#006064","#1B5E20"].filter(function(e){return-1==a.indexOf(e)});e.color=o[0]}D=e,g.dispatch(D)},W=function(){D.type="SAVED",M.push(D),localStorage.setItem(b.disease+"Cohorts",angular.toJson(M))},Y=function(e){M.splice(M.indexOf(e),1),localStorage.setItem(b.disease+"Cohorts",angular.toJson(M)),Q([],"","PATIENT")},Z=function(e,t){var n=l.union.apply(null,e.map(function(e){return e=e.toUpperCase().trim(),P.sampleMap.hasOwnProperty(e)?P.sampleMap[e]:e}).filter(function(e){return P.patientMap.hasOwnProperty(e)}).map(function(e){return P.patientMap[e].samples}));Q(n,t,"SAMPLE"),W()},K=!1,J=function(t,n){return e.queryString({table:t,query:n})},X=function(t,n){return e.query({table:t,query:n})},ee=function(e){},te=function(e){return[{n:"ucsc xena",d:"Originating data processed by and obtained via UCSC Xena browser"},{n:"GEO",d:"Originating data obtained via Gene Expression Omnibus"},{n:"ucsc xena + GEO",d:"GEO data superimposed on TCGA data via centroid method of 3 most correlated samples"}].filter(function(t){return t.n===e})[0]},ne=function(e){return[{n:"All Genes",d:"All gene available in the given data type used in calculation",g:"0"},{n:"TCGA GBM Classifiers",d:"Gene expression-based molecular classification of GBM subtypes (Proneural, Neural, Classical, Mesenchymal)",g:"840"},{n:"Glioma Markers",d:"Genes recurrently impacted in TCGA gliomas",g:"545"},{n:"TCGA Pancan Mutated",d:"Significantly mutated genes according to the TCGA PANCAN working group (syn1750331) identified by both MuS, iC and MutSig",g:"73"},{n:"Oncoplex Vogelstein",d:"Combined set from the Oncoplex gene panel and driver genes described in Vogelstein, Science 2013.",g:"274"},{n:"Oncoplex",d:"A sequencing panel that detects mutations in genes related to cancer treatment, prognosis, and diagnosis.",g:"263"},{n:"OSCC Expression Markers",d:"Differentially expressed probe set comparing normal oral tissue to oral squamous cell carcinoma",g:"109"},{n:"Breast PAM50",d:"Gene expression based subtype predictor for subtypes luminal A, luminal B, HER2-enriched, and basal-like",g:"50"},{n:"Breast Tumor Intrinsic Classifier",d:"Meta analysis of available breast cancer gene expression datasets grouping LumA, LumB, Basal-like, HER2+/E, R-, and Normal Breast-like tumor subtypes",g:"1232"},{n:"FoundationOne Heme",d:"FoundationOne Heme is designed to analyze and interpret sequence information for somatically altered gene, s in human hematologic malignancies (leukemias, lymphomas, and myelomas), and sarcomas. Genes included in this assay encode known or likely targets of therapies, either approved or in clinical trials, or otherwise known drivers of oncogenesis.",g:"593"},{n:"TCGA Sarcoma alterations",d:"Frequently mutated genes in soft-tissue sarcoma subtypes",g:"21"},{n:"Leiomyosarcoma molecular subtypes",d:"Three molecular subtypes of leiomyosarcoma were confirmed in 2 publically available datasets. Subtype I LM, S is associated with good outcome in extrauterine LMS while subtype II LMS is associated with poor prognosis in both uterine and extrauterine LMS. A subset of the biomarkers are used here based on the genes mentioned in the publication.",g:"13"},{n:"Sarcoma markers",d:"Compiled from multiple publications on different sarcoma subtypes",g:"48"},{n:"Sarcoma markers Heme",d:"Compiled from multiple publications on different sarcoma subtypes & intersected with FoundationOne Heme",g:"24"},{n:"Sarcoma markers Oncoplex",d:"Compiled from multiple publications on different sarcoma subtypes & intersected with Oncoplex",g:"19"},{n:"Sarcoma CINSARC",d:"Performed genomic and expression profiling in a training set of 183 sarcomas and established a prognostic, gene expression signature, complexity index in sarcomas (CINSARC), composed of 67 genes related to mitosis and chromosome management",g:"67"}].filter(function(t){return t.n===e})[0]},ae=function(e){return[{name:"gene expression RNAseq (ployA+ IlluminaHiSeq pancan normalized)",desc:"Gene expression values were mean-centered per gene across all 'gene expression RNAseq' TCGA cohorts"},{name:"gene expression RNAseq (polyA+ IlluminaHiSeq)",desc:"Gene expression measured experimentally using the Illumina HiSeq 2000 RNA Sequencing platform, log2(x+1) transformed RSEM normalized count"},{name:"gene expression RNAseq (polyA+ IlluminaHiSeq percentile)",desc:"Gene expression estimation in percentile rank (RSEM values between 0% to 100%), with higher value representing higher expression"},{name:"protein expression RPPA",desc:"RPPA (reverse phase protein array) technology processed by MDACC"},{name:"copy number (gistic2)",desc:"TCGA FIREHOSE pipeline applied GISTIC2 method with segmented CNV values mapped to gene-level estimates"},{name:"protein expression RPPA (RBN)",desc:"RPPA (reverse phase protein array) technology normalized by RBN (replicate-base normalization) method developed by MDACC"},{name:"gene expression (AgilentG4502A_07_3)",desc:"Gene expression measured experimentally using Agilent 244K custom gene expression G4502A_07_1 microarray, log2 lowess normalized ratio of sample signal to reference signal (cy5/cy3) collapsed by gene"},{name:"gene expression (AffyU133a)",desc:"Gene expression measured experimentally using the Affymetrix HT Human Genome U133a microarray, log transformed"},{name:"gene expression (AgilentG4502A_07_1)",desc:"Gene expression measured experimentally using Agilent 244K custom gene expression G4502A_07_1 microarray, log2 lowess normalized ratio of sample signal to reference signal (cy5/cy3) collapsed by gene"},{name:"gene expression (AgilentG4502A_07_2)",desc:"Gene expression measured experimentally using Agilent 244K custom gene expression G4502A_07_2 microarray, log2 lowess normalized ratio of sample signal to reference signal (cy5/cy3) collapsed by gene"},{name:"gene expression RNAseq (ployA+ IlluminaHiSeq pancan normalized)",desc:"Gene expression values were mean-centered per gene across all 'gene expression RNAseq' TCGA cohorts"},{name:"gene expression RNAseq (polyA+ IlluminaGA)",desc:"Gene expression measured experimentally using the Illumina Genome Analyzer RNA Sequencing platform by the British Columbia Cancer Agency, RPKM values"},{name:"gene expression RNAseq (polyA+ IlluminaHiSeq UNC)",desc:"Gene expression measured experimentally using the Illumina HiSeq 2000 RNA Sequencing platform, log2(x+1) transformed RSEM normalized count"},{name:"gene expression RNAseq (polyA+ IlluminaHiseq BC)",desc:"Gene expression measured experimentally using the Illumina HiSeq 2000 RNA Sequencing platform, RPKM values"},{name:"gene expression RNAseq (polyA+ IlluminaHiSeq percentile UNC)",desc:"Gene expression estimation in percentile rank (RSEM values between 0% to 100%), with higher value representing higher expression"},{name:"gene expression RNAseq + GSE21050",desc:"TCGA + Affy U133Plus2.0: Expression data from Complex genetics sarcomas (cohort 1 and 2) (310 samples)"},{name:"gene expression RNAseq + GSE20196",desc:"TCGA + Affy U133Plus2.0: Gene expression profile of poorly differentiated synovial sarcoma (34 samples)"},{name:"gene expression RNAseq + GSE12102",desc:"TCGA + Affy U133Plus2.0: Overcoming resistance to conventional drugs in Ewings sarcoma and identification of molecular predictors of outcome (37 samples)"},{name:"gene expression RNAseq + GSE16102-GPL96",desc:"TCGA + Affy U133A: Gene expression profiles of canine and human osteosarcoma (57 samples)"},{name:"gene expression RNAseq + GSE16102-GPL3979",desc:"TCGA + Affy U133A: Gene expression profiles of canine and human osteosarcoma (57 samples)"},{name:"gene expression RNAseq + GSE21122",desc:"TCGA + Affy U133A: Whole-transcript expression data for soft-tissue sarcoma tumors and control normal fat specimens (158 samples)"},{name:"gene expression RNAseq + GSE23980",desc:"TCGA + Affy U133Plus2.0: Expression data from human soft tissue sarcomas with complex genomics (171 samples)"},{name:"gene expression RNAseq + GSE30929",desc:"TCGA + Affy U133A: Whole-transcript expression data for liposarcoma (140 samples)"},{name:"gene expression RNAseq + GSE6481",desc:"TCGA + Affy U133A: Gene Expression Analysis of Soft Tissue Sarcomas: Characterization & Reclassification of Malignant Fibrous Histiocytoma (105 samples)"},{name:"GSE12102",desc:"Affy U133Plus2.0: Overcoming resistance to conventional drugs in Ewings sarcoma and identification of molecular predictors of outcome (37 samples)"},{name:"GSE16102-GPL96",desc:"Affy U133A: Gene expression profiles of canine and human osteosarcoma (57 samples)"},{name:"GSE16102-GPL3979",desc:"Affy U133A: Gene expression profiles of canine and human osteosarcoma (57 samples)"},{name:"GSE20196",desc:"Affy U133Plus2.0: Gene expression profile of poorly differentiated synovial sarcoma (34 samples)"},{name:"GSE21050",desc:"Affy U133Plus2.0: Expression data from Complex genetics sarcomas (cohort 1 and 2) (310 samples)"},{name:"GSE21122",desc:"Affy U133A: Whole-transcript expression data for soft-tissue sarcoma tumors and control normal fat specimens (158 samples)"},{name:"GSE23980",desc:"Affy U133Plus2.0: Expression data from human soft tissue sarcomas with complex genomics (171 samples)"},{name:"GSE30929",desc:"Affy U133A: Whole-transcript expression data for liposarcoma (140 samples)"},{name:"GSE6481",desc:"Affy U133A: Gene Expression Analysis of Soft Tissue Sarcomas: Characterization & Reclassification of Malignant Fibrous Histiocytoma (105 samples)"}].filter(function(t){return t.name===e})[0]};return{ALL:"All Patients",SAMPLE:"SAMPLE",PATIENT:"PATIENT",getGeneInfo:ee,getGenesetInfo:ne,getSourceInfo:te,getDataTypeInfo:ae,init:d,query:X,queryString:J,setDataSource:_,getDataSource:N,getDataSources:I,setPatientColor:U,getPatientColor:R,getTools:L,getLayout:k,setCohortToolInfo:q,getCohortToolInfo:$,getCohortDatasetInfo:G,getCohorts:B,getCohort:O,setCohort:Q,saveCohort:W,deleteCohort:Y,importIds:Z,onPatientColorChange:v,onCohortToolInfo:h,onNavChange:m,onDataSource:u,onResize:p,onCohortChange:g,onCohortsChange:f,setBusy:S,km:E.km,getData:z}}e.$inject=["osHttp","$http","signals","$location","$q","jStat","$","$window","_","moment"],angular.module("oncoscape").service("osApi",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,r,s,i,l,c,d,u){function p(e){e.sampleIds.length!=G&&(z=!0,G=e.sampleIds.length,x.startBatch(),x.$('node[nodeType="patient"]:selected').deselect(),x.$('node[nodeType="patient"]').forEach(function(t){-1!=e.sampleIds.indexOf(t.id())&&t.select()}),x.endBatch())}function m(){var t=x.$('node[nodeType="patient"]:selected');t.length!=G&&(G=t.length,z||e.setCohort(t.map(function(e){return e.data().id}),"Markers + Patients",e.SAMPLE),z=!1)}function h(){}e.setBusy(!0);var g,f,v=function(){return{patients:{select:new i.Signal,unselect:new i.Signal,over:new i.Signal,out:new i.Signal},genes:{select:new i.Signal,unselect:new i.Signal,over:new i.Signal,out:new i.Signal},edges:{select:new i.Signal,unselect:new i.Signal,over:new i.Signal,out:new i.Signal},clear:function(){this.edges.select.removeAll(),this.edges.unselect.removeAll(),this.edges.over.removeAll(),this.edges.out.removeAll(),this.patients.select.removeAll(),this.patients.unselect.removeAll(),this.patients.over.removeAll(),this.patients.out.removeAll(),this.genes.select.removeAll(),this.genes.unselect.removeAll(),this.genes.over.removeAll(),this.genes.out.removeAll()}}}(),y=function(e){var t=localStorage.getItem("MP-"+e.getDataSource().disease),n=null!==t;n&&(t=angular.fromJson(t));var a=null,o=function(e){a=e},r=function(a,o){n&&(e.onPatientColorChange.dispatch(t.optColors),requestAnimationFrame(function(){o.startBatch(),o.add(t.edges),o.$('node[nodeType="patient"]').forEach(function(e){t.moved.hasOwnProperty(e.id())&&e.position(t.moved[e.id()])}),o.endBatch()}))},s=function(){return n?t.optEdgeColors:[{name:"Mutation",abv:"m",show:!0,color:"#9C27B0","class":"switch-mutation",count:"",id:0},{name:"Amplification",abv:"cnG2",show:!0,color:"#3F51B5","class":"switch-cnG2",count:"",id:2},{name:"Gain",abv:"cnG1",show:!0,color:"#03A9F4","class":"switch-cnG1",count:"",id:1},{name:"Loss",abv:"cnL1",show:!0,color:"#FF9800","class":"switch-cnL1",count:"",id:-1},{name:"Deletion",abv:"cnL2",show:!0,color:"#F44336","class":"switch-cnL2",count:"",id:-2}]},i=function(a){if(n)return a.filter(function(e){return e.name==t.optGeneSet.name},t.optGeneSet.name)[0];var o=e.getDataSource().geneset,r=a.reduce(function(e,t){return t.name===o&&(e=t),e},a[0]);return r},l=function(e){return n?e.filter(function(e){return e.name==t.optPatientLayout.name},t.optPatientLayout.name)[0]:e.reduce(function(e,t){return t.hasOwnProperty("default")&&t["default"]&&(e=t),e},e[0])},c=function(t,n){var o={};o.moved={},n.$('node[nodeType="patient"]').forEach(function(e){d.isMatch(e.data().position,e.position())||(o.moved[e.id()]=e.position())}),o.optEdgeColors=t.optEdgeColors,o.optGeneSet=t.optGeneSet,o.optPatientLayout=t.optPatientLayout,o.optColors=a,o.edges=n.$('edge[edgeType="cn"]').jsons(),localStorage.setItem("MP-"+e.getDataSource().disease,angular.toJson(o))};return{applyState:r,getOptEdgeColors:s,getGeneSet:i,getPatientLayout:l,setColors:o,save:c}}(e),b=angular.element("#markers-chart"),x=function(e){return s({container:e,style:[{selector:"core",style:{"selection-box-color":"#039BE5","selection-box-border-color":"#3993fa","selection-box-border-width":"1px","selection-box-opacity":".2"}},{selector:"node",style:{"background-color":"#039BE5",display:"data(display)",width:"data(sizeEle)",height:"data(sizeEle)","border-width":"data(sizeBdr)","font-size":"data(sizeLbl)","text-valign":"center"}},{selector:'node[nodeType="telomere"]',style:{"background-color":"#039BE5","border-color":"#039BE5"}},{selector:'node[nodeType="patient"]',style:{"background-color":"data(color)","text-halign":"center","border-color":"#FFFFFF"}},{selector:'node[nodeType="patient"]:selected',style:{"background-color":"data(color)","border-color":"#000","border-width":5}},{selector:'node[nodeType="gene"]',style:{"background-color":"data(color)","border-color":"data(colorBdr)","text-halign":"data(halign)","text-margin-x":"data(padding)","font-size":"8px",color:"#aaa",label:"data(id)","border-width":"data(sizeBdr)"}},{selector:'node[nodeType="gene"]:selected',style:{"background-color":"#fc8400","border-color":"#000000",color:"#000"}},{selector:'node[nodeType="centromere"]',style:{"font-size":"20px","text-halign":"center","background-color":"#039BE5",color:"#FFFFFF","border-color":"rgb(19, 150, 222)",height:"40px",width:"40px",shape:"round",label:"  data(id)"}},{selector:"edge",style:{display:"data(display)","line-color":"data(color)",width:"data(sizeEle)"}},{selector:'node[nodeType="annotation-text"]',style:{"font-size":"50px","text-halign":"right","text-valign":"bottom","background-color":"#FFFFFF",color:"#000","border-color":"#FFFFFF",height:"50px",width:"50px",shape:"round",label:"data(label)","text-transform":"uppercase"}}],hideEdgesOnViewport:!1,hideLabelsOnViewport:!0,textureOnViewport:!1,wheelSensitivity:.2,zoom:.08,pan:{x:650,y:160},minZoom:.05,maxZoom:20,layout:{name:"preset",fit:!0}})}(b);!function(){e.query("render_chromosome",{type:"chromosome"}).then(function(e){var t=e.data[0].data,n=[];Object.keys(t).forEach(function(e){var t=this.chromosomes[e];this.elements.push({group:"edges",grabbable:!1,locked:!0,selectable:!1,data:{color:"#039BE5",id:"ce"+e,display:"element",edgeType:"chromosome",sizeBdr:0,sizeEle:3,source:"cp"+e,target:"cq"+e}}),this.elements.push({group:"nodes",grabbable:!1,locked:!0,selectable:!1,position:{x:t.x,y:t.p},data:{id:"cp"+e,display:"element",nodeType:"telomere",degree:1,sizeBdr:1,sizeEle:1,sizeLbl:1,subType:"unassigned"}}),this.elements.push({group:"nodes",grabbable:!1,locked:!0,selectable:!1,position:{x:t.x,y:t.q},data:{id:"cq"+e,display:"element",nodeType:"telomere",degree:1,sizeBdr:5,sizeEle:5,sizeLbl:5,subType:"unassigned"}}),this.elements.push({group:"nodes",grabbable:!1,locked:!0,selectable:!1,position:{x:t.x,y:t.c},data:{id:e,display:"element",sizeBdr:1,sizeEle:10,sizeLbl:10,nodeType:"centromere",degree:1}})},{chromosomes:t,elements:n}),x.add(n)})}();var w=function(e,t,n){return e.showPopupSelection=!1,e.datasource=t.getDataSource(),e.detail={show:!1,html:"",title:""},e.optGeneSets=[],e.optGeneSet=null,e.optPatientLayouts=[],e.optPatientLayout=null,e.showPanelLayout=!1,e.showPanelColor=!1,e.showPanelColorRna=!1,e.search="",e.searchCount="",e.searchNotFound="",e.optCommandModes=[{name:"Sequential"},{name:"Set"},{name:"Ad Hoc"}],e.optCommandMode=e.optCommandModes[0],e.exeSearch=function(){var t=e.search.toUpperCase().trim(),n=0,o=t.length>0;x.$("node").forEach(function(e){var a=o?-1!==e.id().toUpperCase().indexOf(t):!1;a&&(n+=1),e[a?"select":"deselect"]()}),0==n&&(e.searchNotFound="Symbol not in geneset"),e.searchCount="("+n+" found)",a(function(){e.searchCount=""},3e3,!0),a(function(){e.searchNotFound=""},3e3,!0)},e.hideModal=function(){angular.element("#modalEdge").modal("hide")},e.filterModelEdge=function(){angular.element("#modalEdge").modal("hide");var t=e.optEdgeColors.filter(function(e){return e.show}).map(function(e){return e.id}),n=g.edges.filter(function(e){return-1!=t.indexOf(e.data.cn)},{vals:t});x.startBatch(),x.add(n),x.endBatch(),g=null},e.edgeToggle=function(){e.cmd("ShowSelectedEdges")},e.selectColor=function(e){var t=e.color,n=x.$('node[nodeType="patient"]');x.startBatch(),n.forEach(function(e){e.data().color==this&&e.select()},t),x.endBatch()},e.deselectColor=function(e){var t=e.color,n=x.$('node[nodeType="patient"]:selected');x.startBatch(),n.forEach(function(e){e.data().color==this&&e.unselect()},t),x.endBatch()},e.lockPatients=!1,e.lockGenes=!1,e.lock=function(t){switch(t){case"patient":e.lockPatients=!e.lockPatients,x.startBatch(),x.$('node[nodeType="patient"]').forEach(function(t){e.lockPatients?t.unselectify():t.selectify()}),x.endBatch();break;case"gene":e.lockGenes=!e.lockGenes,x.startBatch(),x.$('node[nodeType="cn"]').forEach(function(t){e.lockGenes?t.unselectify():t.selectify()}),x.endBatch()}},e.optEdgeColors=n.getOptEdgeColors(),u.all([t.query("hg19_geneset",{type:"geneset",$fields:["name"]}),t.query(t.getDataSource().disease+"_cluster",{$fields:["input","geneset","dataType","source","default"]})]).then(function(a){var o=a[1].data.map(function(e){return e.name=e.dataType+" "+e.input+" "+e.geneset,e}).sort(function(e,t){var n=e.name.toLowerCase(),a=t.name.toLowerCase();return a>n?-1:n>a?1:0});e.optGeneSets=d.uniq(t.getDataSource().edges.map(function(e){return{name:e.geneset}}),function(e){return e.name}).map(function(e){var n=t.getGenesetInfo(e.name);return e.tip=n.d+" ("+n.g+" Genes)",Object.assign(e,{info:t.getGenesetInfo(e.name)})}),e.optGeneSet=n.getGeneSet(e.optGeneSets),e.optPatientLayouts=o;var r=n.getPatientLayout(e.optPatientLayouts),s=o.filter(function(e){return e["default"]});e.optPatientLayout=angular.isDefined(r)?r:angular.isDefined(s)?s:o[0]}),e.resize=function(){var e=c.innerWidth;b.width(e),b.height(c.innerHeight-90),x.resize()},angular.element(c).bind("resize",d.debounce(e.resize,300)),e}(this,e,y),A=function(e,t){var n=function(){e.fit(),e.center()},a=function(){e.fit(e.$(":selected"),50)};return t.zoom={reset:n,fit:a},e.on("pan",d.debounce(function(){e.startBatch(),D(),e.endBatch()},50)),t.zoom}(x,w),C=t.scaleLog().domain([.005,20]).range([5,1]),k=t.scaleLog().domain([.005,20]).range([80,1]),S=t.scaleLog().domain([.005,20]).range([50,1]),E=t.scalePow().range([.01,2]),P=t.select("body").append("div").attr("class","markers-tooltip");P.style("opacity",0);var M=function(e){E.domain(x.$('node[nodeType="'+e+'"]').toArray().reduce(function(e,t){var n=t.data().weight;return e[0]=Math.min(e[0],n),e[1]=Math.max(e[1],n),e},[1/0,-(1/0)]));var t=x.zoom(),n=k(t),a=.375>t?0:S(t),o=C(t);x.startBatch(),x.$('node[nodeType="'+e+'"]').forEach(function(e){e.data({sizeEle:Math.round(this.sizeNode*E(e.data().weight)),sizeLbl:this.sizeLbl,sizeBdr:this.sizeBdr})},{sizeNode:n,sizeBdr:o,sizeLbl:a,scale:E}),x.endBatch()},D=function(){M("patient"),M("gene")},T=function(e,t,n,a,r,s,i){var l={};f=new Worker("app/components/markers/markers.worker.js"),f.addEventListener("message",function(e){l[e.data.cmd](e.data.data)},!1);var c=function(t,n){if(angular.isUndefined(n))return void e.remove(t);if(0!==n.length){var a=n.map(function(e){return this.getElementById(e)},e);try{e.collection(a).remove()}catch(o){}}};return l.patients_html=function(){},l.patients_resize=function(){},l.patients_delete=function(e){c('node[nodeType="patient"]',e)},l.patients_insert=function(a){e.startBatch();var o=e.add(a.patients);o.on("select",s.debounce(i.patients.select.dispatch,300)),o.on("unselect",s.debounce(i.patients.unselect.dispatch,300)),o.on("mouseover",i.patients.over.dispatch),o.on("mouseout",i.patients.out.dispatch),o.forEach(function(e){try{e.data({weight:a.degrees[e.id()].weight})}catch(t){e.data({
weight:10})}}),D(),e.endBatch(),t.resize();var r=n.getCohort();e.startBatch(),e.nodes('node[nodeType="patient"]').forEach(function(e){-1!=this.indexOf(e.id())&&e.select()},r.sampleIds),e.endBatch(),t.zoom.reset(),e.center(),e.fit(e.nodes(),400),y.applyState(R,e)},l.patients_layout=function(t){e.startBatch(),e.$("node[nodeType='annotation-text']").remove();e.nodes('node[nodeType="patient"]').forEach(function(e){if(t.hasOwnProperty(e.id())){var n=t[e.id()];e.data().position={x:n.x,y:n.y},e.position(n),e.style({display:"element"})}else e.style({display:"none"})}),D(),e.endBatch()},l.genes_html=function(){},l.genes_delete=function(e){c('node[nodeType="gene"]',e)},l.genes_insert=function(t){e.startBatch();var a=e.add(t.genes);a.on("select",s.debounce(i.genes.select.dispatch,300)),a.on("unselect",s.debounce(i.genes.unselect.dispatch,300)),a.on("mouseover",i.genes.over.dispatch),a.on("mouseout",i.genes.out.dispatch),a.forEach(function(e){try{e.data({weight:t.degrees[e.id()].weight})}catch(n){e.data({weight:0})}}),e.endBatch(),D(),n.setBusy(!1)},l.edges_delete=function(e){c('edge[edgeType="cn"]',e)},l.edges_insert=function(n){if(g=n,n.counts.total>5e3)return angular.element("#modalEdge").modal(),void o.$apply(function(){t.edgeCounts=n.counts});if("Ad Hoc"==t.optCommandMode.name){e.startBatch(),e.$('edge[edgeType="cn"]').remove();var a=e.add(n.edges);if("patient"==L){var r=a.map(function(e){return[e.data().source,e.data().color]}).reduce(function(e,t){return e[t[0]]=t[1],e},{});e.$('node[nodeType="gene"]').forEach(function(e){var t=e.id(),n=this.hasOwnProperty(t);e.data("sizeBdr",n?10:1),e.data("colorBdr",n?this[t]:"#FFFFFF"),e.data("color",n?this[t]:"#0096d5")},r)}e.endBatch()}else{e.startBatch();try{e.add(n.edges)}catch(s){}t.edgeCounts=n.counts,e.endBatch()}},function(e){f.postMessage({cmd:"setOptions",data:e})}}(x,w,e,u,A,d,v),F=function(t,n){return function(a){a=a||"";var o=n.optGeneSet.name,r={mode:n.optCommandMode.name,cmd:a,dataset:e.getDataSource().disease,patients:{data:n.datasource.clinical.patient,layout:n.optPatientLayout,selected:t.$('node[nodeType="patient"]:selected').map(function(e){return e.data().id})},genes:{layout:n.optGeneSet.name,selected:t.$('node[nodeType="gene"]:selected').map(function(e){return e.data().id})},edges:{layout:n.datasource.edges.filter(function(e){return e.geneset==this},o)[0],colors:n.optEdgeColors.filter(function(e){return e.show}).map(function(e){return{id:e.id,color:e.color}})}};return r}}(x,w);w.cmd=function(){},function(t,n){var a=2,o=function(){T(F())};a+=0,n.$watch("vm.optGeneSet",function(){return a>0?void(a-=1):void(angular.isUndefined(t.optGeneSet)||angular.isUndefined(t.optPatientLayout)||(e.setBusy(!0),x.$('edge[edgeType="cn"]').remove(),o()))}),a+=1,n.$watch("vm.optPatientLayout",function(){return a>0?void(a-=1):void o()}),a+=1,n.$watch("vm.optEdgeColors.color",function(){return a>0?void(a-=1):(o(),void t.resize())})}(w,o);var L="",B=function(){angular.element(".legend-count").text("");var e=x.$('node[nodeType="patient"]:selected').toArray();0===e.length&&(e=x.$('node[nodeType="patient"]').toArray());var t=e.reduce(function(e,t){var n=t.data().color;return e.hasOwnProperty(n)||(e[n]=0),e[n]+=1,e},{});Object.keys(t).forEach(function(e){angular.element("#legend-"+e.substr(1)).text(" ("+this[e]+")")},t)},O=function(e){o.$apply(function(){"mouseout"==e.type||(L="patient")})},$=function(e){o.$apply(function(){if("mouseout"==e.type)angular.element("#cohortmenu-legand").html(""),P.transition().duration(5e3).style("opacity",0);else{L="gene";var t=e.cyTarget,n="https://cancer.sanger.ac.uk/cosmic/gene/analysis?ln="+e.cyTarget.id(),a="http://www.genecards.org/cgi-bin/carddisp.pl?gene="+e.cyTarget.id();P.transition().duration(200).style("opacity",1).style("z-index",9999),P.html("<div><b>"+t.id()+'</b></div><div onclick=window.open("'+n+'","_blank")>COSMIC</div><div onclick=window.open("'+a+'","_blank")>GeneCard</div>').style("left",e.cyRenderedPosition.x+"px").style("top",e.cyRenderedPosition.y+"px")}})},G=0,z=!1;e.onCohortChange.add(p),o.$watch("vm.optCommandMode",function(){switch(v.clear(),x.$("node").unselect(),x.$('edge[edgeType="cn"]').remove(),w.optCommandMode.name){case"Sequential":w.cmd=function(t){var n,a,o;switch(t){case"ShowSelectedEdges":var r=x.$('node[nodeType="patient"]:selected, node[nodeType="gene"]:selected');if(0===r.length)return;r.neighborhood("edge").remove(),n=F(t),T(n);break;case"HideAllEdges":x.$('edge[edgeType="cn"]').remove();break;case"HideSelectedEdges":x.$('node[nodeType="patient"]:selected, node[nodeType="gene"]:selected').neighborhood("edge").remove();break;case"HideUnselectedEdges":x.$('node[nodeType="patient"]:unselected').neighborhood("edge").remove();break;case"SelectConnected":x.startBatch(),x.$("node:selected").neighborhood("node").forEach(function(e){e.select()}),x.endBatch();break;case"SelectInverse":x.startBatch(),x.$("node").forEach(function(e){e[e._private.selected?"deselect":"select"]()}),x.endBatch();break;case"HideUnselectedNodes":x.startBatch(),x.$('node[nodeType="patient"]:unselected').forEach(function(e){e.style({display:"none"})}),x.endBatch();break;case"ShowAllNodes":x.startBatch(),x.$('node[nodeType="patient"]:hidden').forEach(function(e){e.style({display:"element"})}),x.endBatch();break;case"LaunchCbio":if(a=x.$('node[nodeType="gene"]:selected').map(function(e){return e.data().id}),0===a.length)alert("Please select genes from the chromosome view and try again.");else{a=a.join("%20");var s=e.getDataSource().cBio;o="http://www.cbioportal.org/index.do?gene_list="+a+"&Action=Submit&cancer_study_id="+s+"&case_set_id="+s+"_cnaseq&genetic_profile_ids_PROFILE_MUTATION_EXTENDED="+s+"_mutations&genetic_profile_ids_PROFILE_COPY_NUMBER_ALTERATION="+s+"_gistic&tab_index=tab_visualize",c.open(o)}break;case"LaunchGeneCards":a=x.$('node[nodeType="gene"]:selected').map(function(e){return e.data().id}),0===a.length?alert("Please select genes from the chromosome view and try again."):(a=a.join("%20"),o="http://www.genecards.org/Search/Symbol?queryString="+a,c.open(o));break;case"LaunchPwc":a=x.$('node[nodeType="gene"]:selected').map(function(e){return e.data().id}),0===a.length?alert("Please select genes from the chromosome view and try again."):(a=a.join(","),o="http://www.pathwaycommons.org/pcviz/#pathsbetween/"+a,c.open(o));break;default:n=F(t),T(n)}},v.patients.select.add(B),v.patients.unselect.add(B),v.genes.over.add($),v.genes.out.add($),v.genes.select.add(h),v.genes.unselect.add(h),v.patients.over.add(O),v.patients.out.add(O),v.patients.select.add(m),v.patients.unselect.add(m);break;case"Set":var t=function(){x.$('edge[edgeType="cn"]').remove();var e=F();(e.patients.selected.length>0||e.genes.selected.length>0)&&T(e),m(e)},n=function(){x.$('edge[edgeType="cn"]').remove();var e=F();T(e),m(e)},a=function(){x.$('edge[edgeType="cn"]').remove();var e=F();(e.patients.selected.length>0||e.genes.selected.length>0)&&T(e),h(e)},o=function(){x.$('edge[edgeType="cn"]').remove();var e=F();T(e),h(e)};v.patients.select.add(B),v.patients.unselect.add(B),v.genes.over.add($),v.genes.out.add($),v.patients.over.add(O),v.patients.out.add(O),v.patients.select.add(n),v.patients.unselect.add(t),v.genes.select.add(o),v.genes.unselect.add(a);break;case"Ad Hoc":var r=function(e){x.nodes().unselect(),e.cyTarget.select(),T(F())},s=function(e){e.cyTarget.unselect(),x.startBatch(),x.$('edge[edgeType="cn"]').remove(),x.$('node[nodeType="gene"]').forEach(function(e){e.data("color","#0096d5"),e.data("sizeBdr",1),e.data("colorBdr","#FFFFFF")}),x.endBatch()};v.genes.over.add($),v.genes.out.add($),v.patients.over.add(O),v.patients.out.add(O),v.patients.over.add(r),v.patients.out.add(s),v.genes.over.add(r),v.genes.out.add(s)}});var R=function(e){if(null!==e){if(y.setColors(e),w.showPanelColor=!1,w.legendCaption=e.name,"None"==e.name)return w.legendCaption="",x.startBatch(),x.nodes('node[nodeType="patient"]').forEach(function(e){e.data("color","#0096d5")}),void x.endBatch();var t=e.data.reduce(function(e,t){for(var n=0;n<t.values.length;n++)e[t.values[n]]=t.color;return e},{});x.startBatch(),x.nodes('node[nodeType="patient"]').forEach(function(e){t.hasOwnProperty(e.id())?e.data("color",t[e.id()]):e.data("color","#DDDDDD")}),x.endBatch();var n=d.uniq(x.nodes('node[nodeType="patient"]').map(function(e){return e.data().color}));w.legendNodes=e.data.filter(function(e){return d.contains(n,e.color)}),a(B)}};e.onPatientColorChange.add(R),o.$on("$destroy",function(){y.save(w,x),e.onPatientColorChange.remove(R),f.terminate(),v.clear()})}e.$inject=["osApi","d3","$state","$timeout","$scope","$stateParams","cytoscape","signals","moment","$window","_","$q"];var t={restrict:"E",templateUrl:"app/components/markers/markers.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osMarkers",e)}(),function(){"use strict";function e(){function e(e,t,n,a){var o=this;o.networks=a.getAuthSources(),o.login=a.login;var r=function(){t.go("datasource")};a.onLogin.add(r),n.$on("$destroy",function(){a.onLogin.remove(r)})}e.$inject=["osApi","$state","$scope","osAuth"];var t={restrict:"E",templateUrl:"app/components/login/login.html",replace:!0,controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osLogin",e)}(),function(){"use strict";function e(){var e={restrict:"E",templateUrl:"app/components/loader/loader.html",replace:!0};return e}angular.module("oncoscape").directive("osLoader",e)}(),function(){"use strict";function e(){function e(e,t,n){var a=this;a.showPanelColorRna=!1,a.colorScales=[{name:"Quantile"},{name:"Quantize"}],a.colorScale=a.colorScales[0],a.colorBins=[2,3,4,5,6,7,8].map(function(e){return{name:e+" Bins",value:e}}),a.colorBin=a.colorBins[2],a.colorOptions=e.getDataSource().colors,angular.isDefined(a.colorOptions)&&0!==a.colorOptions.length&&(a.colorOption=a.colorOptions[0]);var o=e.getDataSource().category.filter(function(e){return"color"==e.type})[0].collection;e.query(o,{type:"color",dataset:e.getDataSource().disease,$fields:["name","subtype"]}).then(function(e){var t=e.data.reduce(function(e,t){return e.hasOwnProperty(t.subtype)||(e[t.subtype]=[]),e[t.subtype].push(t),e},{});a.optPatientColors=Object.keys(t).map(function(e){return{name:e,values:this[e].sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})}},t)}),a.setColor=function(t){return e.setBusy(!0),a.close(),"None"==t.name?void e.setPatientColor({dataset:e.getDataSource().disease,type:"color",name:"None",data:[],show:!0}):void e.query(o,{type:"color",dataset:e.getDataSource().disease,name:t.name}).then(function(t){var n=t.data[0];n.data=n.data.map(function(e){var t=e.name.toLowerCase().trim();return(""===t||"null"==t||"undefined"==t)&&(e.name="Null",e.color="#DDDDDD"),e.id="legend-"+e.color.substr(1),e}).sort(function(e,t){var n=isNaN(e.name)?e.name:parseInt(e.name),a=isNaN(t.name)?t.name:parseInt(t.name);return a>n?-1:n>a?1:"Null"==e.name?1:"Null"==t.name?-1:0}),e.setPatientColor(t.data[0]),e.setBusy(!1),a.close()})},a.setGeneColor=function(){var o=("+"+a.geneColor.replace(/\s/g,"").toUpperCase()).match(/[-+]\w*/gi).map(function(e){return{op:e.substr(0,1),gene:e.substr(1).toLowerCase(),message:"",status:""}});e.setBusy(!0),e.query("lookup-genes",{symbols:{$in:o.map(function(e){return e.gene})}}).then(function(r){a.close(),o.map(function(e){var t=this.filter(function(e){return-1!=e.symbols.indexOf(this)},e.gene);0===t.length?(e.message=e.gene.toUpperCase(),e.status="Removed"):t.length>1?(e.message=e.gene.toUpperCase()+" -> "+t[0].hugo.toUpperCase(),e.status="Converted"):1==t.length&&e.gene!=t[0].hugo&&(e.message=e.gene.toUpperCase()+" -> "+t[0].hugo.toUpperCase(),e.status="Converted")},r.data);var s=n.sortBy(o.filter(function(e){return""!==e.status}),"length"),i=n.groupBy(s,function(e){return e.status}),l="";angular.isDefined(i.Removed)&&i.Removed.length>0&&(l+="Removed: "+i.Removed.map(function(e){return e.message+" - "})),l.length>0&&(l=l.substr(0,l.length-2)+"\r\n"),angular.isDefined(i.Converted)&&i.Converted.length>0&&(l+="Converted: "+i.Converted.map(function(e){return e.message+"\r\n"})),l.trim().length>0&&alert(l);var c=o.filter(function(e){return"Removed"!=e.status}).map(function(e){return e.gene.toUpperCase()});e.query(a.colorOption.collection,{gene:{$in:c}}).then(function(r){if(r.data.length>0){var s;if(1==r.data.length)s=r.data[0];else{s={},s.patients=r.data.reduce(function(e,t){for(var n=e.lookup[t.gene],a=0;a<e.pids.length;a++){var o=e.pids[a],r=e.output.hasOwnProperty(o)?e.output[o]:0;"+"===n&&(e.output[o]=r+t.patients[o]),"-"===n&&(e.output[o]=r-t.patients[o])}return e},{pids:Object.keys(r.data[0].patients),lookup:o.reduce(function(e,t){return e[t.gene]=t.op,e},{}),output:{}}).output;var i=Object.keys(s.patients).reduce(function(e,t){return e.min=Math.min(e.min,e.values[t]),e.max=Math.max(e.min,e.values[t]),e},{values:s.patients,min:1/0,max:-(1/0)});s.min=i.min,s.max=i.max}var l,c=["#9d1cb2","#00a7f7","#3d4eb8","#ff9900","#f7412d","#795548","#E91E63","#673AB7"],d=c.splice(0,a.colorBin.value),u="Quantile"==a.colorScale.name?t.scaleQuantile():t.scaleQuantize();"Quantile"==a.colorScale.name?(u.domain(Object.keys(s).map(function(e){return s[e]},{data:s})).range(d),l=u.quantiles().map(function(e){return parseFloat(e).toFixed(3)}),l.unshift(""),l=l.map(function(e,t,n){return 0===t?"-  "+n[1]:t==n.length-1?n[t]+"  +":n[t]+"  "+n[t+1]}),d=n.zip(d,l).map(function(e){return{color:e[0],name:e[1]}})):(u.domain([s.min,s.max]).range(d),l=u.ticks(d.length).map(function(e){return"~"+parseFloat(e).toFixed(2)}),d=n.zip(d,l).map(function(e){return{color:e[0],name:e[1]}})),s=Object.keys(s.patients).map(function(e){return{id:e,color:this.scale(this.patients[e]),value:this.patients[e]}},{patients:s.patients,scale:u}).reduce(function(e,t){return e.hasOwnProperty(t.color)||(e[t.color]=[]),e[t.color].push(t.id),e},{}),s=Object.keys(s).map(function(e){return{color:e,name:this.names.filter(function(e){return e.color==this.color},{color:e})[0].name,values:this.data[e]}},{data:s,names:d}),s=s.sort(function(e,t){return-1!=e.name.indexOf("-")?-1:-1!=t.name.indexOf("-")?1:-1!=e.name.indexOf("+")?1:-1!=t.name.indexOf("+")?-1:e.name<t.name?-1:e.name>t.name?1:0}),s.push({color:"#DDD",name:"Null",values:[]}),c={dataset:e.getDataSource().disease,type:"color",name:o.reduce(function(e,t){return e+=t.op+t.gene+" "},""),data:s},e.setPatientColor(c)}e.setBusy(!1)})})}}e.$inject=["osApi","d3","_"];var t={restrict:"E",templateUrl:"app/components/layoutPanel/layoutPanel.html",controller:e,controllerAs:"vm",bindToController:!0,scope:{close:"&"}};return t}angular.module("oncoscape").directive("osLayoutPanel",e)}(),function(){"use strict";function e(){function e(e){angular.element(".marquee-x").marquee({particlesNumber:79,color:"#1396de",particle:{speed:39}});var t=this;t.login=function(){e.go("login")},t.getStarted=function(){e.go("datasource")}}e.$inject=["$state"];var t={restrict:"E",templateUrl:"app/components/landing/landing.html",replace:!0,controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osLanding",e)}(),function(){"use strict";function e(){function e(){}var t={restrict:"E",templateUrl:"app/components/help/help.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osHelp",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,r,s,i){function l(t,n,a,o,r,s,i){if(t.select("g").remove(),i?p.colLabels:p.rowLabels){t.attr("width",a).attr("height",o).style("position","absolute").style("left",r).style("top",s);var l=t.append("g"),c=e.scaleLinear().domain([0,n.length]).range([0,i?a:o]),d="start",u=i?20:10,m=l.selectAll("label").data(n);m.enter().append("text").attr(i?"x":"y",function(e,t){return c(t+.8)}).attr(i?"y":"x",u).attr("text-anchor",d).attr("font-size","12px").text(function(e){return e})}}function c(t,n,a,o,r,s,i){if(t.select("g").remove(),i?p.colDendrogram:p.rowDendrogram){var l=e.hierarchy(n),c=e.cluster().separation(function(){return 1}).size(i?[a,o]:[o,a]),d=e.scaleLinear().domain([0,i?o:a]).range([0,i?o:a]),u=e.scaleLinear().domain([0,n.height]).range([i?o:a,0]),m=c(l),h=m.links().map(function(e){return{source:{x:e.source.x,y:e.source.data.height},target:{x:e.target.x,y:e.target.data.height},edgePar:e.target.data.edgePar}}),g=t.attr("width",a).attr("height",o).style("position","absolute").style("left",r).style("top",s).append("g");if(g.append("rect").attr("width",i?o:a).attr("height",i?a:o).style("fill","#FFF"),i){var f="rotate(90,"+o/2+","+o/2+") translate(0,"+(-a+o)+")";g.attr("transform",f)}var v=g.selectAll("polyline").data(h);return v.enter().append("polyline").attr("class","denolink").attr("points",function(e){return u(e.source.y)+","+e.source.x+" "+u(e.source.y)+","+e.target.x+" "+u(e.target.y)+","+e.target.x}).style("stroke",function(e){return e.edgePar.col}),{g:g,scaleY:u,scaleX:d,rotated:i,data:h}}}function d(t,n,a,o,r,s){function i(){if(e.event.sourceEvent&&e.event.selection){e.event.selection.map(function(e){return this.invert(e[0],e[1])},f).map(Math.round);var t=e.event.selection;t[0][1]=0,t[1][1]=o,e.select(this).transition().call(e.event.target.move,t)}}t.select("g").remove(),t.attr("width",a).attr("height",o).style("left",r).style("top",s).style("position","absolute");var l=t.append("g").attr("width",a).attr("height",o),c=t.append("g").attr("width",a).attr("height",o).attr("class","brush"),d=Math.max.apply(null,n.data),u=Math.min.apply(null,n.data),m=e.scaleLinear().domain([u,d]).range(p.colorScheme.value),h=n.dim[0],g=n.dim[1],f=e.scaleLinear().domain([0,h]).range([0,a]),v=e.scaleLinear().domain([0,g]).range([0,o]),y=p.gridlines?1:-1;c.call(e.brush().on("end",i));var b=f(1)-y,x=v(1)-y,w=l.selectAll("rect").data(n.data);return w.enter().append("rect").attr("class","box").attr("colIndex",function(e,t){return t%h}).attr("rowIndex",function(e,t){return Math.floor(t/h)}).attr("x",function(e,t){return f(t%h)}).attr("y",function(e,t){return v(t%g)}).attr("width",b).attr("height",x).attr("fill",function(e){return m(e)}),{g:l,scaleY:v,scaleX:f,data:n.data,cols:h,rows:g,boxW:b,boxH:x}}function u(){}var p=this;p.datasource=t.getDataSource(),p.rowLabels=p.colLabels=p.gridlines=!1,p.rowDendrogram=p.colDendrogram=!0,p.colorSchemes=[{name:"Blues",value:["#303f9f","#03a9f4"]},{name:"Black / Blue",value:["#000000","#1d85cb"]},{name:"Black / Red",value:["#000000","#D32F2F"]},{name:"Red / Yellow",value:["#D32F2F","#FFEB3B"]}],p.colorScheme=p.colorSchemes[0],p.scales=[{name:"None"},{name:"Row"},{name:"Column"}],p.scale=p.scales[2],p.dendrogramClusters=[{name:"One",value:1},{name:"Two",value:2},{name:"Three",value:3},{name:"Four",value:4},{name:"Five",value:5},{name:"Six",value:6},{name:"Seven",value:7},{name:"Eight",value:8},{name:"Nine",value:9},{name:"Ten",value:10}],p.dendrogramCluster=p.dendrogramClusters[6];var m,h,g=e.select("#heatmap-chart"),f=g.append("svg").classed("dendrogram colDend",!0),v=g.append("svg").classed("dendrogram rowDend",!0),y=g.append("svg").classed("colormap",!0),b=g.append("svg").classed("axis xaxis",!0),x=g.append("svg").classed("axis yaxis",!0);t.setBusy(!0),p.loadData=function(){t.query("brca_psi_bradleylab_miso",{$limit:100}).then(function(e){m={data:e.data.map(function(e){return Object.keys(e.patients).forEach(function(e){null==this[e]&&(this[e]=0)},e.patients),e.patients})},p.loadHeatmap()})},p.loadHeatmap=function(){t.setBusy(!0),v.select("g").remove(),f.select("g").remove(),y.select("g").remove(),m.scale=p.scale.name.toLowerCase(),m.kcol=m.krow=p.dendrogramCluster.value,t.getCpuApi().getHeatmap(m).then(function(e){h=angular.fromJson(e),p.draw(),t.setBusy(!1)})},p.draw=function(){var e=t.getLayout(),n=s.innerWidth-e.left-e.right-40,a=s.innerHeight-160,o=n-(p.rowLabels?160:0)-(p.rowDendrogram?80:0),r=a-(p.colLabels?160:0)-(p.colDendrogram?80:0);d(y,h.matrix,o,r,(p.rowDendrogram?80:0)+e.left+20,p.colDendrogram?80:0),c(v,h.rows,80,r,e.left+20,p.colDendrogram?80:0,!1),c(f,h.cols,o,80,(p.rowDendrogram?80:0)+e.left+20,0,!0),l(b,h.matrix.rows,160,r,o+(p.rowDendrogram?80:0)+e.left+20,p.colDendrogram?80:0,!1),l(x,h.matrix.cols,o,160,(p.rowDendrogram?80:0)+e.left+20,r+(p.colDendrogram?80:0),!0),u()},p.loadData(),t.onResize.add(p.draw),angular.element(s).bind("resize",i.debounce(p.draw,300))}e.$inject=["d3","osApi","$state","$timeout","$scope","$stateParams","$window","_"];var t={restrict:"E",templateUrl:"app/components/heatmap/heatmap.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osHeatmap",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o){var r=this;r.showImport=!1,r.showTools=!1,r.showDatasets=!1,r.datasources=[],r.tools=[],r.cohorts=[],e.onNavChange.add(function(t){switch(t){case"TOOLS":r.showTools=!1,r.showDatasets=!1;break;case"TOOL":r.showTools=!0,r.showDatasets=!0,r.datasources=e.getDataSources(),r.tools=e.getTools(),r.cohorts=e.getCohorts();break;default:r.showTools=!1,r.showDatasets=!1}}),r.addPatientCohort=function(){e.saveCohort()},r.setPatientCohort=function(t){e.setCohort(t)},r.importIds="",r.importCohort=function(){var t=r.importIds.split(",").map(function(e){return e.trim()});e.importIds(t,r.importName),r.importIds="",r.importName="",r.showImport=!1},r.logout=function(){localStorage.clear(),o.location.href="#"},r.showHelp=function(){o.open("\\documentation"+a.current.help.toString())},e.onCohortsChange.add(function(){r.cohorts=e.getCohorts()}),r.loadDataset=function(e){angular.element(".navbar-collapse").collapse("hide"),a.go(a.current.url.split("/")[1],{datasource:e})},r.loadTool=function(t){a.go(t,{datasource:e.getDataSource().disease}),angular.element(".navbar-collapse").collapse("hide")}}e.$inject=["osApi","osAuth","$stateParams","$state","$window"];var t={restrict:"E",templateUrl:"app/components/header/header.html",scope:{},controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osHeader",e)}(),function(){"use strict";function e(){function e(e,t){var n=this;n.datasets=e.getDataSources(),n.explore=function(e,n){t.go(e,{datasource:n.disease})},e.setBusy(!1)}e.$inject=["osApi","$state"];var t={restrict:"E",templateUrl:"app/components/datasource/datasource.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osDatasource",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,r,s,i,l,c,d){function u(){S.forEach(function(e){e.attr("transform",t.event.transform)})}var p=e.getLayout(),m=d.innerWidth-p.left-p.right,h=d.innerHeight-120,g=t.zoom().scaleExtent([1,40]).translateExtent([[-100,-100],[m+90,h+100]]).on("zoom",u),f=e.getCohort(),v=function(e){f=e,M()};e.onCohortChange.add(v);var y=e.getDataSource(),b=this;b.optionColors=[],b.optionLayouts=[];var x=[0,1,2,3,4,5,6,7,8],w=[],A=[],C=t.select("#compareclusterChart").append("svg:svg"),k=x.map(function(){return t.brush()});C.call(g);var S=x.map(function(){return C.append("svg:g")}),E=S.map(function(e){return e.append("svg:rect")});E.forEach(function(e){e.attr("fill","black"),e.attr("opacity",0)});var P=[0,1,2,3].map(function(){return C.append("svg:line")});P.forEach(function(e){e.attr("stroke","#cbcbcb"),e.attr("stroke-width","1px")});var M=function(){var e=f.sampleIds;x.forEach(function(t){S[t].selectAll("circle").classed("pca-node-selected",function(){return e.indexOf(this.__data__.id)>=0})})},D=function(){return b.optionLayouts=y.calculated.filter(function(e){return"pcaScores"===e.type||"mds"===e.type}),new Promise(function(t){e.query("brain_color_tcga_import").then(function(e){b.optionColors=e.data.map(function(e){return e.lookup=e.data.map(function(e){var t=e.values.reduce(function(e,t){return e[t]=e.color,e},{color:null===e.color?"black":e.color});return delete t.color,t}).reduce(function(e,t){return i.extend(e,t),e},{}),e}),A=b.optionLayouts.splice(0,9).map(function(e){return{name:e.collection}}),w=b.optionColors.splice(0,9),t()})})},T=function(){if(null!==t.event.selection){var e=t.event.target;k.filter(function(t){return t.brush!==e}).forEach(function(e){S[e.index].call(e.move,null)})}},F=function(){if(null===t.event.selection)return void C.selectAll("circle").classed("pca-node-selected",!1);var e=t.event.target,n=t.event.selection,a=e.xScale,o=e.yScale,r=a.invert(n[0][0]),s=a.invert(n[1][0]),i=o.invert(n[0][1]),l=o.invert(n[1][1]);C.selectAll("circle").classed("pca-node-selected",function(e){return e.x>=r&&e.x<=s&&e.y>=i&&e.y<=l})},L=function(t){return new Promise(function(n){var a=A[t].name;e.query(a).then(function(e){var a=e.data[0].data;e.data[0].domain=Object.keys(a).reduce(function(e,t){var n=a[t];return isNaN(n.x)||isNaN(n.y)?e:(e.pc1[0]=Math.min(e.pc1[0],n.x),e.pc1[1]=Math.max(e.pc1[1],n.x),e.pc2[0]=Math.min(e.pc2[0],n.y),e.pc2[1]=Math.max(e.pc2[1],n.y),e)},{pc1:[1/0,-(1/0)],pc2:[1/0,-(1/0)]}),e.data[0].bind=Object.keys(a).map(function(e){var t=a[e];return t.id=e,t}),A[t].data=e.data[0],n(e.data[0])})})};D().then(function(){Promise.all(x.map(function(e){return L(e)})).then(function(){B(),M()})});var B=function(){O(),x.forEach($)},O=function(){var t=e.getLayout(),n=d.innerWidth-t.left-t.right,a=d.innerHeight-120;P[0].attr("x1",0).attr("y1",a*(1/3)).attr("x2",n).attr("y2",1*a/3),P[1].attr("x1",0).attr("y1",a*(2/3)).attr("x2",n).attr("y2",2*a/3),P[2].attr("x1",n*(1/3)).attr("y1",0).attr("x2",n*(1/3)).attr("y2",a),P[3].attr("x1",n*(2/3)).attr("y1",0).attr("x2",n*(2/3)).attr("y2",a)},$=function(n){var a=e.getLayout(),o=d.innerWidth-a.left-a.right,r=d.innerHeight-120;C.attr("width",o).attr("height",r);var s=Math.floor(o/3),i=Math.floor(r/3),l=E[n];l.attr("width",s).attr("height",i);var c=A[n].data,u=t.scaleLinear().domain(c.domain.pc1).range([5,Math.min(s)-5]),p=t.scaleLinear().domain(c.domain.pc2).range([5,Math.min(i)-5]),m=S[n],h=k[n];h.on("start",T),h.on("end",F),h.extent([[0,0],[s,i]]),m.call(h),h.index=n,h.xScale=u,h.yScale=p,m.attr("transform","translate("+n%3*s+","+parseInt(n/3)*i+")");var g=m.selectAll("circle").data(c.bind);g.enter().append("svg:circle").attr("cx",0).attr("cy",0).attr("class","point").attr("r",1).style("fill",function(e){return w[n].lookup[e.id]}).attr("cx",function(e){return u(e.x)}).attr("cy",function(e){return p(e.y)}),g.exit().transition().duration(200).delay(function(e,t){return t/300*100}).style("fill-opacity","0").remove(),g.transition().duration(750).attr("cx",function(e){return u(e.x)}).attr("cy",function(e){return p(e.y)})};e.onResize.add(B)}e.$inject=["osApi","d3","$state","$timeout","$scope","moment","$stateParams","_","$","$q","$window"];var t={restrict:"E",templateUrl:"app/components/compareclusters/compareclusters.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osCompareCluster",e)}(),function(){"use strict";function e(){function e(e,t,n){var a=this;a.showPanelColorRna=!1,a.colorScales=[{name:"Quantile"},{name:"Quantize"}],a.colorScale=a.colorScales[0],a.colorBins=[2,3,4,5,6,7,8].map(function(e){return{name:e+" Bins",value:e}}),a.colorBin=a.colorBins[2],a.colorOptions=e.getDataSource().colors,angular.isDefined(a.colorOptions)&&0!==a.colorOptions.length&&(a.colorOption=a.colorOptions[0]);var o=e.getDataSource().category.filter(function(e){return"color"==e.type})[0].collection;e.query(o,{type:"color",dataset:e.getDataSource().disease,$fields:["name","subtype"]}).then(function(e){var t=e.data.reduce(function(e,t){return e.hasOwnProperty(t.subtype)||(e[t.subtype]=[]),e[t.subtype].push(t),e},{}),n=/(\d+%)/i;a.optPatientColors=Object.keys(t).map(function(e){return{name:e,values:this[e].filter(function(e){var t=e.name.match(n);return null===t?!0:parseInt(t[0])>10?!0:void 0}).sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})}},t)}),a.resetColor=function(){e.setPatientColor({dataset:e.getDataSource().disease,type:"color",name:"None",data:[],show:!0})},a.setColor=function(t){return e.setBusy(!0),a.close(),"None"==t.name?void e.setPatientColor({dataset:e.getDataSource().disease,type:"color",name:"None",data:[],show:!0}):void e.query(o,{type:"color",dataset:e.getDataSource().disease,name:t.name}).then(function(t){var n=t.data[0];n.data=n.data.map(function(e){var t=e.name.toLowerCase().trim();return(""===t||"null"==t||angular.isUndefined(t))&&(e.name="Null",e.color="#DDDDDD"),e.id="legend-"+e.color.substr(1),e}).sort(function(e,t){var n=isNaN(e.name)?e.name:parseInt(e.name),a=isNaN(t.name)?t.name:parseInt(t.name);return a>n?-1:n>a?1:"Null"==e.name?1:"Null"==t.name?-1:0}),e.setPatientColor(t.data[0]),e.setBusy(!1),a.close()})},a.setGeneColor=function(){var o=("+"+a.geneColor.replace(/\s/g,"").toUpperCase()).match(/[-+]\w*/gi).map(function(e){return{op:e.substr(0,1),gene:e.substr(1).toLowerCase(),message:"",status:""}});e.setBusy(!0),e.query("lookup-genes",{symbols:{$in:o.map(function(e){return e.gene})}}).then(function(r){a.close(),o.map(function(e){var t=this.filter(function(e){return-1!=e.symbols.indexOf(this)},e.gene);0===t.length?(e.message=e.gene.toUpperCase(),e.status="Removed"):t.length>1?(e.message=e.gene.toUpperCase()+" -> "+t[0].hugo.toUpperCase(),e.status="Converted"):1==t.length&&e.gene!=t[0].hugo&&(e.message=e.gene.toUpperCase()+" -> "+t[0].hugo.toUpperCase(),e.status="Converted")},r.data);var s=n.sortBy(o.filter(function(e){return""!==e.status}),"length"),i=n.groupBy(s,function(e){return e.status}),l="";angular.isDefined(i.Removed)&&i.Removed.length>0&&(l+="Removed: "+i.Removed.map(function(e){return e.message+" - "})),l.length>0&&(l=l.substr(0,l.length-2)+"\r\n"),angular.isDefined(i.Converted)&&i.Converted.length>0&&(l+="Converted: "+i.Converted.map(function(e){return e.message+"\r\n"})),l.trim().length>0&&alert(l);var c=o.filter(function(e){return"Removed"!=e.status}).map(function(e){return e.gene.toUpperCase()});e.query(a.colorOption.collection,{gene:{$in:c}}).then(function(r){if(r.data.length>0){var s;if(1==r.data.length)s=r.data[0];else{s={},s.patients=r.data.reduce(function(e,t){for(var n=e.lookup[t.gene],a=0;a<e.pids.length;a++){var o=e.pids[a],r=e.output.hasOwnProperty(o)?e.output[o]:0;"+"===n&&(e.output[o]=r+t.patients[o]),"-"===n&&(e.output[o]=r-t.patients[o])}return e},{pids:Object.keys(r.data[0].patients),lookup:o.reduce(function(e,t){return e[t.gene]=t.op,e},{}),output:{}}).output;var i=Object.keys(s.patients).reduce(function(e,t){return e.min=Math.min(e.min,e.values[t]),e.max=Math.max(e.min,e.values[t]),e},{values:s.patients,min:1/0,max:-(1/0)});s.min=i.min,s.max=i.max}var l,c=["#9d1cb2","#00a7f7","#3d4eb8","#ff9900","#f7412d","#795548","#E91E63","#673AB7"],d=c.splice(0,a.colorBin.value),u="Quantile"==a.colorScale.name?t.scaleQuantile():t.scaleQuantize();"Quantile"==a.colorScale.name?(u.domain(Object.keys(s).map(function(e){return s[e]},{data:s})).range(d),l=u.quantiles().map(function(e){return parseFloat(e).toFixed(3)}),l.unshift(""),l=l.map(function(e,t,n){return 0===t?"-  "+n[1]:t==n.length-1?n[t]+"  +":n[t]+"  "+n[t+1]}),d=n.zip(d,l).map(function(e){return{color:e[0],name:e[1]}})):(u.domain([s.min,s.max]).range(d),l=u.ticks(d.length).map(function(e){return"~"+parseFloat(e).toFixed(2)}),d=n.zip(d,l).map(function(e){return{color:e[0],name:e[1]}})),s=Object.keys(s.patients).map(function(e){return{id:e,color:this.scale(this.patients[e]),value:this.patients[e]}},{patients:s.patients,scale:u}).reduce(function(e,t){return e.hasOwnProperty(t.color)||(e[t.color]=[]),e[t.color].push(t.id),e},{}),s=Object.keys(s).map(function(e){return{color:e,name:this.names.filter(function(e){return e.color==this.color},{color:e})[0].name,values:this.data[e]}},{data:s,names:d}),s=s.sort(function(e,t){return-1!=e.name.indexOf("-")?-1:-1!=t.name.indexOf("-")?1:-1!=e.name.indexOf("+")?1:-1!=t.name.indexOf("+")?-1:e.name<t.name?-1:e.name>t.name?1:0}),s.push({color:"#DDD",name:"Null",values:[]}),c={dataset:e.getDataSource().disease,type:"color",name:o.reduce(function(e,t){return e+=t.op+t.gene+" "},""),data:s},e.setPatientColor(c)}e.setBusy(!1)})})}}e.$inject=["osApi","d3","_"];var t={restrict:"E",templateUrl:"app/components/colorpanel/colorpanel.html",
controller:e,controllerAs:"vm",bindToController:!0,scope:{close:"&"}};return t}angular.module("oncoscape").directive("osColorPanel",e)}(),function(){"use strict";function e(){function e(e,t,n,a,o,r,s,i){var l=this;l.cohorts=[],l.cohort=null,l.cohortFeatures=[],l.cohortFeature=null,l.cohortSummary="",e.onCohortsChange.add(function(e){l.cohorts=e,w(e)}),e.onCohortChange.add(function(t){var n=e.getCohortDatasetInfo(),r=s("number")(n.numSamples)+" Samples In Dataset<br /> "+s("number")(n.numPatients)+" Patients In Dataset<br /> "+s("number")(t.numSamples)+" Samples In Current Cohort<br /> "+s("number")(t.numPatients)+" Patients In Current Cohort<br />"+s("number")(t.numClinical)+" Patients with Clinical Data<br />"+s("number")(t.survival.data.tte.length)+" Patients with Survival Outcome<br />";l.cohortSummary=a.trustAsHtml(r),angular.isUndefined(t)||(o(function(){var e=null!==l.cohortFeature?l.cohortFeatures.indexOf(l.cohortFeature):0;l.cohort=t,l.cohortFeatures=t.histogram.features,l.cohortFeature=t.histogram.features[e]}),w(l.cohorts.concat([t])))}),l.setCohort=function(t){angular.isString(t)?e.setCohort([],e.ALL,e.SAMPLE):e.setCohort(t)},l.updateCohort=function(){"UNSAVED"==l.cohort.type?e.saveCohort(l.cohort):e.deleteCohort(l.cohort)};var c=angular.element(".cohort-menu"),d=!0,u=function(){c.removeClass("tray-collapsed-left")},p=function(){c.addClass("tray-collapsed-left")};l.toggle=function(){d=!d,angular.element("#cohortmenu-lock").addClass(d?"fa-lock":"fa-unlock-alt").removeClass(d?"fa-unlock-alt":"fa-lock").attr("locked",d?"true":"false"),d?c.unbind("mouseover",u).unbind("mouseout",p).removeClass("tray-collapsed-left"):c.addClass("tray-collapsed-left").bind("mouseover",u).bind("mouseout",p),e.onResize.dispatch()};var m=i.select("#cohortmenu-chart").append("svg").attr("width",260).attr("height",150).append("g"),h=angular.element("#cohortmenu-single-value"),g=i.tip().attr("class","tip").offset([-8,0]).html(function(e){return"Range: "+e.label+"<br>Count: "+e.value+" of "+l.cohortFeature.data.count+"<br>Percent: "+s("number")(e.value/l.cohortFeature.data.count*100,2)+"%"});m.call(g),n.$watch("vm.cohortFeature",function(){if(null!==l.cohortFeature){var e=l.cohortFeature.data;if("factor"==e.type){if(1==e.hist.length)return h.text(e.hist[0].label).css("display","block").removeClass("cohortmenu-single-value-numeric"),void m.classed("cohort-chart-hide",!0)}else if(e.min==e.max)return h.text(e.min).css("display","block").addClass("cohortmenu-single-value-numeric"),void m.classed("cohort-chart-hide",!0);h.text("").css("display","none"),m.classed("cohort-chart-hide",!1);var t=Math.floor((250-e.bins)/e.bins);e.histRange[0]>0&&(e.histRange[0]-=2);var n=i.scaleLinear().domain([0,e.histRange[1]]).range([0,135]),a=m.selectAll(".cohort-menu-chart-bar").data(e.hist);a.enter().append("rect").attr("class","cohort-menu-chart-bar").attr("x",function(e,n){return(t+1)*n+5}).attr("y",function(e){return 150-n(e.value)}).attr("height",function(e){return n(e.value)}).attr("width",t).on("mouseover",g.show).on("mouseout",g.hide),a.transition().duration(300).attr("x",function(e,n){return(t+1)*n+5}).attr("y",function(e){return 150-n(e.value)}).attr("height",function(e){return n(e.value)}).attr("width",t),a.exit().transition().duration(300).attr("y",150).attr("height",0).style("fill-opacity",1e-6).remove();var o=m.selectAll("text").data(e.hist);o.enter().append("text").attr("x",function(e,n){return 4+(t+1)*n+.5*t+1}).attr("y",function(e){return 145-n(e.value)}).attr("fill","#000").attr("height",function(e){return n(e.value)}).attr("width",t).attr("font-size","8px").attr("text-anchor","middle").text(function(e){return e.label}),o.transition().duration(300).attr("x",function(e,n){return(t+1)*n+.5*t+5}).attr("y",function(e){var t=145-n(e.value);return 0>t&&(t=20),t}).text(function(e){return e.label}),o.exit().transition().duration(300).attr("y",150).attr("height",0).style("fill-opacity",1e-6).remove()}});var f=function(e){return 0===Math.abs(e)?e:Math.abs(e)<30?e+" Days":Math.abs(e)<360?Math.round(e/30.4*10)/10+" Mos":Math.round(e/365*10)/10+" Yrs"},v=i.select("#cohortmenu-survival").append("svg"),y=v.append("g").selectAll("cohortmenu-survival-percent-line").data([.25,.5,.75]);y.enter().append("line").attr("class","cohortmenu-survival-percent-line").attr("stroke-width",1).attr("stroke","#EAEAEA").attr("x1",0).attr("x2",250).attr("y1",function(e){return 140*e}).attr("y2",function(e){return 140*e});var b=v.append("g").attr("class","axisCohort"),x={width:250,height:170,xScale:null,yScale:null,xAxis:i.axisBottom().ticks(4).tickFormat(f)};v.attr("width","100%").attr("height",x.height);var w=function(e){var t=e.reduce(function(e,t){return e[0]=Math.min(e[0],t.survival.compute[0].t),e[1]=Math.max(e[1],t.survival.compute[t.survival.compute.length-1].t),e},[1/0,-(1/0)]);x.xScale=i.scaleLinear().domain(t).range([0,x.width-1]),x.yScale=i.scaleLinear().domain([0,1]).range([x.height-30,0]);var n=i.line().curve(i.curveStepBefore).x(function(e){return Math.round(x.xScale(e.t))}).y(function(e){return Math.round(x.yScale(e.s))});x.xAxis.scale(x.xScale),b.attr("transform","translate(0, "+x.yScale(0)+")").call(x.xAxis).selectAll("text").style("text-anchor",function(e,t){return 0===t?"start":"center"}),v.selectAll(".survival-line").remove();for(var a=0;a<e.length;a++){var o=e[a];v.append("path").datum(o.survival.compute).attr("class","survival-line").style("stroke",o.color).attr("d",n)}}}e.$inject=["osApi","$state","$scope","$sce","$timeout","$rootScope","$filter","d3"];var t={restrict:"E",templateUrl:"app/components/cohortmenu/cohortmenu.html",controller:e,controllerAs:"vm",scope:{},bindToController:!0};return t}angular.module("oncoscape").directive("osCohortMenu",e)}(),function(){"use strict";function e(){function e(e,t,n,a){function o(){clearTimeout(S),"grouped"===this.value?r():s()}function r(){b.domain([0,m]),k.transition().duration(500).delay(function(e,t){return 10*t}).attr("x",function(e,t,n){return y(e.x)+y.rangeBand()/c*n}).attr("width",y.rangeBand()/c).transition().attr("y",function(e){return b(e.y)}).attr("height",function(e){return v-b(e.y)})}function s(){b.domain([0,h]),k.transition().duration(500).delay(function(e,t){return 10*t}).attr("y",function(e){return b(e.y0+e.y)}).attr("height",function(e){return b(e.y0)-b(e.y0+e.y)}).transition().attr("x",function(e){return y(e.x)}).attr("width",y.rangeBand())}function i(e,t){function n(t){for(var n=1/(.1+Math.random()),a=2*Math.random()-.5,o=10/(.1+Math.random()),r=0;e>r;r++){var s=(r/e-a)*o;t[r]+=n*Math.exp(-s*s)}}var a,o=[];for(a=0;e>a;++a)o[a]=t+t*Math.random();for(a=0;5>a;++a)n(o);return o.map(function(e,t){return{x:t,y:Math.max(0,e)}})}var l=this;l.datasource=t.getDataSource();var c=5,d=58,u=e.layout.stack(),p=u(e.range(c).map(function(){return i(d,.1)})),m=e.max(p,function(t){return e.max(t,function(e){return e.y})}),h=e.max(p,function(t){return e.max(t,function(e){return e.y0+e.y})}),g={top:40,right:10,bottom:20,left:10},f=960-g.left-g.right,v=500-g.top-g.bottom,y=e.scaleOrdinal().domain(e.range(d)).rangeRoundBands([0,f],.08),b=e.scaleLinear().domain([0,h]).range([v,0]),x=e.scaleLinear().domain([0,c-1]).range(["#aad","#556"]),w=e.svg.axis().scale(y).tickSize(0).tickPadding(6).orient("bottom"),A=e.select("body").append("svg").attr("width",f+g.left+g.right).attr("height",v+g.top+g.bottom).append("g").attr("transform","translate("+g.left+","+g.top+")"),C=A.selectAll(".layer").data(p).enter().append("g").attr("class","layer").style("fill",function(e,t){return x(t)}),k=C.selectAll("rect").data(function(e){return e}).enter().append("rect").attr("x",function(e){return y(e.x)}).attr("y",v).attr("width",y.rangeBand()).attr("height",0);k.transition().delay(function(e,t){return 10*t}).attr("y",function(e){return b(e.y0+e.y)}).attr("height",function(e){return b(e.y0)-b(e.y0+e.y)}),A.append("g").attr("class","x axis").attr("transform","translate(0,"+v+")").call(w),e.selectAll("input").on("change",o);var S=a(function(){e.select('input[value="grouped"]').property("checked",!0).each(o)},2e3)}e.$inject=["d3","osApi","$state","$timeout"];var t={restrict:"E",templateUrl:"app/components/barchart/barchart.html",controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("oncoscape").directive("osBarchart",e)}(),function(){"use strict";function e(e,t){e.onerror=function(e,n,a,o,r){r||(r=new Error(e),r.fileName=n,r.lineNumber=a,r.columnNumber=o||0),t(r)}}e.$inject=["$window","$exceptionHandler"],angular.module("oncoscape").run(e)}(),function(){"use strict";function e(e,t){var n=function(e){return e.setBusy(!0),new Promise(function(t){e.init().then(function(){t(),angular.element("#main").removeClass("container-main-full"),angular.element("#header").css({display:"block"}),angular.element("#cohortMenu").css({display:"none"}),e.onNavChange.dispatch("")})})};n.$inject=["osApi"];var a=function(e,t){return new Promise(function(a){n(e).then(function(){e.setDataSource(t.datasource).then(function(){a(),angular.element("#cohortMenu").css({display:"none"}),e.onNavChange.dispatch("TOOLS")})})})};a.$inject=["osApi","$stateParams"];var o="",r=function(e,t){return new Promise(function(n){a(e,t).then(function(){null===e.getCohort()||t.datasource!==o?e.setDataSource(t.datasource).then(function(){n(),angular.element("#cohortMenu").css({display:"block"}),e.onNavChange.dispatch("TOOL")}):(angular.element("#cohortMenu").css({display:"block"}),e.onNavChange.dispatch("TOOL"),n()),o=t.datasource})})};r.$inject=["osApi","$stateParams"];var s=function(e,t){t(function(){angular.element("#main").addClass("container-main-full"),angular.element("#header").css({display:"none"}),angular.element("#cohortMenu").css({display:"none"}),e.onNavChange.dispatch("")},200)};s.$inject=["osApi","$timeout"],e.state("landing",{url:"/",template:"<os-landing>",datasource:!1,help:"/",resolve:{resolveLanding:s}}).state("datasource",{url:"/datasource",template:"<os-datasource>",datasource:!1,help:"/",resolve:{resolveDatasource:n}}).state("tools",{url:"/tools/{datasource}",template:"<os-tools>",datasource:!0,help:"/",resolve:{resolveTools:a}}).state("scatter",{url:"/scatter/{datasource}",template:"<os-scatter>",datasource:!1,help:"/",resolve:{resolveTool:r}}).state("spreadsheet",{url:"/spreadsheet/{datasource}",template:"<os-spreadsheet>",datasource:!0,help:"/spreadsheet.html",resolve:{resolveTool:r}}).state("plsr",{url:"/plsr/{datasource}",template:"<os-plsr>",datasource:!0,help:"/",resolve:{resolveTool:r}}).state("pca",{url:"/pca/{datasource}",template:"<os-pca>",datasource:!0,help:"/pca.html",resolve:{resolveTool:r}}).state("comparecluster",{url:"/cc/{datasource}",template:"<os-compare-cluster>",datasource:!0,help:"/",resolve:{resolveTool:r}}).state("markers",{url:"/markers/{datasource}",template:"<os-markers>",datasource:!0,help:"/markerspatients.html",resolve:{resolveTool:r}}).state("pathways",{url:"/pathways/{datasource}",template:"<os-pathways>",datasource:!0,help:"/pathways.html",resolve:{resolveTool:r}}).state("timelines",{url:"/timelines/{datasource}",template:"<os-timelines>",datasource:!0,help:"/timelines.html",resolve:{resolveTool:r}}).state("survival",{url:"/survival/{datasource}",template:"<os-survival>",datasource:!0,help:"/survival.html",resolve:{resolveTool:r}}).state("sunburst",{url:"/sunburst/{datasource}",template:"<os-sunburst>",datasource:!0,help:"/",resolve:{resolveTool:r}}).state("heatmap",{url:"/heatmap/{datasource}",template:"<os-heatmap>",datasource:!1,help:"/",resolve:{resolveTool:r}}).state("barcharts",{url:"/barchart/{datasource}",template:"<os-barchart>",datasource:!0,help:"/",resolve:{resolveTool:r}}),t.otherwise("/")}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("oncoscape").config(e)}(),function(){"use strict";angular.module("oncoscape").constant("THREE",THREE).constant("moment",moment).constant("d3",d3).constant("cytoscape",cytoscape).constant("signals",signals).constant("$",$).constant("auth",hello).constant("jStat",jStat).constant("localStorage",localStorage).constant("saveAs",saveAs).constant("TextEncoder",TextEncoder).constant("_",_)}(),function(){"use strict";function e(e){e.debugEnabled(!1)}e.$inject=["$logProvider"],angular.module("oncoscape").config(e)}(),angular.module("oncoscape").run(["$templateCache",function(e){e.put("app/components/barchart/barchart.html",'<os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-item"><br><label></label></div></div></section></os-tray><section class="tray-content-block"><div style="position:absolute;top:10px;text-align:center;width:100%;"><h2 class="h2-tool">Heatmap</h2><span class="h3-tool">{{vm.datasource.source}} {{vm.datasource.name}}</span><div id="barchart-chart"></div></div></section>'),e.put("app/components/cohortmenu/cohortmenu.html",'<div id="cohortMenu" style="display:none"><label class="tray-label tray-label-left"><i class="fa fa-chevron-right" aria-hidden="true"></i></label><div class="cohort-menu tray tray-left"><section><div class="row"><div class="col-xs-12 form-item cohortmenu-hr"><label>Selected Cohort</label><div class="input-group"><input ng-readonly="vm.cohort.type==\'ALL\'" style="background:#FFF;border-left-width:10px;border-left-color:{{vm.cohort.color}};" class="form-control" aria-label="Text input with segmented button dropdown" ng-model="vm.cohort.name" onfocus="this.select();"><div class="input-group-btn"><button type="button" class="btn btn-default" tooltip="{{vm.cohort.type == \'UNSAVED\' ? \'Save Cohort\' : \'Delete Cohort\'}}" tooltip-placement="left" ng-if="vm.cohort.type!=\'ALL\'" ng-click="vm.updateCohort()"><span class="fa {{vm.cohort.type == \'UNSAVED\' ? \'fa-plus\' : \'fa-times\'}}" aria-hidden="true"></span></button> <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" tooltip="Change Cohort" tooltip-placement="left"><span class="caret"></span> <span class="sr-only">Toggle Dropdown</span></button><ul class="dropdown-menu dropdown-menu-right" style="width:260px;padding:0px;"><li class="legend-bar markers-command hvr-sweep-to-right" style="height:25px;border-color:{{item.color}};width:100%;padding-left:10px;" ng-repeat="item in vm.cohorts" ng-click="vm.setCohort(item)">{{item.name}}</li></ul></div></div></div><div class="col-xs-12 form-item cohortmenu-hr"><label class="cohortmenu-toggle-btn" data-toggle="collapse" data-target="#cohortmenu-histogram" tooltip="Show / Hide" tooltip-placement="right">Clinical Histogram <i class="fa fa-angle-down" aria-hidden="true"></i></label><div id="cohortmenu-histogram" class="collapse in" style="background:#FFF;border:1px solid #EAEAEA;"><div id="cohortmenu-chart" style="width:100%;height:150px;"><div id="cohortmenu-single-value" class="cohortmenu-single-value"></div></div><div class="dropdown" style="width:100%"><button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" style="width:100%;border:0px solid #eaeaea;border-top-width:1px;">{{vm.cohortFeature.label}} <span class="caret"></span></button><ul class="dropdown-menu" style="width:260px;padding:0px;"><li class="markers-command hvr-sweep-to-right" ng-repeat="item in vm.cohortFeatures" ng-click="vm.cohortFeature=item">{{item.label}}</li></ul></div></div></div><div class="col-xs-12 form-item cohortmenu-hr"><label class="cohortmenu-toggle-btn" data-toggle="collapse" data-target="#cohortmenu-survival-box" tooltip="Show / Hide" tooltip-placement="right">Survival Curve <i class="fa fa-angle-down" aria-hidden="true"></i></label><div id="cohortmenu-survival-box" class="collapse in" style="background:#FFF;border:1px solid #EAEAEA;padding:5px;"><div id="cohortmenu-survival"></div><label>Cohorts</label><div ng-repeat="item in vm.cohorts" class="legend-bar markers-command hvr-sweep-to-right" style="border-color:{{item.color}};padding-left:10px;" ng-click="vm.setCohort(item)">{{item.name}}</div><label>Selected Cohort</label><div class="legend-bar markers-command hvr-sweep-to-right" style="height:25px;border-color:{{vm.cohort.color}};padding-left:10px;">{{vm.cohort.name}} ({{vm.cohort.type}})</div></div></div><div class="col-xs-12 form-item"><label class="cohortmenu-toggle-btn" data-toggle="collapse" data-target="#cohortmenu-summary-box" tooltip="Show / Hide" tooltip-placement="right">Cohort Summary <i class="fa fa-angle-down" aria-hidden="true"></i></label><div id="cohortmenu-summary-box" class="collapse in" style="background:#FFF;border:1px solid #EAEAEA;padding:5px;" ng-bind-html="vm.cohortSummary"></div></div><div id="cohortmenu-legand"></div></div><i id="cohortmenu-lock" class="fa fa-lock tray-sticky-icon" ng-click="vm.toggle()" locked="true" tooltip="Show / Hide" tooltip-placement="left"></i></section></div></div>'),e.put("app/components/colorpanel/colorpanel.html",'<div class="panel panel-default mdi" style="padding-bottom:30px;"><div class="panel-heading"><h3 class="panel-title">Patient Color Options</h3><span class="pull-right clickable" data-effect="fadeOut" ng-click="vm.close()" role="button" tabindex="0"><i class="fa fa-times"></i></span></div><div class="panel-body"><div class="row" ng-if="vm.colorOptions.length>0"><div class="col-xs-12 col-sm-9"><h3>Enter Hugo Gene(s) Seperated By + And - Operators. (eg BRCA1 + BRCA2 - p53)</h3><div class="input-group"><div class="input-group-btn"><button style="width:150px;" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{vm.colorOption.name}}&nbsp;<span class="caret"></span></button><ul class="dropdown-menu"><li ng-click="vm.colorOption=item;" ng-repeat="item in vm.colorOptions">{{item.name}}</li></ul></div><div class="input-group-btn"><button style="width:100px;" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{vm.colorScale.name}}&nbsp;<span class="caret"></span></button><ul class="dropdown-menu"><li ng-click="vm.colorScale=item;" ng-repeat="item in vm.colorScales">{{item.name}}</li></ul></div><div class="input-group-btn"><button style="width:100px;border-radius:0px;" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{vm.colorBin.name}}&nbsp;<span class="caret"></span></button><ul class="dropdown-menu"><li ng-click="vm.colorBin=item;" ng-repeat="item in vm.colorBins">{{item.name}}</li></ul></div><input ng-model="vm.geneColor" type="text" class="form-control" placeholder="Hugo Gene Symbol" style="border-right-width: 0px; border-left-width: 0px; height:33px;"> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="vm.setGeneColor()">Submit</button></span></div></div></div><div class="row"><div class="col-xs-12"><button class="btn btn-default" ng-click="vm.resetColor()">Reset Color Options</button></div></div><div ng-repeat="item in vm.optPatientColors"><br><div class="row"><div class="col-xs-12">{{item.name}}</div></div><div class="row"><div class="col-xs-4" ng-repeat="color in item.values"><a class="hvr-sweep-to-right markers-command" ng-click="vm.setColor(color)">{{color.name}}</a></div></div></div></div></div>'),e.put("app/components/datasource/datasource.html",'<section class="datasource"><div class="container"><div class="row"><div class="col-sm-12 col-md-12"><br><p style="float:right;padding-top:22px;"><a href="https://cancergenome.nih.gov/publications/publicationguidelines" target="_blank">Publication Guidelines</a></p><h1>Disease Datasets</h1></div></div><div class="row"><ul><li ng-repeat="dataset in vm.datasets" class="col-xs-12 col-sm-6 col-md-4 col-lg-3" ng-click="vm.explore(\'tools\',dataset)"><div class="datasource-btn"><img class="datasource-img" ng-src="/assets/images/img{{dataset.img}}"><p class="datasource-h1">{{dataset.name}}</p><p class="datasource-h2">{{dataset.source}} | 11-17-2016</p></div></li></ul></div></div></section>'),e.put("app/components/header/header.html",'<div id="header" class="header" style="display:none"><nav class="navbar navbar-inverse navbar-fixed-top"><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="#" style="position:relative;"><img alt="Brand" src="/assets/images/logo-white.png" class="header-logo-img"> <span class="header-logo-text">Oncoscape</span></a></div><div class="collapse navbar-collapse" id="header-navbar"><ul class="nav navbar-nav navbar-right"><li class="dropdown" ng-show="vm.showTools"><a href="" class="dropdown-toggle header-link" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-stats"></span>Tools</a><ul class="dropdown-menu row" style="max-height:80vh;overflow:scroll;"><li ng-repeat="item in vm.tools" class="col-xs-12 col-sm-6 col-lg-4" ng-click="vm.loadTool(item.route)"><div class="datasource-btn" style="color:#000"><img class="datasource-img" ng-src="/assets/images/{{item.img}}"><p class="datasource-h1">{{item.name}}</p><p class="datasource-h2">{{item.desc}}</p></div></li></ul></li><li class="dropdown" ng-show="vm.showDatasets"><a href="" class="dropdown-toggle header-link" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-th"></span>Datasets</a><ul class="dropdown-menu row" style="max-height:88vh;overflow:scroll;"><li ng-repeat="item in vm.datasources" style="padding-bottom:10px" class="col-xs-12 col-sm-6 col-lg-4" ng-click="vm.loadDataset(item.disease)"><div class="datasource-btn" style="color:#000"><img class="datasource-img" ng-src="/assets/images/img{{item.img}}"><p class="datasource-h1">{{item.name}}</p><p class="datasource-h2">{{item.source}} | 11-17-2016</p></div></li></ul></li><li class="dropdown" ng-show="vm.showDatasets"><a href="" class="dropdown-toggle header-link" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="fa fa-users"></span>Cohorts</a><div class="dropdown-menu container-fluid"><div class="row"><div ng-if="!vm.showImport" class="col-xs-12 col-sm-3" style="border:0px solid #DDD; border-right-width:1px;"><h2 style="margin-top:0px;">Create A Cohort</h2>Oncoscape allows you to pass cohorts of patients from one tool to the next. To create a cohort out of your current selection click create cohort.<br><button class="btn btn-primary" style="margin-top:15px;" ng-click="vm.addPatientCohort(); $event.stopPropagation();">Create Cohort</button> <button class="btn btn-primary" style="margin-top:15px;" ng-click="vm.showImport=true; $event.stopPropagation();">Import Cohort</button></div><div ng-if="vm.showImport" class="col-xs-12 col-sm-3" style="border:0px solid #DDD; border-right-width:1px;"><h2 style="margin-top:0px;">Import A Cohort</h2>Enter a comma seperated list of patient or sample IDs below and click import<br><input ng-model="vm.importName" type="text" class="form-control" style="margin-top:5px;" placeholder="Enter Cohort Name"> <input ng-model="vm.importIds" type="text" class="form-control" style="margin-top:5px;" placeholder="eg. TCGA-01-0110, TCGA-02-0220"> <button class="btn btn-primary" style="margin-top:15px;" ng-click="vm.importCohort(); $event.stopPropagation();">Save</button> <button class="btn btn-primary" style="margin-top:15px;" ng-click="vm.showImport=false; $event.stopPropagation();">Cancel</button></div><div class="col-xs-12 col-sm-9"><h2 style="margin-top:0px;">Your Cohorts</h2><div class="markers-command hvr-sweep-to-right header-cohort-btn" ng-repeat="item in vm.cohorts" ng-click="vm.setPatientCohort(item)"><p class="datasource-h1">{{item.name}}</p><p class="datasource-h2">{{item.numPatients}} patients<br>{{item.numSamples}} samples<br>{{item.numClinical}} clinical records</p></div></div></div></div></li><li><a href="" ng-click="vm.showHelp()" target="_blank" class="header-link"><span class="glyphicon glyphicon-question-sign"></span>Help</a></li><li><a href="http://resources.sttrcancer.org/oncoscape-contact" class="header-link"><span class="fa fa-comments"></span>Feedback</a></li><li><a href="" ng-click="vm.logout()" class="header-link"><span class="fa fa-power-off"></span>Logout</a></li></ul></div></div></nav></div>'),e.put("app/components/heatmap/heatmap.html",'<os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-item"><br><label></label></div><div class="col-xs-12 form-item"><label>Display Options</label><div class="legend-bar" style="border-color:#000;position:relative;background-color:#FFF;padding:2px 10px;line-height:25px;">Row Dendrograms <label class="switch {{item.class}}" style="float:right"><input type="checkbox" class="switch-input" ng-model="vm.rowDendrogram" ng-change="vm.draw()"> <span class="switch-label" data-on="On" data-off="Off"></span> <span class="switch-handle"></span></label></div><div class="legend-bar" style="border-color:#000;position:relative;background-color:#FFF;padding:2px 10px;line-height:25px;">Row Labels <label class="switch {{item.class}}" style="float:right"><input type="checkbox" class="switch-input" ng-model="vm.rowLabels" ng-change="vm.draw()"> <span class="switch-label" data-on="On" data-off="Off"></span> <span class="switch-handle"></span></label></div><div class="legend-bar" style="border-color:#000;position:relative;background-color:#FFF;padding:2px 10px;line-height:25px;">Column Dendrograms <label class="switch {{item.class}}" style="float:right"><input type="checkbox" class="switch-input" ng-model="vm.colDendrogram" ng-change="vm.draw()"> <span class="switch-label" data-on="On" data-off="Off"></span> <span class="switch-handle"></span></label></div><div class="legend-bar" style="border-color:#000;position:relative;background-color:#FFF;padding:2px 10px;line-height:25px;">Column Labels <label class="switch {{item.class}}" style="float:right"><input type="checkbox" class="switch-input" ng-model="vm.colLabels" ng-change="vm.draw()"> <span class="switch-label" data-on="On" data-off="Off"></span> <span class="switch-handle"></span></label></div><div class="legend-bar" style="border-color:#000;position:relative;background-color:#FFF;padding:2px 10px;line-height:25px;">Grid Lines <label class="switch {{item.class}}" style="float:right"><input type="checkbox" class="switch-input" ng-model="vm.gridlines" ng-change="vm.draw()"> <span class="switch-label" data-on="On" data-off="Off"></span> <span class="switch-handle"></span></label></div></div><div class="col-xs-12 form-item"><label>Color Scheme</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.colorScheme.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li ng-repeat="item in vm.colorSchemes" ng-click="vm.colorScheme=item;vm.draw()">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Scale</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.scale.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li ng-repeat="item in vm.scales" ng-click="vm.scale=item;vm.loadHeatmap()">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Dendrogram Clusters</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.dendrogramCluster.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li ng-repeat="item in vm.dendrogramClusters" ng-click="vm.dendrogramCluster=item;vm.loadHeatmap()">{{item.name}}</li></ul></div></div></div></section></os-tray><section class="tray-content-block"><div style="position:absolute;top:10px;text-align:center;width:100%;"><h2 class="h2-tool">Heatmap</h2><span class="h3-tool">{{vm.datasource.source}} {{vm.datasource.name}}</span><div id="heatmap-chart" style="position:relative"></div><div id="tooltip" class="hidden"><p><span id="value"></span></p></div></div></section>'),e.put("app/components/help/help.html",'<div class="help"><iframe src="http://resources.sttrcancer.org/pca?embed=true"></iframe></div>'),e.put("app/components/landing/landing.html",'<div class="landing"><header class="landing container"><div class="row marquee marquee-bg"><div class="col-sm-12"><div class="marquee-x"></div><div class="header-content" style="text-align:center;z-index: 999;pointer-events:none;"><h1 class="landing-h1">Oncoscape</h1><p class="landing-h2">Cancer Explorer</p><span class="landing-buttons" style="pointer-events:all;"><a class="btn btn-outline btn-xl page-scroll" ng-click="vm.getStarted()">Explore</a> <a class="btn btn-outline btn-xl page-scroll" href="/documentation/" target="_blank">Learn More</a></span></div></div></div></header><div class="container-fluid" style="background-color:#000; color:#FFF;padding-top:150px;padding-bottom:150px;"><div class="row"><div class="col-xs-12 col-sm-7"><h1 style="font-size:50px;pointer-events:none;">Our Mission</h1><p style="font-size:30px;line-height:50px;">Empower researchers to discover novel patterns and relationships between clinical and molecular factors.</p><a class="btn btn-outline btn-xl page-scroll" href="http://cancergenome.nih.gov/publications/publicationguidelines">Publishing Guidelines</a></div><div class="hidden-xs col-sm-5" style="text-align:center"><img src="assets/images/thumb.png" class="img-responsive" alt="" style="display:inline-block;height:100%;"></div></div></div></div>'),e.put("app/components/layoutpanel/layoutpanel.html",'<div class="panel panel-default mdi" style="padding-bottom:30px;"><div class="panel-heading"><h3 class="panel-title">Patient Color Options</h3><span class="pull-right clickable" data-effect="fadeOut" ng-click="vm.close()" role="button" tabindex="0"><i class="fa fa-times"></i></span></div><div class="panel-body"><div class="row" ng-if="vm.colorOptions.length>0"><div class="col-xs-12 col-sm-9"><h3>Enter Hugo Gene(s) Seperated By + And - Operators. (eg BRCA1 + BRCA2 - p53)</h3><div class="input-group"><div class="input-group-btn"><button style="width:150px;" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{vm.colorOption.name}}&nbsp;<span class="caret"></span></button><ul class="dropdown-menu"><li ng-click="vm.colorOption=item;" ng-repeat="item in vm.colorOptions">{{item.name}}</li></ul></div><div class="input-group-btn"><button style="width:100px;" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{vm.colorScale.name}}&nbsp;<span class="caret"></span></button><ul class="dropdown-menu"><li ng-click="vm.colorScale=item;" ng-repeat="item in vm.colorScales">{{item.name}}</li></ul></div><div class="input-group-btn"><button style="width:100px;border-radius:0px;" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{vm.colorBin.name}}&nbsp;<span class="caret"></span></button><ul class="dropdown-menu"><li ng-click="vm.colorBin=item;" ng-repeat="item in vm.colorBins">{{item.name}}</li></ul></div><input ng-model="vm.geneColor" type="text" class="form-control" placeholder="Hugo Gene Symbol" style="border-right-width: 0px; border-left-width: 0px; height:33px;"> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="vm.setGeneColor()">Submit</button></span></div></div></div><div class="row"><h3 class="col-sm-3" ng-repeat="item in vm.optPatientColors">{{item.name}}<br><div ng-repeat="color in item.values"><a href="" style="font-size:12px;" class="hvr-sweep-to-right markers-command" ng-click="vm.setColor(color)">{{color.name}}</a></div></h3></div></div><div style="position:absolute;bottom:0px;width:100%;padding:10px;font-size:10px;text-align:center;">Percentages Indicate Data Availibility</div></div>'),
e.put("app/components/compareclusters/compareclusters.html",'<os-tray caption="Patients" content="tray-content-block"><section class="tray-content"><div class="row"><br><br><div ng-if="vm.legendCaption.length>0" class="col-xs-12 form-item"><label>Patient {{vm.legendCaption}}</label><div ng-repeat="item in vm.legendNodes" class="legend-bar" style="border-color:{{item.color}};position:relative;background-color:#FFF;padding:2px 10px;line-height:25px;">{{item.name}}</div></div><div class="col-xs-12 form-item"><label>Patient</label> <button class="btn btn-default btn-no-focus" type="button" style="width:100%;font-weight: 300;" ng-click="vm.showPanelColor = true">Color Options</button></div><div class="col-xs-12 form-item"><label>Grid</label> <button class="btn btn-default btn-no-focus" type="button" style="width:100%;font-weight: 300;" ng-click="vm.showPanelColor = true">Layout Options</button></div></div></section></os-tray><section class="tray-content-block"><div style="position:absolute;top:10px;text-align:center;width:100%;"><h2 class="h2-tool">Compare Clusters</h2><span class="h3-tool">{{vm.datasource.source}} {{vm.datasource.name}}</span><br><div id="compareclusterChart" class="pca"></div></div></section>'),e.put("app/components/loader/loader.html",'<div class="loader-modal"><div class="loader"><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__bar"></div><div class="loader__ball"></div></div></div>'),e.put("app/components/login/login.html",'<form class="login"><div class="login-body"><h3 class="login-header">Sign in</h3><div ng-repeat="item in vm.networks" class="login-option" ng-click="vm.login(item);"><span class="{{item.icon}} login-icon"></span> {{item.name}}</div></div></form>'),e.put("app/components/markers/markers.html",'<os-tray content="tray-content-block" change="vm.resize()"><section class="tray-content"><div class="row"><div class="col-xs-12 form-item"><label>Edge Visibility</label><div class="legend-bar-container"><div ng-repeat="item in vm.optEdgeColors" class="legend-bar" style="border-color:{{item.color}};position:relative;background-color:#FFF;padding:2px 10px;line-height:25px;">{{item.name}} {{item.count}} <label class="switch" style="float:right" tooltip="Toggle Visibility" tooltip-placement="left"><input type="checkbox" class="switch-input" ng-model="item.show" ng-change="vm.edgeToggle(item)"> <span class="switch-label" data-on="On" data-off="Off"></span> <span class="switch-handle"></span></label></div></div></div><div ng-if="vm.legendNodes.length>0" class="col-xs-12 form-item"><label>Patient {{vm.legendCaption}}</label><div class="legend-bar-container"><div ng-repeat="item in vm.legendNodes" class="legend-bar legend-bar-button" style="border-color:{{item.color}};">{{item.name}}<span id="{{item.id}}" class="legend-count"></span> <label style="float:right;padding-top:5px;" class="btn-group"><button tooltip="Deselect" tooltip-placement="left" ng-click="vm.deselectColor(item)" class="btn btn-xs btn-default" style="background-color:#039BE5;color:#FFF;text-shadow: 0 1px rgba(0, 0, 0, 0.2);width:24px;margin-right:1px;"><i class="fa fa-circle-o"></i></button> <button tooltip="Select" tooltip-placement="left" ng-click="vm.selectColor(item)" class="btn btn-xs btn-default" style="background-color:#039BE5;color:#FFF;text-shadow: 0 1px rgba(0, 0, 0, 0.2);width:24px;margin-left:1px;"><i class="fa fa-dot-circle-o"></i></button></label></div></div></div><div class="col-xs-12 form-item"><label>Patient Options</label><div class="btn-group" role="group" style="display: block"><button class="btn btn-default btn-no-focus" type="button" style="width:50%; font-weight: 300;" title="Zoom Reset" ng-click="vm.showPanelLayout = true">Layouts</button> <button class="btn btn-default btn-no-focus" type="button" style="width:50%; font-weight: 300;" title="Zoom Selection" ng-click="vm.showPanelColor = true">Colors</button></div></div><div class="col-xs-12 form-item"><label>Gene Set</label><div class="input-group"><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="padding-right:30px;">{{vm.optGeneSet.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li class="markers-command hvr-sweep-to-right" ng-repeat="item in vm.optGeneSets" ng-click="vm.optGeneSet=item" tooltip="{{item.tip}}" tooltip-placement="bottom">{{item.name}}</li></ul></div><div class="input-group-addon btn-help-icon"><a href="http://resources.sttrcancer.org/api/#gene-sets" target="_blank"><i style="color:#000" class="glyphicon glyphicon-question-sign"></i></a></div></div></div><div class="col-xs-6 form-item" style="padding-right:5px"><label>Command Mode</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="padding-right:30px;">{{vm.optCommandMode.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li class="markers-command hvr-sweep-to-right" ng-repeat="item in vm.optCommandModes" ng-click="vm.optCommandMode=item">{{item.name}}</li></ul></div></div><div class="col-xs-6 form-item" style="padding-left:5px"><label>Search {{vm.searchCount}}</label><div class="input-group"><input type="text" class="form-control" ng-model="vm.search" ng-enter="vm.exeSearch()" placeholder=""><div class="input-group-addon btn-help-icon" ng-click="vm.exeSearch()">Go</div></div><label>{{vm.searchNotFound}}</label></div><div class="col-xs-12 form-item" ng-if="vm.optCommandMode.name==\'Sequential\'"><label>Commands</label><br><a ng-click="vm.cmd(\'ShowSelectedEdges\')" class="markers-command hvr-sweep-to-right">Show Edges of Selected</a> <a ng-click="vm.cmd(\'HideSelectedEdges\')" class="markers-command hvr-sweep-to-right">Hide Edges of Selected</a> <a ng-click="vm.cmd(\'HideUnselectedEdges\')" class="markers-command hvr-sweep-to-right">Hide Edges of Unselected</a> <a ng-click="vm.cmd(\'HideAllEdges\')" class="markers-command hvr-sweep-to-right">Hide All Edges</a> <a ng-click="vm.cmd(\'SelectInverse\')" class="markers-command hvr-sweep-to-right">Invert Node Selection</a> <a ng-click="vm.cmd(\'SelectConnected\')" class="markers-command hvr-sweep-to-right">Select Connected Nodes</a> <a ng-click="vm.cmd(\'HideUnselectedNodes\')" class="markers-command hvr-sweep-to-right">Hide Unselected Nodes</a> <a ng-click="vm.cmd(\'ShowAllNodes\')" class="markers-command hvr-sweep-to-right">Show All Nodes</a></div><div class="col-xs-12 form-item"><label>View Selected Genes Using</label> <a ng-click="vm.cmd(\'LaunchCbio\')" class="markers-command hvr-sweep-to-right">cBioPortal</a> <a ng-click="vm.cmd(\'LaunchPwc\')" class="markers-command hvr-sweep-to-right">Pathway Commons</a> <a ng-click="vm.cmd(\'LaunchGeneCards\')" class="markers-command hvr-sweep-to-right">Gene Cards</a></div><div class="col-xs-12 form-item"><label>Lock Selections</label><div class="btn-group" role="group" style="display: block"><button class="btn btn-default btn-no-focus" type="button" ng-click="vm.lock(\'patient\')" style="width:50%; font-weight: 300;" title="Patient Selection Lock"><i class="fa fa-unlock" ng-show="!vm.lockPatients"></i> <i class="fa fa-lock" ng-show="vm.lockPatients"></i> Patients</button> <button class="btn btn-default btn-no-focus" type="button" ng-click="vm.lock(\'gene\')" style="width:50%; font-weight: 300;" title="Gene Selection Lock"><i class="fa fa-unlock" ng-show="!vm.lockGenes"></i> <i class="fa fa-lock" ng-show="vm.lockGenes"></i> Genes</button></div></div><div class="col-xs-12 form-item"><label>Zoom</label><div class="btn-group" role="group" style="display: block"><button class="btn btn-default btn-no-focus" type="button" ng-click="vm.zoom.reset()" style="width:50%; font-weight: 300;" title="Zoom Reset">Fit</button> <button class="btn btn-default btn-no-focus" type="button" ng-click="vm.zoom.fit()" style="width:50%; font-weight: 300;" title="Zoom Selection">Selected</button></div></div></div></section></os-tray><section class="tray-content-block"><div id="markers-chart" class="markers-chart"></div><div style="position:absolute;top:10px;text-align:center;width:100%;"><h2 class="h2-tool">Markers + Patients</h2><span class="h3-tool">{{vm.datasource.source}} {{vm.datasource.name}}</span><div style="margin-top:10px;"><div><b>Clustered Samples (left)</b>: {{vm.optPatientLayout.name}}</div><div><b>Geneset on Chromosome (right)</b>: {{vm.optGeneSet.name}}</div><div><i>node sizes are relative to the number of alterations</i></div></div></div></section><div id="modalEdge" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-body"><h2 style="margin-top:0px;">Your request would add {{vm.edgeCounts.total}} edges to the graph.</h2><p>To improve performance + readability you may want to disable some of the edges.</p><div class="legend" ng-repeat="item in vm.optEdgeColors | filter:{show:true}"><label class="switch"><input type="checkbox" class="switch-input" ng-model="item.show"> <span class="switch-label" data-on="On" data-off="Off"></span> <span class="switch-handle"></span></label> <span style="padding-left:20px;">{{item.name}} ({{vm.edgeCounts[item.abv]}})</span></div></div><div style="position:absolute;right:10px;bottom:10px;"><button class="btn btn-default" ng-click="vm.hideModal()">Cancel</button> <button class="btn btn-primary" ng-click="vm.filterModelEdge()">Continue</button></div></div></div></div><os-color-panel ng-if="vm.showPanelColor" close="vm.showPanelColor=false"></os-color-panel><div class="panel panel-default mdi" ng-if="vm.showPanelLayout"><div class="panel-heading"><h3 class="panel-title">Patient Layout</h3><span class="pull-right clickable" data-effect="fadeOut" ng-click="vm.showPanelLayout=false"><i class="fa fa-times"></i></span></div><div class="panel-body"><div class="row"><table class="tbl"><thead><tr><th>Method</th><th>Gene Set</th><th>Input Data</th><th>Data Source</th></tr></thead><tbody><tr ng-repeat="item in vm.optPatientLayouts" ng-click="vm.optPatientLayout=item;vm.showPanelLayout=false;"><td>{{item.dataType}}</td><td>{{item.geneset}}</td><td>{{item.input}}</td><td>{{item.source}}</td></tr></tbody></table></div></div></div>'),e.put("app/components/pathways/pathways.html",'<os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><br><br><div class="col-xs-12 form-item"><label>Search</label> <input type="text" class="form-control" ng-model="vm.search"></div><div class="col-xs-12 form-label"><h2>Legend</h2><span class="legend-bar" style="border-color: green">Activation</span> <span class="legend-bar" style="border-color: red">Inhibition</span> <span class="legend-bar" style="border-color: #38347B">Modification</span> <span class="legend-bar" style="border-color: #056ce1">Genes</span></div></div></section></os-tray><section class="tray-content-block" style="padding-right:0px;"><div id="pathways-chart" class="pathways-chart"></div><div style="position:absolute;top:10px;text-align:center;width:100%;"><h2 class="h2-tool">Pathways</h2><span class="h3-tool">{{vm.datasource.source}} {{vm.datasource.name}}</span></div></section><div class="modal fade pathways" id="gbm-webpage" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">{{vm.tip}}</h4></div><iframe class="modal-iframe" ng-src="{{vm.frame}}"></iframe></div></div></div>'),e.put("app/components/pca/pca.html",'<os-tray content="tray-content-block"><section class="tray-content"><div class="row"><div class="col-xs-12 form-item"><label>Data Source</label><div class="input-group"><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.source.name}}<span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:260px;"><li tooltip="{{item.tip}}" tooltip-placement="bottom" class="markers-command hvr-sweep-to-right" ng-repeat="item in vm.sources" ng-click="vm.source=item">{{item.name}}</li></ul></div><div class="input-group-addon btn-help-icon"><a href="http://resources.sttrcancer.org/api/#data-content" target="_blank"><i style="color:#000" class="glyphicon glyphicon-question-sign"></i></a></div></div></div><div class="col-xs-12 form-item"><label>Data Type</label><div class="input-group"><div class="dropdown bs-dropdown"><button style="max-width:220px" class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.pcaType.name}}<span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:260px;"><li class="markers-command hvr-sweep-to-right" ng-repeat="item in vm.pcaTypes" ng-click="vm.pcaType=item" tooltip="{{item.tip}}" tooltip-placement="bottom">{{item.name}}</li></ul></div><div class="input-group-addon btn-help-icon"><a href="http://resources.sttrcancer.org/api/#molecular-data" target="_blank"><i style="color:#000" class="glyphicon glyphicon-question-sign"></i></a></div></div></div><div class="col-xs-12 form-item"><label>Gene Set</label><div class="input-group"><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.geneSet.name}}<span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:260px;"><li tooltip="{{item.tip}}" tooltip-placement="bottom" class="markers-command hvr-sweep-to-right" ng-repeat="item in vm.geneSets" ng-click="vm.geneSet=item">{{item.name}}</li></ul></div><div class="input-group-addon btn-help-icon"><a href="http://resources.sttrcancer.org/api/#gene-sets" target="_blank"><i style="color:#000" class="glyphicon glyphicon-question-sign"></i></a></div></div></div><div ng-if="vm.legendCaption.length>0" class="col-xs-12 form-item"><label>Patient {{vm.legendCaption}}</label><div ng-repeat="item in vm.legendNodes" class="legend-bar legend-bar-button" style="border-color:{{item.color}};">{{item.name}}<span id="{{item.id}}" class="legend-count"></span> <label style="float:right;padding-top:5px;" class="btn-group"><button tooltip="Deselect" tooltip-placement="left" ng-click="vm.deselectColor(item)" class="btn btn-xs btn-default" style="background-color:#47a8d8;color:#FFF;text-shadow: 0 1px rgba(0, 0, 0, 0.2);width:24px;margin-right:1px;"><i class="fa fa-circle-o"></i></button> <button tooltip="Select" tooltip-placement="left" ng-click="vm.selectColor(item)" class="btn btn-xs btn-default" style="background-color:#47a8d8;color:#FFF;text-shadow: 0 1px rgba(0, 0, 0, 0.2);width:24px;margin-left:1px;"><i class="fa fa-dot-circle-o"></i></button></label></div></div><div class="col-xs-12 form-item"><label>Patient</label> <button class="btn btn-default btn-no-focus" type="button" style="width:100%;font-weight: 300;" ng-click="vm.showPanelColor = true">Color Options</button></div><div class="col-xs-12 form-item"><label>Percent Variance Explained</label><div id="percVar" style="border: 1px solid #EAEAEA;background: #FFF;"></div></div></div></section></os-tray><section class="tray-content-block"><div class="tool-container"><h2 class="h2-tool">Principal Component Analysis</h2><span class="h3-tool">{{vm.datasource.source}} {{vm.datasource.name}}</span><div id="pca-chart" class="pca"></div></div></section><os-color-panel ng-if="vm.showPanelColor" close="vm.showPanelColor=false"></os-color-panel>'),e.put("app/components/plsr/plsr.html",'<os-tool-menu datasource="{{vm.datasource}}" change="vm.addCohortGene()"></os-tool-menu><os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-label"><h2>Filters</h2></div><div class="col-xs-12 form-item"><label>Gene Set</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.geneSet}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li ng-repeat="item in vm.geneSets" ng-click="vm.geneSet=item">{{item}}</li></ul></div></div><div class="col-xs-12 form-item"><label>Age At Diagnosis</label><div range-slider="" min="vm.deathMinValue" model-min="vm.deathMinFilter" max="vm.deathMaxValue" model-max="vm.deathMaxFilter" prevent-equal-min-max="true" show-values="true" attach-handle-values="true" on-handle-up="vm.update()"></div></div><div class="col-xs-12 form-item"><label>Survival</label><div range-slider="" min="vm.survivalMinValue" model-min="vm.survivalMinFilter" max="vm.survivalMaxValue" model-max="vm.survivalMaxFilter" prevent-equal-min-max="" show-values="true" attach-handle-values="true" on-handle-up="vm.update()"></div></div><div class="col-xs-12 form-label"><h2>Legend</h2><span class="legend-bar" style="border-color: #1396de">Age At Diagnosis</span> <span class="legend-bar" style="border-color: #38347b">Survial</span> <span class="legend"><span class="legend-dot" style="background-color:#000"></span>Genes</span></div></div></section></os-tray><section class="tray-content-block"><div class="container-fluid"><h2 class="h2-tool">Partial Least Squares Regression</h2><h3 class="h3-datasource">{{vm.datasource}}</h3><div id="plsr-chart" class="plsr"></div></div></section><div class="modal fade plsr-webpage" id="plsr-webpage" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">{{vm.tip}}</h4></div><iframe class="modal-iframe" ng-src="{{vm.frame}}"></iframe></div></div></div>'),e.put("app/components/scatter/scatter.html",'<os-tray content="tray-content-block"><section class="tray-content"><div class="row"><div class="col-xs-12 form-item"><label>Cluster</label><div class="input-group"><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" style="max-width: 220px;" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.layout.name}}<span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li ng-repeat="item in vm.layouts" ng-click="vm.setLayout(item)">{{item.name}}</li></ul></div><div class="input-group-addon btn-help-icon"><a href="http://resources.sttrcancer.org/api/#gene-sets" target="_blank"><i style="color:#000" class="glyphicon glyphicon-question-sign"></i></a></div></div></div><div class="col-xs-12 form-item"><label>3D View</label><div style="background-color:#FFF; border: 1px solid #EAEAEA;cursor: hand;position: relative;width:260px;height:260px;"><div id="scatter-chart" class="scatter"></div></div></div><div class="col-xs-12 form-item"><label>Variance Explained</label><div><os-tray-piechart chart-data1="vm.pc1" chart-data2="vm.pc2" chart-height="130"></os-tray-piechart><div class="pca-pc1-label"><span>PC1</span><br>{{vm.pc1[0].value}}%</div><div class="pca-pc2-label"><span>PC2</span><br>{{vm.pc2[0].value}}%</div></div></div><div class="col-xs-12 form-item"><label>Loadings</label><os-tray-barchart chart-data="vm.loadings" chart-height="100"></os-tray-barchart></div></div></section></os-tray><section class="tray-content-block"><div class="tool-container"><h2 class="h2-tool">3D Scatter Analysis</h2><span class="h3-tool">{{vm.datasource.source}} {{vm.datasource.name}}</span><div id="scatter-select-controller" style="position:absolute;width:100%;height:100%;"></div><div id="scatter-axis-controller"></div></div></section><os-color-panel ng-if="vm.showPanelColor" close="vm.showPanelColor=false"></os-color-panel>'),e.put("app/components/spreadsheet/spreadsheet.html",'<os-tray caption="Patients" content="tray-content-block"><section class="tray-content"><div class="row"><div class="col-xs-12 form-item"><label>Clinical Collections</label><div class="input-group"><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.collection.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:260px;"><li class="markers-command hvr-sweep-to-right" ng-repeat="item in vm.collections" ng-click="vm.collection=item">{{item.name}}</li></ul></div><div class="input-group-addon btn-help-icon"><a style="color:#000;" href="http://resources.sttrcancer.org/api/#clinical-data" target="_blank"><i class="glyphicon glyphicon-question-sign"></i></a></div></div></div><div class="col-xs-12 form-item"><label>Click To Export</label><div class="btn-group" role="group" style="display: block"><button class="btn btn-default btn-no-focus" type="button" style="width: 100%;font-weight: 300;" ng-click="vm.exportCsv(\'all\')">Export {{vm.collection.name}} data</button></div></div></div></section></os-tray><section class="tray-content-block"><div class="tool-container"><h2 class="h2-tool">Spreadsheet</h2><span class="h3-tool">{{vm.datasource.source}} {{vm.datasource.name}}</span> <button ng-click="vm.sortSelected()" class="btn btn-default" style="position:absolute; left: 310px;top: 30px;" tooltip="Move Selected Rows To The Top Of The Grid" tooltip-placement="right">Selected On Top</button> <button ng-click="vm.showPanelColumns=true" class="btn btn-default" style="position:absolute; right: 310px;top: 30px;" tooltip="Toggle Columns On + Off" tooltip-placement="right">Select Columns</button><div class="grid" id="spreadsheet-grid" ui-grid="vm.options" ui-grid-selection="" ui-grid-resize-columns="" ui-grid-move-columns="" ui-grid-pinning="" ui-grid-grouping=""></div></div></section><div class="panel panel-default mdi" ng-if="vm.showPanelColumns"><div class="panel-heading"><h3 class="panel-title">Visible Columns</h3><span class="pull-right clickable" data-effect="fadeOut" ng-click="vm.closePanelColumns()"><i class="fa fa-times"></i></span></div><div class="panel-body" style="padding-top:0px;"><div class="row"><br><div class="col-xs-12"><button class="btn btn-default btn-no-focus" type="button" ng-click="vm.showColumns()">Select All</button> <button class="btn btn-default btn-no-focus" type="button" ng-click="vm.hideColumns()">Deselect All</button></div></div><div class="row"><div class="col-md-4" ng-repeat="col in vm.options.columnDefs | orderBy:\'name\'" style="text-transform:capitalize;"><div class="checkbox" style="margin-bottom:0px"><label><input type="checkbox" ng-model="col.visible">{{col.name}}</label></div></div></div></div></div>'),e.put("app/components/sunburst/sunburst.html",'<os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><br><br><div class="col-xs-12 form-item"><label>Patient</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.patient.patient_ID}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li ng-repeat="item in vm.patients">{{item.patient_ID}}</li></ul></div></div><div class="col-xs-12 form-item" ng-repeat="chart in vm.charts"><label>{{chart.name}}</label><div ng-repeat="group in chart.groups" class="legend-bar" style="border-color:#FFF;position:relative;background-color:#FFF;padding:2px 10px;line-height:25px;"><label class="switch" style="float:right"><input type="checkbox" class="switch-input" ng-model="group.show" ng-change="vm.draw()"> <span class="switch-label" data-on="On" data-off="Off"></span> <span class="switch-handle"></span></label> {{group.name}}<div ng-repeat="tag in group.tags" class="legend-bar" style="border-color:{{tag.color}}; position: relative; padding: 2px 10px; line-height: 25px; background-color: rgb(255, 255, 255);">{{tag.name}}</div></div></div></div></section></os-tray><section class="tray-content-block"><div style="position:absolute;top:10px;text-align:center;width:100%;"><h2 class="h2-tool">Sunburst</h2><span class="h3-tool">{{vm.datasource.source}} {{vm.datasource.name}}</span><div id="sunburst-chart"></div></div></section>'),e.put("app/components/survival/survival.html",'<os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-12 form-item" ng-if="vm.cohortsLegend.length>0"><label>Cohorts</label><div ng-repeat="cohort in vm.cohortsLegend track by $index" class="legend-bar" style="border-color:{{cohort.color}};position:relative;background-color:#FFF;padding:2px 10px;line-height:25px;"><span>{{cohort.name}}</span> <label class="switch {{item.class}}" style="float:right"><input type="checkbox" class="switch-input" ng-model="cohort.show" ng-change="vm.toggle(cohort)"> <span class="switch-label" data-on="On" data-off="Off"></span> <span class="switch-handle"></span></label></div></div><div class="col-xs-12 form-item"><label>Selected Cohort</label><div class="legend-bar" style="border-color:{{vm.cohort.color}};position:relative;background-color:#FFF;padding:2px 10px;line-height:25px;"><span>{{vm.cohort.name}} (selected)</span></div><br><label>P-Values for Selected Cohort</label><div class="tray-chart"><div ng-repeat="p in vm.pValues track by $index" style="height:25px;line-height:25px;margin-bottom:1px;">&nbsp; {{p.p}}<div ng-repeat="c in p.c track by $index" style="background-color:{{c}};width:10px;height:25px;margin-right:1px;display:inline-block;float:left;"></div></div></div></div></div></section></os-tray><section class="tray-content-block survival"><div style="position:absolute;top:10px;text-align:center;width:100%;"><h2 class="h2-tool">Survival Curves</h2><span class="h3-tool">{{vm.datasource.source}} {{vm.datasource.name}}</span><div id="survival-chart"></div></div></section>'),e.put("app/components/timelines/timelines.html",'<os-tray content="tray-content-block" change="vm.resize($event)"><section class="tray-content"><div class="row"><div class="col-xs-6 form-item" style="padding-right:5px"><label>Align By</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.align.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li class="markers-command hvr-sweep-to-right" ng-repeat="item in vm.events track by $index" ng-click="vm.align=item; vm.update();">{{item.name}}</li></ul></div></div><div class="col-xs-6 form-item" style="padding-left:5px"><label>Order By</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.sort.name}} <span class="caret"></span></button><ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1" style="width:100%"><li class="markers-command hvr-sweep-to-right" ng-repeat="item in vm.events track by $index" ng-click="vm.sort=item; vm.update();">{{item.name}}</li></ul></div></div><div class="col-xs-6 form-item" style="padding-right:5px"><label>Patient Status</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.filter.name}} <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="width:100%"><li class="markers-command hvr-sweep-to-right" ng-repeat="item in vm.filters" ng-click="vm.filter=item;vm.update();">{{item.name}}</li></ul></div></div><div class="col-xs-6 form-item" style="padding-left:5px"><label>Timescale</label><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{vm.timescale.name}} <span class="caret"></span></button><ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1" style="width:100%"><li class="markers-command hvr-sweep-to-right" ng-repeat="item in vm.timescales" ng-click="vm.timescale=item;vm.update();">{{item.name}}</li></ul></div></div><div class="col-xs-12 form-item"><div class="dropdown bs-dropdown"><button class="btn btn-default dropdown-toggle" type="button" ng-click="vm.resetZoom()" style="text-align:center;">Clear Selection + Reset Zoom</button></div></div><div class="col-xs-12 form-item"><label>Events</label><div ng-repeat="item in vm.events track by $index" class="legend-bar" style="border-color:{{item.color}};position:relative;background-color:#FFF;padding:2px 10px;line-height:25px;">{{item.name}} <label class="switch {{item.class}}" style="float:right"><input type="checkbox" class="switch-input" ng-model="item.selected" ng-change="vm.update();"> <span class="switch-label" data-on="On" data-off="Off"></span> <span class="switch-handle"></span></label></div></div></div></section></os-tray><section class="tray-content-block"><div style="position:absolute;top:10px;text-align:center;width:100%;"><h2 class="h2-tool">Timelines</h2><span class="h3-tool">{{vm.datasource.source}} {{vm.datasource.name}}</span><div class="timelines-content" style="margin-top:20px;"></div></div></section>'),e.put("app/components/tools/tools.html",'<section class="datasource"><div class="container"><div class="row"><div class="col-sm-12 col-md-8"><br><h1>Analysis Tools</h1></div></div><div class="row"><ul><li ng-repeat="tool in vm.tools" class="col-xs-12 col-sm-6 col-md-4" ng-click="vm.explore(tool.route)"><div class="datasource-btn"><img class="datasource-img" ng-src="/assets/images/{{tool.img}}"><p class="datasource-h1" style="padding-top:10px;">{{tool.name}}</p><p class="datasource-h2">{{tool.desc}}</p></div></li></ul></div></div></section>'),e.put("app/components/tray/tray.html",'<div><label class="tray-label tray-label-right"><i class="fa fa-chevron-left" aria-hidden="true"></i></label><div class="tray {{vm.trayClass}} tray-right" locked="true"><ng-transclude></ng-transclude><i class="fa fa-lock tray-sticky-icon {{vm.iconClass}}" ng-click="vm.toggle()" tooltip="Show / Hide" tooltip-placement="left"></i></div></div>')}]);
//# sourceMappingURL=../maps/scripts/app-a26054a065.js.map
